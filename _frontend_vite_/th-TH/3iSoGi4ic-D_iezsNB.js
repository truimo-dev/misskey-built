import{a as f}from"./3iSoGi4ic-DUrJvqB4.js";import{M as p}from"./3iSoGi4ic-CteuwjJ2.js";import{az as k,J as v}from"./3iSoGi4ic-DV-GuiCp.js";import{b as C,c as x,u as g,z as U,f as b,i as c,h as r,p as a,B as w,l as B,C as y,E as l}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const T=C({__name:"miauth",props:{session:{},callback:{},name:{},icon:{},permission:{}},setup(o){const e=o,n=x(()=>e.permission?e.permission.split(",").filter(t=>f.includes(t)):[]),s=g("authRoot");async function m(t){await v("miauth/gen-token",{session:e.session,name:e.name,iconUrl:e.icon,permission:n.value},t).then(()=>{if(e.callback&&e.callback!==""){const i=new URL(e.callback);if(["javascript:","file:","data:","mailto:","tel:","vbscript:"].includes(i.protocol))throw new Error("invalid url");i.searchParams.set("session",e.session),window.location.href=i.toString()}else s.value?.showUI("success")}).catch(()=>{s.value?.showUI("failed")})}function u(){s.value?.showUI("denied")}return k(()=>({title:"MiAuth",icon:"ti ti-apps"})),(t,i)=>{const d=U("PageWithAnimBg");return c(),b(d,null,{default:r(()=>[a("div",{class:"xiCGc"},[a("div",{class:"xCfDd"},[w(p,{ref_key:"authRoot",ref:s,name:o.name,icon:o.icon||void 0,permissions:n.value,onAccept:m,onDeny:u},{consentAdditionalInfo:r(()=>[o.callback!=null?(c(),B("div",{key:0,class:"_gaps_s xoQBU"},[a("div",null,l("หากอนุญาตการเข้าถึง ระบบจะเปลี่ยนเส้นทางไปยัง URL ด้านล่างโดยอัตโนมัติ"),1),a("div",{class:"_monospace xktfA"},l(o.callback),3)],2)):y("",!0)]),_:1},8,["name","icon","permissions"])],2)],2)]),_:1})}}});export{T as default};
