import N from"./3iSoGi4ic-CBiS4VhD.js";import{Q as Z,j as B,l as H,b6 as Y,bm as L,A as G,b as J,a7 as E,ag as K,ab as g,R as X,ad as h,C as ee,a8 as le,k as ae}from"./3iSoGi4ic-DV-GuiCp.js";import{ImageFrameRenderer as F}from"./3iSoGi4ic-CXdqbDJK.js";import{M as S}from"./3iSoGi4ic-Fx-BY70c.js";import{M as c}from"./3iSoGi4ic-CSc4cSLM.js";import{M}from"./3iSoGi4ic-BDF7xMl0.js";import{b as te,r as oe,u as I,w as P,a as ie,e as se,n as ne,o as re,f as me,i as O,h as n,p as l,g as A,t as de,l as ue,C as pe,E as t,B as d,D as o}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-C_KRNUC8.js";import"./3iSoGi4ic-BmLZI3Ia.js";const ge={class:"_spacer _gaps"},ve={class:"_gaps"},be={class:"_gaps"},Te=te({__name:"MkImageFrameEditorDialog",props:{presetEditMode:{type:Boolean},preset:{},params:{},image:{},imageCaption:{},imageFilename:{}},emits:["ok","presetOk","cancel","closed"],setup(R,{emit:j}){Z();const u=R,V=B(u.preset)??{id:H(),name:""},i=oe(B(u.params)??{borderThickness:.05,borderRadius:0,labelTop:{enabled:!1,scale:1,padding:.2,textBig:"",textSmall:"",centered:!1,withQrCode:!1},labelBottom:{enabled:!0,scale:1,padding:.2,textBig:"{year}/{0month}/{0day}",textSmall:"{camera_mm}mm   f/{camera_f}   {camera_s}s   ISO{camera_iso}",centered:!1,withQrCode:!0},bgColor:[1,1,1],fgColor:[0,0,0],font:"sans-serif"}),w=j,_=I("dialog");async function D(){if(u.presetEditMode){const{canceled:r}=await ee({type:"question",text:"Discard unsaved changes?"});if(r)return}_.value?.close()}const Q=Y(50,()=>{m?.render(i)});P(i,async(r,e)=>{Q()},{deep:!0});const v=I("canvasEl"),C=new Image;C.src="/client-assets/sample/3-2.jpg";const W=new Promise(r=>{C.onload=()=>r()}),k=new Image;k.src="/client-assets/sample/2-3.jpg";const $=new Promise(r=>{k.onload=()=>r()}),p=ie(u.image!=null?"provided":"3_2");P(p,async()=>{p.value!=="provided"&&m!=null&&(m.destroy(!1),m=null,y())});let x=u.image;async function z(){const r=await le({multiple:!1});r.length!==0&&(x=r[0],p.value="provided",m!=null&&(m.destroy(!1),m=null,y()))}let m=null,b=null;async function y(){if(v.value!=null){if(p.value==="3_2")m=new F({canvas:v.value,image:C,exif:null,caption:"Example caption",filename:"example_file_name.jpg",renderAsPreview:!0});else if(p.value==="2_3")m=new F({canvas:v.value,image:k,exif:null,caption:"Example caption",filename:"example_file_name.jpg",renderAsPreview:!0});else if(x!=null){b=await window.createImageBitmap(x);const r=N.load(await x.arrayBuffer());m=new F({canvas:v.value,image:b,exif:r,caption:u.imageCaption??null,filename:u.imageFilename??null,renderAsPreview:!0})}await m.render(i)}}se(async()=>{const r=L();await ne(),await W,await $;try{await y()}catch(e){console.error(e),G({type:"error",text:"Failed to load image"})}r()}),re(()=>{m!=null&&(m.destroy(),m=null),b!=null&&(b.close(),b=null)});async function q(){if(u.presetEditMode){const{canceled:r,result:e}=await ae({title:"Jméno",default:V.name});if(r)return;V.name=e||"",_.value?.close(),m!=null&&(m.destroy(),m=null),w("presetOk",{...V,params:B(i)})}else _.value?.close(),m!=null&&(m.destroy(),m=null),w("ok",i)}function T(r){return`#${r.map(e=>(e*255).toString(16).padStart(2,"0")).join("")}`}function U(r){if(typeof r=="number"||typeof r!="string"||!/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(r))return null;const e=r.slice(1).match(/[0-9a-fA-F]{2}/g);return e==null?[0,0,0]:e.map(s=>parseInt(s,16)/255)}return(r,e)=>(O(),me(h,{ref_key:"dialog",ref:_,width:1e3,height:600,scroll:!1,withOkButton:!0,onClose:e[20]||(e[20]=s=>D()),onOk:e[21]||(e[21]=s=>q()),onClosed:e[22]||(e[22]=s=>w("closed"))},{header:n(()=>[e[23]||(e[23]=l("i",{class:"ti ti-device-ipad-horizontal"},null,-1)),o(" "+t("Edit frame"),1)]),default:n(()=>[l("div",{class:"x6UrA"},[l("div",{class:"xD9kk"},[l("div",{class:A(["xfjlf",de(J).s.animation?"x7Oup":null])},[l("canvas",{ref_key:"canvasEl",ref:v,class:"xDRYs"},null,2),l("div",{class:"xg5mE"},[l("div",{class:"_acrylic x3x51"},t("Náhled"),3),u.image==null?(O(),ue("div",{key:0,class:"_acrylic xmWmn"},[l("button",{class:A(["_button",["x8Zdv",p.value==="3_2"?"xcWqP":null]]),onClick:e[0]||(e[0]=s=>p.value="3_2")},[...e[24]||(e[24]=[l("i",{class:"ti ti-crop-landscape"},null,-1)])],2),l("button",{class:A(["_button",["x8Zdv",p.value==="2_3"?"xcWqP":null]]),onClick:e[1]||(e[1]=s=>p.value="2_3")},[...e[25]||(e[25]=[l("i",{class:"ti ti-crop-portrait"},null,-1)])],2),l("button",{class:"_button x8Zdv",onClick:z},[...e[26]||(e[26]=[l("i",{class:"ti ti-upload"},null,-1)])],2)],2)):pe("",!0)],2)],2),l("div",{class:"xfeu3"},[l("div",ge,[d(c,{modelValue:i.borderThickness,"onUpdate:modelValue":e[2]||(e[2]=s=>i.borderThickness=s),min:0,max:.2,step:.01,continuousUpdate:!0},{label:n(()=>[o(t("Frame width"),1)]),_:1},8,["modelValue"]),d(E,{modelValue:T(i.bgColor),type:"color","onUpdate:modelValue":e[3]||(e[3]=s=>{const f=U(s);f!=null&&(i.bgColor=f)})},{label:n(()=>[o(t("Background color"),1)]),_:1},8,["modelValue"]),d(E,{modelValue:T(i.fgColor),type:"color","onUpdate:modelValue":e[4]||(e[4]=s=>{const f=U(s);f!=null&&(i.fgColor=f)})},{label:n(()=>[o(t("Text color"),1)]),_:1},8,["modelValue"]),d(K,{modelValue:i.font,"onUpdate:modelValue":e[5]||(e[5]=s=>i.font=s),items:[{label:"Sans Serif",value:"sans-serif"},{label:"Serif",value:"serif"}]},{label:n(()=>[o(t("Písmo"),1)]),_:1},8,["modelValue","items"]),d(S,{defaultOpen:i.labelTop.enabled},{label:n(()=>[o(t("Nadpis"),1)]),default:n(()=>[l("div",ve,[d(g,{modelValue:i.labelTop.enabled,"onUpdate:modelValue":e[6]||(e[6]=s=>i.labelTop.enabled=s)},{label:n(()=>[o(t("Zobrazit"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:i.labelTop.padding,"onUpdate:modelValue":e[7]||(e[7]=s=>i.labelTop.padding=s),min:.01,max:.5,step:.01,continuousUpdate:!0},{label:n(()=>[o(t("Label width"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:i.labelTop.scale,"onUpdate:modelValue":e[8]||(e[8]=s=>i.labelTop.scale=s),min:.5,max:2,step:.01,continuousUpdate:!0},{label:n(()=>[o(t("Label scale"),1)]),_:1},8,["modelValue"]),d(g,{modelValue:i.labelTop.centered,"onUpdate:modelValue":e[9]||(e[9]=s=>i.labelTop.centered=s)},{label:n(()=>[o(t("Centered"),1)]),_:1},8,["modelValue"]),d(E,{modelValue:i.labelTop.textBig,"onUpdate:modelValue":e[10]||(e[10]=s=>i.labelTop.textBig=s)},{label:n(()=>[o(t("Caption (Big)"),1)]),_:1},8,["modelValue"]),d(M,{modelValue:i.labelTop.textSmall,"onUpdate:modelValue":e[11]||(e[11]=s=>i.labelTop.textSmall=s)},{label:n(()=>[o(t("Caption (Small)"),1)]),_:1},8,["modelValue"]),d(g,{modelValue:i.labelTop.withQrCode,"onUpdate:modelValue":e[12]||(e[12]=s=>i.labelTop.withQrCode=s)},{label:n(()=>[o(t("QR Code"),1)]),_:1},8,["modelValue"])])]),_:1},8,["defaultOpen"]),d(S,{defaultOpen:i.labelBottom.enabled},{label:n(()=>[o(t("Footer"),1)]),default:n(()=>[l("div",be,[d(g,{modelValue:i.labelBottom.enabled,"onUpdate:modelValue":e[13]||(e[13]=s=>i.labelBottom.enabled=s)},{label:n(()=>[o(t("Zobrazit"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:i.labelBottom.padding,"onUpdate:modelValue":e[14]||(e[14]=s=>i.labelBottom.padding=s),min:.01,max:.5,step:.01,continuousUpdate:!0},{label:n(()=>[o(t("Label width"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:i.labelBottom.scale,"onUpdate:modelValue":e[15]||(e[15]=s=>i.labelBottom.scale=s),min:.5,max:2,step:.01,continuousUpdate:!0},{label:n(()=>[o(t("Label scale"),1)]),_:1},8,["modelValue"]),d(g,{modelValue:i.labelBottom.centered,"onUpdate:modelValue":e[16]||(e[16]=s=>i.labelBottom.centered=s)},{label:n(()=>[o(t("Centered"),1)]),_:1},8,["modelValue"]),d(E,{modelValue:i.labelBottom.textBig,"onUpdate:modelValue":e[17]||(e[17]=s=>i.labelBottom.textBig=s)},{label:n(()=>[o(t("Caption (Big)"),1)]),_:1},8,["modelValue"]),d(M,{modelValue:i.labelBottom.textSmall,"onUpdate:modelValue":e[18]||(e[18]=s=>i.labelBottom.textSmall=s)},{label:n(()=>[o(t("Caption (Small)"),1)]),_:1},8,["modelValue"]),d(g,{modelValue:i.labelBottom.withQrCode,"onUpdate:modelValue":e[19]||(e[19]=s=>i.labelBottom.withQrCode=s)},{label:n(()=>[o(t("QR Code"),1)]),_:1},8,["modelValue"])])]),_:1},8,["defaultOpen"]),d(X,null,{default:n(()=>[l("div",null,t("Supported variables")+":",1),l("div",null,[e[27]||(e[27]=l("code",{class:"_selectableAtomic"},"{filename}",-1)),o(" - "+t("Název souboru"),1)]),l("div",null,[e[28]||(e[28]=l("code",{class:"_selectableAtomic"},"{filename_without_ext}",-1)),o(" - "+t("Filename without extension"),1)]),l("div",null,[e[29]||(e[29]=l("code",{class:"_selectableAtomic"},"{caption}",-1)),o(" - "+t("File caption"),1)]),l("div",null,[e[30]||(e[30]=l("code",{class:"_selectableAtomic"},"{year}",-1)),o(" - "+t("Year of photography"),1)]),l("div",null,[e[31]||(e[31]=l("code",{class:"_selectableAtomic"},"{month}",-1)),o(" - "+t("Month of photogrphy"),1)]),l("div",null,[e[32]||(e[32]=l("code",{class:"_selectableAtomic"},"{day}",-1)),o(" - "+t("Date of photography"),1)]),l("div",null,[e[33]||(e[33]=l("code",{class:"_selectableAtomic"},"{hour}",-1)),o(" - "+t("Time the photo was taken (hour)"),1)]),l("div",null,[e[34]||(e[34]=l("code",{class:"_selectableAtomic"},"{minute}",-1)),o(" - "+t("Time the photo was taken (minute)"),1)]),l("div",null,[e[35]||(e[35]=l("code",{class:"_selectableAtomic"},"{second}",-1)),o(" - "+t("Time the photo was taken (second)"),1)]),l("div",null,[e[36]||(e[36]=l("code",{class:"_selectableAtomic"},"{0month}",-1)),o(" - "+t("Month of photogrphy")+" ("+t("Zero padding")+")",1)]),l("div",null,[e[37]||(e[37]=l("code",{class:"_selectableAtomic"},"{0day}",-1)),o(" - "+t("Date of photography")+" ("+t("Zero padding")+")",1)]),l("div",null,[e[38]||(e[38]=l("code",{class:"_selectableAtomic"},"{0hour}",-1)),o(" - "+t("Time the photo was taken (hour)")+" ("+t("Zero padding")+")",1)]),l("div",null,[e[39]||(e[39]=l("code",{class:"_selectableAtomic"},"{0minute}",-1)),o(" - "+t("Time the photo was taken (minute)")+" ("+t("Zero padding")+")",1)]),l("div",null,[e[40]||(e[40]=l("code",{class:"_selectableAtomic"},"{0second}",-1)),o(" - "+t("Time the photo was taken (second)")+" ("+t("Zero padding")+")",1)]),l("div",null,[e[41]||(e[41]=l("code",{class:"_selectableAtomic"},"{camera_model}",-1)),o(" - "+t("Camera Name"),1)]),l("div",null,[e[42]||(e[42]=l("code",{class:"_selectableAtomic"},"{camera_lens_model}",-1)),o(" - "+t("Lens model"),1)]),l("div",null,[e[43]||(e[43]=l("code",{class:"_selectableAtomic"},"{camera_mm}",-1)),o(" - "+t("Focal length"),1)]),l("div",null,[e[44]||(e[44]=l("code",{class:"_selectableAtomic"},"{camera_mm_35}",-1)),o(" - "+t("Focal length (in 35 mm format)"),1)]),l("div",null,[e[45]||(e[45]=l("code",{class:"_selectableAtomic"},"{camera_f}",-1)),o(" - "+t("Aperture (f-number)"),1)]),l("div",null,[e[46]||(e[46]=l("code",{class:"_selectableAtomic"},"{camera_s}",-1)),o(" - "+t("Shutter speed"),1)]),l("div",null,[e[47]||(e[47]=l("code",{class:"_selectableAtomic"},"{camera_iso}",-1)),o(" - "+t("ISO"),1)]),l("div",null,[e[48]||(e[48]=l("code",{class:"_selectableAtomic"},"{gps_lat}",-1)),o(" - "+t("Latitude"),1)]),l("div",null,[e[49]||(e[49]=l("code",{class:"_selectableAtomic"},"{gps_long}",-1)),o(" - "+t("Longitude"),1)])]),_:1})])],2)],2)],2)]),_:1},512))}});export{Te as default};
