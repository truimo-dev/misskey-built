import{b as M,a as C,u as f,w as S,e as I,H as b,l as v,i as l,p as a,q as T,t as w,x as F,Z as H,f as y,h as k,C as R,F as A,A as P}from"./3iSoGi4ic-D0mTJ0Mu.js";import{av as $,aF as j,J as B,x as N,ba as x}from"./3iSoGi4ic-DV-GuiCp.js";import{u as U}from"./3iSoGi4ic-DCTAa4Sx.js";import{M as W}from"./3iSoGi4ic-CC5SbM-1.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const q=["id","width"],D=["id"],u="abcdefghijklmnopqrstuvwxyz",L=M({__name:"MkTagCloud",setup(_,{expose:m}){const p=!!window.TagCanvas,g=getComputedStyle(window.document.documentElement),e=Array.from({length:16},()=>u[Math.floor(Math.random()*u.length)]).join(""),i=Array.from({length:16},()=>u[Math.floor(Math.random()*u.length)]).join(""),s=C(!1),o=f("rootEl"),n=f("canvasEl"),r=f("tagsEl"),c=C(300);return S(s,()=>{try{window.TagCanvas.Start(e,i,{textColour:"#ffffff",outlineColour:$(g.getPropertyValue("--MI_THEME-accent")).toHexString(),outlineRadius:10,initial:[-.03,-.01],frontSelect:!0,imageRadius:8,dragThreshold:3,wheelZoom:!1,reverse:!0,depth:.5,maxSpeed:.2,minSpeed:.003,stretchX:.8,stretchY:.8})}catch{}}),I(()=>{o.value&&(c.value=o.value.offsetWidth),p?s.value=!0:window.document.head.appendChild(Object.assign(window.document.createElement("script"),{async:!0,src:"/client-assets/tagcanvas.min.js"})).addEventListener("load",()=>s.value=!0)}),b(()=>{window.TagCanvas&&window.TagCanvas.Delete(e)}),m({update:()=>{window.TagCanvas.Update(e)}}),(d,t)=>(l(),v("div",{ref_key:"rootEl",ref:o,class:"xuSou"},[a("canvas",{id:w(e),ref_key:"canvasEl",ref:n,style:{display:"block"},width:c.value,height:"300",onContextmenu:T(()=>{},["prevent"])},null,40,q),a("div",{id:w(i),ref_key:"tagsEl",ref:r,class:"xEwHN"},[a("ul",null,[F(d.$slots,"default")])],10,D)],2))}});const V={class:""},z=["onClick"],O=["src"],E="instanceCloud",oe=M({__name:"WidgetInstanceCloud",props:{widget:{}},emits:["updateProps"],setup(_,{expose:m,emit:p}){const g={transparent:{type:"boolean",default:!1}},e=_,i=p,{widgetProps:s,configure:o}=U(E,g,e,i),n=f("cloud"),r=H(null);function c(t){N(`/instance-info/${t.host}`)}j(()=>{B("federation/instances",{sort:"+latestRequestReceivedAt",limit:25}).then(t=>{r.value=t,n.value&&n.value.update()})},1e3*60*3,{immediate:!0,afterMounted:!0});function d(t){return x(t.iconUrl,"preview")??x(t.faviconUrl,"preview")??"/client-assets/dummy.png"}return m({name:E,configure:o,id:e.widget?e.widget.id:null}),(t,Z)=>(l(),y(W,{naked:w(s).transparent,showHeader:!1,class:"mkw-instance-cloud"},{default:k(()=>[a("div",V,[r.value?(l(),y(L,{key:0,ref_key:"cloud",ref:n},{default:k(()=>[(l(!0),v(A,null,P(r.value,h=>(l(),v("li",{key:h.id},[a("a",{onClick:T(J=>c(h),["prevent"])},[a("img",{style:{width:"32px"},src:d(h)},null,8,O)],8,z)]))),128))]),_:1},512)):R("",!0)])]),_:1},8,["naked"]))}});export{oe as default};
