import{i as J,u as j,C as K,c as Q}from"./3iSoGi4ic-CqmhgU-Q.js";import{U as X,bd as Z,b7 as i}from"./3iSoGi4ic-DV-GuiCp.js";import{a as b}from"./3iSoGi4ic-BPp9MNgd.js";import{a as ee}from"./3iSoGi4ic-y3_HjM0O.js";import{M as ae,c as te}from"./3iSoGi4ic-C7_f0Ypu.js";import{b as re,u as I,a as se,w as ne,e as oe,z as le,l as P,i as U,p as ie,B as z,C as ce}from"./3iSoGi4ic-D0mTJ0Mu.js";const we=re({__name:"MkChart",props:{src:{},args:{default:void 0},limit:{default:90},span:{},detailed:{type:Boolean,default:!1},stacked:{type:Boolean,default:!1},bar:{type:Boolean,default:!1},aspectRatio:{default:null},nowForChromatic:{default:void 0}},setup(A){J();const t=A,f=I("legendEl"),l=(...e)=>e.reduce((a,s)=>a.map((c,m)=>s[m]+c)),o=e=>e.map(a=>-a),n={blue:"#008FFB",green:"#00E396",yellow:"#FEB019",red:"#FF4560",purple:"#e300db",orange:"#fe6919",lime:"#bde800",cyan:"#00e0e0"},C=[n.blue,n.green,n.yellow,n.red,n.purple],d=e=>C[e%C.length],p=t.nowForChromatic!=null?new Date(t.nowForChromatic):new Date;let h=null,u=null;const y=I("chartEl"),g=se(!0),w=e=>{const a=p.getFullYear(),s=p.getMonth(),c=p.getDate(),m=p.getHours();return t.span==="day"?new Date(a,s,c-e):new Date(a,s,c,m-e)},r=e=>e.map((a,s)=>({x:w(s).getTime(),y:a})),{handler:E}=j(),L=()=>{if(u==null||y.value==null)return;h&&h.destroy();const e=X.s.darkMode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",a=u.series.map((s,c)=>Math.max(...s.data.map(m=>m.y)));h=new K(y.value,{type:t.bar?"bar":"line",data:{labels:new Array(t.limit).fill(0).map((s,c)=>ee(w(c))).slice().reverse(),datasets:u.series.map((s,c)=>({parsing:!1,label:s.name,data:s.data.slice().reverse(),tension:.3,pointRadius:0,borderWidth:t.bar?0:2,borderColor:s.color?s.color:d(c),borderDash:s.dashed?[5,5]:[],borderJoinStyle:"round",borderRadius:t.bar?3:void 0,backgroundColor:t.bar?s.color?s.color:d(c):b(s.color?s.color:d(c),.1),gradient:t.bar?void 0:{backgroundColor:{axis:"y",colors:{0:b(s.color?s.color:d(c),0),[a[c]]:b(s.color?s.color:d(c),.35)}}},barPercentage:.9,categoryPercentage:.9,fill:s.type==="area",clip:8,hidden:!!s.hidden}))},options:{aspectRatio:t.aspectRatio||2.5,layout:{padding:{left:0,right:8,top:0,bottom:0}},scales:{x:{type:"time",stacked:t.stacked,offset:!1,time:{unit:t.span==="day"?"month":"day",displayFormats:{day:"M/d",month:"Y/M"}},grid:{},ticks:{stepSize:1,display:t.detailed,maxRotation:0,autoSkipPadding:16},min:w(t.limit).getTime()},y:{position:"left",stacked:t.stacked,suggestedMax:50,grid:{},ticks:{display:t.detailed}}},interaction:{intersect:!1,mode:"index"},elements:{point:{hoverRadius:5,hoverBorderWidth:2}},plugins:{legend:{display:!1},tooltip:{enabled:!1,mode:"index",animation:{duration:0},external:E,callbacks:{label:s=>`${s.dataset.label}: ${u?.bytes?Z(s.parsed.y*1e3,1):s.parsed.y.toString()}`}},zoom:t.detailed?{pan:{enabled:!0},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},drag:{enabled:!1},mode:"x"},limits:{x:{min:"original",max:"original"},y:{min:"original",max:"original"}}}:void 0}},plugins:[Q(e),...t.detailed&&f.value?[te(f.value)]:[]]})},W=async()=>{const e=await i("charts/federation",{limit:t.limit,span:t.span});return{series:[{name:"Received",type:"area",data:r(e.inboxInstances),color:n.blue},{name:"Delivered",type:"area",data:r(e.deliveredInstances),color:n.green},{name:"Stalled",type:"area",data:r(e.stalled),color:n.red},{name:"Pub Active",type:"line",data:r(e.pubActive),color:n.purple},{name:"Sub Active",type:"line",data:r(e.subActive),color:n.orange},{name:"Pub & Sub",type:"line",data:r(e.pubsub),dashed:!0,color:n.cyan},{name:"Pub",type:"line",data:r(e.pub),dashed:!0,color:n.purple},{name:"Sub",type:"line",data:r(e.sub),dashed:!0,color:n.orange}]}},_=async()=>{const e=await i("charts/ap-request",{limit:t.limit,span:t.span});return{series:[{name:"In",type:"area",color:"#008FFB",data:r(e.inboxReceived)},{name:"Out (succ)",type:"area",color:"#00E396",data:r(e.deliverSucceeded)},{name:"Out (fail)",type:"area",color:"#FEB019",data:r(e.deliverFailed)}]}},v=async e=>{const a=await i("charts/notes",{limit:t.limit,span:t.span});return{series:[{name:"All",type:"line",data:r(e==="combined"?l(a.local.inc,o(a.local.dec),a.remote.inc,o(a.remote.dec)):l(a[e].inc,o(a[e].dec))),color:"#888888"},{name:"Renotes",type:"area",data:r(e==="combined"?l(a.local.diffs.renote,a.remote.diffs.renote):a[e].diffs.renote),color:n.green},{name:"Replies",type:"area",data:r(e==="combined"?l(a.local.diffs.reply,a.remote.diffs.reply):a[e].diffs.reply),color:n.yellow},{name:"Normal",type:"area",data:r(e==="combined"?l(a.local.diffs.normal,a.remote.diffs.normal):a[e].diffs.normal),color:n.blue},{name:"With file",type:"area",data:r(e==="combined"?l(a.local.diffs.withFile,a.remote.diffs.withFile):a[e].diffs.withFile),color:n.purple}]}},x=async()=>{const e=await i("charts/notes",{limit:t.limit,span:t.span});return{series:[{name:"Combined",type:"line",data:r(l(e.local.total,e.remote.total))},{name:"Local",type:"area",data:r(e.local.total)},{name:"Remote",type:"area",data:r(e.remote.total)}]}},F=async e=>{const a=await i("charts/users",{limit:t.limit,span:t.span});return{series:[{name:"Combined",type:"line",data:r(e?l(a.local.total,a.remote.total):l(a.local.inc,o(a.local.dec),a.remote.inc,o(a.remote.dec)))},{name:"Local",type:"area",data:r(e?a.local.total:l(a.local.inc,o(a.local.dec)))},{name:"Remote",type:"area",data:r(e?a.remote.total:l(a.remote.inc,o(a.remote.dec)))}]}},q=async()=>{const e=await i("charts/active-users",{limit:t.limit,span:t.span});return{series:[{name:"Read & Write",type:"area",data:r(e.readWrite),color:n.orange},{name:"Write",type:"area",data:r(e.write),color:n.lime},{name:"Read",type:"area",data:r(e.read),color:n.blue},{name:"< Week",type:"area",data:r(e.registeredWithinWeek),color:n.green},{name:"< Month",type:"area",data:r(e.registeredWithinMonth),color:n.yellow},{name:"< Year",type:"area",data:r(e.registeredWithinYear),color:n.red},{name:"> Week",type:"area",data:r(e.registeredOutsideWeek),color:n.yellow},{name:"> Month",type:"area",data:r(e.registeredOutsideMonth),color:n.red},{name:"> Year",type:"area",data:r(e.registeredOutsideYear),color:n.purple}]}},N=async()=>{const e=await i("charts/drive",{limit:t.limit,span:t.span});return{bytes:!0,series:[{name:"All",type:"line",dashed:!0,data:r(l(e.local.incSize,o(e.local.decSize),e.remote.incSize,o(e.remote.decSize)))},{name:"Local +",type:"area",data:r(e.local.incSize)},{name:"Local -",type:"area",data:r(o(e.local.decSize))},{name:"Remote +",type:"area",data:r(e.remote.incSize)},{name:"Remote -",type:"area",data:r(o(e.remote.decSize))}]}},O=async()=>{const e=await i("charts/drive",{limit:t.limit,span:t.span});return{series:[{name:"All",type:"line",dashed:!0,data:r(l(e.local.incCount,o(e.local.decCount),e.remote.incCount,o(e.remote.decCount)))},{name:"Local +",type:"area",data:r(e.local.incCount)},{name:"Local -",type:"area",data:r(o(e.local.decCount))},{name:"Remote +",type:"area",data:r(e.remote.incCount)},{name:"Remote -",type:"area",data:r(o(e.remote.decCount))}]}},V=async()=>{const e=t.args?.host;if(e==null)return{series:[]};const a=await i("charts/instance",{host:e,limit:t.limit,span:t.span});return{series:[{name:"In",type:"area",color:"#008FFB",data:r(a.requests.received)},{name:"Out (succ)",type:"area",color:"#00E396",data:r(a.requests.succeeded)},{name:"Out (fail)",type:"area",color:"#FEB019",data:r(a.requests.failed)}]}},k=async e=>{const a=t.args?.host;if(a==null)return{series:[]};const s=await i("charts/instance",{host:a,limit:t.limit,span:t.span});return{series:[{name:"Users",type:"area",color:"#008FFB",data:r(e?s.users.total:l(s.users.inc,o(s.users.dec)))}]}},R=async e=>{const a=t.args?.host;if(a==null)return{series:[]};const s=await i("charts/instance",{host:a,limit:t.limit,span:t.span});return{series:[{name:"Notes",type:"area",color:"#008FFB",data:r(e?s.notes.total:l(s.notes.inc,o(s.notes.dec)))}]}},S=async e=>{const a=t.args?.host;if(a==null)return{series:[]};const s=await i("charts/instance",{host:a,limit:t.limit,span:t.span});return{series:[{name:"Following",type:"area",color:"#008FFB",data:r(e?s.following.total:l(s.following.inc,o(s.following.dec)))},{name:"Followers",type:"area",color:"#00E396",data:r(e?s.followers.total:l(s.followers.inc,o(s.followers.dec)))}]}},B=async e=>{const a=t.args?.host;if(a==null)return{series:[]};const s=await i("charts/instance",{host:a,limit:t.limit,span:t.span});return{bytes:!0,series:[{name:"Drive usage",type:"area",color:"#008FFB",data:r(e?l(s.drive.incUsage):l(s.drive.incUsage,o(s.drive.decUsage)))}]}},M=async e=>{const a=t.args?.host;if(a==null)return{series:[]};const s=await i("charts/instance",{host:a,limit:t.limit,span:t.span});return{series:[{name:"Drive files",type:"area",color:"#008FFB",data:r(e?s.drive.totalFiles:l(s.drive.incFiles,o(s.drive.decFiles)))}]}},T=async()=>{const e=t.args?.user?.id;if(e==null)return{series:[]};const a=await i("charts/user/notes",{userId:e,limit:t.limit,span:t.span});return{series:[...t.args?.withoutAll?[]:[{name:"All",type:"line",data:r(l(a.inc,o(a.dec))),color:"#888888"}],{name:"With file",type:"area",data:r(a.diffs.withFile),color:n.purple},{name:"Renotes",type:"area",data:r(a.diffs.renote),color:n.green},{name:"Replies",type:"area",data:r(a.diffs.reply),color:n.yellow},{name:"Normal",type:"area",data:r(a.diffs.normal),color:n.blue}]}},Y=async()=>{const e=t.args?.user?.id;if(e==null)return{series:[]};const a=await i("charts/user/pv",{userId:e,limit:t.limit,span:t.span});return{series:[{name:"Unique PV (user)",type:"area",data:r(a.upv.user),color:n.purple},{name:"PV (user)",type:"area",data:r(a.pv.user),color:n.green},{name:"Unique PV (visitor)",type:"area",data:r(a.upv.visitor),color:n.yellow},{name:"PV (visitor)",type:"area",data:r(a.pv.visitor),color:n.blue}]}},H=async()=>{const e=t.args?.user?.id;if(e==null)return{series:[]};const a=await i("charts/user/following",{userId:e,limit:t.limit,span:t.span});return{series:[{name:"Local",type:"area",data:r(a.local.followings.total)},{name:"Remote",type:"area",data:r(a.remote.followings.total)}]}},$=async()=>{const e=t.args?.user?.id;if(e==null)return{series:[]};const a=await i("charts/user/following",{userId:e,limit:t.limit,span:t.span});return{series:[{name:"Local",type:"area",data:r(a.local.followers.total)},{name:"Remote",type:"area",data:r(a.remote.followers.total)}]}},G=async()=>{const e=t.args?.user?.id;if(e==null)return{series:[]};const a=await i("charts/user/drive",{userId:e,limit:t.limit,span:t.span});return{bytes:!0,series:[{name:"Inc",type:"area",data:r(a.incSize)},{name:"Dec",type:"area",data:r(a.decSize)}]}},D=async()=>{const e=()=>{switch(t.src){case"federation":return W();case"ap-request":return _();case"users":return F(!1);case"users-total":return F(!0);case"active-users":return q();case"notes":return v("combined");case"local-notes":return v("local");case"remote-notes":return v("remote");case"notes-total":return x();case"drive":return N();case"drive-files":return O();case"instance-requests":return V();case"instance-users":return k(!1);case"instance-users-total":return k(!0);case"instance-notes":return R(!1);case"instance-notes-total":return R(!0);case"instance-ff":return S(!1);case"instance-ff-total":return S(!0);case"instance-drive-usage":return B(!1);case"instance-drive-usage-total":return B(!0);case"instance-drive-files":return M(!1);case"instance-drive-files-total":return M(!0);case"per-user-notes":return T();case"per-user-pv":return Y();case"per-user-following":return H();case"per-user-followers":return $();case"per-user-drive":return G();default:return null}};g.value=!0,u=await e(),g.value=!1,L()};return ne(()=>[t.src,t.span],D),oe(()=>{D()}),(e,a)=>{const s=le("MkLoading");return U(),P("div",{class:"xyOdv"},[ie("canvas",{ref_key:"chartEl",ref:y},null,512),z(ae,{ref_key:"legendEl",ref:f,style:{"margin-top":"8px"}},null,512),g.value?(U(),P("div",{key:0,class:"xh7fH"},[z(s)],2)):ce("",!0)],2)}}});export{we as M};
