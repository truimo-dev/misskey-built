import{b as O,a as b,Z as R,aA as N,ab as z,c as Q,l as d,i as u,p as t,f as H,C as _,B as p,h as r,q as L,t as f,E as o,D as B,s as F,m as J}from"./3iSoGi4ic-D0mTJ0Mu.js";import{h as Z}from"./3iSoGi4ic-B1GPmOGN.js";import{ak as G,i as v,a7 as P,$,M as U,b$ as K,C as V,dD as X,P as Y,J as A}from"./3iSoGi4ic-DV-GuiCp.js";import{M as D}from"./3iSoGi4ic-DtDbNQ4_.js";import{M as ee}from"./3iSoGi4ic-mUIS9yQt.js";import{_ as te}from"./3iSoGi4ic-Dz5OvLqt.js";import{M as se}from"./3iSoGi4ic-Cj3FgKaq.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CdSqfJMx.js";import"./3iSoGi4ic-Dv7rS4og.js";import"./3iSoGi4ic-CZYXc2mx.js";import"./3iSoGi4ic-CS6W3O_2.js";const ae={class:"_gaps"},le={class:"_gaps"},re={class:"_gaps_m"},oe={key:0,value:"all"},ne={value:"local"},ue={key:1,value:"server"},ie={value:"user"},ce={class:"_gaps"},de={key:0},pe={style:{overflow:"hidden"}},$e=O({__name:"search.note",props:{query:{default:""},userId:{default:void 0},username:{default:void 0},host:{default:""}},async setup(E){let i,S;const c=E,x=G(),I=b(0),w=R(null),q=b(N(c,"query").value),k=b(N(c,"host").value),n=R(null),g=v.noteSearchableScope??"local";let h=null;c.userId&&(h=([i,S]=z(()=>A("users/show",{userId:c.userId}).catch(()=>null)),i=await i,S(),i)),c.username&&h==null&&(h=([i,S]=z(()=>A("users/show",{username:c.username,...c.host?{host:c.host}:{}}).catch(()=>null)),i=await i,S(),i)),h!=null&&(g==="local"&&h.host!=null||(n.value=h));const m=b(n.value!=null?"user":g==="local"?"local":k.value?"server":"all"),M=a=>!a||a===Z?".":a,l=Q(()=>{const a=q.value.trim();if(!a)return null;if(m.value==="user")return n.value==null?null:{query:a,host:M(n.value.host),userId:n.value.id};if(v.federation!=="none"&&m.value==="server"){let e=k.value?.trim();if(!e)return null;if(e.startsWith("https://")||e.startsWith("http://"))try{e=new URL(e).host}catch{}return{query:a,host:M(e)}}return v.federation==="none"||m.value==="local"?{query:a,host:"."}:{query:a}});function W(){K({includeSelf:!0,localOnly:v.noteSearchableScope==="local"}).then(a=>{n.value=a})}function T(){n.value=$}function j(){n.value=null}async function C(){if(l.value!=null){if(l.value.query.startsWith("https://")&&!l.value.query.includes(" ")&&!(await V({type:"info",text:"Vuoi davvero richiedere informazioni?"})).canceled){const e=await X(l.value.query);e.type==="User"?x.push("/@:acct/:page?",{params:{acct:`${e.object.username}@${e.object.host}`}}):e.type==="Note"&&x.push("/notes/:noteId/:initialTab?",{params:{noteId:e.object.id}});return}if(l.value.query.length>1&&!l.value.query.includes(" ")){if(l.value.query.startsWith("@")&&!(await V({type:"info",text:"Vuoi davvero richiedere informazioni?"})).canceled){x.pushByPath(`/${l.value.query}`);return}if(l.value.query.startsWith("#")&&!(await V({type:"info",text:"Vuoi davvero aprire la pagina dell'hashtag?"})).canceled){x.push("/tags/:tag",{params:{tag:l.value.query.substring(1)}});return}}w.value=J(new Y("notes/search",{limit:10,params:{...l.value}})),I.value++}}return(a,e)=>(u(),d("div",ae,[t("div",le,[p(P,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=y=>q.value=y),large:"",autofocus:"",type:"search",onEnter:L(C,["prevent"])},{prefix:r(()=>[...e[3]||(e[3]=[t("i",{class:"ti ti-search"},null,-1)])]),_:1},8,["modelValue"]),p(D,{expanded:""},{header:r(()=>[B(o("Opzioni del ruolo"),1)]),default:r(()=>[t("div",re,[p(te,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=y=>m.value=y)},{default:r(()=>[f(v).federation!=="none"&&f(g)==="global"?(u(),d("option",oe,o("Tutte"),1)):_("",!0),t("option",ne,o(f(v).federation==="none"?"Tutte":"Locale"),1),f(v).federation!=="none"&&f(g)==="global"?(u(),d("option",ue,o("Server specifico"),1)):_("",!0),t("option",ie,o("Profilo specifico"),1)]),_:1},8,["modelValue"]),f(v).federation!=="none"&&m.value==="server"?(u(),d("div",{key:0,class:"xpgtz"},[p(P,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=y=>k.value=y),placeholder:"Es: misskey.example.com",onEnter:L(C,["prevent"])},{label:r(()=>[B(o("Inserire il nome host"),1)]),prefix:r(()=>[...e[4]||(e[4]=[t("i",{class:"ti ti-server"},null,-1)])]),_:1},8,["modelValue","placeholder"])],2)):_("",!0),m.value==="user"?(u(),d("div",{key:1,class:"xpgtz"},[t("div",{class:"x9I4U"},o("Per favore, seleziona un profilo"),3),t("div",ce,[n.value==null?(u(),d("div",{key:0,class:"x4VND"},[f($)!=null?(u(),d("div",de,[p(U,{transparent:"",class:"xeH3r",onClick:T},{default:r(()=>[t("div",{class:"xl2Be"},[e[5]||(e[5]=t("span",null,[t("i",{class:"ti ti-plus"}),t("i",{class:"ti ti-user"})],-1)),t("span",null,o("Segli me"),1)],2)]),_:1},8,["class"])])):_("",!0),t("div",{style:F(f($)==null?"grid-column: span 2;":void 0)},[p(U,{transparent:"",class:"xeH3r",onClick:W},{default:r(()=>[t("div",{class:"xl2Be"},[e[6]||(e[6]=t("span",null,[t("i",{class:"ti ti-plus"})],-1)),t("span",null,o("Seleziona profilo"),1)],2)]),_:1},8,["class"])],4)],2)):(u(),d("div",{key:1,class:"xn3kz"},[t("div",pe,[p(se,{user:n.value,withChart:!1,class:""},null,8,["user","class"])]),t("div",null,[t("button",{class:"_button xo0S4",onClick:j},[...e[7]||(e[7]=[t("i",{class:"ti ti-x"},null,-1)])],2)])],2))])],2)):_("",!0)])]),_:1}),t("div",null,[p(U,{large:"",primary:"",gradate:"",rounded:"",disabled:l.value==null,style:{margin:"0 auto"},onClick:C},{default:r(()=>[B(o("Cerca"),1)]),_:1},8,["disabled"])])]),w.value?(u(),H(D,{key:0},{header:r(()=>[B(o("Risultati della Ricerca"),1)]),default:r(()=>[(u(),H(ee,{key:`searchNotes:${I.value}`,paginator:w.value},null,8,["paginator"]))]),_:1})):_("",!0)]))}});export{$e as default};
