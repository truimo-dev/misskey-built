import{ak as D,a7 as F,M as y,ab as R,L as I,C as T,af as N,_ as U,az as z,J as W}from"./3iSoGi4ic-DV-GuiCp.js";import{M as $}from"./3iSoGi4ic-BDF7xMl0.js";import{b as S,a as k,c as b,z as V,k as H,f,i as p,h as i,p as l,B as _,D as d,E as r,l as x,A as L,s as j,j as q,F as G,C as J}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const X={class:"_spacer",style:{"--MI_SPACER-w":"800px","--MI_SPACER-min":"16px","--MI_SPACER-max":"32px"}},K={class:"_gaps_s"},O={class:"name"},Q=["onClick"],Y={class:"_buttons"},Z=S({__name:"edit.root",props:{post:{}},setup(g){const u=D(),t=g,n=k(t.post?.files??[]),v=k(t.post?.description??null),c=k(t.post?.title??""),m=k(t.post?.isSensitive??!1);function h(s){N({anchorElement:s.currentTarget??s.target,multiple:!0}).then(e=>{n.value=n.value.concat(e)})}function w(s){n.value=n.value.filter(e=>e.id!==s.id)}async function C(){if(t.post!=null)await I("gallery/posts/update",{postId:t.post.id,title:c.value,description:v.value,fileIds:n.value.map(s=>s.id),isSensitive:m.value}),u.push("/gallery/:postId",{params:{postId:t.post.id}});else{const s=await I("gallery/posts/create",{title:c.value,description:v.value,fileIds:n.value.map(e=>e.id),isSensitive:m.value});u.push("/gallery/:postId",{params:{postId:s.id}})}}async function M(){if(t.post==null)return;const{canceled:s}=await T({type:"warning",text:"Rimuovere?"});s||(await I("gallery/posts/delete",{postId:t.post.id}),u.push("/gallery"))}const A=b(()=>[]),P=b(()=>[]);return(s,e)=>{const B=V("PageWithHeader"),E=H("tooltip");return p(),f(B,{actions:A.value,tabs:P.value},{default:i(()=>[l("div",X,[_(F,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a)},{label:i(()=>[d(r("Titolo"),1)]),_:1},8,["modelValue"]),_($,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),max:500},{label:i(()=>[d(r("Descrizione"),1)]),_:1},8,["modelValue"]),l("div",K,[(p(!0),x(G,null,L(n.value,a=>(p(),x("div",{key:a.id,class:"wqugxsfx",style:j({backgroundImage:a?`url(${a.thumbnailUrl})`:""})},[l("div",O,r(a.name),1),q((p(),x("button",{class:"remove _button",onClick:te=>w(a)},[...e[3]||(e[3]=[l("i",{class:"ti ti-x"},null,-1)])],8,Q)),[[E,"Elimina"]])],4))),128)),_(y,{primary:"",onClick:h},{default:i(()=>[e[4]||(e[4]=l("i",{class:"ti ti-plus"},null,-1)),d(" "+r("Allega file"),1)]),_:1})]),_(R,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a)},{default:i(()=>[d(r("Segna come esplicito"),1)]),_:1},8,["modelValue"]),l("div",Y,[t.post!=null?(p(),f(y,{key:0,primary:"",onClick:C},{default:i(()=>[e[5]||(e[5]=l("i",{class:"ti ti-device-floppy"},null,-1)),d(" "+r("Salva"),1)]),_:1})):(p(),f(y,{key:1,primary:"",onClick:C},{default:i(()=>[e[6]||(e[6]=l("i",{class:"ti ti-device-floppy"},null,-1)),d(" "+r("Pubblicare"),1)]),_:1})),t.post!=null?(p(),f(y,{key:2,danger:"",onClick:M},{default:i(()=>[e[7]||(e[7]=l("i",{class:"ti ti-trash"},null,-1)),d(" "+r("Elimina"),1)]),_:1})):J("",!0)])])]),_:1},8,["actions","tabs"])}}}),ee=U(Z,[["__scopeId","data-v-a424b263"]]),pe=S({__name:"edit",props:{postId:{}},setup(g){const u=g;function t(){return u.postId==null?Promise.resolve(null):W("gallery/posts/show",{postId:u.postId})}return z(()=>({title:u.postId?"Modifica":"Pubblicare nella galleria",icon:"ti ti-pencil"})),(n,v)=>{const c=V("MkSuspense");return p(),f(c,{p:t},{default:i(({result:m})=>[_(ee,{post:m},null,8,["post"])]),_:1})}}});export{pe as default};
