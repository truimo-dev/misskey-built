import{_ as J}from"./3iSoGi4ic-BNF0PL3J.js";import{P as D,ak as Q,$ as O,aH as Y,dk as Z,aF as ee,J as _,az as se,M as E,ay as T,b$ as te,h as ie}from"./3iSoGi4ic-DV-GuiCp.js";import{M as S}from"./3iSoGi4ic-Fx-BY70c.js";import{M as U}from"./3iSoGi4ic-CdSqfJMx.js";import{b as ae,m as W,a as I,o as G,e as ne,M as re,z as f,k as le,l as n,i,p as t,f as M,C as c,B as r,h as o,D as p,E as u,t as A,F as C,A as R,j as V,g as K}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-Dv7rS4og.js";const oe={key:0,class:"_spacer",style:{"--MI_SPACER-w":"600px"}},ue={class:"_gaps"},de={class:"_panel _gaps",style:{padding:"16px"}},ce={class:"_buttonsCenter"},me={style:{"font-size":"90%",opacity:"0.7","text-align":"center"}},ve={class:"_gaps_s"},pe=["onClick"],ye={style:{"margin-right":"8px"}},_e={key:0,style:{"margin-right":"0.75em",color:"var(--MI_THEME-accent)","font-weight":"bold"}},fe={key:1,style:{"margin-right":"0.75em",visibility:"hidden"}},xe={key:2,style:{"margin-left":"0.75em",visibility:"hidden"}},ge={key:3,style:{"margin-left":"0.75em",color:"var(--MI_THEME-accent)","font-weight":"bold"}},ke={key:2},we={key:0,style:{"margin-right":"0.75em",color:"var(--MI_THEME-accent)","font-weight":"bold"}},he={key:1,style:{"margin-right":"0.75em",visibility:"hidden"}},Ie={key:2,style:{"margin-left":"0.75em",visibility:"hidden"}},Me={key:3,style:{"margin-left":"0.75em",color:"var(--MI_THEME-accent)","font-weight":"bold"}},Pe={key:2},be={key:1,class:"_spacer",style:{"--MI_SPACER-w":"600px"}},Ee={class:"cancel"},Ue=ae({__name:"index",setup(Se){const $=W(new D("reversi/games",{limit:10,params:{my:!0}})),z=W(new D("reversi/games",{limit:10})),H=Q();if(O){const a=Y().useChannel("reversi");a.on("matched",s=>{(d.value!=null||v.value)&&g(s.game)}),a.on("invited",s=>{x.value.some(y=>y.id===s.user.id)||x.value.unshift(s.user)}),G(()=>{a.dispose()})}const x=I([]),d=I(null),v=I(!1),P=I(!1);function g(a){d.value=null,v.value=!1,Z("/client-assets/reversi/matched.mp3",{volume:1,playbackRate:1}),H.push("/reversi/g/:gameId",{params:{gameId:a.id}})}async function k(){if(d.value){const a=await _("reversi/match",{userId:d.value.id});a!=null&&g(a)}else if(v.value){const a=await _("reversi/match",{userId:null,noIrregularRules:P.value});a!=null&&g(a)}}async function N(){T();const a=await te({includeSelf:!1,localOnly:!0});a!=null&&(d.value=a,k())}function L(a){T(),ie([{text:"Irregular rules (completely free)",action:()=>{P.value=!1,v.value=!0,k()}},{text:"No irregular rules",action:()=>{P.value=!0,v.value=!0,k()}}],a.currentTarget??a.target)}function w(){d.value?(_("reversi/cancel-match",{userId:d.value.id}),d.value=null):v.value&&(_("reversi/cancel-match",{userId:null}),v.value=!1)}async function X(a){const s=await _("reversi/match",{userId:a.id});s&&g(s)}return ee(k,1e3*5,{immediate:!1,afterMounted:!0}),ne(()=>{_("reversi/invitations").then(a=>{x.value=a}),window.addEventListener("beforeunload",w)}),re(()=>{w()}),G(()=>{w()}),se(()=>({title:"Reversi",icon:"ti ti-device-gamepad"})),(a,s)=>{const y=f("MkAvatar"),q=f("MkUserName"),h=f("MkEllipsis"),F=f("MkTime"),B=f("MkA"),j=f("I18n"),b=le("panel");return!v.value&&!d.value?(i(),n("div",oe,[t("div",ue,[s[11]||(s[11]=t("div",null,[t("img",{src:J,style:{display:"block","max-width":"100%","max-height":"200px",margin:"auto"}})],-1)),t("div",de,[t("div",ce,[r(E,{primary:"",gradate:"",rounded:"",onClick:L},{default:o(()=>[p(u("Free Match"),1)]),_:1}),r(E,{primary:"",gradate:"",rounded:"",onClick:N},{default:o(()=>[p(u("Invite"),1)]),_:1})]),t("div",me,[s[0]||(s[0]=t("i",{class:"ti ti-music"},null,-1)),p(" "+u("Sound will be played"),1)])]),x.value.length>0?(i(),M(S,{key:0,defaultOpen:!0},{label:o(()=>[p(u("Invites"),1)]),default:o(()=>[t("div",ve,[(i(!0),n(C,null,R(x.value,m=>V((i(),n("button",{key:m.id,class:"xqyFK _button",tabindex:"-1",onClick:e=>X(m)},[r(y,{style:{width:"32px",height:"32px","margin-right":"8px"},user:m,showIndicator:!0},null,8,["user"]),t("span",ye,[t("b",null,[r(q,{user:m},null,8,["user"])])]),t("span",null,"@"+u(m.username),1)],10,pe)),[[b]])),128))])]),_:1})):c("",!0),A(O)?(i(),M(S,{key:1,defaultOpen:!0},{label:o(()=>[p(u("My rounds"),1)]),default:o(()=>[r(U,{paginator:A($)},{default:o(({items:m})=>[t("div",{class:"x5OSo"},[(i(!0),n(C,null,R(m,e=>V((i(),M(B,{key:e.id,class:K(["xcK61",!e.isStarted&&!e.isEnded&&"xhqVv",e.isStarted&&!e.isEnded&&"x2cU5"]),tabindex:"-1",to:`/reversi/g/${e.id}`},{default:o(()=>[t("div",{class:"xsWpl"},[e.winnerId===e.user1Id?(i(),n("span",_e,[...s[1]||(s[1]=[t("i",{class:"ti ti-trophy"},null,-1)])])):c("",!0),e.winnerId===e.user2Id?(i(),n("span",fe,[...s[2]||(s[2]=[t("i",{class:"ti ti-x"},null,-1)])])):c("",!0),r(y,{class:"xi1VG",user:e.user1},null,8,["class","user"]),s[5]||(s[5]=t("span",{style:{margin:"0 1em"}},"vs",-1)),r(y,{class:"xi1VG",user:e.user2},null,8,["class","user"]),e.winnerId===e.user1Id?(i(),n("span",xe,[...s[3]||(s[3]=[t("i",{class:"ti ti-x"},null,-1)])])):c("",!0),e.winnerId===e.user2Id?(i(),n("span",ge,[...s[4]||(s[4]=[t("i",{class:"ti ti-trophy"},null,-1)])])):c("",!0)],2),t("div",{class:"xDROt"},[e.isStarted&&!e.isEnded?(i(),n("span",{key:0,class:"xeEmf"},u("Currently playing"),3)):e.isEnded?(i(),n("span",ke,u("Ended"),1)):(i(),n("span",{key:1,class:"xqgsX"},[r(h)],2)),r(F,{style:{"margin-left":"auto",opacity:"0.7"},time:e.createdAt},null,8,["time"])],2)]),_:2},1032,["class","to"])),[[b]])),128))],2)]),_:1},8,["paginator"])]),_:1})):c("",!0),r(S,{defaultOpen:!0},{label:o(()=>[p(u("All rounds"),1)]),default:o(()=>[r(U,{paginator:A(z)},{default:o(({items:m})=>[t("div",{class:"x5OSo"},[(i(!0),n(C,null,R(m,e=>V((i(),M(B,{key:e.id,class:K(["xcK61",!e.isStarted&&!e.isEnded&&"xhqVv",e.isStarted&&!e.isEnded&&"x2cU5"]),tabindex:"-1",to:`/reversi/g/${e.id}`},{default:o(()=>[t("div",{class:"xsWpl"},[e.winnerId===e.user1Id?(i(),n("span",we,[...s[6]||(s[6]=[t("i",{class:"ti ti-trophy"},null,-1)])])):c("",!0),e.winnerId===e.user2Id?(i(),n("span",he,[...s[7]||(s[7]=[t("i",{class:"ti ti-x"},null,-1)])])):c("",!0),r(y,{class:"xi1VG",user:e.user1},null,8,["class","user"]),s[10]||(s[10]=t("span",{style:{margin:"0 1em"}},"vs",-1)),r(y,{class:"xi1VG",user:e.user2},null,8,["class","user"]),e.winnerId===e.user1Id?(i(),n("span",Ie,[...s[8]||(s[8]=[t("i",{class:"ti ti-x"},null,-1)])])):c("",!0),e.winnerId===e.user2Id?(i(),n("span",Me,[...s[9]||(s[9]=[t("i",{class:"ti ti-trophy"},null,-1)])])):c("",!0)],2),t("div",{class:"xDROt"},[e.isStarted&&!e.isEnded?(i(),n("span",{key:0,class:"xeEmf"},u("Currently playing"),3)):e.isEnded?(i(),n("span",Pe,u("Ended"),1)):(i(),n("span",{key:1,class:"xqgsX"},[r(h)],2)),r(F,{style:{"margin-left":"auto",opacity:"0.7"},time:e.createdAt},null,8,["time"])],2)]),_:2},1032,["class","to"])),[[b]])),128))],2)]),_:1},8,["paginator"])]),_:1})])])):(i(),n("div",be,[t("div",{class:"xxWDv"},[d.value?(i(),n("div",{key:0,class:"xqmKB"},[r(j,{src:"Waiting for {x}",tag:"span"},{x:o(()=>[t("b",null,[r(q,{user:d.value},null,8,["user"])])]),_:1},8,["src"]),r(h)],2)):(i(),n("div",{key:1,class:"xqmKB"},[p(u("Finding opponent..."),1),r(h)],2)),t("div",Ee,[r(E,{inline:"",rounded:"",onClick:w},{default:o(()=>[p(u("Cancel"),1)]),_:1})])],2)]))}}});export{Ue as default};
