import{aS as le,c3 as b,P,az as ne,c4 as c,bl as oe,M as B,ab as F,aW as q,ag as ie,bk as $,J as f,ba as D,A as re}from"./3iSoGi4ic-DV-GuiCp.js";import{M as I}from"./3iSoGi4ic-BWBLHwGQ.js";import{_ as ue}from"./3iSoGi4ic-DYnmgoxC.js";import{F as N}from"./3iSoGi4ic-CaDkpGcu.js";import{F as T}from"./3iSoGi4ic-BBsRrkiB.js";import{M as de}from"./3iSoGi4ic-Cj3FgKaq.js";import{M as me}from"./3iSoGi4ic-CdSqfJMx.js";import{d as ce}from"./3iSoGi4ic-y3_HjM0O.js";import{M as ve}from"./3iSoGi4ic-BDF7xMl0.js";import{b as fe,a as p,m as j,w as pe,c as z,z as H,k as he,f as x,i,h as e,l as k,C as M,p as u,B as l,E as o,t as h,D as n,R as ke,F as we,A as ye,j as be}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CqmhgU-Q.js";import"./3iSoGi4ic-BPp9MNgd.js";import"./3iSoGi4ic-C7_f0Ypu.js";import"./3iSoGi4ic-CS6W3O_2.js";import"./3iSoGi4ic-Dv7rS4og.js";const _e={key:0,class:"_spacer",style:{"--MI_SPACER-w":"600px","--MI_SPACER-min":"16px","--MI_SPACER-max":"32px"}},ge={key:0,class:"_gaps_m"},xe=["src"],Me={style:{display:"flex","flex-direction":"column",gap:"1em"}},Se={class:"_monospace"},Ce={class:"_monospace"},Ae={class:"_gaps_s"},Ne={key:1},Ve={key:1,class:"_gaps_m"},Re={key:2,class:"_gaps_m"},Ee={key:3,class:"_gaps_m"},Ye=fe({__name:"instance-info",props:{host:{}},setup(d){const _=d,g=p("overview"),{model:S,def:L}=le({items:[{label:"Requests",value:"instance-requests"},{label:"Forskjell på antall brukere",value:"instance-users"},{label:"Cumulative number of users",value:"instance-users-total"},{label:"Difference in the number of notes",value:"instance-notes"},{label:"Cumulative number of notes",value:"instance-notes-total"},{label:"Forskjell på antall Følg/Følgere",value:"instance-ff"},{label:"Cumulative number of followed users / followers",value:"instance-ff-total"},{label:"Difference in cache size",value:"instance-drive-usage"},{label:"Cumulative total cache size",value:"instance-drive-usage-total"},{label:"Forskjell på antall filer",value:"instance-drive-files"},{label:"Cumulative number of files",value:"instance-drive-files-total"}],initialValue:"instance-requests"}),m=p(null),a=p(null),w=p("none"),V=p(!1),R=p(!1),E=p(!1),U=p(null),C=p(""),W=b?j(new P("admin/show-users",{limit:10,params:{sort:"+updatedAt",state:"all",hostname:_.host},offsetMode:!0})):j(new P("users",{limit:10,params:{sort:"+updatedAt",state:"all",hostname:_.host},offsetMode:!0}));b&&pe(C,async()=>{a.value!=null&&await f("admin/federation/update-instance",{host:a.value.host,moderationNote:C.value})});async function J(){$&&(m.value=await f("admin/meta")),a.value=await f("federation/show-instance",{host:_.host}),w.value=a.value?.suspensionState??"none",V.value=a.value?.isBlocked??!1,R.value=a.value?.isSilenced??!1,E.value=a.value?.isMediaSilenced??!1,U.value=D(a.value?.faviconUrl,"preview")??D(a.value?.iconUrl,"preview"),C.value=a.value?.moderationNote??""}async function K(){if(!$)return;if(!m.value)throw new Error("No meta?");if(!a.value)throw new Error("No instance?");const{host:v}=a.value;await f("admin/update-meta",{blockedHosts:V.value?m.value.blockedHosts.concat([v]):m.value.blockedHosts.filter(t=>t!==v)})}async function G(){if(!$)return;if(!m.value)throw new Error("No meta?");if(!a.value)throw new Error("No instance?");const{host:v}=a.value,t=m.value.silencedHosts??[];await f("admin/update-meta",{silencedHosts:R.value?t.concat([v]):t.filter(y=>y!==v)})}async function O(){if(!$)return;if(!m.value)throw new Error("No meta?");if(!a.value)throw new Error("No instance?");const{host:v}=a.value,t=m.value.mediaSilencedHosts??[];await f("admin/update-meta",{mediaSilencedHosts:E.value?t.concat([v]):t.filter(y=>y!==v)})}async function Q(){if(b){if(!a.value)throw new Error("No instance?");w.value="manuallySuspended",await f("admin/federation/update-instance",{host:a.value.host,isSuspended:!0})}}async function X(){if(b){if(!a.value)throw new Error("No instance?");w.value="none",await f("admin/federation/update-instance",{host:a.value.host,isSuspended:!1})}}function Y(){if(b){if(!a.value)throw new Error("No instance?");f("admin/federation/refresh-remote-instance-metadata",{host:a.value.host}),re({text:"Refresh requested"})}}J();const Z=z(()=>[{text:`https://${_.host}`,icon:"ti ti-external-link",handler:()=>{window.open(`https://${_.host}`,"_blank","noopener")}}]),ee=z(()=>[{key:"overview",title:"Overview",icon:"ti ti-info-circle"},...b?[{key:"chart",title:"Diagrammer",icon:"ti ti-chart-line"},{key:"users",title:"Brukere",icon:"ti ti-users"}]:[],{key:"raw",title:"Raw",icon:"ti ti-code"}]);return ne(()=>({title:_.host,icon:"ti ti-server"})),(v,t)=>{const y=H("MkTime"),te=H("MkA"),ae=H("PageWithHeader"),se=he("tooltip");return i(),x(ae,{tab:g.value,"onUpdate:tab":t[5]||(t[5]=r=>g.value=r),actions:Z.value,tabs:ee.value,swipable:!0},{default:e(()=>[a.value?(i(),k("div",_e,[g.value==="overview"?(i(),k("div",ge,[u("div",{class:"xeVFk"},[U.value?(i(),k("img",{key:0,src:U.value,alt:"",class:"xBto7"},null,10,xe)):M("",!0),u("span",{class:"xsqB1"},o(a.value.name||`(${"Ukjent"})`),3)],2),u("div",Me,[l(c,{copy:d.host,oneline:""},{key:e(()=>[...t[6]||(t[6]=[n("Host",-1)])]),value:e(()=>[u("span",Se,[l(oe,{url:`https://${d.host}`},{default:e(()=>[n(o(d.host),1)]),_:1},8,["url"])])]),_:1},8,["copy"]),l(c,{oneline:""},{key:e(()=>[n(o("Programvare"),1)]),value:e(()=>[u("span",Ce,o(a.value.softwareName||`(${"Ukjent"})`)+" / "+o(a.value.softwareVersion||`(${"Ukjent"})`),1)]),_:1}),l(c,{oneline:""},{key:e(()=>[n(o("Administrator"),1)]),value:e(()=>[n(o(a.value.maintainerName||`(${"Ukjent"})`)+" ("+o(a.value.maintainerEmail||`(${"Ukjent"})`)+")",1)]),_:1})]),l(c,null,{key:e(()=>[n(o("Beskrivelse"),1)]),value:e(()=>[n(o(a.value.description),1)]),_:1}),h(b)?(i(),x(T,{key:0},{label:e(()=>[...t[7]||(t[7]=[n("Moderation",-1)])]),default:e(()=>[u("div",Ae,[l(c,null,{key:e(()=>[n(o("Delivery status"),1)]),value:e(()=>[n(o({"none":"Publishing","manuallySuspended":"Manually suspended","goneSuspended":"Server is suspended due to server deletion","autoSuspendedForNotResponding":"Server is suspended due to no responding","softwareSuspended":"Suspended as this software is no longer being distributed to"}[w.value]),1)]),_:1}),w.value==="none"?(i(),x(B,{key:0,disabled:!a.value,danger:"",onClick:Q},{default:e(()=>[n(o("Suspendert"),1)]),_:1},8,["disabled"])):M("",!0),w.value!=="none"?(i(),x(B,{key:1,disabled:!a.value||w.value=="softwareSuspended",onClick:X},{default:e(()=>[n(o("Delivery resume"),1)]),_:1},8,["disabled"])):M("",!0),l(F,{modelValue:V.value,"onUpdate:modelValue":[t[0]||(t[0]=r=>V.value=r),K],disabled:!m.value||!a.value},{default:e(()=>[n(o("Blokker denne serveren"),1)]),_:1},8,["modelValue","disabled"]),l(F,{modelValue:R.value,"onUpdate:modelValue":[t[1]||(t[1]=r=>R.value=r),G],disabled:!m.value||!a.value},{default:e(()=>[n(o("Silence this instance"),1)]),_:1},8,["modelValue","disabled"]),l(F,{modelValue:E.value,"onUpdate:modelValue":[t[2]||(t[2]=r=>E.value=r),O],disabled:!m.value||!a.value},{default:e(()=>[n(o("Media-silence this server"),1)]),_:1},8,["modelValue","disabled"]),l(B,{onClick:Y},{default:e(()=>[...t[8]||(t[8]=[u("i",{class:"ti ti-refresh"},null,-1),n(" Refresh metadata",-1)])]),_:1}),l(ve,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=r=>C.value=r),manualSave:""},{label:e(()=>[n(o("Moderation note"),1)]),caption:e(()=>[n(o("You can fill in notes that will be shared only among moderators."),1)]),_:1},8,["modelValue"])])]),_:1})):M("",!0),l(T,null,{default:e(()=>[l(c,{oneline:"",style:{margin:"1em 0"}},{key:e(()=>[n(o("Registrerte seg"),1)]),value:e(()=>[l(y,{mode:"detail",time:a.value.firstRetrievedAt},null,8,["time"])]),_:1}),l(c,{oneline:"",style:{margin:"1em 0"}},{key:e(()=>[n(o("Updated at"),1)]),value:e(()=>[l(y,{mode:"detail",time:a.value.infoUpdatedAt},null,8,["time"])]),_:1}),l(c,{oneline:"",style:{margin:"1em 0"}},{key:e(()=>[n(o("Siste forespørsel mottatt"),1)]),value:e(()=>[a.value.latestRequestReceivedAt?(i(),x(y,{key:0,time:a.value.latestRequestReceivedAt},null,8,["time"])):(i(),k("span",Ne,"N/A"))]),_:1})]),_:1}),l(T,null,{default:e(()=>[l(c,{oneline:"",style:{margin:"1em 0"}},{key:e(()=>[...t[9]||(t[9]=[n("Following (Pub)",-1)])]),value:e(()=>[n(o(h(q)(a.value.followingCount)),1)]),_:1}),l(c,{oneline:"",style:{margin:"1em 0"}},{key:e(()=>[...t[10]||(t[10]=[n("Followers (Sub)",-1)])]),value:e(()=>[n(o(h(q)(a.value.followersCount)),1)]),_:1})]),_:1}),l(T,null,{label:e(()=>[...t[11]||(t[11]=[n("Well-known resources",-1)])]),default:e(()=>[l(N,{to:`https://${d.host}/.well-known/host-meta`,external:"",style:{"margin-bottom":"8px"}},{default:e(()=>[...t[12]||(t[12]=[n("host-meta",-1)])]),_:1},8,["to"]),l(N,{to:`https://${d.host}/.well-known/host-meta.json`,external:"",style:{"margin-bottom":"8px"}},{default:e(()=>[...t[13]||(t[13]=[n("host-meta.json",-1)])]),_:1},8,["to"]),l(N,{to:`https://${d.host}/.well-known/nodeinfo`,external:"",style:{"margin-bottom":"8px"}},{default:e(()=>[...t[14]||(t[14]=[n("nodeinfo",-1)])]),_:1},8,["to"]),l(N,{to:`https://${d.host}/robots.txt`,external:"",style:{"margin-bottom":"8px"}},{default:e(()=>[...t[15]||(t[15]=[n("robots.txt",-1)])]),_:1},8,["to"]),l(N,{to:`https://${d.host}/manifest.json`,external:"",style:{"margin-bottom":"8px"}},{default:e(()=>[...t[16]||(t[16]=[n("manifest.json",-1)])]),_:1},8,["to"])]),_:1})])):g.value==="chart"?(i(),k("div",Ve,[u("div",null,[u("div",{class:"xna1T"},[l(ie,{modelValue:h(S),"onUpdate:modelValue":t[4]||(t[4]=r=>ke(S)?S.value=r:null),items:h(L),style:{margin:"0 10px 0 0",flex:"1"}},null,8,["modelValue","items"])],2),u("div",null,[u("div",{class:"xFaER"},o((({n})=>("Last "+n+" hours"))({n:90})),3),l(I,{src:h(S),span:"hour",limit:90,args:{host:d.host},detailed:!0},null,8,["src","args"]),u("div",{class:"xFaER"},o((({n})=>("Last "+n+" days"))({n:90})),3),l(I,{src:h(S),span:"day",limit:90,args:{host:d.host},detailed:!0},null,8,["src","args"])])])])):g.value==="users"?(i(),k("div",Re,[l(me,{paginator:h(W)},{default:e(({items:r})=>[u("div",{class:"x6deU"},[(i(!0),k(we,null,ye(r,A=>be((i(),x(te,{key:A.id,to:`/admin/user/${A.id}`},{default:e(()=>[l(de,{user:A},null,8,["user"])]),_:2},1032,["to"])),[[se,`Last posted: ${A.updatedAt?h(ce)(A.updatedAt):"unknown"}`,void 0,{mfm:!0}]])),128))],2)]),_:1},8,["paginator"])])):g.value==="raw"?(i(),k("div",Ee,[l(ue,{tall:"",value:a.value},null,8,["value"])])):M("",!0)])):M("",!0)]),_:1},8,["tab","actions","tabs"])}}});export{Ye as default};
