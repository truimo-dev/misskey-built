import{b as F,u as q,a as x,z as I,f as R,i as u,h as s,p as t,B as n,T,l as _,C as S,D as l,E as o,F as V,A as $}from"./3iSoGi4ic-D0mTJ0Mu.js";import{b as L,f as g}from"./3iSoGi4ic-B1GPmOGN.js";import{Q as P,R as y,bl as G,M as r,c4 as C,a7 as N,ad as U,L as z}from"./3iSoGi4ic-DV-GuiCp.js";import{M as O}from"./3iSoGi4ic-Fx-BY70c.js";import{c as W}from"./3iSoGi4ic-DbFLP2ql.js";import"./3iSoGi4ic-D98_HDRS.js";const j={style:{"overflow-x":"clip"}},Z={key:0,style:{height:"100cqh",overflow:"auto","text-align":"center"}},H={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px"}},K={class:"_gaps"},Q=["href"],J=["src"],X={class:"_buttonsCenter",style:{"margin-top":"16px"}},Y={key:1,style:{height:"100cqh",overflow:"auto"}},tt={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px"}},et={class:"_gaps"},st={class:"_buttonsCenter",style:{"margin-top":"16px"}},ot={key:2,style:{height:"100cqh",overflow:"auto"}},at={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px"}},nt={class:"_gaps"},lt={style:{"text-align":"center"}},it={style:{"text-align":"center"}},rt={style:{"text-align":"center","font-weight":"bold"}},dt={class:"_gaps"},ut={class:"_monospace"},ct={class:"_buttonsCenter",style:{"margin-top":"16px"}},ht=F({__name:"2fa.qrdialog",props:{twoFactorData:{}},emits:["closed"],setup(c,{emit:h}){const w=P(),b=h,m=q("dialog"),d=x(0),p=x(null),f=x();function k(){m.value?.close()}async function M(){if(p.value==null)return;const v=await z("i/2fa/done",{token:p.value.toString()});f.value=v.backupCodes,d.value++,W({duration:1e3*3})}function A(){if(f.value!==void 0){const v=new Blob([f.value.join(`
`)],{type:"text/plain"}),e=window.document.createElement("a");e.href=URL.createObjectURL(v),e.download=`${w.username}@${L}`+(g!==""?`_${g}`:"")+"-2fa-backup-codes.txt",e.click()}}function D(){m.value?.close()}return(v,e)=>{const B=I("I18n");return u(),R(U,{ref_key:"dialog",ref:m,width:500,height:550,onClose:k,onClosed:e[3]||(e[3]=i=>b("closed"))},{header:s(()=>[l(o("Setup two-factor authentification"),1)]),default:s(()=>[t("div",j,[n(T,{mode:"out-in",enterActiveClass:"xyZxu",leaveActiveClass:"xqcE3",enterFromClass:"x6IGD",leaveToClass:"xLcMM"},{default:s(()=>[d.value===0?(u(),_("div",Z,[t("div",H,[t("div",K,[n(y,null,{default:s(()=>[n(G,{url:"https://misskey-hub.net/docs/for-users/stepped-guides/how-to-enable-2fa/",target:"_blank"},{default:s(()=>[l(o("Here is detailed guide"),1)]),_:1})]),_:1}),n(B,{src:"First, install an authentication app (such as {a} or {b}) on your device.",tag:"div"},{a:s(()=>[...e[4]||(e[4]=[t("a",{href:"https://authy.com/",rel:"noopener",target:"_blank",class:"_link"},"Authy",-1)])]),b:s(()=>[...e[5]||(e[5]=[t("a",{href:"https://support.google.com/accounts/answer/1066447",rel:"noopener",target:"_blank",class:"_link"},"Google Authenticator",-1)])]),_:1},8,["src"]),t("div",null,o("Then, scan the QR code displayed on this screen."),1),t("div",null,[t("a",{class:"xETpM",href:c.twoFactorData.url},[t("img",{class:"xhubw",src:c.twoFactorData.qr},null,10,J)],10,Q),t("div",null,[n(r,{inline:"",rounded:"",link:"",to:c.twoFactorData.url,linkBehavior:"browser"},{default:s(()=>[l(o("Launch the app"),1)]),_:1},8,["to"])])]),n(C,{copy:c.twoFactorData.url},{key:s(()=>[l(o("Enter the following URI if you are using a desktop program"),1)]),value:s(()=>[l(o(c.twoFactorData.url),1)]),_:1},8,["copy"])]),t("div",X,[n(r,{rounded:"",onClick:k},{default:s(()=>[l(o("Avbryt"),1)]),_:1}),n(r,{primary:"",rounded:"",gradate:"",onClick:e[0]||(e[0]=i=>d.value++)},{default:s(()=>[l(o("Fortsett")+" ",1),e[6]||(e[6]=t("i",{class:"ti ti-arrow-right"},null,-1))]),_:1})])])])):d.value===1?(u(),_("div",Y,[t("div",tt,[t("div",et,[t("div",null,o("Enter an authentication code"),1),n(N,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=i=>p.value=i),autocomplete:"one-time-code",inputmode:"numeric"},null,8,["modelValue"]),t("div",null,o("Enter the authentication code (token) provided by your app to finish setup."),1)]),t("div",st,[n(r,{rounded:"",onClick:e[2]||(e[2]=i=>d.value--)},{default:s(()=>[e[7]||(e[7]=t("i",{class:"ti ti-arrow-left"},null,-1)),l(" "+o("Back"),1)]),_:1}),n(r,{primary:"",rounded:"",gradate:"",onClick:M},{default:s(()=>[l(o("Fortsett")+" ",1),e[8]||(e[8]=t("i",{class:"ti ti-arrow-right"},null,-1))]),_:1})])])])):d.value===2?(u(),_("div",ot,[t("div",at,[t("div",nt,[t("div",lt,o("Setup complete")+"ðŸŽ‰",1),t("div",it,o("From now on, any future login attempts will ask for such a login token."),1),t("div",rt,o("Before you close this window, please note the following backup codes."),1),n(O,{defaultOpen:!0},{icon:s(()=>[...e[9]||(e[9]=[t("i",{class:"ti ti-key"},null,-1)])]),label:s(()=>[l(o("Backup codes"),1)]),default:s(()=>[t("div",dt,[n(y,{warn:""},{default:s(()=>[l(o("You can use these codes to gain access to your account in case of becoming unable to use your two-factor authentificator app. Each can only be used once. Please keep them in a safe place."),1)]),_:1}),(u(!0),_(V,null,$(f.value,(i,E)=>(u(),_("div",{key:i,class:"_gaps_s"},[n(C,{copy:i},{key:s(()=>[l("#"+o(E+1),1)]),value:s(()=>[t("code",ut,o(i),1)]),_:2},1032,["copy"])]))),128)),n(r,{primary:"",rounded:"",gradate:"",onClick:A},{default:s(()=>[e[10]||(e[10]=t("i",{class:"ti ti-download"},null,-1)),l(" "+o("Nedlastinger"),1)]),_:1})])]),_:1})]),t("div",ct,[n(r,{primary:"",rounded:"",gradate:"",onClick:D},{default:s(()=>[l(o("Ferdig"),1)]),_:1})])])])):S("",!0)]),_:1},8,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass"])])]),_:1},512)}}});export{ht as default};
