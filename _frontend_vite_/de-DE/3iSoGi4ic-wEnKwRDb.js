const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DyuZAl7a.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css"])))=>i.map(i=>d[i]);
import{b as O,a as y,l as P,i as c,p as s,f as M,C as S,h as f,D as $,E as m,B as b,t as R,q as J,u as F,c as G,z as N,s as W,d as Q,e as ee,Z as te,H as se,T as ae,n as Z}from"./3iSoGi4ic-D0mTJ0Mu.js";import{aU as ne,R as oe,M as _,a7 as H,aX as le,k as ie,aY as re,A as w,i as g,ar as ue,e as ce,J as D,aV as pe,aZ as de}from"./3iSoGi4ic-DV-GuiCp.js";import{g as me,s as X,a as Y}from"./3iSoGi4ic-DR2vO6TF.js";import{h as ve}from"./3iSoGi4ic-B1GPmOGN.js";import{_ as A}from"./3iSoGi4ic-C4MHiTai.js";const ye={key:1,class:"_gaps_m"},fe={class:"_gaps_s"},ge=O({__name:"MkSignin.input",props:{message:{default:""},openOnRemote:{default:void 0},initialUsername:{default:void 0}},emits:["usernameSubmitted","passkeyClick"],setup(l,{emit:T}){const V=l,k=T,a=ne(ve),r=y(V.initialUsername??"");function u(i,t){switch(i.type){case"web":case"lookup":{let o;i.type==="lookup"?o=`/authorize-follow?acct=${encodeURIComponent(i.url)}`:o=i.path,t?window.open(`https://${t}${o}`,"_blank","noopener"):window.open(`https://misskey-hub.net/mi-web/?path=${encodeURIComponent(o)}`,"_blank","noopener");break}case"share":{const o=le(i.params);t?window.open(`https://${t}/share?${o}`,"_blank","noopener"):window.open(`https://misskey-hub.net/share/?${o}`,"_blank","noopener");break}}}async function v(i){const{canceled:t,result:o}=await ie({title:"Gib die Domain an",placeholder:"misskey.example.com"});if(t)return;let x=o;if(x=re(x??""),x==null){w({type:"error",title:"Dieser Wert ist ungültig.",text:"Bitte später erneut versuchen"});return}u(i,x)}return(i,t)=>(c(),P("div",{class:"xjhcj","data-cy-signin-page-input":""},[s("div",{class:"xs13V"},[s("div",{class:"x3njI"},[...t[5]||(t[5]=[s("i",{class:"ti ti-user"},null,-1)])],2),l.message?(c(),M(oe,{key:0},{default:f(()=>[$(m(l.message),1)]),_:1})):S("",!0),l.openOnRemote?(c(),P("div",ye,[s("div",fe,[b(_,{type:"button",rounded:"",primary:"",style:{margin:"0 auto"},onClick:t[0]||(t[0]=o=>u(l.openOnRemote))},{default:f(()=>[$(m("Weiter auf Remote-Server")+" ",1),t[6]||(t[6]=s("i",{class:"ti ti-external-link"},null,-1))]),_:1}),s("button",{type:"button",class:"_button xk6qi",onClick:t[1]||(t[1]=o=>v(l.openOnRemote))},m("Server-Host auswählen"),3)]),s("div",{class:"x1bPK"},[s("p",{class:"x6ftT"},m("Oder"),3)],2)])):S("",!0),s("form",{class:"_gaps_s",onSubmit:t[3]||(t[3]=J(o=>k("usernameSubmitted",r.value),["prevent"]))},[b(H,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value=o),placeholder:"Benutzername",type:"text",pattern:"^[a-zA-Z0-9_]+$",spellcheck:!1,autocomplete:"username webauthn",autofocus:"",required:"","data-cy-signin-username":""},{prefix:f(()=>[...t[7]||(t[7]=[$("@",-1)])]),suffix:f(()=>[$("@"+m(R(a)),1)]),_:1},8,["modelValue","placeholder"]),b(_,{type:"submit",large:"",primary:"",rounded:"",style:{margin:"0 auto"},"data-cy-signin-page-input-continue":""},{default:f(()=>[$(m("Fortfahren")+" ",1),t[8]||(t[8]=s("i",{class:"ti ti-arrow-right"},null,-1))]),_:1})],32),s("div",{class:"x1bPK"},[s("p",{class:"x6ftT"},m("Oder"),3)],2),s("div",null,[b(_,{type:"submit",style:{margin:"auto auto"},large:"",rounded:"",primary:"",gradate:"",onClick:t[4]||(t[4]=o=>k("passkeyClick",o))},{default:f(()=>[t[9]||(t[9]=s("i",{class:"ti ti-device-usb",style:{"font-size":"medium"}},null,-1)),$(m("Mit Passkey anmelden"),1)]),_:1})])],2)],2))}});const ke=["value"],be={key:0},xe=O({__name:"MkSignin.password",props:{user:{},needCaptcha:{type:Boolean}},emits:["passwordSubmitted"],setup(l,{expose:T,emit:V}){const k=V,a=y(""),r=F("hcaptcha"),u=F("mcaptcha"),v=F("recaptcha"),i=F("turnstile"),t=F("testcaptcha"),o=y(null),x=y(null),h=y(null),q=y(null),B=y(null),K=G(()=>g.enableHcaptcha&&!o.value||g.enableMcaptcha&&!x.value||g.enableRecaptcha&&!h.value||g.enableTurnstile&&!q.value||g.enableTestcaptcha&&!B.value);function L(){const{dispose:U}=ue(Q(()=>ce(()=>import("./3iSoGi4ic-DyuZAl7a.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),{},{closed:()=>U()})}function j(){k("passwordSubmitted",{password:a.value,captcha:{hCaptchaResponse:o.value,mCaptchaResponse:x.value,reCaptchaResponse:h.value,turnstileResponse:q.value,testcaptchaResponse:B.value}})}function z(){r.value?.reset(),u.value?.reset(),v.value?.reset(),i.value?.reset(),t.value?.reset()}return T({resetCaptcha:z}),(U,d)=>{const I=N("Mfm"),n=N("I18n");return c(),P("div",{class:"xo3Fs","data-cy-signin-page-password":""},[s("div",{class:"_gaps xv6GK"},[s("div",{class:"x8Srp",style:W({backgroundImage:l.user?`url('${l.user.avatarUrl}')`:void 0})},null,6),s("div",{class:"x2TCJ"},[b(n,{src:"Willkommen zurück, {name}",tag:"span"},{name:f(()=>[b(I,{text:l.user.name??l.user.username,plain:!0},null,8,["text"])]),_:1},8,["src"])],2),s("form",{class:"_gaps_s",onSubmit:J(j,["prevent"])},[s("input",{type:"hidden",name:"username",autocomplete:"username",value:l.user.username},null,8,ke),b(H,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=p=>a.value=p),placeholder:"Passwort",type:"password",autocomplete:"current-password webauthn",withPasswordToggle:!0,required:"",autofocus:"","data-cy-signin-password":""},{prefix:f(()=>[...d[6]||(d[6]=[s("i",{class:"ti ti-lock"},null,-1)])]),caption:f(()=>[s("button",{class:"_textButton",type:"button",onClick:L},m("Passwort vergessen"),1)]),_:1},8,["modelValue","placeholder"]),l.needCaptcha?(c(),P("div",be,[R(g).enableHcaptcha?(c(),M(A,{key:0,ref:"hcaptcha",modelValue:o.value,"onUpdate:modelValue":d[1]||(d[1]=p=>o.value=p),provider:"hcaptcha",sitekey:R(g).hcaptchaSiteKey},null,8,["modelValue","sitekey"])):S("",!0),R(g).enableMcaptcha?(c(),M(A,{key:1,ref:"mcaptcha",modelValue:x.value,"onUpdate:modelValue":d[2]||(d[2]=p=>x.value=p),provider:"mcaptcha",sitekey:R(g).mcaptchaSiteKey,instanceUrl:R(g).mcaptchaInstanceUrl},null,8,["modelValue","sitekey","instanceUrl"])):S("",!0),R(g).enableRecaptcha?(c(),M(A,{key:2,ref:"recaptcha",modelValue:h.value,"onUpdate:modelValue":d[3]||(d[3]=p=>h.value=p),provider:"recaptcha",sitekey:R(g).recaptchaSiteKey},null,8,["modelValue","sitekey"])):S("",!0),R(g).enableTurnstile?(c(),M(A,{key:3,ref_key:"turnstile",ref:i,modelValue:q.value,"onUpdate:modelValue":d[4]||(d[4]=p=>q.value=p),provider:"turnstile",sitekey:R(g).turnstileSiteKey},null,8,["modelValue","sitekey"])):S("",!0),R(g).enableTestcaptcha?(c(),M(A,{key:4,ref_key:"testcaptcha",ref:t,modelValue:B.value,"onUpdate:modelValue":d[5]||(d[5]=p=>B.value=p),provider:"testcaptcha",sitekey:null},null,8,["modelValue"])):S("",!0)])):S("",!0),b(_,{type:"submit",disabled:l.needCaptcha&&K.value,large:"",primary:"",rounded:"",style:{margin:"0 auto"},"data-cy-signin-page-password-continue":""},{default:f(()=>[$(m("Fortfahren")+" ",1),d[7]||(d[7]=s("i",{class:"ti ti-arrow-right"},null,-1))]),_:1},8,["disabled"])],32)],2)],2)}}});const he={class:"_gaps_s"},we={key:0,class:"ti ti-key"},Ce={key:1,class:"ti ti-123"},Re=O({__name:"MkSignin.totp",emits:["totpSubmitted"],setup(l,{emit:T}){const V=T,k=y(""),a=y(!1);return(r,u)=>(c(),P("div",{class:"xDf1J"},[s("div",{class:"_gaps xbqlv"},[s("div",he,[s("div",{class:"xerUf"},[...u[3]||(u[3]=[s("i",{class:"ti ti-key"},null,-1)])],2),s("div",{class:"xnGfI"},m("Zwei-Faktor-Authentifizierung"),3)]),s("form",{class:"_gaps_s",onSubmit:u[2]||(u[2]=J(v=>V("totpSubmitted",k.value),["prevent"]))},[b(H,{modelValue:k.value,"onUpdate:modelValue":u[1]||(u[1]=v=>k.value=v),type:"text",pattern:a.value?"^[A-Z0-9]{32}$":"^[0-9]{6}$",autocomplete:"one-time-code",required:"",autofocus:"",spellcheck:!1,inputmode:a.value?void 0:"numeric"},{label:f(()=>[$(m("Token")+" ("+m("Zwei-Faktor-Authentifizierung")+")",1)]),prefix:f(()=>[a.value?(c(),P("i",we)):(c(),P("i",Ce))]),caption:f(()=>[s("button",{class:"_textButton",type:"button",onClick:u[0]||(u[0]=v=>a.value=!a.value)},m(a.value?"Gib das Einmalpasswort ein":"Verwende die Backup-Codes"),1)]),_:1},8,["modelValue","pattern","inputmode"]),b(_,{type:"submit",large:"",primary:"",rounded:"",style:{margin:"0 auto"}},{default:f(()=>[$(m("Fortfahren")+" ",1),u[4]||(u[4]=s("i",{class:"ti ti-arrow-right"},null,-1))]),_:1})],32)],2)],2))}});const Se={class:"_gaps_s"},$e=O({__name:"MkSignin.passkey",props:{credentialRequest:{},isPerformingPasswordlessLogin:{type:Boolean}},emits:["done","useTotp"],setup(l,{emit:T}){const V=l,k=T,a=y(!0);async function r(){a.value=!0,await me(V.credentialRequest).catch(()=>Promise.reject(null)).then(u=>{k("done",u)}).finally(()=>{a.value=!1})}return ee(()=>{r()}),(u,v)=>(c(),P("div",{class:"xqz2Y"},[s("div",{class:"_gaps xox7m"},[s("div",Se,[s("div",{class:"xw7c1"},[...v[1]||(v[1]=[s("i",{class:"ti ti-fingerprint"},null,-1)])],2),s("div",{class:"x7jBx"},m("Folge bitten den Anweisungen deines Browsers bzw. Gerätes und verwende deinen Hardware-Sicherheitsschlüssel oder Passkey."),3)]),b(_,{large:"",primary:"",rounded:"",disabled:a.value,style:{margin:"0 auto"},onClick:r},{default:f(()=>[$(m("Wiederholen"),1)]),_:1},8,["disabled"]),l.isPerformingPasswordlessLogin!==!0?(c(),M(_,{key:0,transparent:"",rounded:"",disabled:a.value,style:{margin:"0 auto"},onClick:v[0]||(v[0]=i=>k("useTotp"))},{default:f(()=>[$(m("Gib das Einmalpasswort ein"),1)]),_:1},8,["disabled"])):S("",!0)],2)],2))}});const Ie=O({__name:"MkSignin",props:{autoSet:{type:Boolean,default:!1},message:{default:""},openOnRemote:{default:void 0},initialUsername:{default:void 0}},emits:["login"],setup(l,{emit:T}){const V=T,k=l,a=y("input"),r=y(!1),u=F("passwordPageEl"),v=y(!1),i=y(null),t=y(""),o=te(null),x=y(""),h=y(!1);function q(){X()&&(h.value=!0,r.value=!0,D("signin-with-passkey",{}).then(n=>{x.value=n.context??"",o.value=Y({publicKey:n.option}),a.value="passkey",r.value=!1}).catch(I))}function B(n){r.value=!0,h.value?D("signin-with-passkey",{credential:n.toJSON(),context:x.value}).then(p=>{if(p.signinResponse==null){I();return}V("login",p.signinResponse),d(p.signinResponse)}).catch(I):i.value!=null&&U({username:i.value.username,password:t.value,credential:n.toJSON()})}function K(){a.value="totp"}async function L(n){r.value=!0,i.value=await D("users/show",{username:n}).catch(()=>null),await U({username:n})}async function j(n){if(r.value=!0,t.value=n.password,i.value==null){await w({type:"error",title:"Benutzer nicht gefunden",text:"Anmeldung fehlgeschlagen. Überprüfe Benutzername und Passswort."}),r.value=!1;return}else await U({username:i.value.username,password:n.password,"hcaptcha-response":n.captcha.hCaptchaResponse,"m-captcha-response":n.captcha.mCaptchaResponse,"g-recaptcha-response":n.captcha.reCaptchaResponse,"turnstile-response":n.captcha.turnstileResponse,"testcaptcha-response":n.captcha.testcaptchaResponse})}async function z(n){if(r.value=!0,i.value==null){await w({type:"error",title:"Benutzer nicht gefunden",text:"Anmeldung fehlgeschlagen. Überprüfe Benutzername und Passswort."}),r.value=!1;return}else await U({username:i.value.username,password:t.value,token:n})}async function U(n){const p={username:n.username??i.value?.username,...n};function E(C){return C.username!=null}if(!E(p))throw new Error("Invalid request");return await D("signin-flow",p).then(async C=>{if(C.finished)V("login",C),await d(C);else{switch(C.next){case"captcha":{v.value=!0,a.value="password";break}case"password":{v.value=!1,a.value="password";break}case"totp":{a.value="totp";break}case"passkey":{X()?(o.value=Y({publicKey:C.authRequest}),a.value="passkey"):a.value="totp";break}}h.value===!0&&(h.value=!1,a.value="input",t.value=""),u.value?.resetCaptcha(),Z(()=>{r.value=!1})}return C}).catch(C=>(I(C),Promise.reject(C)))}async function d(n){k.autoSet&&await pe(n.i)}function I(n){switch(n?.id??null){case"6cc579cc-885d-43d8-95c2-b8c7fc963280":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Benutzer nicht gefunden"});break}case"932c904e-9460-45b7-9ce6-7ed33be7eb2c":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Falsches Passwort."});break}case"e03a5f46-d309-4865-9b69-56282d94e1eb":{de();break}case"22d05606-fbcf-421a-a2db-b32610dcfd1b":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Versuchsanzahl überschritten"});break}case"cdf1235b-ac71-46d4-a3a6-84ccce48df6f":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Das Einmalpasswort ist falsch oder abgelaufen."});break}case"36b96a7d-b547-412d-aeed-2d611cdc8cdc":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Unbekannter Passkey"});break}case"93b86c4b-72f9-40eb-9815-798928603d1e":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Die Passkey-Verifizierung ist fehlgeschlagen."});break}case"b18c89a7-5b5e-4cec-bb5b-0419f332d430":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Die Passkey-Verifizierung ist fehlgeschlagen."});break}case"2d84773e-f7b7-4d0b-8f72-bb69b584c912":{w({type:"error",title:"Anmeldung fehlgeschlagen",text:"Die Verifizierung des Passkeys war erfolgreich, aber die passwortlose Anmeldung ist deaktiviert."});break}default:console.error(n),w({type:"error",title:"Anmeldung fehlgeschlagen",text:JSON.stringify(n)})}h.value===!0&&(h.value=!1,a.value="input",t.value=""),u.value?.resetCaptcha(),Z(()=>{r.value=!1})}return se(()=>{t.value="",v.value=!1,i.value=null}),(n,p)=>{const E=N("MkLoading");return c(),P("div",{class:"xegeM"},[b(ae,{mode:"out-in",enterActiveClass:"xz5bY",leaveActiveClass:"xplZI",enterFromClass:"xxveb",leaveToClass:"xr4Ob",inert:r.value},{default:f(()=>[a.value==="input"?(c(),M(ge,{key:"input",message:l.message,openOnRemote:l.openOnRemote,initialUsername:l.initialUsername,onUsernameSubmitted:L,onPasskeyClick:q},null,8,["message","openOnRemote","initialUsername"])):a.value==="password"?(c(),M(xe,{key:"password",ref_key:"passwordPageEl",ref:u,user:i.value,needCaptcha:v.value,onPasswordSubmitted:j},null,8,["user","needCaptcha"])):a.value==="totp"?(c(),M(Re,{key:"totp",onTotpSubmitted:z})):a.value==="passkey"?(c(),M($e,{key:"passkey",credentialRequest:o.value,isPerformingPasswordlessLogin:h.value,onDone:B,onUseTotp:K},null,8,["credentialRequest","isPerformingPasswordlessLogin"])):S("",!0)]),_:1},8,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass","inert"]),r.value?(c(),P("div",{key:0,class:"xg2ds"},[b(E)],2)):S("",!0)],2)}}});export{Ie as M};
