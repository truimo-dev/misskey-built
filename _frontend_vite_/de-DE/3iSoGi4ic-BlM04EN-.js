import{aS as S,a7 as K,ag as W,M as I,ab as X,ad as Y,J as k,A as O}from"./3iSoGi4ic-DV-GuiCp.js";import{s as T}from"./3iSoGi4ic-DI0ojuRL.js";import{M as Z}from"./3iSoGi4ic-DLCHT8hS.js";import{b as ee,N as te,u as ae,a as y,c as g,e as oe,z as ie,f as N,i as m,h as l,l as h,p,B as r,D as u,E as d,t as n,R as B,C as se}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const le={key:0,style:{display:"flex","flex-direction":"column","min-height":"100%"}},ne={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px","flex-grow":"1"}},re={key:0,class:"ti ti-plus",style:{"line-height":"normal"}},ue={key:1,class:"ti ti-settings",style:{"line-height":"normal"}},de={key:1},_e=ee({__name:"notification-recipient.editor",props:{mode:{},id:{}},emits:["submitted","canceled","closed"],setup(U,{emit:$}){const f=$,J=U,{mode:x,id:V}=te(J),v=ae("dialogEl"),C=y(0),b=y(""),{model:i,def:j}=S({items:[{label:"Email",value:"email"},{label:"Webhook",value:"webhook"}],initialValue:"email"}),{model:c,def:z}=S({items:g(()=>M.value.map(e=>({label:e.name?`${e.name}(${e.username})`:e.username,value:e.id})))}),{model:s,def:L}=S({items:g(()=>E.value.map(e=>({label:e.name,value:e.id})))}),_=y(!0),M=y([]),E=y([]),P=g(()=>{switch(i.value){case"email":return "Die Benachrichtigung wird bei Eingang einer Meldung an die E-Mail-Adressen der Moderatoren gesendet";case"webhook":return "Sendet eine Benachrichtigung an den System Webhook, wenn eine Meldung eingegangen ist oder gelöst wurde";default:return""}}),Q=g(()=>{if(!b.value)return!0;switch(i.value){case"email":return c.value===null;case"webhook":return s.value===null;default:return!0}});async function q(){await w(async()=>{const e=i.value==="email"?c.value:null,t=i.value==="webhook"?s.value:null,R={isActive:_.value,name:b.value,method:i.value,userId:e??void 0,systemWebhookId:t??void 0};try{switch(x.value){case"create":{await k("admin/abuse-report/notification-recipient/create",R);break}case"edit":{await k("admin/abuse-report/notification-recipient/update",{id:V.value,...R});break}}v.value?.close(),f("submitted")}catch(o){const H=o.message??"Im Server ist ein unerwarteter Fehler aufgetreten.";await O({type:"error",title:"Fehler",text:H}),v.value?.close(),f("canceled")}})}function D(){v.value?.close(),f("canceled")}async function F(){let e;s.value===null?e=await T({mode:"create"}):e=await T({mode:"edit",id:s.value}),e&&(await A(),s.value=e.id??null)}async function A(){await w(async()=>{E.value=[{id:null,name:"Neu erstellen"},...await k("admin/system-webhook/list",{})]})}async function G(){await w(async()=>{const e=Array.of();for(;;){const t=await k("admin/show-users",{limit:100,state:"adminOrModerator",origin:"local",offset:e.length});if(t.length===0)break;e.push(...t)}M.value=e})}async function w(e){C.value++;try{return await e()}finally{C.value--}}return oe(async()=>{await w(async()=>{if(await G(),await A(),x.value==="edit"){if(!V.value)throw new Error("id is required");try{const e=await k("admin/abuse-report/notification-recipient/show",{id:V.value});b.value=e.name,i.value=e.method,c.value=e.userId??null,s.value=e.systemWebhookId??null,_.value=e.isActive}catch(e){const t=e.message??"Im Server ist ein unerwarteter Fehler aufgetreten.";await O({type:"error",title:"Fehler",text:t}),v.value?.close(),f("canceled")}}else c.value=M.value[0]?.id??null,s.value=E.value[0]?.id??null})}),(e,t)=>{const R=ie("MkLoading");return m(),N(Y,{ref_key:"dialogEl",ref:v,width:400,height:490,withOkButton:!1,okButtonDisabled:!1,onClose:D,onClosed:t[5]||(t[5]=o=>f("closed"))},{header:l(()=>[u(d(n(x)==="create"?"Meldungsempfänger hinzufügen":"Bearbeite einen Empfänger für Meldungen"),1)]),default:l(()=>[C.value===0?(m(),h("div",le,[p("div",ne,[p("div",{class:"x33RQ _gaps_m"},[r(K,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o)},{label:l(()=>[u(d("Titel"),1)]),_:1},8,["modelValue"]),r(W,{modelValue:n(i),"onUpdate:modelValue":t[1]||(t[1]=o=>B(i)?i.value=o:null),items:n(j)},{label:l(()=>[u(d("Art der Benachrichtigung"),1)]),caption:l(()=>[u(d(P.value),1)]),_:1},8,["modelValue","items"]),p("div",null,[n(i)==="email"?(m(),N(W,{key:0,modelValue:n(c),"onUpdate:modelValue":t[2]||(t[2]=o=>B(c)?c.value=o:null),items:n(z)},{label:l(()=>[u(d("Zu benachrichtigender Benutzer"),1)]),_:1},8,["modelValue","items"])):n(i)==="webhook"?(m(),h("div",{key:1,class:"xjhfJ"},[r(W,{modelValue:n(s),"onUpdate:modelValue":t[3]||(t[3]=o=>B(s)?s.value=o:null),items:n(L),style:{flex:"1"}},{label:l(()=>[u(d("Zu verwendender Webhook"),1)]),_:1},8,["modelValue","items"]),r(I,{rounded:"",class:"xrnEO",onClick:F},{default:l(()=>[n(s)===null?(m(),h("span",re)):(m(),h("span",ue))]),_:1},8,["class"])],2)):se("",!0)]),r(Z),r(X,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=o=>_.value=o)},{label:l(()=>[u(d("Aktivieren"),1)]),_:1},8,["modelValue"])],2)]),p("div",{class:"xsOhO _buttonsCenter"},[r(I,{primary:"",rounded:"",disabled:Q.value,onClick:q},{default:l(()=>[t[6]||(t[6]=p("i",{class:"ti ti-check"},null,-1)),u(" "+d("OK"),1)]),_:1},8,["disabled"]),r(I,{rounded:"",onClick:D},{default:l(()=>[t[7]||(t[7]=p("i",{class:"ti ti-x"},null,-1)),u(" "+d("Abbrechen"),1)]),_:1})],2)])):(m(),h("div",de,[r(R)]))]),_:1},512)}}});export{_e as default};
