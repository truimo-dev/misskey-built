import{Q as A,a7 as I,M as C,d3 as N,J as h,E as _,L as V,C as P}from"./3iSoGi4ic-DV-GuiCp.js";import{M as $}from"./3iSoGi4ic-Fx-BY70c.js";import{M as F}from"./3iSoGi4ic-B70zSkp5.js";import{M as Q}from"./3iSoGi4ic-BDF7xMl0.js";import{b as W,u as X,a as x,w as q,z as L,f as T,i as p,a2 as Z,h as n,D as r,E as u,p as s,B as c,C as H,t as B,l as y,F as J,A as Y}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const j={style:{display:"flex","flex-direction":"column","min-height":"100%"}},G={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px","flex-grow":"1"}},K={class:"_gaps_m"},O={class:"_gaps"},ee=["onClick"],ce=W({__name:"avatar-decoration-edit-dialog",props:{avatarDecoration:{}},emits:["done","closed"],setup(D,{emit:S}){const M=A(),o=D,w=S,f=X("windowEl"),m=x(o.avatarDecoration?o.avatarDecoration.url:""),k=x(o.avatarDecoration?o.avatarDecoration.name:""),g=x(o.avatarDecoration?o.avatarDecoration.description:""),b=x(o.avatarDecoration?o.avatarDecoration.roleIdsThatCanBeUsedThisDecoration:[]),d=x([]);q(b,async()=>{d.value=(await Promise.all(b.value.map(t=>h("admin/roles/show",{roleId:t}).catch(()=>null)))).filter(t=>t!=null)},{immediate:!0});async function U(){const t=await h("admin/roles/list"),e=d.value.map(l=>l.id),{canceled:v,result:a}=await _({items:t.filter(l=>l.isPublic).filter(l=>!e.includes(l.id)).map(l=>({label:l.name,value:l.id}))});v||a==null||d.value.push(t.find(l=>l.id===a))}async function z(t,e){d.value=d.value.filter(v=>v.id!==t.id)}async function E(){const t={url:m.value,name:k.value,description:g.value,roleIdsThatCanBeUsedThisDecoration:d.value.map(e=>e.id)};if(o.avatarDecoration)await V("admin/avatar-decorations/update",{id:o.avatarDecoration.id,...t}),w("done",{updated:{id:o.avatarDecoration.id,...t}}),f.value?.close();else{const e=await V("admin/avatar-decorations/create",t);w("done",{created:e}),f.value?.close()}}async function R(){const{canceled:t}=await P({type:"warning",text:(({x})=>("Möchtest du „"+x+"“ wirklich entfernen?"))({x:k.value})});t||h("admin/avatar-decorations/delete",{id:o.avatarDecoration.id}).then(()=>{w("done",{deleted:!0}),f.value?.close()})}return(t,e)=>{const v=L("MkAvatar");return p(),T(N,{ref_key:"windowEl",ref:f,initialWidth:400,initialHeight:500,canResize:!0,onClose:e[4]||(e[4]=a=>f.value?.close()),onClosed:e[5]||(e[5]=a=>w("closed"))},Z({default:n(()=>[s("div",j,[s("div",G,[s("div",K,[s("div",{class:"xqzzN"},[s("div",{class:"xvd9b xzdSZ"},[c(v,{style:{width:"60px",height:"60px"},user:B(M),decorations:m.value!=""?[{url:m.value}]:[],forceShowDecoration:""},null,8,["user","decorations"])],2),s("div",{class:"xvd9b x9MQI"},[c(v,{style:{width:"60px",height:"60px"},user:B(M),decorations:m.value!=""?[{url:m.value}]:[],forceShowDecoration:""},null,8,["user","decorations"])],2)],2),c(I,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a)},{label:n(()=>[r(u("Name"),1)]),_:1},8,["modelValue"]),c(I,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a)},{label:n(()=>[r(u("Bild-URL"),1)]),_:1},8,["modelValue"]),c(Q,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a)},{label:n(()=>[r(u("Beschreibung"),1)]),_:1},8,["modelValue"]),c($,null,{label:n(()=>[r(u("Verfügbare Rollen"),1)]),suffix:n(()=>[r(u(d.value.length===0?"Alle":d.value.length),1)]),default:n(()=>[s("div",O,[c(C,{rounded:"",onClick:U},{default:n(()=>[e[7]||(e[7]=s("i",{class:"ti ti-plus"},null,-1)),r(" "+u("Hinzufügen"),1)]),_:1}),(p(!0),y(J,null,Y(d.value,a=>(p(),y("div",{key:a.id,class:"x58sV"},[c(F,{class:"xCmfy",role:a,forModeration:!0,detailed:!1,style:{"pointer-events":"none"}},null,8,["class","role"]),a.target==="manual"?(p(),y("button",{key:0,class:"_button xD1Xn",onClick:l=>z(a,l)},[...e[8]||(e[8]=[s("i",{class:"ti ti-x"},null,-1)])],10,ee)):(p(),y("button",{key:1,class:"_button xD1Xn",disabled:""},[...e[9]||(e[9]=[s("i",{class:"ti ti-ban"},null,-1)])],2))],2))),128))])]),_:1}),D.avatarDecoration?(p(),T(C,{key:0,danger:"",onClick:e[3]||(e[3]=a=>R())},{default:n(()=>[e[10]||(e[10]=s("i",{class:"ti ti-trash"},null,-1)),r(" "+u("Löschen"),1)]),_:1})):H("",!0)])]),s("div",{class:"xo6mc"},[c(C,{primary:"",rounded:"",style:{margin:"0 auto"},onClick:E},{default:n(()=>[e[11]||(e[11]=s("i",{class:"ti ti-check"},null,-1)),r(" "+u(o.avatarDecoration?"Aktualisieren":"Erstellen"),1)]),_:1})],2)])]),_:2},[D.avatarDecoration?{name:"header",fn:n(()=>[r(u(D.avatarDecoration.name),1)]),key:"0"}:{name:"header",fn:n(()=>[e[6]||(e[6]=r("New decoration",-1))]),key:"1"}]),1536)}}});export{ce as default};
