const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-ClDqOi4E.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Cz831_R7.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B3Lt9OYG.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Fx-BY70c.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Dkg-saem.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D1MdWo18.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-BX91TJn-.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-D1x0sUsI.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-PMDL3R3O.js"])))=>i.map(i=>d[i]);
import{d8 as At,bz as Ot,bF as It,ar as ut,e as et,d9 as $t,r as dt,M as oe,ah as Dt,d as it,h as Ut,C as fe,af as Vt,da as mt,J as we,A as Re,b2 as Ve,ab as gt,Z as Nt,a7 as be,aS as zt,b as Lt,ag as Pt,db as Ft,ca as Gt,az as qt}from"./3iSoGi4ic-DV-GuiCp.js";import{R as ft,b as se,N as Me,u as _e,a as j,c as H,w as Ne,e as Ee,o as vt,l as S,C as te,t as V,i as w,q as de,s as ze,g as me,p as D,E as U,n as je,d as Wt,f as ne,F as ve,A as Oe,B as $,j as Ht,v as Jt,h as k,D as G,a3 as Kt,z as Le,U as pt,aC as tt}from"./3iSoGi4ic-D0mTJ0Mu.js";import{M as Xt}from"./3iSoGi4ic-D1MdWo18.js";import{M as Ae}from"./3iSoGi4ic-Fx-BY70c.js";const Qt=["name","category","aliases","type","license","host","uri","publicUrl","isSensitive","localOnly","updatedAt"];function ae(l){return l||void 0}function Pe(l){return l===""?null:l}function ht(l){return l===""?[]:l.split(" ").map(c=>c.trim())}function wt(l){try{const c=JSON.parse(l);return Array.isArray(c)?c.every(i=>typeof i=="object"&&"id"in i&&"name"in i)?c.map(i=>({id:i.id,name:i.name})):[]:[]}catch(c){return console.warn(c),[]}}class Yt extends At{}const ge={row:-1,col:-1};function Ye(l,c,i,m){const e=c.using&&l.setting.valueTransformer?l.setting.valueTransformer(c,l,i):i;return{address:{row:c.index,col:l.index},value:e,column:l,row:c,selected:!1,ranged:!1,contentSize:{width:0,height:0},violation:{valid:!0,params:{column:l,row:c,value:i,allCells:[]},violations:[]},setting:m}}function Zt(l){l.selected=!1,l.ranged=!1,l.violation={valid:!0,params:{column:l.column,row:l.row,value:l.value,allCells:[]},violations:[]}}function yt(l){return l.hasAttribute("data-grid-cell")}function eo(l){return l.hasAttribute("data-grid-row")}function to(l){switch(l){case void 0:case"auto":return"auto";default:return`${l}px`}}function oo(l){const c=l.getAttribute("data-grid-cell-row");if(c===null)throw new Error("data-grid-cell-row attribute not found");return Number(c)}function no(l){const c=l.getAttribute("data-grid-cell-col");if(c===null)throw new Error("data-grid-cell-col attribute not found");return Number(c)}function Se(l,c=10){let i=l;for(let m=0;m<c&&i.parentElement;m++){if(yt(i)&&eo(i.parentElement)){const e=oo(i),u=no(i);return{row:e,col:u}}i=i.parentElement}return ge}function Ue(l,c=10){let i=l;for(let m=0;m<c;m++){if(yt(i))return i;if(!i.parentElement)break;i=i.parentElement}return null}function Be(l,c){return l.row===c.row&&l.col===c.col}function ye(l,c){const i=ft(l)?l.value:l,m=Array.of(),e=c.randedBounds;for(let r=e.leftTop.row;r<=e.rightBottom.row;r++){const g=Array.of();for(let M=e.leftTop.col;M<=e.rightBottom.col;M++){const{bindTo:R,events:N}=c.columns[M].setting,p=i[r][R],h=N?.copy?N.copy(p):typeof p=="object"||Array.isArray(p)?JSON.stringify(p):p?.toString()??"";g.push(h)}m.push(g.join("	"))}const u=m.join(`
`);Ot(u)}async function lo(l,c){function i(r,g){if(g.events?.paste)return g.events.paste(r);switch(g.type){case"number":return Number(r);case"boolean":return r==="true";default:return r}}const m=await navigator.clipboard.readText(),e=l.randedBounds,u=m.replace(/\r/g,"").split(`
`).map(r=>r.split("	"));if(u.length===1&&u[0].length===1){const r=l.rangedCells;for(const g of r)g.column.setting.editable&&c(g.row,g.column,i(u[0][0],g.column.setting))}else{const r=e.leftTop.row,g=e.leftTop.col,{columns:M,rows:R}=l;for(let N=e.leftTop.row;N<=e.rightBottom.row;N++){const p=N-r;if(u.length<=p)break;const h=u[p];for(let P=e.leftTop.col;P<=e.rightBottom.col;P++){const z=P-g;if(h.length<=z)break;M[P].setting.editable&&c(R[N],M[P],i(h[z],M[P].setting))}}}}function xt(l,c){for(const i of l.rangedCells){const{editable:m,events:e}=i.column.setting;m&&(e?.delete?e.delete(i,l):c(i))}}const so=["data-grid-cell-row","data-grid-cell-col"],ao={key:0},io={key:1},ro={key:2},co={key:3},uo={key:4},mo=["src","alt"],go=["value"],fo=["value"],vo=["value"],po=se({__name:"MkDataCell",props:{cell:{},rowSetting:{},bus:{}},emits:["operation:beginEdit","operation:endEdit","change:value","change:contentSize"],setup(l,{emit:c}){const i=c,m=l,{cell:e,bus:u}=Me(m),r=_e("rootEl"),g=_e("contentAreaEl"),M=_e("inputAreaEl"),R=j(!1),N=j(void 0),p=H(()=>e.value.column.width),h=H(()=>e.value.column.setting.type),P=H(()=>{switch(h.value){case"boolean":return!0;default:return!1}});Ne(()=>[e.value.value],()=>{je(Y)},{immediate:!0}),Ne(()=>e.value.selected,()=>{e.value.selected&&W()});function z(I){switch(I.type){case"dblclick":{J(I.target);break}}}function E(I){(I.target instanceof Node&&!r.value?.contains(I.target)||!Be(e.value.address,Se(I.target)))&&ee(!0,!1)}function X(I){if(R.value)switch(I.code){case"Escape":{ee(!1,!0);break}case"NumpadEnter":case"Enter":I.isComposing||ee(!0,!0)}else switch(I.preventDefault(),I.code){case"NumpadEnter":case"Enter":case"F2":{J(I.target);break}}}function Q(I){N.value=I.target.value}function C(){Y()}function B(){O(),addEventListener("mousedown",E)}function O(){removeEventListener("mousedown",E)}async function J(I){if(!(R.value||!e.value.selected||!e.value.column.setting.editable))if(e.value.column.setting.customValueEditor){i("operation:beginEdit",e.value);const b=await e.value.column.setting.customValueEditor(e.value.row,e.value.column,e.value.value,I);i("operation:endEdit",e.value),b!==e.value.value&&x(b),W()}else switch(h.value){case"number":case"date":case"text":{N.value=e.value.value,R.value=!0,B(),i("operation:beginEdit",e.value),await je(()=>{M.value&&M.value.querySelector("*").focus()});break}case"boolean":{x(!e.value.value);break}}}function ee(I,b){if(!R.value)return;const a=N.value;N.value=void 0,i("operation:endEdit",e.value),O(),I&&a!==e.value.value&&x(a),R.value=!1,b&&W()}function W(){je(()=>{r.value?.focus()})}function x(I){const b=e.value;i("change:value",b,I)}function Y(){i("change:contentSize",e.value,{width:g.value?.clientWidth??0,height:g.value?.clientHeight??0})}return It(r,I=>{if(e.value.violation.valid)return;const b=e.value.violation.violations.filter(y=>!y.valid).map(y=>y.result.message).join(`
`),a=ut(Wt(()=>et(()=>import("./3iSoGi4ic-ClDqOi4E.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url)),{showing:I,content:b,anchorElement:r.value},{closed:()=>{a.dispose()}})}),Ee(()=>{u.value.on("forceRefreshContentSize",C)}),vt(()=>{u.value.off("forceRefreshContentSize",C)}),(I,b)=>V(e).row.using?(w(),S("div",{key:0,ref_key:"rootEl",ref:r,class:"mk_grid_td xz6zJ",style:ze({maxWidth:p.value,minWidth:p.value}),tabindex:-1,"data-grid-cell":"","data-grid-cell-row":V(e).row.index,"data-grid-cell-col":V(e).column.index,onKeydown:X,onDblclick:de(z,["prevent"])},[D("div",{class:me(["xjqJL",[V(e).violation.valid||V(e).selected?{}:"xD37i"],[V(e).selected?"xfGIP":{}],[V(e).ranged&&!V(e).row.ranged?"xbEH1":{}],[P.value?"xl2VN":{}]])},[R.value?(w(),S("div",{key:1,ref_key:"inputAreaEl",ref:M,class:"xulX7"},[h.value==="text"?(w(),S("input",{key:0,type:"text",class:"xjPe7",value:N.value,onInput:Q,onMousedown:b[0]||(b[0]=de(()=>{},["stop"])),onContextmenu:b[1]||(b[1]=de(()=>{},["stop"]))},null,42,go)):te("",!0),h.value==="number"?(w(),S("input",{key:1,type:"number",class:"xjPe7",value:N.value,onInput:Q,onMousedown:b[2]||(b[2]=de(()=>{},["stop"])),onContextmenu:b[3]||(b[3]=de(()=>{},["stop"]))},null,42,fo)):te("",!0),h.value==="date"?(w(),S("input",{key:2,type:"date",class:"xjPe7",value:N.value,onInput:Q,onMousedown:b[4]||(b[4]=de(()=>{},["stop"])),onContextmenu:b[5]||(b[5]=de(()=>{},["stop"]))},null,42,vo)):te("",!0)],2)):(w(),S("div",{key:0,class:"x7jMb",style:ze(h.value==="boolean"?"justify-content: center":"")},[D("div",{ref_key:"contentAreaEl",ref:g,class:"xnGGh"},[h.value==="text"?(w(),S("div",ao,U(V(e).value),1)):te("",!0),h.value==="number"?(w(),S("div",io,U(V(e).value),1)):te("",!0),h.value==="date"?(w(),S("div",ro,U(V(e).value),1)):h.value==="boolean"?(w(),S("div",co,[D("div",{class:me(["xg56k",{xc7ON:V(e).value===!0,"ti ti-check":V(e).value===!0}])},null,2)])):h.value==="image"?(w(),S("div",uo,[V(e).value&&typeof V(e).value=="string"?(w(),S("img",{key:0,src:V(e).value,alt:V(e).value,class:"xfMk7",onLoad:Y},null,42,mo)):te("",!0)])):te("",!0)],2)],6))],2)],46,so)):te("",!0)}});const ho=["data-grid-cell-row"],bt=se({__name:"MkNumberCell",props:{content:{},row:{}},setup(l){return(c,i)=>(w(),S("div",{class:"mk_grid_th x4lT0",tabindex:-1,"data-grid-cell":"","data-grid-cell-row":l.row?.index??-1,"data-grid-cell-col":-1},[D("div",{class:"x1V0E"},U(l.content),3)],10,ho))}});const wo=["data-grid-row"],yo=se({__name:"MkDataRow",props:{row:{},cells:{},setting:{},bus:{}},emits:["operation:beginEdit","operation:endEdit","change:value","change:contentSize"],setup(l,{emit:c}){const i=c;return(m,e)=>(w(),S("div",{class:me(["mk_grid_tr",["xlZt5",l.row.ranged?"xqgCb":{},...(l.row.additionalStyles??[]).map(u=>u.className??{})]]),style:ze([...(l.row.additionalStyles??[]).map(u=>u.style??{})]),"data-grid-row":l.row.index},[l.setting.showNumber?(w(),ne(bt,{key:0,content:(l.row.index+1).toString(),row:l.row},null,8,["content","row"])):te("",!0),(w(!0),S(ve,null,Oe(l.cells,u=>(w(),ne(po,{key:u.address.col,vIf:u.column.setting.type!=="hidden",cell:u,rowSetting:l.setting,bus:l.bus,"onOperation:beginEdit":e[0]||(e[0]=r=>i("operation:beginEdit",r)),"onOperation:endEdit":e[1]||(e[1]=r=>i("operation:endEdit",r)),"onChange:value":e[2]||(e[2]=(r,g)=>i("change:value",r,g)),"onChange:contentSize":e[3]||(e[3]=(r,g)=>i("change:contentSize",r,g))},null,8,["vIf","cell","rowSetting","bus"]))),128))],14,wo))}});const xo=["data-grid-cell-col"],bo={key:1},Co=se({__name:"MkHeaderCell",props:{column:{},bus:{}},emits:["operation:beginWidthChange","operation:endWidthChange","operation:widthLargest","change:width","change:contentSize"],setup(l,{emit:c}){const i=c,m=l,{column:e,bus:u}=Me(m),r=_e("rootEl"),g=_e("contentEl"),M=j(!1),R=H(()=>{const O=e.value.setting.title??e.value.setting.bindTo;return O.length>0?O:"　"});Ne(e,()=>{je(B)},{immediate:!0});function N(O){switch(O.type){case"dblclick":{i("operation:widthLargest",e.value);break}}}function p(O){switch(O.type){case"mousedown":{M.value||(Q(),E(),M.value=!0,i("operation:beginWidthChange",e.value));break}}}function h(O){if(r.value)switch(O.type){case"mousemove":{if(M.value){const J=r.value.getBoundingClientRect(),ee=r.value.clientWidth,W=J.left+ee,x=ee+(O.clientX-W);i("change:width",e.value,`${x}px`)}break}}}function P(O){switch(O.type){case"mouseup":{M.value&&(C(),X(),M.value=!1,i("operation:endWidthChange",e.value));break}}}function z(){B()}function E(){X(),addEventListener("mousemove",h)}function X(){removeEventListener("mousemove",h)}function Q(){C(),addEventListener("mouseup",P)}function C(){removeEventListener("mouseup",P)}function B(){const O=g.value?.clientWidth??0,J=g.value?.clientHeight??0;i("change:contentSize",e.value,{width:O+3+3,height:J})}return Ee(()=>{u.value.on("forceRefreshContentSize",z)}),vt(()=>{u.value.off("forceRefreshContentSize",z)}),(O,J)=>(w(),S("div",{ref_key:"rootEl",ref:r,class:"mk_grid_th xlXGj",style:ze([{maxWidth:V(e).width,minWidth:V(e).width,width:V(e).width}]),"data-grid-cell":"","data-grid-cell-row":-1,"data-grid-cell-col":V(e).index},[D("div",{class:"xEsPk"},[D("div",{class:"xlAYg"},null,2),D("div",{class:"xpv2U"},[D("div",{ref_key:"contentEl",ref:g,class:"xpFgb"},[V(e).setting.icon?(w(),S("span",{key:0,class:me(["ti",V(e).setting.icon]),style:{"line-height":"normal"}},null,2)):(w(),S("span",bo,U(R.value),1))],2)],2),D("div",{class:"xBGrI",onMousedown:p,onDblclick:N},null,34)],2)],14,xo))}});const _o=se({__name:"MkHeaderRow",props:{columns:{},gridSetting:{},bus:{}},emits:["operation:beginWidthChange","operation:endWidthChange","operation:widthLargest","operation:selectionColumn","change:width","change:contentSize"],setup(l,{emit:c}){const i=c;return(m,e)=>(w(),S("div",{class:"mk_grid_tr xeCLP","data-grid-row":-1},[l.gridSetting.showNumber?(w(),ne(bt,{key:0,content:"#",top:!0})):te("",!0),(w(!0),S(ve,null,Oe(l.columns,u=>(w(),ne(Co,{key:u.index,column:u,bus:l.bus,"onOperation:beginWidthChange":e[0]||(e[0]=r=>i("operation:beginWidthChange",r)),"onOperation:endWidthChange":e[1]||(e[1]=r=>i("operation:endWidthChange",r)),"onOperation:widthLargest":e[2]||(e[2]=r=>i("operation:widthLargest",r)),"onChange:width":e[3]||(e[3]=(r,g)=>i("change:width",r,g)),"onChange:contentSize":e[4]||(e[4]=(r,g)=>i("change:contentSize",r,g))},null,8,["column","bus"]))),128))],2))}});function rt(l,c,i){const{column:m,row:e}=c,u=m.setting.validators??[],r={column:m,row:e,value:i,allCells:l},g=u.map(M=>{const R=M.validate(r);return{valid:R.valid,validator:M,result:R}});return{valid:g.every(M=>M.result.valid),params:r,violations:g}}class ko{required(){return{name:"required",validate:({value:c})=>({valid:c!=null&&c!=="",message:"This value is required"})}}regex(c){return{name:"regex",validate:({value:i})=>({valid:typeof i!="string"||c.test(i.toString()??""),message:(({pattern})=>("This value doesn't match the pattern in "+pattern))({pattern:c.source})})}}unique(){return{name:"unique",validate:({column:c,row:i,value:m,allCells:e})=>{const u=c.setting.bindTo;return{valid:e.filter(g=>g.column.setting.bindTo===u&&g.row.index!==i.index).every(g=>g.value!==m),message:"This value must be unique"}}}}}const ke=new ko;function Mo(l,c){return{index:c,setting:l,width:to(l.width),contentSize:{width:0,height:0}}}const Eo={showNumber:!0,selectable:!0,minimumDefinitionCount:100,styleRules:[],contextMenuFactory:()=>[],events:{}};function Ze(l,c,i){return{index:l,ranged:!1,using:c,setting:i,additionalStyles:[]}}function To(l){l.ranged=!1,l.using=!1,l.additionalStyles=[]}const So={class:"mk_grid_thead"},Bo={class:"mk_grid_tbody"},Fe=se({__name:"MkGrid",props:{settings:{},data:{}},emits:["event"],setup(l,{emit:c}){const i=c,m=l,e={noOverflowStyle:!1,rounded:!0,outerBorder:!0,...m.settings.root},u={...Eo,...m.settings.row},r=m.settings.cols,g=m.settings.cells??{},{data:M}=Me(m),R=new Yt,N=new ResizeObserver(t=>window.setTimeout(()=>Y(t))),p=_e("rootEl"),h=j("normal"),P=j(r.map(Mo)),z=j([]),E=j([]),X=j(ge),Q=j(ge),C=j(ge.col),B=j(ge.row),O=H(()=>{const t=E.value.flatMap(o=>o.cells).filter(o=>o.selected);return t.length>0?t[0]:void 0}),J=H(()=>E.value.flatMap(t=>t.cells).filter(t=>t.ranged)),ee=H(()=>{const t=J.value,o=t.map(n=>n.address.col),s=t.map(n=>n.address.row),v={col:Math.min(...o),row:Math.min(...s)},f={col:Math.max(...o),row:Math.max(...s)};return{leftTop:v,rightBottom:f}}),W=H(()=>{const t={col:0,row:0},o={col:Math.max(...P.value.map(s=>s.index)),row:Math.max(...z.value.filter(s=>s.using).map(s=>s.index))};return{leftTop:t,rightBottom:o}}),x=H(()=>z.value.filter(t=>t.ranged));H(()=>z.value.filter(t=>t.using).length-1),Ne(M,Rt,{deep:!0});function Y(t){if(t.length!==1||t[0].target!==p.value)return;const o=t[0].contentRect;switch(h.value){case"hidden":{o.width>0&&o.height>0&&(h.value="normal",pe(),R.emit("forceRefreshContentSize"));break}default:{(o.width===0||o.height===0)&&(h.value="hidden");break}}}function I(t){const{ctrlKey:o,shiftKey:s,code:v}=t;function f(n){Ie(n.leftTop,n.rightBottom),he(n.leftTop,n.rightBottom)}switch(h.value){case"normal":{t.preventDefault(),t.stopPropagation();const n=O.value?.address??ge,T=W.value,_=ee.value;$t({delete:()=>{if(x.value.length>0)u.events.delete&&u.events.delete(x.value);else{const le=De();xt(le,ce=>{We(ce,void 0)})}},"ctrl+c|meta+c":()=>{const le=De();ye(M.value,le)},"ctrl+v|meta+v":async()=>{const le=E.value,ce=De();await lo(ce,(ue,Te,jt)=>{We(le[ue.index].cells[Te.index],jt)})},"ctrl+shift+right|meta+shift+right":()=>{f({leftTop:{col:n.col,row:_.leftTop.row},rightBottom:{col:T.rightBottom.col,row:_.rightBottom.row}})},"ctrl+shift+left|meta+shift+left":()=>{f({leftTop:{col:T.leftTop.col,row:_.leftTop.row},rightBottom:{col:n.col,row:_.rightBottom.row}})},"ctrl+shift+up|meta+shift+up":()=>{f({leftTop:{col:_.leftTop.col,row:T.leftTop.row},rightBottom:{col:_.rightBottom.col,row:n.row}})},"ctrl+shift+down|meta+shift+down":()=>{f({leftTop:{col:_.leftTop.col,row:n.row},rightBottom:{col:_.rightBottom.col,row:T.rightBottom.row}})},"ctrl+right|meta+right":()=>{re({col:T.rightBottom.col,row:n.row})},"ctrl+left|meta+left":()=>{re({col:T.leftTop.col,row:n.row})},"ctrl+up|meta+up":()=>{re({col:n.col,row:T.leftTop.row})},"ctrl+down|meta+down":()=>{re({col:n.col,row:T.rightBottom.row})},"shift+right":()=>{f({leftTop:{col:_.leftTop.col<n.col?_.leftTop.col+1:n.col,row:_.leftTop.row},rightBottom:{col:_.rightBottom.col>n.col||_.leftTop.col===n.col?_.rightBottom.col+1:n.col,row:_.rightBottom.row}})},"shift+left":()=>{f({leftTop:{col:_.leftTop.col<n.col||_.rightBottom.col===n.col?_.leftTop.col-1:n.col,row:_.leftTop.row},rightBottom:{col:_.rightBottom.col>n.col?_.rightBottom.col-1:n.col,row:_.rightBottom.row}})},"shift+up":()=>{f({leftTop:{col:_.leftTop.col,row:_.leftTop.row<n.row||_.rightBottom.row===n.row?_.leftTop.row-1:n.row},rightBottom:{col:_.rightBottom.col,row:_.rightBottom.row>n.row?_.rightBottom.row-1:n.row}})},"shift+down":()=>{f({leftTop:{col:_.leftTop.col,row:_.leftTop.row<n.row?_.leftTop.row+1:n.row},rightBottom:{col:_.rightBottom.col,row:_.rightBottom.row>n.row||_.leftTop.row===n.row?_.rightBottom.row+1:n.row}})},down:()=>{re({col:n.col,row:n.row+1})},up:()=>{re({col:n.col,row:n.row-1})},right:()=>{re({col:n.col+1,row:n.row})},left:()=>{re({col:n.col-1,row:n.row})}},[])(t);break}}}function b(t){switch(t.button){case 0:{a(t);break}case 2:{y(t);break}}}function a(t){const o=Se(t.target);switch(h.value){case"cellEditing":{xe(o)&&!Be(Q.value,o)&&re(o);break}case"normal":{if(xe(o)){if(t.shiftKey&&O.value&&!Be(o,O.value.address)){const s=O.value.address,v={col:Math.min(s.col,o.col),row:Math.min(s.row,o.row)},f={col:Math.max(s.col,o.col),row:Math.max(s.row,o.row)};pe(),he(v,f),E.value[s.row].cells[s.col].selected=!0}else re(o);X.value=o,Qe(),Xe(),h.value="cellSelecting"}else if(Je(o)){if(t.shiftKey){const s=J.value.map(T=>T.address.col),v=[o.col,...s];pe();const f={col:Math.min(...v),row:0},n={col:Math.max(...v),row:E.value.length-1};he(f,n),s.length===0?C.value=o.col:o.col>Math.min(...s)?C.value=Math.min(...s):C.value=Math.max(...s)}else{pe();const s=E.value.map(v=>v.cells[o.col]);nt(...s.map(v=>v.address)),C.value=o.col}Qe(),Xe(),X.value=o,h.value="colSelecting",Ue(t.target)?.focus()}else if(Ke(o)){if(t.shiftKey){const s=x.value.map(T=>T.index),v=[o.row,...s];pe();const f={col:0,row:Math.min(...v)},n={col:Math.min(...E.value.map(T=>T.cells.length-1)),row:Math.max(...v)};he(f,n),He(Math.min(...v),Math.max(...v)),s.length===0?B.value=o.row:o.col>Math.min(...s)?B.value=Math.min(...s):B.value=Math.max(...s)}else{pe();const s=E.value[o.row].cells;nt(...s.map(v=>v.address)),He(o.row,o.row),B.value=o.row}Qe(),Xe(),X.value=o,h.value="rowSelecting",Ue(t.target)?.focus()}break}}}function y(t){const o=Se(t.target);switch(h.value){case"normal":{if(!xe(o))return;[...J.value].some(v=>Be(v.address,o))||re(o);break}}}function A(t){t.preventDefault();const o=Se(t.target);if(!Be(X.value,o))switch(h.value){case"cellSelecting":{const s=O.value?.address;if(!xe(o)||!s)return;const v={col:Math.min(o.col,s.col),row:Math.min(o.row,s.row)},f={col:Math.max(o.col,s.col),row:Math.max(o.row,s.row)};Ie(v,f),he(v,f),X.value=o;break}case"colSelecting":{if(!Je(o)||X.value.col===o.col)return;const s={col:Math.min(o.col,C.value),row:0},v={col:Math.max(o.col,C.value),row:E.value.length-1};Ie(s,v),he(s,v),X.value=o,Ue(t.target)?.focus();break}case"rowSelecting":{if(!Ke(o)||X.value.row===o.row)return;const s={col:0,row:Math.min(o.row,B.value)},v={col:Math.min(...E.value.map(n=>n.cells.length-1)),row:Math.max(o.row,B.value)};Ie(s,v),he(s,v);const f=[z.value[o.row].index,...x.value.map(n=>n.index)];He(Math.min(...f),Math.max(...f)),X.value=o,Ue(t.target)?.focus();break}}}function F(t){switch(t.preventDefault(),h.value){case"rowSelecting":case"colSelecting":case"cellSelecting":{at(),st(),h.value="normal",X.value=ge;break}}}function L(t){const o=Se(t.target),s=De(),v=Array.of();switch(!0){case xe(o):{const f=E.value[o.row].cells[o.col];f.setting.contextMenuFactory&&v.push(...f.setting.contextMenuFactory(f.column,f.row,f.value,s));break}case Je(o):{const f=P.value[o.col];f.setting.contextMenuFactory&&v.push(...f.setting.contextMenuFactory(f,s));break}case Ke(o):{const f=z.value[o.row];f.setting.contextMenuFactory&&v.push(...f.setting.contextMenuFactory(f,s));break}}v.length>0&&dt(v,t)}function K(t){h.value="cellEditing",Q.value=t.address;for(const o of E.value.flatMap(s=>s.cells))(o.address.col!==t.address.col||o.address.row!==t.address.row)&&(o.selected=!1)}function ie(){Q.value=ge,h.value="normal"}function q(t,o){$e([t]),We(t,o)}function Z(t,o){const s=E.value;if(s.length>t.address.row&&s[t.address.row].cells.length>t.address.col){const v=s[t.address.row].cells[t.address.col].contentSize;(v.width!==o.width||v.height!==o.height)&&(s[t.address.row].cells[t.address.col].contentSize=o,t.column.setting.width==="auto"&&qe(t.column))}}function Ge(){switch(h.value){case"normal":{h.value="colResizing";break}}}function Mt(){switch(h.value){case"colResizing":{h.value="normal";break}}}function Et(t,o){switch(h.value){case"colResizing":{const s=P.value[t.index];s.width=o;break}}}function Tt(t,o){switch(h.value){case"normal":{const s=P.value[t.index].contentSize;(s.width!==o.width||s.height!==o.height)&&(P.value[t.index].contentSize=o,t.setting.width==="auto"&&qe(t));break}}}function St(t){switch(h.value){case"normal":{qe(t);break}}}function qe(t){const o=E.value,s=P.value[t.index].contentSize.width,v=o.length>0?o.map(f=>f.cells[t.index]).reduce((f,n)=>Math.max(f,n.contentSize.width),0):0;t.width=`${Math.max(s,v)}px`}function ot(t){const o={selectedCell:O.value,rangedCells:J.value,rangedRows:x.value,randedBounds:ee.value,availableBounds:W.value,state:h.value,rows:z.value,columns:P.value};i("event",t,o)}function We(t,o){const s="address"in t?t.address:t,v=E.value[s.row].cells[s.col];ot({type:"cell-value-change",column:v.column,row:v.row,oldValue:v.value,newValue:o})}function re(t){if(!xe(t))return;pe();const o=E.value;o[t.row].cells[t.col].selected=!0,o[t.row].cells[t.col].ranged=!0}function nt(...t){const o=E.value;for(const s of t){const v=o[s.row];v.row.using&&(v.cells[s.col].ranged=!0)}}function pe(){const t=J.value;for(const s of t)s.selected=!1,s.ranged=!1;const o=z.value.filter(s=>s.using);for(const s of o)s.ranged=!1}function Ie(t,o){const s=lt({leftTop:t,rightBottom:o}),v=J.value;for(const n of v){const T=n.address.col<s.leftTop.col||n.address.col>s.rightBottom.col,_=n.address.row<s.leftTop.row||n.address.row>s.rightBottom.row;(T||_)&&(n.ranged=!1)}const f=z.value.filter((n,T)=>T<s.leftTop.row||T>s.rightBottom.row);for(const n of f)n.ranged=!1}function he(t,o){const s=lt({leftTop:t,rightBottom:o}),v=E.value.slice(s.leftTop.row,s.rightBottom.row+1);for(const f of v)for(const n of f.cells.slice(s.leftTop.col,s.rightBottom.col+1))n.ranged=!0}function He(t,o){if(!u.selectable)return;const s=z.value.slice(t,o+1);for(const v of s)v.ranged=!0}function $e(t){const o=z.value,s=[...new Set(t.map(n=>n.address.row))],v=Array.of();for(const n of s){const T=t.filter(_=>_.address.row===n);v.push({row:o[n],cells:T})}const f=E.value;for(const n of v.filter(T=>T.row.using)){const T=n.row,_=n.cells.map(ue=>ue.column),le=f[n.row.index].cells,ce=u.styleRules.filter(ue=>ue.condition({row:T,targetCols:_,cells:le})).map(ue=>ue.applyStyle);JSON.stringify(ce)!==JSON.stringify(T.additionalStyles)&&(T.additionalStyles=ce)}}function xe(t){const o=W.value;return t.row>=o.leftTop.row&&t.col>=o.leftTop.col&&t.row<=o.rightBottom.row&&t.col<=o.rightBottom.col}function Je(t){return t.row===-1&&t.col>=0}function Ke(t){return t.row>=0&&t.col===-1}function lt(t){const o=W.value,s={col:Math.max(t.leftTop.col,o.leftTop.col),row:Math.max(t.leftTop.row,o.leftTop.row)},v={col:Math.min(t.rightBottom.col,o.rightBottom.col),row:Math.min(t.rightBottom.row,o.rightBottom.row)};return{leftTop:s,rightBottom:v}}function Xe(){st(),addEventListener("mousemove",A)}function st(){removeEventListener("mousemove",A)}function Qe(){at(),addEventListener("mouseup",F)}function at(){removeEventListener("mouseup",F)}function De(){return{selectedCell:O.value,rangedCells:J.value,rangedRows:x.value,randedBounds:ee.value,availableBounds:W.value,state:h.value,rows:z.value,columns:P.value}}function Bt(){const t=M.value,o=t.length>u.minimumDefinitionCount?t.map((n,T)=>Ze(T,!0,u)):Array.from({length:u.minimumDefinitionCount},(n,T)=>Ze(T,T<t.length,u)),s=P.value,v=o.map(n=>{const T=n.using?s.map(_=>Ye(_,n,t[n.index][_.setting.bindTo],g)):s.map(_=>Ye(_,n,void 0,g));return{row:n,cells:T,origin:t[n.index]}});z.value=o,E.value=v;const f=v.filter(n=>n.row.using).flatMap(n=>n.cells);for(const n of f)n.violation=rt(f,n,n.value);$e(f)}function Rt(t){const o=P.value;if(z.value.length<t.length){const f=Array.of(),n=Array.of();for(let T=z.value.length;T<t.length;T++){const _=Ze(T,!0,u);f.push(_),n.push({row:_,cells:o.map(le=>Ye(le,_,t[T][le.setting.bindTo],g)),origin:t[T]})}z.value.push(...f),E.value.push(...n),$e(n.flatMap(T=>T.cells))}const s=z.value.filter(f=>f.using);if(s.length>t.length)for(let f=t.length;f<s.length;f++){To(z.value[f]);for(let n=0;n<o.length;n++){const T=E.value[f];T.origin={},Zt(T.cells[n])}}const v=Array.of();for(let f=0;f<t.length;f++){const n=E.value[f];n.row.using=!0;const T=n.cells,_=t[f];for(let le=0;le<T.length;le++){const ce=P.value[le],ue=T[le],Te=_[ce.setting.bindTo];ue.value!==Te&&(ue.value=ce.setting.valueTransformer?ce.setting.valueTransformer(n.row,ce,Te):Te,v.push(ue))}}if(v.length>0){const f=E.value.slice(0,t.length).flatMap(n=>n.cells);for(const n of f)n.violation=rt(f,n,n.value);$e(v),ot({type:"cell-validation",all:E.value.filter(n=>n.row.using).flatMap(n=>n.cells).map(n=>n.violation).filter(n=>!n.valid)})}}return Ee(()=>{h.value="normal";const t=r.map(o=>o.bindTo);if(new Set(t).size!==r.length)throw new Error(`Duplicate bindTo setting : [${t.join(",")}]}]`);if(p.value){N.observe(p.value);const o=p.value.getBoundingClientRect();(o.width===0||o.height===0)&&(h.value="hidden")}Bt()}),(t,o)=>(w(),S("div",{ref_key:"rootEl",ref:p,class:me(["mk_grid_border",["xB7vE",{xfrz2:e.noOverflowStyle,mk_grid_root_rounded:e.rounded,mk_grid_root_border:e.outerBorder}]]),onMousedown:de(b,["prevent"]),onKeydown:I,onContextmenu:de(L,["prevent","stop"])},[D("div",So,[$(_o,{columns:P.value,gridSetting:u,bus:V(R),"onOperation:beginWidthChange":Ge,"onOperation:endWidthChange":Mt,"onOperation:widthLargest":St,"onChange:width":Et,"onChange:contentSize":Tt},null,8,["columns","bus"])]),D("div",Bo,[(w(!0),S(ve,null,Oe(z.value,s=>Ht((w(),ne(yo,{key:s.index,row:s,cells:E.value[s.index].cells,setting:u,bus:V(R),using:s.using,"onOperation:beginEdit":K,"onOperation:endEdit":ie,"onChange:value":q,"onChange:contentSize":Z},null,8,["row","cells","bus","using"])),[[Jt,s.using]])),128))])],34))}});const Ce=1,Ct=se({__name:"MkPagingButtons",props:{current:{},max:{},buttonCount:{}},emits:["pageChanged"],setup(l,{emit:c}){const i=c,m=l,{current:e,max:u}=Me(m),r=H(()=>Math.min(u.value,m.buttonCount)),g=H(()=>Math.floor(r.value/2)),M=H(()=>Math.min(Math.max(Ce,e.value-g.value),u.value-r.value+1)),R=H(()=>Array.from({length:r.value},(Q,C)=>M.value+C)),N=H(()=>e.value-1>g.value&&u.value>r.value),p=H(()=>e.value<u.value-g.value&&u.value>r.value);function h(Q){i("pageChanged",Q)}function P(){i("pageChanged",Ce)}function z(){const Q=e.value<=Ce?Ce:e.value-1;i("pageChanged",Q)}function E(){const Q=e.value>=u.value?u.value:e.value+1;i("pageChanged",Q)}function X(){i("pageChanged",u.value)}return(Q,C)=>(w(),S("div",{class:"x10ht"},[$(oe,{primary:"",disabled:Ce===V(e),onClick:z},{default:k(()=>[...C[0]||(C[0]=[G("<",-1)])]),_:1},8,["disabled"]),D("div",{class:"x5rUk"},[N.value?(w(),S("div",{key:0,class:"x1sOM"},[$(oe,{onClick:P},{default:k(()=>[G(U(Ce))]),_:1}),C[1]||(C[1]=D("span",{class:"ti ti-dots"},null,-1))],2)):te("",!0),(w(!0),S(ve,null,Oe(R.value,B=>(w(),ne(oe,{key:B,disabled:V(e)===B,onClick:O=>h(B)},{default:k(()=>[G(U(B),1)]),_:2},1032,["disabled","onClick"]))),128)),p.value?(w(),S("div",{key:1,class:"x1sOM"},[C[2]||(C[2]=D("span",{class:"ti ti-dots"},null,-1)),$(oe,{onClick:X},{default:k(()=>[G(U(V(u)),1)]),_:1})],2)):te("",!0)],2),$(oe,{primary:"",disabled:V(u)===V(e),onClick:E},{default:k(()=>[...C[3]||(C[3]=[G(">",-1)])]),_:1},8,["disabled"])],2))}});const _t=l=>{const c=j(0),i=()=>{c.value++},m=g=>{g?c.value=0:c.value=Math.max(0,c.value-1)},e=g=>{i();const M=g();return M instanceof Promise?M.finally(()=>m()):(m(),M)},u=H(()=>c.value>0),r=H(()=>u.value?Kt(Dt,l):null);return{show:i,close:m,scope:e,component:r,showing:u}},Ro={key:0,style:{"text-align":"center"}},jo=se({__name:"custom-emojis-manager.local.list",setup(l){function c(){const a=tt(),y=ke.required(),A=ke.regex(/^[a-zA-Z0-9_]+$/),F=ke.unique();return{root:{noOverflowStyle:!0,rounded:!1,outerBorder:!1},row:{showNumber:!0,selectable:!0,minimumDefinitionCount:100,styleRules:[{condition:({row:L})=>JSON.stringify(p.value[L.index])!==JSON.stringify(h.value[L.index]),applyStyle:{className:a.changedRow}},{condition:({cells:L})=>L.some(K=>!K.violation.valid),applyStyle:{className:a.violationRow}}],contextMenuFactory:(L,K)=>[{type:"button",text:"Copy selected rows",icon:"ti ti-copy",action:()=>ye(p,K)},{type:"button",text:"Mark selected rows as a target to delete",icon:"ti ti-trash",action:()=>{for(const ie of K.rangedRows)p.value[ie.index].checked=!0}}],events:{delete(L){for(const K of L)p.value[K.index].checked=!0}}},cols:[{bindTo:"checked",icon:"ti-trash",type:"boolean",editable:!0,width:34},{bindTo:"url",icon:"ti-icons",type:"image",editable:!0,width:"auto",validators:[y],async customValueEditor(L,K,ie,q){const Z=await Vt({anchorElement:q,multiple:!1});return p.value[L.index].url=Z.url,p.value[L.index].fileId=Z.id,Z.url}},{bindTo:"name",title:"name",type:"text",editable:!0,width:140,validators:[y,A,F]},{bindTo:"category",title:"category",type:"text",editable:!0,width:140},{bindTo:"aliases",title:"aliases",type:"text",editable:!0,width:140},{bindTo:"license",title:"license",type:"text",editable:!0,width:140},{bindTo:"isSensitive",title:"sensitive",type:"boolean",editable:!0,width:90},{bindTo:"localOnly",title:"localOnly",type:"boolean",editable:!0,width:90},{bindTo:"roleIdsThatCanBeUsedThisEmojiAsReaction",title:"role",type:"text",editable:!0,width:140,valueTransformer(L){return p.value[L.index].roleIdsThatCanBeUsedThisEmojiAsReaction.map(K=>K.name).join(",")},async customValueEditor(L){const K=p.value[L.index].roleIdsThatCanBeUsedThisEmojiAsReaction,ie=await mt({initialRoleIds:K.map(Z=>Z.id),title:"Roles that can use this emoji as reaction",infoMessage:"If no roles are specified, anyone can use this emoji as reaction.",publicOnly:!0});if(ie.canceled)return K;const q=ie.result.map(Z=>({id:Z.id,name:Z.name}));return p.value[L.index].roleIdsThatCanBeUsedThisEmojiAsReaction=q,q},events:{paste:wt,delete(L){p.value[L.row.index].roleIdsThatCanBeUsedThisEmojiAsReaction=[]}}},{bindTo:"type",type:"text",editable:!1,width:90},{bindTo:"updatedAt",type:"text",editable:!1,width:"auto"},{bindTo:"publicUrl",type:"text",editable:!1,width:180},{bindTo:"originalUrl",type:"text",editable:!1,width:180}],cells:{contextMenuFactory(L,K,ie,q){return[{type:"button",text:"Copy selection",icon:"ti ti-copy",action:()=>ye(p,q)},{type:"button",text:"Delete rows in the selection",icon:"ti ti-trash",action:()=>{xt(q,Z=>{p.value[Z.row.index][Z.column.setting.bindTo]=void 0})}},{type:"button",text:"Mark rows in the selection as a target to delete",icon:"ti ti-trash",action:()=>{for(const Z of[...new Set(q.rangedCells.map(Ge=>Ge.row.index)).values()])p.value[Z].checked=!0}}]}}}}const i=_t(),m=j([]),e=j(0),u=j(0),r=j({name:null,category:null,aliases:null,type:null,license:null,updatedAtFrom:null,updatedAtTo:null,sensitive:null,localOnly:null,roles:[],sortOrders:[],limit:100});let g=!1;const M=j(void 0),R=j([]),N=j([]),p=j([]),h=j([]),P=j(!1),z=H(()=>p.value.filter((a,y)=>!a.checked&&JSON.stringify(a)!==JSON.stringify(h.value[y])).length),E=H(()=>p.value.filter(a=>a.checked).length);async function X(){const a=p.value,y=h.value;if(a.length!==y.length)throw new Error("The number of items has been changed. Please refresh the page and try again.");const A=a.filter((q,Z)=>!q.checked&&JSON.stringify(q)!==JSON.stringify(y[Z]));if(A.length===0){await Re({type:"info",text:"There are no updated Emojis."});return}const{canceled:F}=await fe({type:"info",text:(({count})=>("Update "+count+" Emoji(s). Are you sure to continue?"))({count:A.length})});if(F)return;const L=()=>A.map(q=>we("admin/emoji/update",{id:q.id,name:q.name,category:Pe(q.category),aliases:ht(q.aliases),license:Pe(q.license),isSensitive:q.isSensitive,localOnly:q.localOnly,roleIdsThatCanBeUsedThisEmojiAsReaction:q.roleIdsThatCanBeUsedThisEmojiAsReaction.map(Z=>Z.id),fileId:q.fileId}).then(()=>({item:q,success:!0,err:void 0})).catch(Z=>({item:q,success:!1,err:Z}))),K=await Ve(Promise.all(L()));K.filter(q=>!q.success).length>0&&await Re({type:"error",title:"Щось пішло не так",text:"Failed to update or delete Emojis. Please check the registration log for details."}),N.value=K.map(q=>({failed:!q.success,url:q.item.url,name:q.item.name,error:q.err?JSON.stringify(q.err):void 0})),await x()}async function Q(){const a=p.value,y=h.value;if(a.length!==y.length)throw new Error("The number of items has been changed. Please refresh the page and try again.");const A=a.filter(K=>K.checked);if(A.length===0){await Re({type:"info",text:"There are no Emojis to be deleted."});return}const{canceled:F}=await fe({type:"info",text:(({count})=>("Delete checked "+count+" Emoji(s). Are you sure to continue?"))({count:A.length})});if(F)return;async function L(){const K=A.map(ie=>ie.id);await we("admin/emoji/delete-bulk",{ids:K})}await Ve(L())}async function C(){const{canceled:a}=await fe({type:"warning",title:"Справді скинути?",text:"今までに加えた変更がすべてリセットされます。"});a||Y()}async function B(){await x()}async function O(a){if(z.value>0){const{canceled:y}=await fe({type:"warning",title:"Would you like to move pages?",text:"Changes have been made to the Emojis on this page.\nIf you leave the page without saving, all changes made on this page will be discarded."});if(y)return}u.value=a,await je(),x()}function J(a){switch(a.type){case"cell-validation":ee(a);break;case"cell-value-change":W(a);break}}function ee(a){P.value=a.all.filter(y=>!y.valid).length>0}function W(a){const{row:y,column:A,newValue:F}=a;p.value.length>y.index&&A.setting.bindTo in p.value[y.index]&&(p.value[y.index][A.setting.bindTo]=F)}async function x(){const a=r.value.limit,y={name:ae(r.value.name),type:ae(r.value.type),aliases:ae(r.value.aliases),category:ae(r.value.category),license:ae(r.value.license),isSensitive:r.value.sensitive!=null?(!!r.value.sensitive).valueOf():void 0,localOnly:r.value.localOnly!=null?(!!r.value.localOnly).valueOf():void 0,updatedAtFrom:ae(r.value.updatedAtFrom),updatedAtTo:ae(r.value.updatedAtTo),roleIds:r.value.roles.map(F=>F.id),hostType:"local"};JSON.stringify(y)!==M.value&&(u.value=1);const A=await i.scope(()=>we("v2/admin/emoji/list",{query:y,limit:a,page:u.value,sortKeys:R.value.map(({key:F,direction:L})=>`${L}${F}`)}));m.value=A.emojis,e.value=A.allPages,M.value=JSON.stringify(y),Y()}function Y(){p.value=m.value.map(a=>({checked:!1,id:a.id,fileId:void 0,url:a.publicUrl,name:a.name,host:a.host??"",category:a.category??"",aliases:a.aliases.join(" "),license:a.license??"",isSensitive:a.isSensitive,localOnly:a.localOnly,roleIdsThatCanBeUsedThisEmojiAsReaction:a.roleIdsThatCanBeUsedThisEmojiAsReaction,updatedAt:a.updatedAt,publicUrl:a.publicUrl,originalUrl:a.originalUrl,type:a.type})),h.value=JSON.parse(JSON.stringify(p.value))}Ee(async()=>{await x()});const I=H(()=>({title:"Registered emojis",icon:"ti ti-icons"})),b=H(()=>[{icon:"ti ti-search",text:"Пошук",handler:async()=>{if(g)return;g=!0;const{dispose:a}=await it(et(()=>import("./3iSoGi4ic-B3Lt9OYG.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,10,11,12,13,14]),import.meta.url).then(y=>y.default),{query:r.value},{queryUpdated:y=>{r.value=y},sortOrderUpdated:y=>{R.value=y},search:()=>{B()},closed:()=>{a(),g=!1}})}},{icon:"ti ti-list-numbers",text:"表示件数",handler:a=>{async function y(A){if(z.value>0){const{canceled:F}=await fe({type:"warning",title:"表示を変更しますか？",text:"Changes have been made to the Emojis on this page.\nIf you leave the page without saving, all changes made on this page will be discarded."});if(F)return}r.value.limit=A,x()}Ut([{type:"radioOption",text:"25",active:H(()=>r.value.limit===25),action:()=>y(25)},{type:"radioOption",text:"50",active:H(()=>r.value.limit===50),action:()=>y(50)},{type:"radioOption",text:"100",active:H(()=>r.value.limit===100),action:()=>y(100)}],a.currentTarget??a.target)}},{icon:"ti ti-notes",text:"Registration log",handler:async()=>{const{dispose:a}=await it(et(()=>import("./3iSoGi4ic-PMDL3R3O.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,12,13,10,11]),import.meta.url).then(y=>y.default),{logs:N.value},{closed:()=>{a()}})}}]);return(a,y)=>{const A=Le("MkPageHeader"),F=Le("MkStickyContainer");return w(),ne(F,null,{header:k(()=>[$(A,{overridePageMetadata:I.value,actions:b.value},null,8,["overridePageMetadata","actions"])]),default:k(()=>[D("div",{class:"_gaps xtLs9"},[V(i).showing.value?(w(),ne(pt(V(i).component.value),{key:0})):(w(),S(ve,{key:1},[p.value.length===0?(w(),S("div",Ro,U("There are no registered Emojis."),1)):(w(),S("div",{key:1,class:"xpMWr"},[$(Fe,{data:p.value,settings:c(),onEvent:J},null,8,["data","settings"])],2))],64))],2)]),footer:k(()=>[p.value.length>0?(w(),S("div",{key:0,class:"xzQkM"},[D("div",{class:"xi4s6"},[$(oe,{danger:"",style:{"margin-right":"auto"},onClick:Q},{default:k(()=>[G(U("Видалити")+" ("+U(E.value)+") ",1)]),_:1})],2),D("div",{class:"xniQ6"},[$(Ct,{current:u.value,max:e.value,buttonCount:5,onPageChanged:O},null,8,["current","max"])],2),D("div",{class:"xxbzS"},[$(oe,{primary:"",disabled:P.value,onClick:X},{default:k(()=>[G(U("Update")+" ("+U(z.value)+") ",1)]),_:1},8,["disabled"]),$(oe,{onClick:C},{default:k(()=>[G(U("Reset"),1)]),_:1})],2)],2)):te("",!0)]),_:1})}}});const Ao={key:0,style:{display:"flex","flex-direction":"column","overflow-y":"scroll",gap:"16px"}},Oo={key:0},Io={key:1},$o={key:1},kt=se({__name:"custom-emojis-manager.logs",props:{logs:{}},setup(l){function c(){return{row:{showNumber:!1,selectable:!1,contextMenuFactory:(r,g)=>[{type:"button",text:"Copy selected rows",icon:"ti ti-copy",action:()=>ye(m,g)}]},cols:[{bindTo:"failed",title:"failed",type:"boolean",editable:!1,width:50},{bindTo:"url",icon:"ti-icons",type:"image",editable:!1,width:"auto"},{bindTo:"name",title:"name",type:"text",editable:!1,width:140},{bindTo:"error",title:"log",type:"text",editable:!1,width:"auto"}],cells:{contextMenuFactory:(r,g,M,R)=>[{type:"button",text:"Copy selection",icon:"ti ti-copy",action:()=>ye(m,R)}]}}}const i=l,{logs:m}=Me(i),e=j(!1),u=H(()=>{const r=e.value;return m.value.filter(g=>r||g.failed)});return(r,g)=>(w(),S("div",null,[V(m).length>0?(w(),S("div",Ao,[$(gt,{modelValue:e.value,"onUpdate:modelValue":g[0]||(g[0]=M=>e.value=M)},{label:k(()=>[G(U("Show success log"),1)]),_:1},8,["modelValue"]),D("div",null,[u.value.length>0?(w(),S("div",Oo,[$(Fe,{data:u.value,settings:c()},null,8,["data","settings"])])):(w(),S("div",Io,U("There is no failure log."),1))])])):(w(),S("div",$o,U("There is no log."),1))]))}}),Do=se({__name:"MkTagItem",props:{iconClass:{},content:{},exButtonIconClass:{}},emits:["click","exButtonClick"],setup(l,{emit:c}){const i=c;return(m,e)=>(w(),S("div",{class:"xclIJ",onClick:e[1]||(e[1]=u=>i("click",u))},[l.iconClass?(w(),S("span",{key:0,class:me(["x16XY",l.iconClass])},null,2)):te("",!0),D("span",{class:""},U(l.content),3),l.exButtonIconClass?(w(),ne(oe,{key:1,class:"xE9AG",onClick:e[0]||(e[0]=u=>i("exButtonClick",u))},{default:k(()=>[D("span",{class:me(["xvqGc",l.exButtonIconClass])},null,2)]),_:1},8,["class"])):te("",!0)],2))}});const Uo=se({__name:"MkSortOrderEditor",props:{baseOrderKeyNames:{},currentOrders:{}},emits:["update"],setup(l,{emit:c}){const i=c,m=l,{currentOrders:e}=Me(m);function u(R){switch(R.direction){case"+":R.direction="-";break;case"-":R.direction="+";break}M(e.value)}function r(R){const N=m.baseOrderKeyNames.filter(p=>!e.value.map(h=>h.key).includes(p)).map(p=>({text:p,action:()=>{M([...e.value,{key:p,direction:"+"}])}}));dt(N,R)}function g(R){M(e.value.filter(N=>N.key!==R.key))}function M(R){i("update",R)}return(R,N)=>(w(),S("div",{class:"xAe4A"},[D("div",{class:"xFfgQ"},[(w(!0),S(ve,null,Oe(V(e),p=>(w(),ne(Do,{key:p.key,iconClass:p.direction==="+"?"ti ti-arrow-up":"ti ti-arrow-down",exButtonIconClass:"ti ti-x",content:p.key,class:"xhEjB",onClick:h=>u(p),onExButtonClick:h=>g(p)},null,8,["iconClass","content","class","onClick","onExButtonClick"]))),128))],2),$(oe,{class:"x6aCx",onClick:r},{default:k(()=>[...N[0]||(N[0]=[D("span",{class:"ti ti-plus"},null,-1)])]),_:1},8,["class"])],2))}});const Vo={class:"_gaps"},No={key:0,style:{"text-align":"center"}},zo=se({__name:"custom-emojis-manager.remote",setup(l){function c(){const b=tt();return{row:{minimumDefinitionCount:100,styleRules:[{condition:({row:a})=>E.value[a.index].checked,applyStyle:{className:b.changedRow}}],contextMenuFactory:(a,y)=>[{type:"button",text:"Import selected rows",icon:"ti ti-download",action:async()=>{const A=y.rangedRows.map(F=>E.value[F.index]);await Y(A)}}]},cols:[{bindTo:"checked",icon:"ti-download",type:"boolean",editable:!0,width:34},{bindTo:"url",icon:"ti-icons",type:"image",editable:!1,width:"auto"},{bindTo:"name",title:"name",type:"text",editable:!1,width:"auto"},{bindTo:"host",title:"host",type:"text",editable:!1,width:"auto"},{bindTo:"license",title:"license",type:"text",editable:!1,width:200},{bindTo:"uri",title:"uri",type:"text",editable:!1,width:"auto"},{bindTo:"publicUrl",title:"publicUrl",type:"text",editable:!1,width:"auto"}],cells:{contextMenuFactory:(a,y,A,F)=>[{type:"button",text:"Selected row's detail",icon:"ti ti-info-circle",action:async()=>{const L=m.value[y.index],{dispose:K}=ut(Xt,{emoji:{id:L.id,name:L.name,host:L.host,license:L.license,url:L.publicUrl}},{done:()=>{K()},closed:()=>{K()}})}},{type:"button",text:"Import rows in the selection",icon:"ti ti-download",action:async()=>{const L=F.rangedCells.map(K=>E.value[K.row.index]);await Y(L)}}]}}}const i=_t(),m=j([]),e=j(0),u=j(0),r=j(null),g=j(null),M=j(null),R=j(null),N=j(null),p=j(100),h=j(void 0),P=j([]),z=j([]),E=j([]),X=H(()=>["smartphone","tablet"].includes(Nt)),Q=H(()=>E.value.filter(b=>b.checked).length);function C(b){P.value=b}async function B(){await I()}function O(){r.value=null,g.value=null,M.value=null,R.value=null,N.value=null}async function J(b){u.value=b,await I()}async function ee(){const b=E.value.filter(a=>a.checked);await Y(b)}function W(b){switch(b.type){case"cell-value-change":x(b);break}}function x(b){const{row:a,column:y,newValue:A}=b;E.value.length>a.index&&y.setting.bindTo in E.value[a.index]&&(E.value[a.index][y.setting.bindTo]=A)}async function Y(b){if((await fe({type:"info",title:"Import Emojis",text:(({count})=>("Import "+count+" Emoji(s) received from the remote server. Please pay close attention to the license of the Emoji. Are you sure to continue?"))({count:b.length})})).canceled)return;const y=await Ve(Promise.all(b.map(F=>we("admin/emoji/copy",{emojiId:F.id}).then(()=>({item:F,success:!0,err:void 0})).catch(L=>({item:F,success:!1,err:L})))));y.filter(F=>!F.success).length>0&&await Re({type:"error",title:"Щось пішло не так",text:"Failed to update or delete Emojis. Please check the registration log for details."}),z.value=y.map(F=>({failed:!F.success,url:F.item.url,name:F.item.name,error:F.err?JSON.stringify(F.err):void 0})),await I()}async function I(){const b={name:ae(r.value),host:ae(g.value),license:ae(M.value),uri:ae(R.value),publicUrl:ae(N.value),hostType:"remote"};JSON.stringify(b)!==h.value&&(u.value=1);const a=await i.scope(()=>we("v2/admin/emoji/list",{limit:p.value,query:b,page:u.value,sortKeys:P.value.map(({key:y,direction:A})=>`${A}${y}`)}));m.value=a.emojis,e.value=a.allPages,h.value=JSON.stringify(b),E.value=m.value.map(y=>({checked:!1,id:y.id,url:y.publicUrl,name:y.name,license:y.license,host:y.host}))}return Ee(async()=>{await I()}),(b,a)=>{const y=Le("MkStickyContainer");return w(),ne(y,null,{default:k(()=>[D("div",{class:"xutEB _gaps"},[$(Ae,null,{icon:k(()=>[...a[6]||(a[6]=[D("i",{class:"ti ti-search"},null,-1)])]),label:k(()=>[G(U("Search settings"),1)]),caption:k(()=>[G(U("Set detailed search criteria."),1)]),default:k(()=>[D("div",Vo,[D("div",{class:me([[X.value?"xfEVB":"xscK9"]])},[$(be,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=A=>r.value=A),type:"search",autocapitalize:"off",class:"x92rX xhluT",onEnter:B},{label:k(()=>[...a[7]||(a[7]=[G("name",-1)])]),_:1},8,["modelValue","class"]),$(be,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=A=>g.value=A),type:"search",autocapitalize:"off",class:"x14xP xhluT",onEnter:B},{label:k(()=>[...a[8]||(a[8]=[G("host",-1)])]),_:1},8,["modelValue","class"]),$(be,{modelValue:M.value,"onUpdate:modelValue":a[2]||(a[2]=A=>M.value=A),type:"search",autocapitalize:"off",class:"x4Goo xhluT",onEnter:B},{label:k(()=>[...a[9]||(a[9]=[G("license",-1)])]),_:1},8,["modelValue","class"]),$(be,{modelValue:R.value,"onUpdate:modelValue":a[3]||(a[3]=A=>R.value=A),type:"search",autocapitalize:"off",class:"x92rX xhKse",onEnter:B},{label:k(()=>[...a[10]||(a[10]=[G("uri",-1)])]),_:1},8,["modelValue","class"]),$(be,{modelValue:N.value,"onUpdate:modelValue":a[4]||(a[4]=A=>N.value=A),type:"search",autocapitalize:"off",class:"x14xP xhKse",onEnter:B},{label:k(()=>[...a[11]||(a[11]=[G("publicUrl",-1)])]),_:1},8,["modelValue","class"])],2),a[13]||(a[13]=D("hr",null,null,-1)),$(Ae,{spacerMax:8,spacerMin:8},{icon:k(()=>[...a[12]||(a[12]=[D("i",{class:"ti ti-arrows-sort"},null,-1)])]),label:k(()=>[G(U("Sort order"),1)]),default:k(()=>[$(Uo,{baseOrderKeyNames:V(Qt),currentOrders:P.value,onUpdate:C},null,8,["baseOrderKeyNames","currentOrders"])]),_:1}),$(be,{modelValue:p.value,"onUpdate:modelValue":a[5]||(a[5]=A=>p.value=A),type:"number",max:100},{label:k(()=>[G(U("表示件数"),1)]),_:1},8,["modelValue"]),D("div",{class:me([[X.value?"x7dlL":"xa2nP"]])},[$(oe,{primary:"",onClick:B},{default:k(()=>[G(U("Пошук"),1)]),_:1}),$(oe,{onClick:O},{default:k(()=>[G(U("Reset"),1)]),_:1})],2)])]),_:1}),$(Ae,null,{icon:k(()=>[...a[14]||(a[14]=[D("i",{class:"ti ti-notes"},null,-1)])]),label:k(()=>[G(U("Registration log"),1)]),caption:k(()=>[G(U("Logs will be displayed when updating or deleting Emojis. They will disappear after updating or deleting them, moving to a new page, or reloading."),1)]),default:k(()=>[$(kt,{logs:z.value},null,8,["logs"])]),_:1}),V(i).showing.value?(w(),ne(pt(V(i).component.value),{key:0})):(w(),S(ve,{key:1},[E.value.length===0?(w(),S("div",No,U("There are no registered Emojis."),1)):(w(),S(ve,{key:1},[E.value.length>0?(w(),S("div",{key:0,class:"xvgrW"},[$(Fe,{data:E.value,settings:c(),onEvent:W},null,8,["data","settings"])],2)):te("",!0),D("div",{class:"xAKiy"},[a[15]||(a[15]=D("div",null,null,-1)),D("div",{class:"x3n3v"},[$(Ct,{current:u.value,max:e.value,buttonCount:5,onPageChanged:J},null,8,["current","max"])],2),D("div",{class:"xkY2J"},[$(oe,{primary:"",onClick:ee},{default:k(()=>[G(U("Import checked Emojis")+" ("+U(Q.value)+") ",1)]),_:1})],2)],2)],64))],64))],2)]),_:1})}}});const Lo={class:"_spacer"},Po={class:"_gaps"},Fo={class:"_gaps"},Go={class:"_buttonsCenter"},ct=100,qo=se({__name:"custom-emojis-manager.register",setup(l){function c(){const C=tt(),B=ke.required(),O=ke.regex(/^[a-zA-Z0-9_]+$/),J=ke.unique();function ee(W){const x=[...new Set(W.map(Y=>Y.index))];m.value=m.value.filter((Y,I)=>!x.includes(I))}return{row:{showNumber:!0,selectable:!0,minimumDefinitionCount:100,styleRules:[{condition:({cells:W})=>W.some(x=>!x.violation.valid),applyStyle:{className:C.violationRow}}],contextMenuFactory:(W,x)=>[{type:"button",text:"Copy selected rows",icon:"ti ti-copy",action:()=>ye(m,x)},{type:"button",text:"Delete selected rows",icon:"ti ti-trash",action:()=>ee(x.rangedRows)}],events:{delete(W){ee(W)}}},cols:[{bindTo:"url",icon:"ti-icons",type:"image",editable:!1,width:"auto",validators:[B]},{bindTo:"name",title:"name",type:"text",editable:!0,width:140,validators:[B,O,J]},{bindTo:"category",title:"category",type:"text",editable:!0,width:140},{bindTo:"aliases",title:"aliases",type:"text",editable:!0,width:140},{bindTo:"license",title:"license",type:"text",editable:!0,width:140},{bindTo:"isSensitive",title:"sensitive",type:"boolean",editable:!0,width:90},{bindTo:"localOnly",title:"localOnly",type:"boolean",editable:!0,width:90},{bindTo:"roleIdsThatCanBeUsedThisEmojiAsReaction",title:"role",type:"text",editable:!0,width:140,valueTransformer:W=>m.value[W.index].roleIdsThatCanBeUsedThisEmojiAsReaction.map(x=>x.name).join(","),customValueEditor:async W=>{const x=m.value[W.index].roleIdsThatCanBeUsedThisEmojiAsReaction,Y=await mt({initialRoleIds:x.map(b=>b.id),title:"Roles that can use this emoji as reaction",infoMessage:"If no roles are specified, anyone can use this emoji as reaction.",publicOnly:!0});if(Y.canceled)return x;const I=Y.result.map(b=>({id:b.id,name:b.name}));return m.value[W.index].roleIdsThatCanBeUsedThisEmojiAsReaction=I,I},events:{paste:wt,delete(W){m.value[W.row.index].roleIdsThatCanBeUsedThisEmojiAsReaction=[]}}},{bindTo:"type",type:"text",editable:!1,width:90}],cells:{contextMenuFactory:(W,x,Y,I)=>[{type:"button",text:"Copy selection",icon:"ti ti-copy",action:()=>ye(m,I)},{type:"button",text:"Delete rows in the selection",icon:"ti ti-trash",action:()=>ee(I.rangedCells.map(b=>b.row))}]}}}const i=j([]),m=j([]),{model:e,def:u}=zt({items:H(()=>i.value.map(C=>({label:C.name,value:C.id||""}))),initialValue:Lt.s.uploadFolder}),r=j(!1),g=j(!1),M=j([]);j(!1);async function R(){if((await fe({type:"info",text:(({count})=>("Register the Emojis from the list as new custom Emojis. Are you sure to continue? (To avoid overload, only "+count+" Emoji(s) can be registered in a single operation)"))({count:ct})})).canceled)return;const B=m.value,O=()=>B.slice(0,ct).map(x=>we("admin/emoji/add",{name:x.name,category:Pe(x.category),aliases:ht(x.aliases),license:Pe(x.license),isSensitive:x.isSensitive,localOnly:x.localOnly,roleIdsThatCanBeUsedThisEmojiAsReaction:x.roleIdsThatCanBeUsedThisEmojiAsReaction.map(Y=>Y.id),fileId:x.fileId}).then(()=>({item:x,success:!0,err:void 0})).catch(Y=>({item:x,success:!1,err:Y}))),J=await Ve(Promise.all(O()));J.filter(x=>!x.success).length>0&&await Re({type:"error",title:"Щось пішло не так",text:"Failed to update or delete Emojis. Please check the registration log for details."}),M.value=J.map(x=>({failed:!x.success,url:x.item.url,name:x.item.name,error:x.err?JSON.stringify(x.err):void 0}));const W=J.filter(x=>x.success).map(x=>x.item);m.value=m.value.filter(x=>!W.includes(x))}async function N(){(await fe({type:"warning",text:"Discard the edits and clear the Emojis from the list. Are you sure to continue?"})).canceled||(m.value=[])}async function p(){const C=await Ft({multiple:!0,folderId:e.value});m.value.push(...C.map(X))}async function h(){const C=await Gt({multiple:!0});m.value.push(...C.map(X))}function P(C){switch(C.type){case"cell-validation":z(C);break;case"cell-value-change":E(C);break}}function z(C){g.value=C.all.filter(B=>!B.valid).length>0}function E(C){const{row:B,column:O,newValue:J}=C;m.value.length>B.index&&O.setting.bindTo in m.value[B.index]&&(m.value[B.index][O.setting.bindTo]=J)}function X(C){return{fileId:C.id,url:C.url,name:C.name.replace(/(\.[a-zA-Z0-9]+)+$/,"").replaceAll("-","_").replaceAll(" ","_"),host:"",category:"",aliases:"",license:"",isSensitive:C.isSensitive,localOnly:!1,roleIdsThatCanBeUsedThisEmojiAsReaction:[],type:C.type}}async function Q(){const C=await we("drive/folders",{});i.value=Array.of({name:"-"},...C)}return Ee(async()=>{await Q()}),(C,B)=>(w(),S("div",Lo,[D("div",Po,[$(Ae,null,{icon:k(()=>[...B[2]||(B[2]=[D("i",{class:"ti ti-settings"},null,-1)])]),label:k(()=>[G(U("Upload settings"),1)]),caption:k(()=>[G(U("On this screen, you can configure the behavior when uploading Emojis."),1)]),default:k(()=>[D("div",Fo,[$(Pt,{modelValue:V(e),"onUpdate:modelValue":B[0]||(B[0]=O=>ft(e)?e.value=O:null),items:V(u)},{label:k(()=>[G(U("Місце для завантаження за замовчуванням"),1)]),_:1},8,["modelValue","items"]),$(gt,{modelValue:r.value,"onUpdate:modelValue":B[1]||(B[1]=O=>r.value=O)},{label:k(()=>[G(U("Enter the directory name in the \"category\" field"),1)]),caption:k(()=>[G(U("When you drag and drop a directory, enter the directory name in the \"category\" field."),1)]),_:1},8,["modelValue"])])]),_:1}),$(Ae,null,{icon:k(()=>[...B[3]||(B[3]=[D("i",{class:"ti ti-notes"},null,-1)])]),label:k(()=>[G(U("Registration log"),1)]),caption:k(()=>[G(U("Logs will be displayed when updating or deleting Emojis. They will disappear after updating or deleting them, moving to a new page, or reloading."),1)]),default:k(()=>[$(kt,{logs:M.value},null,8,["logs"])]),_:1}),D("div",Go,[$(oe,{primary:"",rounded:"",onClick:p},{default:k(()=>[G(U("Завантажити"),1)]),_:1}),$(oe,{primary:"",rounded:"",onClick:h},{default:k(()=>[G(U("З диска"),1)]),_:1})]),m.value.length>0?(w(),S("div",{key:0,class:"xkJpd"},[$(Fe,{data:m.value,settings:c(),onEvent:P},null,8,["data","settings"])],2)):te("",!0),m.value.length>0?(w(),S("div",{key:1,class:"xfKPa"},[$(oe,{primary:"",disabled:g.value,onClick:R},{default:k(()=>[G(U("Реєстрація"),1)]),_:1},8,["disabled"]),$(oe,{onClick:N},{default:k(()=>[G(U("Очистити"),1)]),_:1})],2)):te("",!0)])]))}});const Wo=se({__name:"custom-emojis-manager2",setup(l){const c=j("local"),i=H(()=>[{key:"local",title:"Локальні"},{key:"remote",title:"Віддалені"},{key:"register",title:"Emoji registration"}]);return qt(H(()=>({title:"Кастомні емоджі",icon:"ti ti-icons",needWideArea:!0}))),(m,e)=>{const u=Le("PageWithHeader");return w(),ne(u,{tab:c.value,"onUpdate:tab":e[0]||(e[0]=r=>c.value=r),tabs:i.value},{default:k(()=>[c.value==="local"?(w(),ne(jo,{key:0,class:"xsnTk"},null,8,["class"])):c.value==="remote"?(w(),ne(zo,{key:1,class:""},null,8,["class"])):c.value==="register"?(w(),ne(qo,{key:2,class:""},null,8,["class"])):te("",!0)]),_:1},8,["tab","tabs"])}}});const Zo=Object.freeze(Object.defineProperty({__proto__:null,default:Wo},Symbol.toStringTag,{value:"Module"}));export{Uo as M,kt as _,Zo as c,Qt as g};
