import{J as D,U as B,av as F,i as s,R as w,M as T,H as O,ar as C,o as $}from"./3iSoGi4ic-DV-GuiCp.js";import{c as U}from"./3iSoGi4ic-B1GPmOGN.js";import z from"./3iSoGi4ic-DaTARTeS.js";import J from"./3iSoGi4ic-DienmJ9d.js";import{_ as R}from"./3iSoGi4ic-Dy0PONm0.js";import{b as A,u as P,a as S,e as Y,z as I,l as u,i as n,f as b,C as c,j as W,v as j,p as t,n as Z,t as e,B as d,h as y,D as f,E as r}from"./3iSoGi4ic-D0mTJ0Mu.js";import{i as q,u as Q,C as X,c as G}from"./3iSoGi4ic-CqmhgU-Q.js";const K=30,tt=A({__name:"MkVisitorDashboard.ActiveUsersChart",setup(V){q();const o=P("chartEl"),m=new Date;let p=null;const x=S(!0),{handler:a}=Q();async function i(){p&&p.destroy();const g=k=>{const _=m.getFullYear(),M=m.getMonth(),H=m.getDate();return new Date(_,M,H-k)},v=k=>k.map((_,M)=>({x:g(M).getTime(),y:_})),h=await D("charts/active-users",{limit:K,span:"day"});x.value=!1,await Z();const E=B.s.darkMode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)",L=getComputedStyle(window.document.documentElement),N=F(L.getPropertyValue("--MI_THEME-accent")).toHexString();Math.max(...h.read),o.value!=null&&(p=new X(o.value,{type:"bar",data:{datasets:[{parsing:!1,label:"Read",data:v(h.read).slice().reverse(),pointRadius:0,borderWidth:0,borderJoinStyle:"round",borderRadius:4,backgroundColor:N,barPercentage:.5,categoryPercentage:1,fill:!0}]},options:{aspectRatio:2.5,layout:{padding:{left:0,right:8,top:0,bottom:0}},scales:{x:{type:"time",offset:!0,time:{unit:"day",displayFormats:{day:"M/d",month:"Y/M"}},grid:{display:!1},ticks:{stepSize:1,display:!0,maxRotation:0,autoSkipPadding:8}},y:{position:"left",suggestedMax:10,grid:{display:!0},ticks:{display:!0}}},interaction:{intersect:!1,mode:"index"},plugins:{legend:{display:!1},tooltip:{enabled:!1,mode:"index",animation:{duration:0},external:a}}},plugins:[G(E)]}))}return Y(async()=>{i()}),(g,v)=>{const h=I("MkLoading");return n(),u("div",null,[x.value?(n(),b(h,{key:0})):c("",!0),W(t("div",{class:"xxIbr"},[t("canvas",{ref_key:"chartEl",ref:o},null,512)],2),[[j,!x.value]])])}}});const st=["src"],et=["innerHTML"],xt=A({__name:"MkVisitorDashboard",setup(V){const o=S(null);s.clientOptions.showActivitiesForVisitor!==!1&&D("stats",{}).then(a=>{o.value=a});function m(){const{dispose:a}=C(z,{autoSet:!0},{closed:()=>a()})}function p(){const{dispose:a}=C(J,{autoSet:!0},{closed:()=>a()})}function x(a){$(a)}return(a,i)=>{const g=I("MkA");return e(s)?(n(),u("div",{key:0,class:"xuuhe"},[t("div",{class:"xkbTO x2yRw"},[t("img",{src:e(s).iconUrl||"/favicon.ico",alt:"",class:"x4mPe"},null,10,st),t("button",{class:"_button _acrylic xllcZ",onClick:x},[...i[2]||(i[2]=[t("i",{class:"ti ti-dots"},null,-1)])],2),t("div",{class:"x82D5"},[t("h1",{class:"xjyZY"},[d(g,{to:"/"},{default:y(()=>[f(r(e(U)),1)]),_:1})],2),t("div",{class:"xc2sN"},[t("div",{innerHTML:e(s).description||"Mạng xã hội liên hợp"},null,8,et)],2),e(s).disableRegistration||e(s).federation!=="all"?(n(),u("div",{key:0,class:"xtOCm _gaps_s"},[e(s).disableRegistration?(n(),b(w,{key:0,warn:""},{default:y(()=>[f(r("Phiên bản này chỉ dành cho người được mời. Bạn phải nhập mã mời hợp lệ để đăng ký."),1)]),_:1})):c("",!0),e(s).federation==="specified"?(n(),b(w,{key:1,warn:""},{default:y(()=>[f(r("This server is operated in a whitelist federation. Interacting with servers other than those designated by the administrator is not allowed."),1)]),_:1})):c("",!0)],2)):c("",!0),t("div",{class:"_gaps_s x9wvy"},[d(T,{class:"xsTzy",full:"",rounded:"",gradate:"","data-cy-signup":"",style:{"margin-right":"12px"},onClick:i[0]||(i[0]=v=>p())},{default:y(()=>[f(r("Đăng ký trên chủ máy này"),1)]),_:1},8,["class"]),d(T,{class:"xsTzy",full:"",rounded:"","data-cy-signin":"",onClick:i[1]||(i[1]=v=>m())},{default:y(()=>[f(r("Đăng nhập"),1)]),_:1},8,["class"])],2)],2)],2),o.value&&e(s).clientOptions.showActivitiesForVisitor!==!1?(n(),u("div",{key:0,class:"x46HU"},[t("div",{class:"xcm7D x2yRw"},[t("div",{class:"x82JE"},r("Người dùng"),3),t("div",{class:"xdQT2"},[d(R,{value:o.value.originalUsersCount},null,8,["value"])],2)],2),t("div",{class:"xcm7D x2yRw"},[t("div",{class:"x82JE"},r("Bài Viết"),3),t("div",{class:"xdQT2"},[d(R,{value:o.value.originalNotesCount},null,8,["value"])],2)],2)],2)):c("",!0),e(s).policies.ltlAvailable&&e(s).clientOptions.showTimelineForVisitor!==!1?(n(),u("div",{key:1,class:"x69lt x2yRw"},[t("div",{class:"xqWTN"},r("Thử xem Timeline"),3),t("div",{class:"xmeRY"},[d(O,{src:"local"})],2)],2)):c("",!0),e(s).clientOptions.showActivitiesForVisitor!==!1?(n(),u("div",{key:2,class:"x2yRw"},[d(tt)],2)):c("",!0)],2)):c("",!0)}}});export{xt as M};
