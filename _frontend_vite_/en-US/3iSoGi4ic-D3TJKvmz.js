const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-qfX4D5dB.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-BDF7xMl0.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-8Z3zIVAA.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-BMNL0SP4.css"])))=>i.map(i=>d[i]);
import{Q as $,bs as F,bt as _,b as m,bo as z,bJ as j,bM as L,J as g,bP as p,w as P,bz as V,d as W,e as X,r as G,h as K,g as Z,bR as q,D as H}from"./3iSoGi4ic-DV-GuiCp.js";import{b as Q,c as S,z as f,l as y,i as o,g as k,B as u,p as v,t as r,q as O,f as x,C as h,h as A,F as E,A as w,D as I,E as J,G as Y,y as ee}from"./3iSoGi4ic-D0mTJ0Mu.js";import{u as te}from"./3iSoGi4ic-B1GPmOGN.js";import{M as se}from"./3iSoGi4ic-DID2kkuO.js";const ae=["onClick"],ue=Q({__name:"XMessage",props:{message:{},isSearchResult:{type:Boolean}},setup(e){const i=$(),s=e,c=S(()=>s.message.fromUserId===i.id),D=S(()=>s.message.text?F(_.parse(s.message.text)):[]);ee(H.mfmEmojiReactCallback,t=>{i.policies.chatAvailability==="available"&&(p("reaction"),g("chat/messages/react",{messageId:s.message.id,reaction:t}))});function N(t){if(i.policies.chatAvailability!=="available")return;const n=Z(t.currentTarget??t.target);n&&q.show(n,null,async a=>{p("reaction"),g("chat/messages/react",{messageId:s.message.id,reaction:a})})}function R(t){i.policies.chatAvailability==="available"&&(t.user.id===i.id?g("chat/messages/unreact",{messageId:s.message.id,reaction:t.reaction}):s.message.reactions.some(n=>n.user.id===i.id&&n.reaction===t.reaction)||(p("reaction"),g("chat/messages/react",{messageId:s.message.id,reaction:t.reaction})))}function B(t){t.target&&P(t.target)||window.getSelection()?.toString()===""&&T(t,!0)}function T(t,n=!1){const a=[];!c.value&&i.policies.chatAvailability==="available"&&(a.push({text:"Reactions",icon:"ti ti-mood-plus",action:d=>{N(d)}}),a.push({type:"divider"})),a.push({text:"Copy contents",icon:"ti ti-copy",action:()=>{V(s.message.text??"")}}),a.push({type:"divider"}),c.value&&i.policies.chatAvailability==="available"&&a.push({text:"Delete",icon:"ti ti-trash",danger:!0,action:()=>{g("chat/messages/delete",{messageId:s.message.id})}}),!c.value&&s.message.fromUser!=null&&a.push({text:"Report",icon:"ti ti-exclamation-circle",action:async()=>{const d=`${te}/chat/messages/${s.message.id}`,{dispose:b}=await W(X(()=>import("./3iSoGi4ic-qfX4D5dB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url).then(C=>C.default),{user:s.message.fromUser,initialComment:`${d}
-----
`},{closed:()=>b()})}}),n?G(a,t):K(a,t.currentTarget??t.target)}return(t,n)=>{const a=f("MkAvatar"),d=f("MkUserName"),b=f("Mfm"),C=f("MkTime"),U=f("MkA");return o(),y("div",{class:k(["xxAgj",{xicVo:c.value}])},[u(a,{class:k(["xEacK",r(m).s.useStickyIcons?"xtGrN":null]),user:e.message.fromUser,link:!c.value,preview:!1},null,8,["class","user","link"]),v("div",{class:k(["xs8cf",e.message.file!=null?"x5aPB":null]),onContextmenu:O(B,["stop"])},[v("div",{class:"xc1of"},[!c.value&&r(m).s["chat.showSenderName"]&&e.message.fromUser!=null?(o(),x(d,{key:0,user:e.message.fromUser},null,8,["user"])):h("",!0)],2),u(se,{class:"x3yK4",tail:c.value?"right":"left",fullWidth:e.message.file!=null,accented:c.value},{default:A(()=>[e.message.text?(o(),x(b,{key:0,ref:"text",class:"_selectable",text:e.message.text,i:r(i),nyaize:"respect",enableEmojiMenu:!0,enableEmojiMenuReaction:!0},null,8,["text","i"])):h("",!0),e.message.file?(o(),x(z,{key:1,mediaList:[e.message.file],class:""},null,8,["mediaList","class"])):h("",!0)]),_:1},8,["class","tail","fullWidth","accented"]),(o(!0),y(E,null,w(D.value,l=>(o(),x(j,{key:l,url:l,style:{margin:"8px 0"}},null,8,["url"]))),128)),v("div",{class:"xADuJ"},[v("button",{class:"_textButton",style:{color:"currentColor"},onClick:T},[...n[0]||(n[0]=[v("i",{class:"ti ti-dots-circle-horizontal"},null,-1)])]),u(C,{class:"xrrQD",time:e.message.createdAt},null,8,["class","time"]),e.isSearchResult&&"toRoom"in e.message&&e.message.toRoom!=null?(o(),x(U,{key:0,to:`/chat/room/${e.message.toRoomId}`},{default:A(()=>[I(J(e.message.toRoom.name),1)]),_:1},8,["to"])):h("",!0),e.isSearchResult&&"toUser"in e.message&&e.message.toUser!=null&&c.value?(o(),x(U,{key:1,to:`/chat/user/${e.message.toUserId}`},{default:A(()=>[I("@"+J(e.message.toUser.username),1)]),_:1},8,["to"])):h("",!0)],2),u(Y,{enterActiveClass:r(m).s.animation?"xAXAF":"",leaveActiveClass:r(m).s.animation?"xsWxz":"",enterFromClass:r(m).s.animation?"xDNTS":"",leaveToClass:r(m).s.animation?"xgJzB":"",moveClass:r(m).s.animation?"xoYEm":"",tag:"div",class:"xyH3J"},{default:A(()=>[(o(!0),y(E,null,w(e.message.reactions,l=>(o(),y("div",{key:l.reaction+l.user.id,class:k(["xiaJa",l.user.id===r(i).id?"xdbrJ":null]),onClick:ie=>R(l)},[u(a,{user:l.user,link:!1,class:"xxaZj"},null,8,["user","class"]),u(L,{withTooltip:!0,reaction:l.reaction.replace(/^:(\w+):$/,":$1@.:"),noStyle:!0,class:"xAqZp"},null,8,["reaction","class"])],10,ae))),128))]),_:1},8,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass","moveClass","class"])],34)],2)}}});export{ue as X};
