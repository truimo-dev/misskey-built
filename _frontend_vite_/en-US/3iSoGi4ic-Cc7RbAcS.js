const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DOA-_1QS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-BDF7xMl0.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-8Z3zIVAA.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dz5OvLqt.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-CZYXc2mx.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Bxvu07K0.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Cqq-L8iu.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Cyr7o_uk.css"])))=>i.map(i=>d[i]);
import{Q as Ve,aS as Y,P as Z,az as Ee,bW as ee,R as z,c4 as $,ab as Te,M as A,bk as O,c3 as te,ag as se,C as V,J as w,A as U,k as Re,L as Q,E as ae,h as $e,d as ie,e as ne,W as le,_ as Ue}from"./3iSoGi4ic-DV-GuiCp.js";import{u as Ne}from"./3iSoGi4ic-B1GPmOGN.js";import{M as oe}from"./3iSoGi4ic-BWBLHwGQ.js";import{_ as re}from"./3iSoGi4ic-DYnmgoxC.js";import{M as We}from"./3iSoGi4ic-BDF7xMl0.js";import{F as He}from"./3iSoGi4ic-CaDkpGcu.js";import{F as Fe}from"./3iSoGi4ic-BBsRrkiB.js";import{M as ue}from"./3iSoGi4ic-Fx-BY70c.js";import{M as Be}from"./3iSoGi4ic-B1V085rU.js";import{M as Le}from"./3iSoGi4ic-B70zSkp5.js";import{M as je}from"./3iSoGi4ic-CdSqfJMx.js";import{b as ze,ab as Oe,a as k,m as de,c as N,w as ce,z as W,k as Qe,f as _,i as s,h as l,p as a,l as u,C as d,B as v,E as o,t as f,D as m,F as E,A as H,R as me,j as Ge}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CqmhgU-Q.js";import"./3iSoGi4ic-BPp9MNgd.js";import"./3iSoGi4ic-y3_HjM0O.js";import"./3iSoGi4ic-C7_f0Ypu.js";import"./3iSoGi4ic-Dv7rS4og.js";const qe={class:"_spacer",style:{"--MI_SPACER-w":"600px","--MI_SPACER-min":"16px","--MI_SPACER-max":"32px"}},Je={key:0,class:"_gaps_m"},Ke={class:"aeakzknw"},Xe={class:"body"},Ye={class:"name"},Ze={class:"sub"},et={class:"acct _monospace"},tt={class:"state"},st={key:0,class:"suspended"},at={key:1,class:"silenced"},it={key:2,class:"moderator"},nt={style:{display:"flex","flex-direction":"column",gap:"1em"}},lt={class:"_monospace"},ot={class:"_monospace"},rt={class:"_monospace"},ut={class:"_monospace"},dt={class:"_gaps"},ct={class:"_gaps"},mt={class:"date"},vt={class:"ip"},pt={key:1,class:"_gaps"},_t=["onClick"],ft=["onClick"],yt={key:0},kt={key:1},wt={key:2,class:"_gaps"},gt={class:"_gaps_s"},ht=["onClick"],xt={key:0,style:{"margin-right":"0.5em"}},It={key:0,class:"ti ti-info-circle"},Mt={key:1,class:"ti ti-alert-triangle",style:{color:"var(--MI_THEME-warn)"}},bt={key:2,class:"ti ti-circle-x",style:{color:"var(--MI_THEME-error)"}},At={key:3,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},Ct={key:1,style:{"margin-left":"auto",opacity:"0.7"}},Pt={key:3,class:"_gaps"},St={key:4,class:"_gaps_m"},Dt={class:"cmhjzshm"},Vt={class:"selects"},Et={class:"charts"},Tt={class:"label"},Rt={class:"label"},$t={key:5,class:"_gaps_m"},Ut=ze({__name:"admin-user",props:{userId:{},initialTab:{default:"overview"}},async setup(ve){let T,G;const q=Ve(),I=ve,F=([T,G]=Oe(()=>X()),T=await T,G(),T),h=k(I.initialTab),{model:C,def:pe}=Y({items:[{label:"Notes",value:"per-user-notes"}],initialValue:"per-user-notes"}),i=k(F.user),c=k(F.info),B=k(F.ips),_e=k(null),J=k(c.value.isModerator),K=k(c.value.isSilenced),P=k(c.value.isSuspended),M=k(i.value.host==null&&i.value.username.includes(".")),S=k(c.value.moderationNote),fe=de(new Z("admin/drive/files",{limit:10,computedParams:N(()=>({userId:I.userId}))})),{model:R,def:ye}=Y({items:[{label:"Active",value:"active"},{label:"Archived",value:"archived"}],initialValue:"active"}),ke=de(new Z("admin/announcements/list",{limit:10,computedParams:N(()=>({userId:I.userId,status:R.value}))})),D=k([]);function X(){return Promise.all([w("users/show",{userId:I.userId}),w("admin/show-user",{userId:I.userId}),O?w("admin/get-user-ips",{userId:I.userId}):Promise.resolve(null)]).then(([r,e,y])=>({user:r,info:e,ips:y}))}ce(S,async()=>{await w("admin/update-user-note",{userId:i.value.id,text:S.value}),await b()});async function b(){const r=await X();i.value=r.user,c.value=r.info,B.value=r.ips,J.value=c.value.isModerator,K.value=c.value.isSilenced,P.value=c.value.isSuspended,M.value=i.value.host==null&&i.value.username.includes("."),S.value=c.value.moderationNote}async function we(){if(!(await V({type:"warning",text:"Really reset your password?"})).canceled){const{password:e}=await w("admin/reset-password",{userId:i.value.id});U({type:"success",text:(({password})=>("The new password is \""+password+"\""))({password:e})})}}async function ge(r){(await V({type:"warning",text:r?"Are you sure that you want to suspend this account?":"Are you sure that you want to unsuspend this account?"})).canceled?P.value=!r:(await w(r?"admin/suspend-user":"admin/unsuspend-user",{userId:i.value.id}),await b())}async function he(){if((await V({type:"warning",text:"Are you sure you want to unset the avatar?"})).canceled)return;await(async()=>{await w("admin/unset-user-avatar",{userId:i.value.id}),le()})().catch(y=>{U({type:"error",text:y.toString()})}),b()}async function xe(){if((await V({type:"warning",text:"Are you sure you want to unset the banner?"})).canceled)return;await(async()=>{await w("admin/unset-user-banner",{userId:i.value.id}),le()})().catch(y=>{U({type:"error",text:y.toString()})}),b()}async function Ie(){if((await V({type:"warning",text:"This will irreversibly delete your account. Proceed?"})).canceled)return;const e=await Re({text:(({x})=>("Please enter "+x+" to confirm"))({x:i.value?.username})});e.canceled||(e.result===i.value?.username?await Q("admin/delete-account",{userId:i.value.id}):U({type:"error",text:"input not match"}))}async function Me(){const r=await w("admin/roles/list").then(x=>x.filter(n=>n.target==="manual")),{canceled:e,result:y}=await ae({title:"Select the role to assign",items:r.map(x=>({label:x.name,value:x.id}))});if(e||y==null)return;const{canceled:L,result:g}=await ae({title:"Time limit"+": "+r.find(x=>x.id===y).name,items:[{value:"indefinitely",label:"Permanently"},{value:"oneHour",label:"One hour"},{value:"oneDay",label:"One day"},{value:"oneWeek",label:"One week"},{value:"oneMonth",label:"One month"}],default:"indefinitely"});if(L)return;const j=g==="indefinitely"?null:g==="oneHour"?Date.now()+1e3*60*60:g==="oneDay"?Date.now()+1e3*60*60*24:g==="oneWeek"?Date.now()+1e3*60*60*24*7:g==="oneMonth"?Date.now()+1e3*60*60*24*30:null;await Q("admin/roles/assign",{roleId:y,userId:i.value.id,expiresAt:j}),b()}async function be(r,e){$e([{text:"Unassign",icon:"ti ti-x",danger:!0,action:async()=>{await Q("admin/roles/unassign",{roleId:r.id,userId:i.value.id}),b()}}],e.currentTarget??e.target)}function Ae(r){D.value.includes(r.id)?D.value=D.value.filter(e=>e!==r.id):D.value.push(r.id)}async function Ce(){const{dispose:r}=await ie(ne(()=>import("./3iSoGi4ic-DOA-_1QS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url).then(e=>e.default),{user:i.value},{closed:()=>r()})}async function Pe(r){const{dispose:e}=await ie(ne(()=>import("./3iSoGi4ic-DOA-_1QS.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url).then(y=>y.default),{user:i.value,announcement:r},{closed:()=>e()})}ce(i,()=>{w("ap/get",{uri:i.value.uri??`${Ne}/users/${i.value.id}`}).then(r=>{_e.value=r})});const Se=N(()=>[]),De=N(()=>M.value?[{key:"overview",title:"Overview",icon:"ti ti-info-circle"},{key:"raw",title:"Raw",icon:"ti ti-code"}]:[{key:"overview",title:"Overview",icon:"ti ti-info-circle"},{key:"roles",title:"Roles",icon:"ti ti-badges"},{key:"announcements",title:"Announcements",icon:"ti ti-speakerphone"},{key:"drive",title:"Drive",icon:"ti ti-cloud"},{key:"chart",title:"Charts",icon:"ti ti-chart-line"},{key:"raw",title:"Raw",icon:"ti ti-code"}]);return Ee(()=>({title:i.value?ee(i.value):"User information",icon:"ti ti-user-exclamation"})),(r,e)=>{const y=W("MkAvatar"),L=W("MkUserName"),g=W("MkTime"),j=W("PageWithHeader"),x=Qe("panel");return s(),_(j,{tab:h.value,"onUpdate:tab":e[4]||(e[4]=n=>h.value=n),actions:Se.value,tabs:De.value},{default:l(()=>[a("div",qe,[h.value==="overview"?(s(),u("div",Je,[a("div",Ke,[v(y,{class:"avatar",user:i.value,indicator:"",link:"",preview:""},null,8,["user"]),a("div",Xe,[a("span",Ye,[v(L,{class:"name",user:i.value},null,8,["user"])]),a("span",Ze,[a("span",et,"@"+o(f(ee)(i.value)),1)]),a("span",tt,[P.value?(s(),u("span",st,"Suspended")):d("",!0),K.value?(s(),u("span",at,"Silenced")):d("",!0),J.value?(s(),u("span",it,"Moderator")):d("",!0)])])]),M.value?(s(),_(z,{key:0},{default:l(()=>[m(o("An account created and automatically operated by the system."),1)]),_:1})):d("",!0),i.value.host?(s(),_(He,{key:1,to:`/instance-info/${i.value.host}`},{default:l(()=>[m(o("Instance Information"),1)]),_:1},8,["to"])):d("",!0),a("div",nt,[v($,{copy:i.value.id,oneline:""},{key:l(()=>[...e[5]||(e[5]=[m("ID",-1)])]),value:l(()=>[a("span",lt,o(i.value.id),1)]),_:1},8,["copy"]),M.value?d("",!0):(s(),u(E,{key:0},[v($,{oneline:""},{key:l(()=>[m(o("Created at"),1)]),value:l(()=>[a("span",ot,[v(g,{time:i.value.createdAt,mode:"detail"},null,8,["time"])])]),_:1}),c.value?(s(),_($,{key:0,oneline:""},{key:l(()=>[m(o("Last used at"),1)]),value:l(()=>[a("span",rt,[v(g,{time:c.value.lastActiveDate,mode:"detail"},null,8,["time"])])]),_:1})):d("",!0),c.value?(s(),_($,{key:1,oneline:""},{key:l(()=>[m(o("Email"),1)]),value:l(()=>[a("span",ut,o(c.value.email),1)]),_:1})):d("",!0)],64))]),M.value?d("",!0):(s(),_(We,{key:2,modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n),manualSave:""},{label:l(()=>[m(o("Moderation note"),1)]),caption:l(()=>[m(o("You can fill in notes that will be shared only among moderators."),1)]),_:1},8,["modelValue"])),M.value?d("",!0):(s(),_(Fe,{key:3},{default:l(()=>[a("div",dt,[v(Te,{modelValue:P.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>P.value=n),ge]},{default:l(()=>[m(o("Suspend"),1)]),_:1},8,["modelValue"]),a("div",null,[i.value.host==null?(s(),_(A,{key:0,inline:"",style:{"margin-right":"8px"},onClick:we},{default:l(()=>[e[6]||(e[6]=a("i",{class:"ti ti-key"},null,-1)),m(" "+o("Reset password"),1)]),_:1})):d("",!0)]),v(ue,null,{icon:l(()=>[...e[7]||(e[7]=[a("i",{class:"ti ti-license"},null,-1)])]),label:l(()=>[m(o("Policies"),1)]),default:l(()=>[a("div",ct,[(s(!0),u(E,null,H(Object.keys(c.value.policies),n=>(s(),u("div",{key:n},o(n)+" ... "+o(c.value.policies[n]),1))),128))])]),_:1}),v(ue,null,{icon:l(()=>[...e[8]||(e[8]=[a("i",{class:"ti ti-password"},null,-1)])]),label:l(()=>[...e[9]||(e[9]=[m("IP",-1)])]),default:l(()=>[f(O)?(s(),_(z,{key:1},{default:l(()=>[...e[10]||(e[10]=[m("The date is the IP address was first acknowledged.",-1)])]),_:1})):(s(),_(z,{key:0,warn:""},{default:l(()=>[m(o("You must log in with an administrator account to view this."),1)]),_:1})),f(O)&&B.value?(s(!0),u(E,{key:2},H(B.value,n=>(s(),u("div",{key:n.ip,class:"_monospace xsTQG",style:{margin:"1em 0"}},[a("span",mt,o(n.createdAt),1),a("span",vt,o(n.ip),1)],2))),128)):d("",!0)]),_:1}),a("div",null,[f(te)?(s(),_(A,{key:0,inline:"",danger:"",style:{"margin-right":"8px"},onClick:he},{default:l(()=>[e[11]||(e[11]=a("i",{class:"ti ti-user-circle"},null,-1)),m(" "+o("Unset avatar"),1)]),_:1})):d("",!0),f(te)?(s(),_(A,{key:1,inline:"",danger:"",onClick:xe},{default:l(()=>[e[12]||(e[12]=a("i",{class:"ti ti-photo"},null,-1)),m(" "+o("Unset banner"),1)]),_:1})):d("",!0)]),f(q).isAdmin?(s(),_(A,{key:0,inline:"",danger:"",onClick:Ie},{default:l(()=>[m(o("Delete account"),1)]),_:1})):d("",!0)])]),_:1}))])):h.value==="roles"?(s(),u("div",pt,[i.value.host==null?(s(),_(A,{key:0,primary:"",rounded:"",onClick:Me},{default:l(()=>[e[13]||(e[13]=a("i",{class:"ti ti-plus"},null,-1)),m(" "+o("Assign"),1)]),_:1})):d("",!0),(s(!0),u(E,null,H(c.value.roles,n=>(s(),u("div",{key:n.id},[a("div",{class:"x74fl"},[v(Le,{class:"xlEaW",role:n,forModeration:!0},null,8,["class","role"]),a("button",{class:"_button",onClick:p=>Ae(n)},[...e[14]||(e[14]=[a("i",{class:"ti ti-chevron-down"},null,-1)])],8,_t),n.target==="manual"?(s(),u("button",{key:0,class:"_button xvrwl",onClick:p=>be(n,p)},[...e[15]||(e[15]=[a("i",{class:"ti ti-x"},null,-1)])],10,ft)):(s(),u("button",{key:1,class:"_button xvrwl",disabled:""},[...e[16]||(e[16]=[a("i",{class:"ti ti-ban"},null,-1)])],2))],2),D.value.includes(n.id)?(s(),u("div",{key:0,class:"xE3kW"},[a("div",null,[e[17]||(e[17]=m("Assigned: ",-1)),v(g,{time:c.value.roleAssigns.find(p=>p.roleId===n.id).createdAt,mode:"detail"},null,8,["time"])]),c.value.roleAssigns.find(p=>p.roleId===n.id).expiresAt?(s(),u("div",yt,"Period: "+o(new Date(c.value.roleAssigns.find(p=>p.roleId===n.id).expiresAt).toLocaleString()),1)):(s(),u("div",kt,"Period: "+o("Permanently"),1))],2)):d("",!0)]))),128))])):h.value==="announcements"?(s(),u("div",wt,[v(A,{primary:"",rounded:"",onClick:Ce},{default:l(()=>[e[18]||(e[18]=a("i",{class:"ti ti-plus"},null,-1)),m(" "+o("Create new"),1)]),_:1}),v(se,{modelValue:f(R),"onUpdate:modelValue":e[2]||(e[2]=n=>me(R)?R.value=n:null),items:f(ye)},{label:l(()=>[m(o("Filter"),1)]),_:1},8,["modelValue","items"]),v(je,{paginator:f(ke)},{default:l(({items:n})=>[a("div",gt,[(s(!0),u(E,null,H(n,p=>Ge((s(),u("div",{key:p.id,class:"xpjPH",onClick:Nt=>Pe(p)},["icon"in p?(s(),u("span",xt,[p.icon==="info"?(s(),u("i",It)):p.icon==="warning"?(s(),u("i",Mt)):p.icon==="error"?(s(),u("i",bt)):p.icon==="success"?(s(),u("i",At)):d("",!0)])):d("",!0),a("span",null,o(p.title),1),p.reads>0?(s(),u("span",Ct,o("Read"),1)):d("",!0)],10,ht)),[[x]])),128))])]),_:1},8,["paginator"])])):h.value==="drive"?(s(),u("div",Pt,[v(Be,{paginator:f(fe),viewMode:"grid"},null,8,["paginator"])])):h.value==="chart"?(s(),u("div",St,[a("div",Dt,[a("div",Vt,[v(se,{modelValue:f(C),"onUpdate:modelValue":e[3]||(e[3]=n=>me(C)?C.value=n:null),items:f(pe),style:{margin:"0 10px 0 0",flex:"1"}},null,8,["modelValue","items"])]),a("div",Et,[a("div",Tt,o((({n})=>("Last "+n+" hours"))({n:90})),1),v(oe,{class:"chart",src:f(C),span:"hour",limit:90,args:{user:i.value,withoutAll:!0},detailed:!0},null,8,["src","args"]),a("div",Rt,o((({n})=>("Last "+n+" days"))({n:90})),1),v(oe,{class:"chart",src:f(C),span:"day",limit:90,args:{user:i.value,withoutAll:!0},detailed:!0},null,8,["src","args"])])])])):h.value==="raw"?(s(),u("div",$t,[c.value&&f(q).isAdmin?(s(),_(re,{key:0,tall:"",value:c.value},null,8,["value"])):d("",!0),v(re,{tall:"",value:i.value},null,8,["value"])])):d("",!0)])]),_:1},8,["tab","actions","tabs"])}}});const is=Ue(Ut,[["__scopeId","data-v-f4a9b5a8"]]);export{is as default};
