import{b as Ke,I as Ze,a as k,u as I,c as K,m as Ce,z as h,k as Z,j as N,l as s,C as a,i as n,f as d,t as e,B as c,h as y,D as A,E as v,F as w,A as T,g as P,p as i,q as L,v as et,y as tt}from"./3iSoGi4ic-D0mTJ0Mu.js";import{j as Re,bx as nt,bB as ot,bC as st,bD as lt,$ as _,bE as it,bt as at,bs as rt,b as C,aP as ut,P as Ie,bF as Te,M as Be,bG as ee,aA as U,bH as ct,bn as dt,bo as pt,bI as mt,bu as yt,bJ as vt,bK as xt,bL as ft,bp as kt,aW as te,bM as bt,ay as V,bN as ne,bO as gt,h as q,c as _t,bP as oe,J as R,bQ as S,ar as se,as as Mt,bR as ht,C as wt,bj as Ct,w as Rt,bS as Ne,r as It,bT as Tt,b8 as Bt,bU as Nt,b7 as At,bV as Et,D as jt}from"./3iSoGi4ic-DV-GuiCp.js";import{h as Ht}from"./3iSoGi4ic-B1GPmOGN.js";import{M as Ae}from"./3iSoGi4ic-Cj3FgKaq.js";import{M as Ee}from"./3iSoGi4ic-CdSqfJMx.js";const $t={key:0},Ft={key:0,style:{padding:"16px"}},Lt={key:0,class:"ti ti-dots",style:{"margin-right":"4px"}},Ut=["title"],Dt={key:0,class:"ti ti-home"},Ot={key:1,class:"ti ti-lock"},zt={key:2,ref:"specified",class:"ti ti-mail"},Pt=["title"],Vt=["title"],qt={key:0,class:"ti ti-home"},St={key:1,class:"ti ti-lock"},Xt={key:2,ref:"specified",class:"ti ti-mail"},Wt=["title"],Jt=["src"],Qt={key:0,style:{opacity:"0.5"}},Gt={key:1},Yt={key:5},Kt={key:7},Zt={key:0,class:"ti ti-heart-filled",style:{color:"var(--MI_THEME-love)"}},en={key:1,class:"ti ti-minus",style:{color:"var(--MI_THEME-accent)"}},tn={key:2,class:"ti ti-heart"},nn={key:3,class:"ti ti-plus"},on={key:0},sn={key:0,style:{padding:"16px"}},ln={style:{display:"grid","grid-template-columns":"repeat(auto-fill, minmax(270px, 1fr))","grid-gap":"12px"}},an=["onClick"],rn={style:{"margin-left":"4px"}},un={style:{display:"grid","grid-template-columns":"repeat(auto-fill, minmax(270px, 1fr))","grid-gap":"12px"}},fn=Ke({__name:"MkNoteDetailed",props:{note:{},initialTab:{default:"replies"}},setup(je){const le=je,He=Ze("inChannel",null);let u=Re(le.note);const ie=nt("note_view_interruptor"),ae=k(!1);if(ie.length>0){let l=Re(u);for(const o of ie)try{l=o.handler(l)}catch(f){console.error(f)}l==null?ae.value=!0:u=l}const re=ot(u),t=st(u)??u,{$note:x,subscribe:$e}=lt({note:t,parentNote:u}),X=I("rootEl"),ue=I("menuButton"),E=I("renoteButton"),ce=I("renoteTime"),j=I("reactButton"),de=I("clipButton"),pe=I("galleryEl"),me=_&&_.id===u.userId,H=k(!1),ye=k(!1),W=k(_?it(t,_,_.mutedWords):!1),B=k(null),D=k(!1),J=t.text?at.parse(t.text):null,Fe=J?rt(J).filter(l=>t.renote?.url!==l&&t.renote?.uri!==l):null,Le=C.s.instanceTicker==="always"||C.s.instanceTicker==="remote"&&t.user.instance,ve=k([]),xe=k([]),Ue=K(()=>["public","home"].includes(t.visibility)||t.userId===_?.id);ut("noteDeleted",l=>{(l===u.id||l===t.id)&&(ye.value=!0)});const O=K(()=>({type:"lookup",url:`https://${Ht}/notes/${t.id}`})),De={r:()=>ke(),"e|a|plus":()=>Q(),q:()=>fe(),m:()=>be(),c:()=>{C.s.showClipButtonInNoteFooter&&ge()},o:()=>pe.value?.openGallery(),"v|enter":()=>{t.cw!=null&&(H.value=!H.value)},esc:{allowRepeat:!0,callback:()=>_e()}};tt(jt.mfmEmojiReactCallback,l=>{oe("reaction"),R("notes/reactions/create",{noteId:t.id,reaction:l}).then(()=>{S.emit(`reacted:${t.id}`,{userId:_.id,reaction:l})})});const M=k(le.initialTab),$=k(null),Oe=Ce(new Ie("notes/renotes",{limit:10,params:{noteId:t.id}})),ze=Ce(new Ie("notes/reactions",{limit:10,computedParams:K(()=>({noteId:t.id,type:$.value}))}));Te(E,async l=>{const o=E.value;if(o==null)return;const b=(await R("notes/renotes",{noteId:t.id,limit:11})).map(z=>z.user);if(b.length<1)return;const{dispose:m}=se(Nt,{showing:l,users:b,count:t.renoteCount,anchorElement:o},{closed:()=>m()})}),t.reactionAcceptance==="likeOnly"&&Te(j,async l=>{const f=(await At("notes/reactions",{noteId:t.id,limit:10,_cacheKey_:x.reactionCount})).map(m=>m.user);if(f.length<1)return;const{dispose:b}=se(Et,{showing:l,reaction:"❤️",users:f,count:x.reactionCount,anchorElement:j.value},{closed:()=>b()})});function fe(){V({openOnRemote:O.value}),ne();const{menu:l}=gt({note:u,renoteButton:E});q(l,E.value),$e()}function ke(){V({openOnRemote:O.value}),ne(),_t({reply:t,channel:t.channel}).then(()=>{F()})}function Q(){if(V({openOnRemote:O.value}),ne(),t.reactionAcceptance==="likeOnly"){oe("reaction"),R("notes/reactions/create",{noteId:t.id,reaction:"❤️"}).then(()=>{S.emit(`reacted:${t.id}`,{userId:_.id,reaction:"❤️"})});const l=j.value;if(l&&C.s.animation){const o=l.getBoundingClientRect(),f=o.left+l.offsetWidth/2,b=o.top+l.offsetHeight/2,{dispose:m}=se(Mt,{x:f,y:b},{end:()=>m()})}}else _e(),ht.show(j.value??null,u,async l=>{C.s.confirmOnReact&&(await wt({type:"question",text:(({emoji})=>("¿Quieres añadir una reacción «"+emoji+"»?"))({emoji:l.replace("@.","")})})).canceled||(oe("reaction"),R("notes/reactions/create",{noteId:t.id,reaction:l}).then(()=>{S.emit(`reacted:${t.id}`,{userId:_.id,reaction:l})}),t.text&&t.text.length>100&&Date.now()-new Date(t.createdAt).getTime()<1e3*3&&Ct("reactWithoutRead"))},()=>{F()})}function Pe(l){const o=l.myReaction;o&&R("notes/reactions/delete",{noteId:l.id}).then(()=>{S.emit(`unreacted:${t.id}`,{userId:_.id,reaction:o})})}function Ve(){t.myReaction==null?Q():Pe(t)}function qe(l){if(!(l.target&&Rt(l.target))&&window.getSelection()?.toString()==="")if(C.s.useReactionPickerForContextMenu)l.preventDefault(),Q();else{const{menu:o,cleanup:f}=Ne({note:u,translating:D,translation:B});It(o,l).then(F).finally(f)}}function be(){const{menu:l,cleanup:o}=Ne({note:u,translating:D,translation:B});q(l,ue.value).then(F).finally(o)}async function ge(){q(await Tt({note:u}),de.value).then(F)}function Se(){me&&(V({openOnRemote:O.value}),q([{text:"Quitar renota",icon:"ti ti-trash",danger:!0,action:()=>{R("notes/delete",{noteId:u.id}).then(()=>{Bt.emit("noteDeleted",u.id)})}}],ce.value))}function F(){X.value?.focus()}function _e(){X.value?.blur()}const Me=k(!1);function Xe(){Me.value=!0,R("notes/children",{noteId:t.id,limit:30}).then(l=>{xe.value=l})}const he=k(!1);function We(){he.value=!0,t.replyId!=null&&R("notes/conversation",{noteId:t.replyId}).then(l=>{ve.value=l.reverse()})}return(l,o)=>{const f=h("MkAvatar"),b=h("MkUserName"),m=h("MkA"),z=h("I18n"),we=h("MkTime"),Je=h("MkAcct"),G=h("Mfm"),Qe=h("MkLoading"),Y=Z("user-preview"),Ge=Z("tooltip"),Ye=Z("hotkey");return!W.value&&!ae.value&&!ye.value?N((n(),s("div",{key:0,ref_key:"rootEl",ref:X,class:"xhW00",tabindex:"0"},[e(t).reply&&e(t).reply.replyId?(n(),s("div",$t,[he.value?a("",!0):(n(),s("div",Ft,[c(Be,{style:{margin:"0 auto"},primary:"",rounded:"",onClick:We},{default:y(()=>[A(v("Ver conversación"),1)]),_:1})])),(n(!0),s(w,null,T(ve.value,r=>(n(),d(ee,{key:r.id,class:"xi2wa",note:r},null,8,["class","note"]))),128))])):a("",!0),e(t).replyId?(n(),d(ee,{key:1,note:e(t).reply,class:"xDmvd"},null,8,["note","class"])):a("",!0),e(re)?(n(),s("div",{key:2,class:"xtE7t"},[c(f,{class:"xnYLl",user:e(u).user,link:"",preview:""},null,8,["class","user"]),o[12]||(o[12]=i("i",{class:"ti ti-repeat",style:{"margin-right":"4px"}},null,-1)),i("span",{class:"xkrYC"},[c(z,{src:"Renotado por {user}",tag:"span"},{user:y(()=>[N((n(),d(m,{class:"x5moQ",to:e(U)(e(u).user)},{default:y(()=>[c(b,{user:e(u).user},null,8,["user"])]),_:1},8,["class","to"])),[[Y,e(u).userId]])]),_:1},8,["src"])],2),i("div",{class:"xD4bL"},[i("button",{ref_key:"renoteTime",ref:ce,class:"_button xuVAO",onMousedown:o[0]||(o[0]=L(r=>Se(),["prevent"]))},[e(me)?(n(),s("i",Lt)):a("",!0),c(we,{time:e(u).createdAt},null,8,["time"])],34),e(u).visibility!=="public"?(n(),s("span",{key:0,style:{"margin-left":"0.5em"},title:{"public":"Público","publicDescription":"Visible para todos los usuarios","home":"Inicio","homeDescription":"Visible sólo en la linea de tiempo de inicio","followers":"Seguidores","followersDescription":"Visible sólo para tus seguidores","specified":"Nota directa","specifiedDescription":"Visible sólo para los usuarios elegidos","disableFederation":"No federado","disableFederationDescription":"No enviar a otras instancias"}[e(u).visibility]},[e(u).visibility==="home"?(n(),s("i",Dt)):e(u).visibility==="followers"?(n(),s("i",Ot)):e(u).visibility==="specified"?(n(),s("i",zt,null,512)):a("",!0)],8,Ut)):a("",!0),e(u).localOnly?(n(),s("span",{key:1,style:{"margin-left":"0.5em"},title:"No federado"},[...o[11]||(o[11]=[i("i",{class:"ti ti-rocket-off"},null,-1)])],8,Pt)):a("",!0)],2)],2)):a("",!0),e(re)&&e(u).renote==null?(n(),s("div",{key:3,class:"xtOlN"},v("Nota eliminada"),3)):(n(),s(w,{key:4},[i("article",{class:"xexC6",onContextmenu:L(qe,["stop"])},[i("header",{class:"xgGIX"},[c(f,{class:"x1yJT",user:e(t).user,indicator:"",link:"",preview:""},null,8,["class","user"]),i("div",{class:"xmMLv"},[i("div",null,[N((n(),d(m,{class:"xzFRZ",to:e(U)(e(t).user)},{default:y(()=>[c(b,{nowrap:!1,user:e(t).user},null,8,["user"])]),_:1},8,["class","to"])),[[Y,e(t).user.id]]),e(t).user.isBot?(n(),s("span",{key:0,class:"xqJh8"},"bot",2)):a("",!0),i("div",{class:"xfkwi"},[e(t).visibility!=="public"?(n(),s("span",{key:0,style:{"margin-left":"0.5em"},title:{"public":"Público","publicDescription":"Visible para todos los usuarios","home":"Inicio","homeDescription":"Visible sólo en la linea de tiempo de inicio","followers":"Seguidores","followersDescription":"Visible sólo para tus seguidores","specified":"Nota directa","specifiedDescription":"Visible sólo para los usuarios elegidos","disableFederation":"No federado","disableFederationDescription":"No enviar a otras instancias"}[e(t).visibility]},[e(t).visibility==="home"?(n(),s("i",qt)):e(t).visibility==="followers"?(n(),s("i",St)):e(t).visibility==="specified"?(n(),s("i",Xt,null,512)):a("",!0)],8,Vt)):a("",!0),e(t).localOnly?(n(),s("span",{key:1,style:{"margin-left":"0.5em"},title:"No federado"},[...o[13]||(o[13]=[i("i",{class:"ti ti-rocket-off"},null,-1)])],8,Wt)):a("",!0)],2)]),i("div",{class:"x3t3o"},[i("div",{class:"x1TBL"},[c(Je,{user:e(t).user},null,8,["user"])],2),e(t).user.badgeRoles?(n(),s("div",{key:0,class:"xxz7V"},[(n(!0),s(w,null,T(e(t).user.badgeRoles,(r,g)=>N((n(),s("img",{key:g,class:"xjgMy",src:r.iconUrl},null,10,Jt)),[[Ge,r.name]])),128))],2)):a("",!0)],2),e(Le)?(n(),d(ct,{key:0,host:e(t).user.host,instance:e(t).user.instance},null,8,["host","instance"])):a("",!0)],2)],2),i("div",{class:"xFeJ0"},[e(t).cw!=null?(n(),s("p",{key:0,class:"xz0O5"},[e(t).cw!=""?(n(),d(G,{key:0,text:e(t).cw,author:e(t).user,nyaize:"respect",enableEmojiMenu:!0,enableEmojiMenuReaction:!0},null,8,["text","author"])):a("",!0),c(dt,{modelValue:H.value,"onUpdate:modelValue":o[1]||(o[1]=r=>H.value=r),text:e(t).text,renote:e(t).renote,files:e(t).files,poll:e(t).poll},null,8,["modelValue","text","renote","files","poll"])],2)):a("",!0),N(i("div",null,[e(t).isHidden?(n(),s("span",Qt,"("+v("Privado")+")",1)):a("",!0),e(t).replyId?(n(),d(m,{key:1,class:"xvq8F",to:`/notes/${e(t).replyId}`},{default:y(()=>[...o[14]||(o[14]=[i("i",{class:"ti ti-arrow-back-up"},null,-1)])]),_:1},8,["class","to"])):a("",!0),e(t).text?(n(),d(G,{key:2,parsedNodes:e(J),text:e(t).text,author:e(t).user,nyaize:"respect",emojiUrls:e(t).emojis,enableEmojiMenu:!0,enableEmojiMenuReaction:!0,class:"_selectable"},null,8,["parsedNodes","text","author","emojiUrls"])):a("",!0),e(t).renote!=null?(n(),s("a",{key:3,class:"xewhw"},"RN:",2)):a("",!0),D.value||B.value?(n(),s("div",{key:4,class:"xvaQx"},[D.value?(n(),d(Qe,{key:0,mini:""})):B.value?(n(),s("div",Gt,[i("b",null,v((({x})=>("Traducido de "+x))({x:B.value.sourceLang}))+": ",1),c(G,{text:B.value.text,author:e(t).user,nyaize:"respect",emojiUrls:e(t).emojis,class:"_selectable"},null,8,["text","author","emojiUrls"])])):a("",!0)],2)):a("",!0),e(t).files&&e(t).files.length>0?(n(),s("div",Yt,[c(pt,{ref_key:"galleryEl",ref:pe,mediaList:e(t).files},null,8,["mediaList"])])):a("",!0),e(t).poll?(n(),d(mt,{key:6,noteId:e(t).id,multiple:e(t).poll.multiple,expiresAt:e(t).poll.expiresAt,choices:e(x).pollChoices,author:e(t).user,emojiUrls:e(t).emojis,class:"xetWd"},null,8,["noteId","multiple","expiresAt","choices","author","emojiUrls","class"])):a("",!0),e(yt)?(n(),s("div",Kt,[(n(!0),s(w,null,T(e(Fe),r=>(n(),d(vt,{key:r,url:r,compact:!0,detail:!0,style:{"margin-top":"6px"}},null,8,["url"]))),128))])):a("",!0),e(t).renote?(n(),s("div",{key:8,class:"xrbUj"},[c(xt,{note:e(t).renote,class:"xqQzL"},null,8,["note","class"])],2)):a("",!0)],512),[[et,e(t).cw==null||H.value]]),e(t).channel&&!e(He)?(n(),d(m,{key:1,class:"xHyu2",to:`/channels/${e(t).channel.id}`},{default:y(()=>[o[15]||(o[15]=i("i",{class:"ti ti-device-tv"},null,-1)),A(" "+v(e(t).channel.name),1)]),_:1},8,["class","to"])):a("",!0)],2),i("footer",null,[i("div",{class:"xi1ty"},[c(m,{to:e(ft)(e(t))},{default:y(()=>[c(we,{time:e(t).createdAt,mode:"detail",colored:""},null,8,["time"])]),_:1},8,["to"])],2),e(t).reactionAcceptance!=="likeOnly"?(n(),d(kt,{key:0,style:{"margin-top":"6px"},reactions:e(x).reactions,reactionEmojis:e(x).reactionEmojis,myReaction:e(x).myReaction,noteId:e(t).id,maxNumber:16,onMockUpdateMyReaction:l.emitUpdReaction},null,8,["reactions","reactionEmojis","myReaction","noteId","onMockUpdateMyReaction"])):a("",!0),i("button",{class:"_button xzgmm",onClick:o[2]||(o[2]=r=>ke())},[o[16]||(o[16]=i("i",{class:"ti ti-arrow-back-up"},null,-1)),e(t).repliesCount>0?(n(),s("p",{key:0,class:"xMn9N"},v(e(te)(e(t).repliesCount)),3)):a("",!0)],2),Ue.value?(n(),s("button",{key:1,ref_key:"renoteButton",ref:E,class:"_button xzgmm",onMousedown:o[3]||(o[3]=L(r=>fe(),["prevent"]))},[o[17]||(o[17]=i("i",{class:"ti ti-repeat"},null,-1)),e(t).renoteCount>0?(n(),s("p",{key:0,class:"xMn9N"},v(e(te)(e(t).renoteCount)),3)):a("",!0)],34)):(n(),s("button",{key:2,class:"_button xzgmm",disabled:""},[...o[18]||(o[18]=[i("i",{class:"ti ti-ban"},null,-1)])],2)),i("button",{ref_key:"reactButton",ref:j,class:"xzgmm _button",onClick:o[4]||(o[4]=r=>Ve())},[e(t).reactionAcceptance==="likeOnly"&&e(x).myReaction!=null?(n(),s("i",Zt)):e(x).myReaction!=null?(n(),s("i",en)):e(t).reactionAcceptance==="likeOnly"?(n(),s("i",tn)):(n(),s("i",nn)),(e(t).reactionAcceptance==="likeOnly"||e(C).s.showReactionsCount)&&e(x).reactionCount>0?(n(),s("p",{key:4,class:"xMn9N"},v(e(te)(e(x).reactionCount)),3)):a("",!0)],2),e(C).s.showClipButtonInNoteFooter?(n(),s("button",{key:3,ref_key:"clipButton",ref:de,class:"_button xzgmm",onMousedown:o[5]||(o[5]=L(r=>ge(),["prevent"]))},[...o[19]||(o[19]=[i("i",{class:"ti ti-paperclip"},null,-1)])],34)):a("",!0),i("button",{ref_key:"menuButton",ref:ue,class:"_button xzgmm",onMousedown:o[6]||(o[6]=L(r=>be(),["prevent"]))},[...o[20]||(o[20]=[i("i",{class:"ti ti-dots"},null,-1)])],34)])],34),i("div",{class:"xyjxP"},[i("button",{class:P(["_button",["xbTX9",{xb8VH:M.value==="replies"}]]),onClick:o[7]||(o[7]=r=>M.value="replies")},[o[21]||(o[21]=i("i",{class:"ti ti-arrow-back-up"},null,-1)),A(" "+v("Responder"),1)],2),i("button",{class:P(["_button",["xbTX9",{xb8VH:M.value==="renotes"}]]),onClick:o[8]||(o[8]=r=>M.value="renotes")},[o[22]||(o[22]=i("i",{class:"ti ti-repeat"},null,-1)),A(" "+v("Renotar"),1)],2),i("button",{class:P(["_button",["xbTX9",{xb8VH:M.value==="reactions"}]]),onClick:o[9]||(o[9]=r=>M.value="reactions")},[o[23]||(o[23]=i("i",{class:"ti ti-icons"},null,-1)),A(" "+v("Reacciones"),1)],2)],2),i("div",null,[M.value==="replies"?(n(),s("div",on,[Me.value?a("",!0):(n(),s("div",sn,[c(Be,{style:{margin:"0 auto"},primary:"",rounded:"",onClick:Xe},{default:y(()=>[A(v("Ver respuestas"),1)]),_:1})])),(n(!0),s(w,null,T(xe.value,r=>(n(),d(ee,{key:r.id,note:r,class:"x8Lf4",detail:!0},null,8,["note","class"]))),128))])):M.value==="renotes"?(n(),s("div",{key:1,class:"xsNFm"},[c(Ee,{paginator:e(Oe),forceDisableInfiniteScroll:!0},{default:y(({items:r})=>[i("div",ln,[(n(!0),s(w,null,T(r,g=>(n(),d(m,{key:g.id,to:e(U)(g.user)},{default:y(()=>[c(Ae,{user:g.user,withChart:!1},null,8,["user"])]),_:2},1032,["to"]))),128))])]),_:1},8,["paginator"])],2)):M.value==="reactions"?(n(),s("div",{key:2,class:"xqeX8"},[i("div",{class:"x8K7p"},[(n(!0),s(w,null,T(Object.keys(e(x).reactions),r=>(n(),s("button",{key:r,class:P([["xoEej",{xcXaO:$.value===r}],"_button"]),onClick:g=>$.value=r},[c(bt,{reaction:r},null,8,["reaction"]),i("span",rn,v(e(x).reactions[r]),1)],10,an))),128))],2),$.value?(n(),d(Ee,{key:$.value,paginator:e(ze),forceDisableInfiniteScroll:!0},{default:y(({items:r})=>[i("div",un,[(n(!0),s(w,null,T(r,g=>(n(),d(m,{key:g.id,to:e(U)(g.user)},{default:y(()=>[c(Ae,{user:g.user,withChart:!1},null,8,["user"])]),_:2},1032,["to"]))),128))])]),_:1},8,["paginator"])):a("",!0)],2)):a("",!0)])],64))],2)),[[Ye,De]]):W.value?(n(),s("div",{key:1,class:"_panel xdS3m",onClick:o[10]||(o[10]=r=>W.value=!1)},[c(z,{src:"{name} dijo algo",tag:"small"},{name:y(()=>[N((n(),d(m,{to:e(U)(e(t).user)},{default:y(()=>[c(b,{user:e(t).user},null,8,["user"])]),_:1},8,["to"])),[[Y,e(t).userId]])]),_:1},8,["src"])],2)):a("",!0)}}});export{fn as M};
