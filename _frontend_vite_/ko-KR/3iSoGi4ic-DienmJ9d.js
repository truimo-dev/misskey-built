import{b as W,a as c,c as Z,z as ve,k as pe,l as i,i as l,p as a,q as me,f as y,C as v,B as b,t as p,h as o,D as n,E as s,j as ee,F as se,A as fe,u as ye,T as ge}from"./3iSoGi4ic-D0mTJ0Mu.js";import{aU as _e,i as r,a7 as P,M as J,J as te,A as le,aV as ke,R as ae,ab as z,C as Y,ad as be}from"./3iSoGi4ic-DV-GuiCp.js";import{h as xe,a as we}from"./3iSoGi4ic-B1GPmOGN.js";import{_ as B}from"./3iSoGi4ic-C4MHiTai.js";import{M as K}from"./3iSoGi4ic-Fx-BY70c.js";import"./3iSoGi4ic-D98_HDRS.js";const Me={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"32px"}},he={class:"_button _help"},Ee={key:0,style:{color:"#999"}},Ce={key:1,style:{color:"var(--MI_THEME-success)"}},Ae={key:2,style:{color:"var(--MI_THEME-error)"}},Se={key:3,style:{color:"var(--MI_THEME-error)"}},Te={key:4,style:{color:"var(--MI_THEME-error)"}},Ve={key:5,style:{color:"var(--MI_THEME-error)"}},$e={key:6,style:{color:"var(--MI_THEME-error)"}},Re={class:"_button _help"},Ie={key:0,style:{color:"#999"}},Ue={key:1,style:{color:"var(--MI_THEME-success)"}},He={key:2,style:{color:"var(--MI_THEME-error)"}},Pe={key:3,style:{color:"var(--MI_THEME-error)"}},Be={key:4,style:{color:"var(--MI_THEME-error)"}},qe={key:5,style:{color:"var(--MI_THEME-error)"}},Oe={key:6,style:{color:"var(--MI_THEME-error)"}},De={key:7,style:{color:"var(--MI_THEME-error)"}},Fe={key:8,style:{color:"var(--MI_THEME-error)"}},Ne={key:9,style:{color:"var(--MI_THEME-error)"}},Le={key:0,style:{color:"var(--MI_THEME-error)"}},je={key:1,style:{color:"var(--MI_THEME-warn)"}},Xe={key:2,style:{color:"var(--MI_THEME-success)"}},ze={key:0,style:{color:"var(--MI_THEME-success)"}},Ye={key:1,style:{color:"var(--MI_THEME-error)"}},Ke=W({__name:"MkSignupDialog.form",props:{autoSet:{type:Boolean,default:!1}},emits:["signup","signupEmailPending"],setup(q,{emit:I}){const A=q,g=I,M=_e(xe),x=c(),h=c(),E=c(),S=c(),C=c(),_=c(""),T=c(""),V=c(""),$=c(""),k=c(""),u=c(null),m=c(null),U=c(""),H=c(null),R=c(!1),O=c(null),D=c(null),F=c(null),N=c(null),L=c(null),j=c(null),X=c(null),ne=Z(()=>R.value||r.enableHcaptcha&&!O.value||r.enableMcaptcha&&!D.value||r.enableRecaptcha&&!F.value||r.enableTurnstile&&!N.value||r.enableTestcaptcha&&!L.value||r.emailRequiredForSignup&&m.value!=="ok"||r.disableRegistration&&$.value===""||u.value!=="ok"||H.value!=="match");function ie(d){let e=0,w=.018;return/[a-zA-Z]/.test(d)&&/[0-9]/.test(d)&&(w+=.02),/[a-z]/.test(d)&&/[A-Z]/.test(d)&&(w+=.015),/[!\x22\#$%&@'()*+,-./_]/.test(d)&&(w+=.02),e=w*d.length,Math.max(0,Math.min(1,e))}function oe(){if(_.value===""){u.value=null;return}{const d=_.value.match(/^[a-zA-Z0-9_]+$/)?_.value.length<1?"min-range":_.value.length>20?"max-range":null:"invalid-format";if(d){u.value=d;return}}j.value!=null&&j.value.abort(),u.value="wait",j.value=new AbortController,te("username/available",{username:_.value},void 0,j.value.signal).then(d=>{u.value=d.available?"ok":"unavailable"}).catch(d=>{d.name!=="AbortError"&&(u.value="error")})}function re(){if(k.value===""){m.value=null;return}X.value!=null&&X.value.abort(),m.value="wait",X.value=new AbortController,te("email-address/available",{emailAddress:k.value},void 0,X.value.signal).then(d=>{m.value=d.available?"ok":d.reason==="used"?"unavailable:used":d.reason==="format"?"unavailable:format":d.reason==="disposable"?"unavailable:disposable":d.reason==="banned"?"unavailable:banned":d.reason==="mx"?"unavailable:mx":d.reason==="smtp"?"unavailable:smtp":"unavailable"}).catch(d=>{d.name!=="AbortError"&&(m.value="error")})}function ue(){if(T.value===""){U.value="";return}const d=ie(T.value);U.value=d>.7?"high":d>.3?"medium":"low"}function de(){if(V.value===""){H.value=null;return}H.value=T.value===V.value?"match":"not-match"}async function ce(){if(R.value)return;R.value=!0;const d={username:_.value,password:T.value,emailAddress:k.value,invitationCode:$.value,"hcaptcha-response":O.value,"m-captcha-response":D.value,"g-recaptcha-response":F.value,"turnstile-response":N.value,"testcaptcha-response":L.value},e=await window.fetch(`${we}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).catch(()=>(G(),null));if(e&&e.ok)if(e.status===204||r.emailRequiredForSignup)le({type:"success",title:"거의 다 끝났습니다",text:(({email})=>("입력하신 메일 주소("+email+")로 확인 메일을 보내드렸습니다. 가입을 완료하시려면 보내드린 메일에 있는 링크로 접속해 주세요."))({email:k.value})}),g("signupEmailPending");else{const w=await e.json();g("signup",w),A.autoSet&&await ke(w.token)}else G();R.value=!1}function G(){R.value=!1,x.value?.reset?.(),h.value?.reset?.(),E.value?.reset?.(),S.value?.reset?.(),C.value?.reset?.(),le({type:"error",text:"오류가 발생했습니다"})}return(d,e)=>{const w=ve("MkLoading"),Q=pe("tooltip");return l(),i("div",null,[a("div",{class:"xe5Bm"},[...e[10]||(e[10]=[a("i",{class:"ti ti-user-edit"},null,-1)])],2),a("div",Me,[a("form",{class:"_gaps_m",autocomplete:"new-password",onSubmit:me(ce,["prevent"])},[p(r).disableRegistration?(l(),y(P,{key:0,modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=f=>$.value=f),type:"text",spellcheck:!1,required:"","data-cy-signup-invitation-code":""},{label:o(()=>[n(s("초대 코드"),1)]),prefix:o(()=>[...e[11]||(e[11]=[a("i",{class:"ti ti-key"},null,-1)])]),_:1},8,["modelValue"])):v("",!0),b(P,{modelValue:_.value,"onUpdate:modelValue":[e[1]||(e[1]=f=>_.value=f),oe],type:"text",pattern:"^[a-zA-Z0-9_]{1,20}$",spellcheck:!1,autocomplete:"username",required:"","data-cy-signup-username":""},{label:o(()=>[n(s("유저명")+" ",1),ee((l(),i("div",he,[...e[12]||(e[12]=[a("i",{class:"ti ti-help-circle"},null,-1)])])),[[Q,"서버상에서 계정을 식별하기 위한 이름. 알파벳(a~z, A~Z), 숫자(0~9) 및 언더바(_)를 사용할 수 있습니다. 유저명은 나중에 변경할 수 없습니다.","dialog"]])]),prefix:o(()=>[...e[13]||(e[13]=[n("@",-1)])]),suffix:o(()=>[n("@"+s(p(M)),1)]),caption:o(()=>[a("div",null,[e[14]||(e[14]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("나중에 변경할 수 없습니다."),1)]),u.value==="wait"?(l(),i("span",Ee,[b(w,{em:!0}),n(" "+s("확인하는 중입니다"),1)])):u.value==="ok"?(l(),i("span",Ce,[e[15]||(e[15]=a("i",{class:"ti ti-check ti-fw"},null,-1)),n(" "+s("사용 가능합니다"),1)])):u.value==="unavailable"?(l(),i("span",Ae,[e[16]||(e[16]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("사용할 수 없습니다"),1)])):u.value==="error"?(l(),i("span",Se,[e[17]||(e[17]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("오류"),1)])):u.value==="invalid-format"?(l(),i("span",Te,[e[18]||(e[18]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("a~z, A~Z, 0-9, _를 사용할 수 있습니다"),1)])):u.value==="min-range"?(l(),i("span",Ve,[e[19]||(e[19]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("너무 짧습니다"),1)])):u.value==="max-range"?(l(),i("span",$e,[e[20]||(e[20]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("너무 깁니다"),1)])):v("",!0)]),_:1},8,["modelValue"]),p(r).emailRequiredForSignup?(l(),y(P,{key:1,modelValue:k.value,"onUpdate:modelValue":[e[2]||(e[2]=f=>k.value=f),re],debounce:!0,type:"email",spellcheck:!1,required:"","data-cy-signup-email":""},{label:o(()=>[n(s("메일 주소")+" ",1),ee((l(),i("div",Re,[...e[21]||(e[21]=[a("i",{class:"ti ti-help-circle"},null,-1)])])),[[Q,"당신이 사용하고 있는 이메일 주소를 입력해 주세요. 이메일 주소는 다른 유저에게 공개되지 않습니다.","dialog"]])]),prefix:o(()=>[...e[22]||(e[22]=[a("i",{class:"ti ti-mail"},null,-1)])]),caption:o(()=>[m.value==="wait"?(l(),i("span",Ie,[b(w,{em:!0}),n(" "+s("확인하는 중입니다"),1)])):m.value==="ok"?(l(),i("span",Ue,[e[23]||(e[23]=a("i",{class:"ti ti-check ti-fw"},null,-1)),n(" "+s("사용 가능합니다"),1)])):m.value==="unavailable:used"?(l(),i("span",He,[e[24]||(e[24]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("이 메일 주소는 사용중입니다"),1)])):m.value==="unavailable:format"?(l(),i("span",Pe,[e[25]||(e[25]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("형식이 올바르지 않습니다"),1)])):m.value==="unavailable:disposable"?(l(),i("span",Be,[e[26]||(e[26]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("임시 이메일 주소는 사용할 수 없습니다"),1)])):m.value==="unavailable:banned"?(l(),i("span",qe,[e[27]||(e[27]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("이 메일 주소는 사용할 수 없습니다"),1)])):m.value==="unavailable:mx"?(l(),i("span",Oe,[e[28]||(e[28]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("메일 서버가 올바르지 않습니다"),1)])):m.value==="unavailable:smtp"?(l(),i("span",De,[e[29]||(e[29]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("메일 서버가 응답하지 않습니다"),1)])):m.value==="unavailable"?(l(),i("span",Fe,[e[30]||(e[30]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("사용할 수 없습니다"),1)])):m.value==="error"?(l(),i("span",Ne,[e[31]||(e[31]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("오류"),1)])):v("",!0)]),_:1},8,["modelValue"])):v("",!0),b(P,{modelValue:T.value,"onUpdate:modelValue":[e[3]||(e[3]=f=>T.value=f),ue],type:"password",autocomplete:"new-password",required:"","data-cy-signup-password":""},{label:o(()=>[n(s("비밀번호"),1)]),prefix:o(()=>[...e[32]||(e[32]=[a("i",{class:"ti ti-lock"},null,-1)])]),caption:o(()=>[U.value=="low"?(l(),i("span",Le,[e[33]||(e[33]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("약한 비밀번호"),1)])):v("",!0),U.value=="medium"?(l(),i("span",je,[e[34]||(e[34]=a("i",{class:"ti ti-check ti-fw"},null,-1)),n(" "+s("좋은 비밀번호"),1)])):v("",!0),U.value=="high"?(l(),i("span",Xe,[e[35]||(e[35]=a("i",{class:"ti ti-check ti-fw"},null,-1)),n(" "+s("강한 비밀번호"),1)])):v("",!0)]),_:1},8,["modelValue"]),b(P,{modelValue:V.value,"onUpdate:modelValue":[e[4]||(e[4]=f=>V.value=f),de],type:"password",autocomplete:"new-password",required:"","data-cy-signup-password-retype":""},{label:o(()=>[n(s("비밀번호")+" ("+s("다시 입력")+")",1)]),prefix:o(()=>[...e[36]||(e[36]=[a("i",{class:"ti ti-lock"},null,-1)])]),caption:o(()=>[H.value=="match"?(l(),i("span",ze,[e[37]||(e[37]=a("i",{class:"ti ti-check ti-fw"},null,-1)),n(" "+s("일치합니다"),1)])):v("",!0),H.value=="not-match"?(l(),i("span",Ye,[e[38]||(e[38]=a("i",{class:"ti ti-alert-triangle ti-fw"},null,-1)),n(" "+s("일치하지 않습니다"),1)])):v("",!0)]),_:1},8,["modelValue"]),p(r).enableHcaptcha?(l(),y(B,{key:2,ref_key:"hcaptcha",ref:x,modelValue:O.value,"onUpdate:modelValue":e[5]||(e[5]=f=>O.value=f),class:"xo1O8",provider:"hcaptcha",sitekey:p(r).hcaptchaSiteKey},null,8,["modelValue","class","sitekey"])):v("",!0),p(r).enableMcaptcha?(l(),y(B,{key:3,ref_key:"mcaptcha",ref:h,modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=f=>D.value=f),class:"xo1O8",provider:"mcaptcha",sitekey:p(r).mcaptchaSiteKey,instanceUrl:p(r).mcaptchaInstanceUrl},null,8,["modelValue","class","sitekey","instanceUrl"])):v("",!0),p(r).enableRecaptcha?(l(),y(B,{key:4,ref_key:"recaptcha",ref:E,modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=f=>F.value=f),class:"xo1O8",provider:"recaptcha",sitekey:p(r).recaptchaSiteKey},null,8,["modelValue","class","sitekey"])):v("",!0),p(r).enableTurnstile?(l(),y(B,{key:5,ref_key:"turnstile",ref:S,modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=f=>N.value=f),class:"xo1O8",provider:"turnstile",sitekey:p(r).turnstileSiteKey},null,8,["modelValue","class","sitekey"])):v("",!0),p(r).enableTestcaptcha?(l(),y(B,{key:6,ref_key:"testcaptcha",ref:C,modelValue:L.value,"onUpdate:modelValue":e[9]||(e[9]=f=>L.value=f),class:"xo1O8",provider:"testcaptcha",sitekey:null},null,8,["modelValue","class"])):v("",!0),b(J,{type:"submit",disabled:ne.value,large:"",gradate:"",rounded:"","data-cy-signup-submit":"",style:{margin:"0 auto"}},{default:o(()=>[R.value?(l(),y(w,{key:0,em:!0,colored:!1})):(l(),i(se,{key:1},[n(s("시작하기"),1)],64))]),_:1},8,["disabled"])],32)])])}}});const Ze={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px"}},Je={class:"_gaps_m"},We={key:0,class:"_gaps_s"},Ge={style:{"text-align":"center"}},Qe={style:{"font-weight":"bold","margin-top":"0.5em"}},et={key:0,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},tt=["innerHTML"],lt={key:0,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},at={class:"_gaps_s"},st={key:0},nt=["href"],it={key:1},ot=["href"],rt={key:0,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},ut={href:"https://isnook.com/@admin/pages/warning",class:"_link"},dt={key:3,style:{"text-align":"center"}},ct={class:"_buttonsCenter"},vt=W({__name:"MkSignupDialog.rules",emits:["cancel","done"],setup(q,{emit:I}){const A=r.serverRules.length>0,g=r.tosUrl!=null&&r.tosUrl!=="",M=r.privacyPolicyUrl!=null&&r.privacyPolicyUrl!=="",x=c(!1),h=c(!1),E=c(!1),S=Z(()=>(!A||x.value)&&(!g&&!M||h.value)&&E.value),C=I,_=Z(()=>g&&M?"약관 및 개인정보 보호 정책":g?"이용 약관":M?"개인정보 보호 정책":"");async function T(k){if(k){if((await Y({type:"question",title:"동의하십니까?",text:(({x})=>("\""+x+"\"의 내용을 읽고 동의합니다."))({x:"서버 규칙"})})).canceled)return;x.value=!0}else x.value=!1}async function V(k){if(k){if((await Y({type:"question",title:"동의하십니까?",text:(({x})=>("\""+x+"\"의 내용을 읽고 동의합니다."))({x:_.value})})).canceled)return;h.value=!0}else h.value=!1}async function $(k){if(k){if((await Y({type:"question",title:"동의하십니까?",text:(({x})=>("\""+x+"\"의 내용을 읽고 동의합니다."))({x:"기본적인 주의사항"})})).canceled)return;E.value=!0}else E.value=!1}return(k,u)=>(l(),i("div",null,[a("div",{class:"xCmmU"},[...u[2]||(u[2]=[a("i",{class:"ti ti-checklist"},null,-1)])],2),a("div",Ze,[a("div",Je,[p(r).disableRegistration||p(r).federation!=="all"?(l(),i("div",We,[p(r).disableRegistration?(l(),y(ae,{key:0,warn:""},{default:o(()=>[n(s("현재 이 서버는 비공개입니다. 회원가입을 하시려면 초대 코드가 필요합니다."),1)]),_:1})):v("",!0),p(r).federation==="specified"?(l(),y(ae,{key:1,warn:""},{default:o(()=>[n(s("이 서버는 화이트 리스트 제도로 운영 중 입니다. 정해진 리모트 서버가 아닌 경우 연합되지 않습니다."),1)]),_:1})):v("",!0)])):v("",!0),a("div",Ge,[a("div",null,s("이 서버에 가입하기 전에 아래 사항을 확인하여 주십시오."),1),a("div",Qe,s("중요하므로 반드시 읽어주십시오."),1)]),A?(l(),y(K,{key:1,defaultOpen:!0},{label:o(()=>[n(s("서버 규칙"),1)]),suffix:o(()=>[x.value?(l(),i("i",et)):v("",!0)]),default:o(()=>[a("ol",{class:"_gaps_s xa9jX"},[(l(!0),i(se,null,fe(p(r).serverRules,m=>(l(),i("li",{class:"xhv4Y"},[a("div",{class:"xnEhD",innerHTML:m},null,10,tt)],2))),256))],2),b(z,{modelValue:x.value,style:{"margin-top":"16px"},"onUpdate:modelValue":T},{default:o(()=>[n(s("동의합니다"),1)]),_:1},8,["modelValue"])]),_:1})):v("",!0),p(g)||p(M)?(l(),y(K,{key:2,defaultOpen:!0},{label:o(()=>[n(s(_.value),1)]),suffix:o(()=>[h.value?(l(),i("i",lt)):v("",!0)]),default:o(()=>[a("div",at,[p(g)?(l(),i("div",st,[a("a",{href:p(r).tosUrl??void 0,class:"_link",target:"_blank"},[n(s("이용 약관")+" ",1),u[3]||(u[3]=a("i",{class:"ti ti-external-link"},null,-1))],8,nt)])):v("",!0),p(M)?(l(),i("div",it,[a("a",{href:p(r).privacyPolicyUrl??void 0,class:"_link",target:"_blank"},[n(s("개인정보 보호 정책")+" ",1),u[4]||(u[4]=a("i",{class:"ti ti-external-link"},null,-1))],8,ot)])):v("",!0)]),b(z,{modelValue:h.value,style:{"margin-top":"16px"},"onUpdate:modelValue":V},{default:o(()=>[n(s("동의합니다"),1)]),_:1},8,["modelValue"])]),_:1})):v("",!0),b(K,{defaultOpen:!0},{label:o(()=>[n(s("기본적인 주의사항"),1)]),suffix:o(()=>[E.value?(l(),i("i",rt)):v("",!0)]),default:o(()=>[a("a",ut,[n(s("기본적인 주의사항")+" ",1),u[5]||(u[5]=a("i",{class:"ti ti-external-link"},null,-1))]),b(z,{modelValue:E.value,style:{"margin-top":"16px"},"data-cy-signup-rules-notes-agree":"","onUpdate:modelValue":$},{default:o(()=>[n(s("동의합니다"),1)]),_:1},8,["modelValue"])]),_:1}),S.value?v("",!0):(l(),i("div",dt,s("계속하시려면 모든 항목에 동의하십시오."),1)),a("div",ct,[b(J,{inline:"",rounded:"",onClick:u[0]||(u[0]=m=>C("cancel"))},{default:o(()=>[n(s("취소"),1)]),_:1}),b(J,{inline:"",primary:"",rounded:"",gradate:"",disabled:!S.value,"data-cy-signup-rules-continue":"",onClick:u[1]||(u[1]=m=>C("done"))},{default:o(()=>[n(s("계속")+" ",1),u[6]||(u[6]=a("i",{class:"ti ti-arrow-right"},null,-1))]),_:1},8,["disabled"])])])])]))}});const pt={style:{"overflow-x":"clip"}},Mt=W({__name:"MkSignupDialog",props:{autoSet:{type:Boolean,default:!1}},emits:["done","cancelled","closed"],setup(q,{emit:I}){const A=I,g=ye("dialog"),M=c(!1);function x(){A("cancelled"),g.value?.close()}function h(S){A("done",S),g.value?.close()}function E(){g.value?.close()}return(S,C)=>(l(),y(be,{ref_key:"dialog",ref:g,width:500,height:600,onClose:x,onClosed:C[1]||(C[1]=_=>A("closed"))},{header:o(()=>[n(s("회원 가입"),1)]),default:o(()=>[a("div",pt,[b(ge,{mode:"out-in",enterActiveClass:"xsLH1",leaveActiveClass:"xrfew",enterFromClass:"xjiCm",leaveToClass:"xhCjk"},{default:o(()=>[M.value?(l(),y(Ke,{key:1,autoSet:q.autoSet,onSignup:h,onSignupEmailPending:E},null,8,["autoSet"])):(l(),y(vt,{key:0,onDone:C[0]||(C[0]=_=>M.value=!0),onCancel:x}))]),_:1},8,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass"])])]),_:1},512))}});export{Mt as default};
