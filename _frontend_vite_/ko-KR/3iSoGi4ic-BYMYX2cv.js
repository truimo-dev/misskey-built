const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D6lvPj3q.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css"])))=>i.map(i=>d[i]);
import{_ as O,j as re,M as P,e as K,k as me,E as q,l as z,b5 as pe,J as B,cg as ve,ca as ce,a7 as A,ab as H,aL as ge,aS as fe,az as Ve,ag as ye,L as D,m as j,C as _e,af as be,$ as ke}from"./3iSoGi4ic-DV-GuiCp.js";import{u as xe}from"./3iSoGi4ic-B1GPmOGN.js";import{b as S,a as f,l as h,i as p,p as i,j as Z,x as X,C as x,v as Ie,w as N,e as L,f as _,h as u,B as I,t as M,d as Y,D as V,E as g,u as Ce,o as we,S as $e,U as Pe,y as he,c as J,z as Se,R as Ue}from"./3iSoGi4ic-D0mTJ0Mu.js";import{M as Ee}from"./3iSoGi4ic-i0V9UGTl.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-Cj3FgKaq.js";import"./3iSoGi4ic-CS6W3O_2.js";import"./3iSoGi4ic-CdSqfJMx.js";import"./3iSoGi4ic-Dv7rS4og.js";const Be={class:"cpjygsrt"},Me={class:"title"},Te={class:"buttons"},Re={key:1,class:"drag-handle _button"},De={key:0,class:"ti ti-chevron-up"},Ae={key:1,class:"ti ti-chevron-down"},Ne={class:"body"},We=S({__name:"page-editor.container",props:{expanded:{type:Boolean,default:!0},removable:{type:Boolean,default:!0},draggable:{type:Boolean}},emits:["toggle","remove"],setup(b,{emit:c}){const v=b,m=c,a=f(v.expanded);function e(n){a.value=n,m("toggle",n)}function d(){m("remove")}return(n,t)=>(p(),h("div",Be,[i("header",null,[i("div",Me,[X(n.$slots,"header",{},void 0,!0)]),i("div",Te,[X(n.$slots,"func",{},void 0,!0),b.removable?(p(),h("button",{key:0,class:"_button",onClick:t[0]||(t[0]=s=>d())},[...t[2]||(t[2]=[i("i",{class:"ti ti-trash"},null,-1)])])):x("",!0),b.draggable?(p(),h("button",Re,[...t[3]||(t[3]=[i("i",{class:"ti ti-menu-2"},null,-1)])])):x("",!0),i("button",{class:"_button",onClick:t[1]||(t[1]=s=>e(!a.value))},[a.value?(p(),h("i",De)):(p(),h("i",Ae))])])]),Z(i("div",Ne,[X(n.$slots,"default",{},void 0,!0)],512),[[Ie,a.value]])]))}}),W=O(We,[["__scopeId","data-v-8b2c5f23"]]);function G(){return[{value:"section",label:"섹션"},{value:"text",label:"텍스트"},{value:"image",label:"이미지"},{value:"note",label:"노트필기"}]}const je={class:"ilrvjyvi"},Xe=S({__name:"page-editor.el.section",props:{modelValue:{}},emits:["update:modelValue","remove"],setup(b,{emit:c}){const v=Y(()=>K(()=>Promise.resolve().then(()=>Je),void 0,import.meta.url)),m=b,a=c,e=f(re(m.modelValue.children??[]));N(e,()=>{a("update:modelValue",{...m.modelValue,children:e.value})},{deep:!0});async function d(){const{canceled:t,result:s}=await me({title:"섹션 타이틀을 입력하기",default:m.modelValue.title});t||s==null||a("update:modelValue",{...m.modelValue,title:s})}async function n(){const{canceled:t,result:s}=await q({title:"블록 추가",items:G()});if(t||s==null)return;const r=z();s==="text"?e.value.push({id:r,type:s,text:""}):s==="section"?e.value.push({id:r,type:s,title:"",children:[]}):s==="image"?e.value.push({id:r,type:s,fileId:null}):s==="note"&&e.value.push({id:r,type:s,detailed:!1,note:null})}return L(()=>{m.modelValue.title==null&&d()}),(t,s)=>(p(),_(W,{draggable:!0,onRemove:s[3]||(s[3]=()=>a("remove"))},{header:u(()=>[s[4]||(s[4]=i("i",{class:"ti ti-note"},null,-1)),V(" "+g(m.modelValue.title),1)]),func:u(()=>[i("button",{class:"_button",onClick:s[0]||(s[0]=r=>d())},[...s[5]||(s[5]=[i("i",{class:"ti ti-pencil"},null,-1)])])]),default:u(()=>[i("section",je,[I(M(v),{modelValue:e.value,"onUpdate:modelValue":s[1]||(s[1]=r=>e.value=r),class:"children"},null,8,["modelValue"]),I(P,{rounded:"",class:"add",onClick:s[2]||(s[2]=r=>n())},{default:u(()=>[...s[6]||(s[6]=[i("i",{class:"ti ti-plus"},null,-1)])]),_:1})])]),_:1}))}}),ze=O(Xe,[["__scopeId","data-v-252b47f0"]]),He=S({__name:"page-editor.el.text",props:{modelValue:{}},emits:["update:modelValue","remove"],setup(b,{emit:c}){const v=b,m=c;let a;const e=f(v.modelValue.text??""),d=Ce("inputEl");return N(e,()=>{m("update:modelValue",{...v.modelValue,text:e.value})}),L(()=>{d.value!=null&&(a=new pe(d.value,e))}),we(()=>{a.detach()}),(n,t)=>(p(),_(W,{draggable:!0,onRemove:t[1]||(t[1]=()=>m("remove"))},{header:u(()=>[t[2]||(t[2]=i("i",{class:"ti ti-align-left"},null,-1)),V(" "+g("텍스트"),1)]),default:u(()=>[i("section",null,[Z(i("textarea",{ref_key:"inputEl",ref:d,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),class:"xzK0s"},null,2),[[$e,e.value]])])]),_:1}))}});const Oe=S({__name:"page-editor.el.image",props:{modelValue:{}},emits:["update:modelValue","remove"],setup(b,{emit:c}){const v=b,m=c,a=f(null);async function e(){ce({multiple:!1}).then(d=>{a.value=d[0],m("update:modelValue",{...v.modelValue,fileId:a.value.id})})}return L(async()=>{v.modelValue.fileId==null?await e():B("drive/files/show",{fileId:v.modelValue.fileId}).then(d=>{a.value=d})}),(d,n)=>(p(),_(W,{draggable:!0,onRemove:n[2]||(n[2]=()=>m("remove"))},{header:u(()=>[n[3]||(n[3]=i("i",{class:"ti ti-photo"},null,-1)),V(" "+g("이미지"),1)]),func:u(()=>[i("button",{onClick:n[0]||(n[0]=t=>e())},[...n[4]||(n[4]=[i("i",{class:"ti ti-folder"},null,-1)])])]),default:u(()=>[i("section",null,[a.value?(p(),_(ve,{key:0,style:{height:"150px"},file:a.value,fit:"contain",onClick:n[1]||(n[1]=t=>e())},null,8,["file"])):x("",!0)])]),_:1}))}}),Le={style:{padding:"16px"},class:"_gaps_s"},Fe=S({__name:"page-editor.el.note",props:{modelValue:{}},emits:["update:modelValue","remove"],setup(b,{emit:c}){const v=b,m=c,a=f(v.modelValue.note),e=f(null);return N(a,async()=>{if(a.value&&(a.value.startsWith("http://")||a.value.startsWith("https://"))&&(a.value=(a.value.endsWith("/")?a.value.slice(0,-1):a.value).split("/").pop()??null),!a.value){e.value=null;return}m("update:modelValue",{...v.modelValue,note:a.value}),e.value=await B("notes/show",{noteId:a.value})},{immediate:!0}),(d,n)=>(p(),_(W,{draggable:!0,onRemove:n[4]||(n[4]=()=>m("remove"))},{header:u(()=>[n[5]||(n[5]=i("i",{class:"ti ti-note"},null,-1)),V(" "+g("노트필기"),1)]),default:u(()=>[i("section",Le,[I(A,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=t=>a.value=t)},{label:u(()=>[V(g("노트 ID"),1)]),caption:u(()=>[V(g("노트 URL을 붙여넣어 설정할 수도 있습니다."),1)]),_:1},8,["modelValue"]),I(H,{modelValue:v.modelValue.detailed,"onUpdate:modelValue":n[1]||(n[1]=t=>v.modelValue.detailed=t)},{default:u(()=>[i("span",null,g("세부 정보 보기"),1)]),_:1},8,["modelValue"]),e.value&&!v.modelValue.detailed?(p(),_(ge,{key:e.value.id+":normal",note:e.value,"onUpdate:note":n[2]||(n[2]=t=>e.value=t),style:{"margin-bottom":"16px"}},null,8,["note"])):x("",!0),e.value&&v.modelValue.detailed?(p(),_(Ee,{key:e.value.id+":detail",note:e.value,"onUpdate:note":n[3]||(n[3]=t=>e.value=t),style:{"margin-bottom":"16px"}},null,8,["note"])):x("",!0)])]),_:1}))}}),Q=S({__name:"page-editor.blocks",props:{modelValue:{}},emits:["update:modelValue"],setup(b,{emit:c}){function v(t){switch(t){case"section":return ze;case"text":return He;case"image":return Oe;case"note":return Fe;default:return null}}const m=Y(()=>K(()=>import("./3iSoGi4ic-D6lvPj3q.js").then(t=>t.v),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url).then(t=>t.default)),a=b,e=c;function d(t){const s=a.modelValue.findIndex(C=>C.id===t.id),r=[...a.modelValue.slice(0,s),t,...a.modelValue.slice(s+1)];e("update:modelValue",r)}function n(t){const s=a.modelValue.findIndex(C=>C.id===t.id),r=[...a.modelValue.slice(0,s),...a.modelValue.slice(s+1)];e("update:modelValue",r)}return(t,s)=>(p(),_(M(m),{modelValue:b.modelValue,tag:"div",itemKey:"id",handle:".drag-handle",group:{name:"blocks"},animation:150,swapThreshold:.5,"onUpdate:modelValue":s[0]||(s[0]=r=>e("update:modelValue",r))},{item:u(({element:r})=>[i("div",{class:"xe33B"},[(p(),_(Pe(v(r.type)),{modelValue:r,"onUpdate:modelValue":d,onRemove:()=>n(r)},null,40,["modelValue","onRemove"]))],2)]),_:1},8,["modelValue"]))}});const Je=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"})),Ke={class:"_spacer",style:{"--MI_SPACER-w":"700px"}},qe={class:"jqqmcavi"},Ze={key:0},Ye={class:"_gaps_m"},Ge={class:"eyeCatch"},Qe={key:1},et=["src","alt"],tt={key:1},lt=S({__name:"page-editor",props:{initPageId:{},initPageName:{},initUser:{}},setup(b){const c=b,v=f("settings"),m=f(ke),a=f(!1),e=f(null),d=f(null),n=f(null),t=f(""),s=f(null),r=f(Date.now().toString()),C=f(null),$=f(null),{model:E,def:ee}=fe({items:[{label:"고딕체",value:"sans-serif"},{label:"명조체",value:"serif"}],initialValue:"sans-serif"}),w=f([]),T=f(!1),R=f(!1);he("readonly",a.value),N($,async()=>{$.value==null?C.value=null:C.value=await B("drive/files/show",{fileId:$.value})});function F(){return{title:t.value.trim(),name:r.value.trim(),summary:s.value,font:E.value,script:"",hideTitleWhenPinned:R.value,alignCenter:T.value,content:w.value,variables:[],eyeCatchingImageId:$.value}}async function te(){const k=F();if(d.value){const l={pageId:d.value,...k};await D("pages/update",l,void 0,{"2298a392-d4a1-44c5-9ebb-ac1aeaa5a9ab":{title:"오류가 발생했습니다",text:"지정한 페이지 URL이 이미 존재합니다"}}),n.value=r.value.trim()}else{const l=await D("pages/create",k,void 0,{"4650348e-301c-499a-83c9-6aa988c66bc1":{title:"오류가 발생했습니다",text:"지정한 페이지 URL이 이미 존재합니다"}});d.value=l.id,n.value=r.value.trim(),j.replace("/pages/edit/:initPageId",{params:{initPageId:d.value}})}}async function le(){if(!d.value)return;const{canceled:k}=await _e({type:"warning",text:(({x})=>("\""+x+"\" 을(를) 삭제하시겠습니까?"))({x:t.value.trim()})});k||(await D("pages/delete",{pageId:d.value}),j.replace("/pages"))}async function ae(){t.value=t.value+" - copy",r.value=r.value+"-copy";const k=await D("pages/create",F(),void 0,{"4650348e-301c-499a-83c9-6aa988c66bc1":{title:"오류가 발생했습니다",text:"지정한 페이지 URL이 이미 존재합니다"}});d.value=k.id,n.value=r.value.trim(),j.push("/pages/edit/:initPageId",{params:{initPageId:d.value}})}async function se(){const{canceled:k,result:l}=await q({title:"블록 추가",items:G()});if(k||l==null)return;const U=z();l==="text"?w.value.push({id:U,type:l,text:""}):l==="section"?w.value.push({id:U,type:l,title:"",children:[]}):l==="image"?w.value.push({id:U,type:l,fileId:null}):l==="note"&&w.value.push({id:U,type:l,detailed:!1,note:null})}function ne(k){be({anchorElement:k.currentTarget??k.target,multiple:!1}).then(l=>{$.value=l.id})}function oe(){$.value=null}async function ie(){if(c.initPageId?e.value=await B("pages/show",{pageId:c.initPageId}):c.initPageName&&c.initUser&&(e.value=await B("pages/show",{name:c.initPageName,username:c.initUser}),a.value=!0),e.value)m.value=e.value.user,d.value=e.value.id,t.value=e.value.title,r.value=e.value.name,n.value=e.value.name,s.value=e.value.summary,E.value=e.value.font,R.value=e.value.hideTitleWhenPinned,T.value=e.value.alignCenter,w.value=e.value.content,$.value=e.value.eyeCatchingImageId;else{const k=z();w.value=[{id:k,type:"text",text:"Hello World!"}]}}ie();const ue=J(()=>[]),de=J(()=>[{key:"settings",title:"페이지 설정",icon:"ti ti-settings"},{key:"contents",title:"콘텐츠",icon:"ti ti-note"}]);return Ve(()=>({title:c.initPageId?"페이지 수정":c.initPageName&&c.initUser?"소스 표시 중":"페이지 만들기",icon:"ti ti-pencil"})),(k,l)=>{const U=Se("PageWithHeader");return p(),_(U,{tab:v.value,"onUpdate:tab":l[9]||(l[9]=y=>v.value=y),actions:ue.value,tabs:de.value},{default:u(()=>[i("div",Ke,[i("div",qe,[d.value&&m.value!=null?(p(),_(P,{key:0,class:"button",inline:"",link:"",to:`/@${m.value.username}/pages/${n.value}`},{default:u(()=>[l[10]||(l[10]=i("i",{class:"ti ti-external-link"},null,-1)),V(" "+g("페이지 보기"),1)]),_:1},8,["to"])):x("",!0),a.value?x("",!0):(p(),_(P,{key:1,inline:"",primary:"",class:"button",onClick:te},{default:u(()=>[l[11]||(l[11]=i("i",{class:"ti ti-device-floppy"},null,-1)),V(" "+g("저장"),1)]),_:1})),d.value?(p(),_(P,{key:2,inline:"",class:"button",onClick:ae},{default:u(()=>[l[12]||(l[12]=i("i",{class:"ti ti-copy"},null,-1)),V(" "+g("복제"),1)]),_:1})):x("",!0),d.value&&!a.value?(p(),_(P,{key:3,inline:"",class:"button",danger:"",onClick:le},{default:u(()=>[l[13]||(l[13]=i("i",{class:"ti ti-trash"},null,-1)),V(" "+g("삭제"),1)]),_:1})):x("",!0)]),v.value==="settings"?(p(),h("div",Ze,[i("div",Ye,[I(A,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=y=>t.value=y)},{label:u(()=>[V(g("제목"),1)]),_:1},8,["modelValue"]),I(A,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=y=>s.value=y)},{label:u(()=>[V(g("페이지 요약"),1)]),_:1},8,["modelValue"]),I(A,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=y=>r.value=y)},{prefix:u(()=>[V(g(M(xe))+"/@"+g(m.value?.username??"???")+"/pages/",1)]),label:u(()=>[V(g("페이지 URL"),1)]),_:1},8,["modelValue"]),I(H,{modelValue:T.value,"onUpdate:modelValue":l[3]||(l[3]=y=>T.value=y)},{default:u(()=>[V(g("가운데 정렬"),1)]),_:1},8,["modelValue"]),I(ye,{modelValue:M(E),"onUpdate:modelValue":l[4]||(l[4]=y=>Ue(E)?E.value=y:null),items:M(ee)},{label:u(()=>[V(g("폰트"),1)]),_:1},8,["modelValue","items"]),I(H,{modelValue:R.value,"onUpdate:modelValue":l[5]||(l[5]=y=>R.value=y)},{default:u(()=>[V(g("프로필에 고정한 경우 타이틀을 표시하지 않음"),1)]),_:1},8,["modelValue"]),i("div",Ge,[$.value==null&&!a.value?(p(),_(P,{key:0,onClick:ne},{default:u(()=>[l[14]||(l[14]=i("i",{class:"ti ti-plus"},null,-1)),V(" "+g("아이캐치 이미지를 설정"),1)]),_:1})):C.value?(p(),h("div",Qe,[i("img",{src:C.value.url,alt:C.value.name,style:{"max-width":"100%"}},null,8,et),a.value?x("",!0):(p(),_(P,{key:0,onClick:l[6]||(l[6]=y=>oe())},{default:u(()=>[l[15]||(l[15]=i("i",{class:"ti ti-trash"},null,-1)),V(" "+g("아이캐치 이미지를 삭제"),1)]),_:1}))])):x("",!0)])])])):v.value==="contents"?(p(),h("div",tt,[i("div",{class:"xlJZX"},[I(Q,{modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=y=>w.value=y),class:"content"},null,8,["modelValue"]),a.value?x("",!0):(p(),_(P,{key:0,rounded:"",class:"add",onClick:l[8]||(l[8]=y=>se())},{default:u(()=>[...l[16]||(l[16]=[i("i",{class:"ti ti-plus"},null,-1)])]),_:1}))],2)])):x("",!0)])]),_:1},8,["tab","actions","tabs"])}}});const ct=O(lt,[["__scopeId","data-v-9ea7216d"]]);export{ct as default};
