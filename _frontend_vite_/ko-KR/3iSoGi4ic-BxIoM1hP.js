import{Q as V,ak as z,a6 as H,M as C,R as P,a7 as X,h as D,b$ as E,k as O,J as b,az as Q}from"./3iSoGi4ic-DV-GuiCp.js";import{X as W}from"./3iSoGi4ic-D3TJKvmz.js";import{M as j}from"./3iSoGi4ic-DtDbNQ4_.js";import{M as q}from"./3iSoGi4ic-qgTlnaib.js";import{b as w,a as y,e as I,z as m,l as _,i as t,f as a,B as p,C as d,t as L,h as i,p as c,D as R,E as v,F as B,A as S,c as T}from"./3iSoGi4ic-D0mTJ0Mu.js";import{M as J}from"./3iSoGi4ic-Fx-BY70c.js";import{M as G}from"./3iSoGi4ic-DygYQwdU.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-DID2kkuO.js";const K={class:"_gaps"},Y={class:"_gaps_s"},Z=w({__name:"home.home",setup(g){const s=V(),o=z(),n=y(""),u=y(!1),f=y([]);function M(h){D([{text:"개인 대화",caption:"특정 유저와 일대일 채팅을 할 수 있습니다.",icon:"ti ti-user",action:()=>{l()}},{type:"divider"},{type:"parent",text:"룸 채팅",caption:"여러 명이 함께 채팅할 수 있습니다.\n또한, 개인 채팅을 허용하지 않은 유저와도 상대방이 수락하면 채팅을 할 수 있습니다.",icon:"ti ti-users-group",children:[{text:"룸을 생성",icon:"ti ti-plus",action:()=>{r()}}]}],h.currentTarget??h.target)}async function l(){E({localOnly:!0}).then(h=>{o.push("/chat/user/:userId",{params:{userId:h.id}})})}async function r(){const{canceled:h,result:k}=await O({title:"이름",minLength:1});if(h)return;const $=await b("chat/rooms/create",{name:k});o.push("/chat/room/:roomId",{params:{roomId:$.id}})}async function F(){const h=await b("chat/messages/search",{query:n.value});f.value=h,u.value=!0}return I(()=>{H({hasUnreadChatMessages:!1})}),(h,k)=>{const $=m("MkAd");return t(),_("div",K,[L(s).policies.chatAvailability==="available"?(t(),a(C,{key:0,primary:"",gradate:"",rounded:"",class:"x3hnh",onClick:M},{default:i(()=>[k[1]||(k[1]=c("i",{class:"ti ti-plus"},null,-1)),R(" "+v("채팅을 시작하기"),1)]),_:1},8,["class"])):(t(),a(P,{key:1},{default:i(()=>[R(v(L(s).policies.chatAvailability==="readonly"?"이 서버 또는 이 계정에서 채팅은 읽기 전용입니다. 새로 쓰거나 채팅 룸을 만들거나 참가할 수 없습니다.":"이 서버 또는 이 계정에서 채팅이 활성화되어 있지 않습니다."),1)]),_:1})),p($,{preferForms:["horizontal","horizontal-big"]}),p(X,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=A=>n.value=A),placeholder:"메시지 검색",type:"search"},{prefix:i(()=>[...k[2]||(k[2]=[c("i",{class:"ti ti-search"},null,-1)])]),_:1},8,["modelValue","placeholder"]),n.value.length>0?(t(),a(C,{key:2,primary:"",rounded:"",onClick:F},{default:i(()=>[R(v("검색"),1)]),_:1})):d("",!0),u.value?(t(),a(j,{key:3},{header:i(()=>[R(v("검색 결과"),1)]),default:i(()=>[c("div",Y,[(t(!0),_(B,null,S(f.value,A=>(t(),_("div",{key:A.id,class:"xmSre"},[p(W,{message:A,isSearchResult:!0},null,8,["message"])],2))),128))])]),_:1})):d("",!0),p(j,null,{header:i(()=>[R(v("이력"),1)]),default:i(()=>[p(q)]),_:1})])}}});const tt={class:"_gaps"},et={key:0,class:"_gaps_s"},st={class:"_buttons"},ot={style:{flex:"1"},class:"_gaps_s"},at=w({__name:"home.invitations",setup(g){const s=z(),o=y(!0),n=y([]);async function u(){o.value=!0;const l=await b("chat/rooms/invitations/inbox");n.value=l,o.value=!1}async function f(l){await b("chat/rooms/join",{roomId:l.room.id}),s.push("/chat/room/:roomId",{params:{roomId:l.room.id}})}async function M(l){await b("chat/rooms/invitations/ignore",{roomId:l.room.id}),n.value=n.value.filter(r=>r.id!==l.id)}return I(()=>{u()}),(l,r)=>{const F=m("MkTime"),h=m("MkAvatar"),k=m("MkUserName"),$=m("MkResult"),A=m("MkLoading");return t(),_("div",tt,[n.value.length>0?(t(),_("div",et,[(t(!0),_(B,null,S(n.value,x=>(t(),a(J,{key:x.id,defaultOpen:!0},{icon:i(()=>[...r[0]||(r[0]=[c("i",{class:"ti ti-users-group"},null,-1)])]),label:i(()=>[R(v(x.room.name),1)]),suffix:i(()=>[p(F,{time:x.createdAt},null,8,["time"])]),footer:i(()=>[c("div",st,[p(C,{primary:"",onClick:U=>f(x)},{default:i(()=>[r[1]||(r[1]=c("i",{class:"ti ti-plus"},null,-1)),R(" "+v("참여"),1)]),_:1},8,["onClick"]),p(C,{danger:"",onClick:U=>M(x)},{default:i(()=>[r[2]||(r[2]=c("i",{class:"ti ti-x"},null,-1)),R(" "+v("무시"),1)]),_:1},8,["onClick"])])]),default:i(()=>[c("div",{class:"xwbs9"},[p(h,{user:x.room.owner,class:"xEF3S",link:""},null,8,["user","class"]),c("div",ot,[p(k,{user:x.room.owner},null,8,["user"]),r[3]||(r[3]=c("hr",null,null,-1)),c("div",null,v(x.room.description===""?"설명문이 없습니다":x.room.description),1)])],2)]),_:2},1024))),128))])):d("",!0),!o.value&&n.value.length==0?(t(),a($,{key:1,type:"empty",text:"초대장이 없습니다"},null,8,["text"])):d("",!0),o.value?(t(),a(A,{key:2})):d("",!0)])}}});const nt={style:{"font-weight":"bold"}},N=w({__name:"XRoom",props:{room:{}},setup(g){return(s,o)=>{const n=m("MkAvatar"),u=m("MkA");return t(),a(u,{to:`/chat/room/${g.room.id}`,class:"_panel _gaps_s xwbgB"},{default:i(()=>[c("div",{class:"x46rH"},[c("div",nt,v(g.room.name),1),p(n,{user:g.room.owner,link:!1,class:"xA6Dz"},null,8,["user","class"])],2),o[0]||(o[0]=c("hr",null,null,-1)),c("div",null,v(g.room.description),1)]),_:1},8,["to","class"])}}});const rt={class:"_gaps"},it={key:0,class:"_gaps_s"},lt=w({__name:"home.joiningRooms",setup(g){const s=y(!0),o=y([]);async function n(){s.value=!0;const u=await b("chat/rooms/joining");o.value=u,s.value=!1}return I(()=>{n()}),(u,f)=>{const M=m("MkResult"),l=m("MkLoading");return t(),_("div",rt,[o.value.length>0?(t(),_("div",it,[(t(!0),_(B,null,S(o.value,r=>(t(),a(N,{key:r.id,room:r.room},null,8,["room"]))),128))])):d("",!0),!s.value&&o.value.length==0?(t(),a(M,{key:1,type:"empty",text:"룸이 없습니다"},null,8,["text"])):d("",!0),s.value?(t(),a(l,{key:2})):d("",!0)])}}}),ct={class:"_gaps"},ut={key:0,class:"_gaps_s"},mt=w({__name:"home.ownedRooms",setup(g){const s=y(!0),o=y([]);async function n(){s.value=!0;const u=await b("chat/rooms/owned",{});o.value=u,s.value=!1}return I(()=>{n()}),(u,f)=>{const M=m("MkResult"),l=m("MkLoading");return t(),_("div",ct,[o.value.length>0?(t(),_("div",ut,[(t(!0),_(B,null,S(o.value,r=>(t(),a(N,{key:r.id,room:r},null,8,["room"]))),128))])):d("",!0),!s.value&&o.value.length==0?(t(),a(M,{key:1,type:"empty",text:"룸이 없습니다"},null,8,["text"])):d("",!0),s.value?(t(),a(l,{key:2})):d("",!0)])}}}),dt={class:"_spacer",style:{"--MI_SPACER-w":"700px"}},wt=w({__name:"home",setup(g){const s=y("home"),o=T(()=>[]),n=T(()=>[{key:"home",title:"홈",icon:"ti ti-home"},{key:"invitations",title:"초대",icon:"ti ti-ticket"},{key:"joiningRooms",title:"참가 중인 룸",icon:"ti ti-users-group"},{key:"ownedRooms",title:"생성한 룸",icon:"ti ti-settings"}]);return Q(()=>({title:"채팅하기",icon:"ti ti-messages"})),(u,f)=>{const M=m("PageWithHeader");return t(),a(M,{tab:s.value,"onUpdate:tab":f[0]||(f[0]=l=>s.value=l),actions:o.value,tabs:n.value,swipable:!0},{default:i(()=>[s.value==="home"?(t(),a(G,{key:0,accented:"",height:200,style:{"margin-bottom":"-200px"}})):d("",!0),c("div",dt,[s.value==="home"?(t(),a(Z,{key:0})):s.value==="invitations"?(t(),a(at,{key:1})):s.value==="joiningRooms"?(t(),a(lt,{key:2})):s.value==="ownedRooms"?(t(),a(mt,{key:3})):d("",!0)])]),_:1},8,["tab","actions","tabs"])}}});export{wt as default};
