import{b as N,u as j,N as q,a as m,c as P,e as T,z as F,f as I,i as B,h as s,p as l,l as J,B as n,D as d,E as r,t as b,j as y,v as w}from"./3iSoGi4ic-D0mTJ0Mu.js";import{a7 as _,ab as C,M as c,ad as G,L as H,J as O,A as z}from"./3iSoGi4ic-DV-GuiCp.js";import{M as Q}from"./3iSoGi4ic-Fx-BY70c.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const X={style:{display:"flex","flex-direction":"column","min-height":"100%"}},Y={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px","flex-grow":"1"}},Z={class:"_gaps"},ee={class:"_gaps_s"},re=N({__name:"MkSystemWebhookEditor",props:{mode:{},id:{},requiredEvents:{}},emits:["submitted","canceled","closed"],setup(h,{emit:K}){const p=K,k=j("dialogEl"),A=h,{mode:u,id:M,requiredEvents:D}=q(A),S=m(0),V=m(""),f=m(""),g=m(""),a=m({abuseReport:!0,abuseReportResolved:!0,userCreated:!0,inactiveModeratorsWarning:!0,inactiveModeratorsInvitationOnlyChanged:!0}),v=m(!0),x=m({abuseReport:!1,abuseReportResolved:!1,userCreated:!1,inactiveModeratorsWarning:!1,inactiveModeratorsInvitationOnlyChanged:!1}),$=P(()=>!V.value||!f.value||!g.value);async function L(){await W(async()=>{const i={isActive:v.value,name:V.value,url:f.value,secret:g.value,on:Object.keys(a.value).filter(e=>a.value[e])};try{switch(u.value){case"create":{const e=await O("admin/system-webhook/create",i);k.value?.close(),p("submitted",e);break}case"edit":{const e=await O("admin/system-webhook/update",{id:M.value,...i});k.value?.close(),p("submitted",e);break}}}catch(e){const U=e.message??"내부 서버에서 예기치 않은 오류가 발생했습니다.";await z({type:"error",title:"오류",text:U}),k.value?.close(),p("canceled")}})}function E(){k.value?.close(),p("canceled")}async function W(i){S.value++;try{return await i()}finally{S.value--}}async function R(i){if(!M.value)return Promise.resolve();await H("admin/system-webhook/test",{webhookId:M.value,type:i,override:{secret:g.value,url:f.value}})}return T(async()=>{await W(async()=>{switch(u.value){case"edit":{if(!M.value)throw new Error("id is required");try{const i=await O("admin/system-webhook/show",{id:M.value});V.value=i.name,f.value=i.url,g.value=i.secret,v.value=i.isActive;for(const e of Object.keys(a.value))a.value[e]=i.on.includes(e)}catch(i){const e=i.message??"내부 서버에서 예기치 않은 오류가 발생했습니다.";await z({type:"error",title:"오류",text:e}),k.value?.close(),p("canceled")}break}}for(const i of D.value??[])x.value[i]=!0})}),(i,e)=>{const U=F("MkLoading");return B(),I(G,{ref_key:"dialogEl",ref:k,width:450,height:590,canClose:!0,withOkButton:!1,okButtonDisabled:!1,onClick:E,onClose:E,onClosed:e[14]||(e[14]=t=>p("closed"))},{header:s(()=>[d(r(b(u)==="create"?"Webhook 생성":"Webhook 수정"),1)]),default:s(()=>[l("div",X,[l("div",Y,[S.value!==0?(B(),I(U,{key:0})):(B(),J("div",{key:1,class:"x7VzK _gaps_m"},[n(_,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t)},{label:s(()=>[d(r("이름"),1)]),_:1},8,["modelValue"]),n(_,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t)},{label:s(()=>[...e[15]||(e[15]=[d("URL",-1)])]),_:1},8,["modelValue"]),n(_,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t)},{label:s(()=>[d(r("시크릿"),1)]),_:1},8,["modelValue"]),n(Q,{defaultOpen:!0},{label:s(()=>[d(r("트리거"),1)]),default:s(()=>[l("div",Z,[l("div",ee,[l("div",{class:"xk3xK"},[n(C,{modelValue:a.value.abuseReport,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.abuseReport=t),disabled:x.value.abuseReport},{label:s(()=>[d(r("유저로부터 신고를 받았을 때"),1)]),_:1},8,["modelValue","disabled"]),y(n(c,{transparent:"",class:"xzx3U",disabled:!(v.value&&a.value.abuseReport),onClick:e[4]||(e[4]=t=>R("abuseReport"))},{default:s(()=>[...e[16]||(e[16]=[l("i",{class:"ti ti-send"},null,-1)])]),_:1},8,["class","disabled"]),[[w,b(u)==="edit"]])],2),l("div",{class:"xk3xK"},[n(C,{modelValue:a.value.abuseReportResolved,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.abuseReportResolved=t),disabled:x.value.abuseReportResolved},{label:s(()=>[d(r("받은 신고를 처리했을 때"),1)]),_:1},8,["modelValue","disabled"]),y(n(c,{transparent:"",class:"xzx3U",disabled:!(v.value&&a.value.abuseReportResolved),onClick:e[6]||(e[6]=t=>R("abuseReportResolved"))},{default:s(()=>[...e[17]||(e[17]=[l("i",{class:"ti ti-send"},null,-1)])]),_:1},8,["class","disabled"]),[[w,b(u)==="edit"]])],2),l("div",{class:"xk3xK"},[n(C,{modelValue:a.value.userCreated,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.userCreated=t),disabled:x.value.userCreated},{label:s(()=>[d(r("유저가 생성되었을 때"),1)]),_:1},8,["modelValue","disabled"]),y(n(c,{transparent:"",class:"xzx3U",disabled:!(v.value&&a.value.userCreated),onClick:e[8]||(e[8]=t=>R("userCreated"))},{default:s(()=>[...e[18]||(e[18]=[l("i",{class:"ti ti-send"},null,-1)])]),_:1},8,["class","disabled"]),[[w,b(u)==="edit"]])],2),l("div",{class:"xk3xK"},[n(C,{modelValue:a.value.inactiveModeratorsWarning,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.inactiveModeratorsWarning=t),disabled:x.value.inactiveModeratorsWarning},{label:s(()=>[d(r("모더레이터가 일정 기간동안 활동하지 않은 경우"),1)]),_:1},8,["modelValue","disabled"]),y(n(c,{transparent:"",class:"xzx3U",disabled:!(v.value&&a.value.inactiveModeratorsWarning),onClick:e[10]||(e[10]=t=>R("inactiveModeratorsWarning"))},{default:s(()=>[...e[19]||(e[19]=[l("i",{class:"ti ti-send"},null,-1)])]),_:1},8,["class","disabled"]),[[w,b(u)==="edit"]])],2),l("div",{class:"xk3xK"},[n(C,{modelValue:a.value.inactiveModeratorsInvitationOnlyChanged,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.inactiveModeratorsInvitationOnlyChanged=t),disabled:x.value.inactiveModeratorsInvitationOnlyChanged},{label:s(()=>[d(r("모더레이터가 일정 기간 활동하지 않아 시스템에 의해 초대제로 바뀐 경우"),1)]),_:1},8,["modelValue","disabled"]),y(n(c,{transparent:"",class:"xzx3U",disabled:!(v.value&&a.value.inactiveModeratorsInvitationOnlyChanged),onClick:e[12]||(e[12]=t=>R("inactiveModeratorsInvitationOnlyChanged"))},{default:s(()=>[...e[20]||(e[20]=[l("i",{class:"ti ti-send"},null,-1)])]),_:1},8,["class","disabled"]),[[w,b(u)==="edit"]])],2)]),y(l("div",{class:"xleMO"},r("스위치 오른쪽에 있는 버튼을 클릭하여 더미 데이터를 사용한 테스트용 웹 훅을 보낼 수 있습니다."),3),[[w,b(u)==="edit"]])])]),_:1}),n(C,{modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=t=>v.value=t)},{label:s(()=>[d(r("사용"),1)]),_:1},8,["modelValue"])],2))]),l("div",{class:"xkBlf _buttonsCenter"},[n(c,{primary:"",rounded:"",disabled:$.value,onClick:L},{default:s(()=>[e[21]||(e[21]=l("i",{class:"ti ti-check"},null,-1)),d(" "+r("확인"),1)]),_:1},8,["disabled"]),n(c,{rounded:"",onClick:E},{default:s(()=>[e[22]||(e[22]=l("i",{class:"ti ti-x"},null,-1)),d(" "+r("취소"),1)]),_:1})],2)])]),_:1},512)}}});export{re as default};
