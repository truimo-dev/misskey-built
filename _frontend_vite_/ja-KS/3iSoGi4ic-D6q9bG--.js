import{a$ as Te,Q as pe,ak as xe,j as se,M as O,ab as K,h as Me,C as ke,aF as ce,J as z,aA as we,dk as ae,l as $e,c as Pe,az as Fe,aH as Ae,A as Le}from"./3iSoGi4ic-DV-GuiCp.js";import{_ as fe}from"./3iSoGi4ic-Dz5OvLqt.js";import{M as le}from"./3iSoGi4ic-Fx-BY70c.js";import{b as be,P as Re,Q as Ve,a as B,c as U,w as ne,o as he,z as X,f as D,i as c,h as y,p as l,D as E,B as w,g as ee,l as v,E as o,t as ye,F as L,s as Ce,A as q,C as x,Z as ve,e as Se,L as je,M as We,k as Ue,j as Oe,T as Ge,Y as ge}from"./3iSoGi4ic-D0mTJ0Mu.js";import{_ as Be}from"./3iSoGi4ic-BNF0PL3J.js";import{u as Ee}from"./3iSoGi4ic-B1GPmOGN.js";import{c as Xe}from"./3iSoGi4ic-DbFLP2ql.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CZYXc2mx.js";var re={},_e;function De(){return _e||(_e=1,(function(M){(function(s){s(typeof DO_NOT_EXPORT_CRC>"u"?M:{})})(function(s){s.version="1.2.2";function n(){for(var t=0,f=new Array(256),r=0;r!=256;++r)t=r,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,t=t&1?-306674912^t>>>1:t>>>1,f[r]=t;return typeof Int32Array<"u"?new Int32Array(f):f}var d=n();function m(t){var f=0,r=0,u=0,a=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(u=0;u!=256;++u)a[u]=t[u];for(u=0;u!=256;++u)for(r=t[u],f=256+u;f<4096;f+=256)r=a[f]=r>>>8^t[r&255];var C=[];for(u=1;u!=16;++u)C[u-1]=typeof Int32Array<"u"?a.subarray(u*256,u*256+256):a.slice(u*256,u*256+256);return C}var b=m(d),e=b[0],k=b[1],h=b[2],_=b[3],I=b[4],$=b[5],F=b[6],T=b[7],j=b[8],H=b[9],V=b[10],Y=b[11],W=b[12],g=b[13],p=b[14];function P(t,f){for(var r=f^-1,u=0,a=t.length;u<a;)r=r>>>8^d[(r^t.charCodeAt(u++))&255];return~r}function R(t,f){for(var r=f^-1,u=t.length-15,a=0;a<u;)r=p[t[a++]^r&255]^g[t[a++]^r>>8&255]^W[t[a++]^r>>16&255]^Y[t[a++]^r>>>24]^V[t[a++]]^H[t[a++]]^j[t[a++]]^T[t[a++]]^F[t[a++]]^$[t[a++]]^I[t[a++]]^_[t[a++]]^h[t[a++]]^k[t[a++]]^e[t[a++]]^d[t[a++]];for(u+=15;a<u;)r=r>>>8^d[(r^t[a++])&255];return~r}function A(t,f){for(var r=f^-1,u=0,a=t.length,C=0,G=0;u<a;)C=t.charCodeAt(u++),C<128?r=r>>>8^d[(r^C)&255]:C<2048?(r=r>>>8^d[(r^(192|C>>6&31))&255],r=r>>>8^d[(r^(128|C&63))&255]):C>=55296&&C<57344?(C=(C&1023)+64,G=t.charCodeAt(u++)&1023,r=r>>>8^d[(r^(240|C>>8&7))&255],r=r>>>8^d[(r^(128|C>>2&63))&255],r=r>>>8^d[(r^(128|G>>6&15|(C&3)<<4))&255],r=r>>>8^d[(r^(128|G&63))&255]):(r=r>>>8^d[(r^(224|C>>12&15))&255],r=r>>>8^d[(r^(128|C>>6&63))&255],r=r>>>8^d[(r^(128|C&63))&255]);return~r}s.table=d,s.bstr=P,s.buf=R,s.str=A})})(re)),re}var Ne=De();const He=Te(Ne),Q=!0,Z=!1;let Ye=class{map;mapWidth;mapHeight;board;turn=Q;opts;prevPos=-1;prevColor=null;logs=[];constructor(s,n){this.putStone=this.putStone.bind(this),this.opts=n,this.opts.isLlotheo==null&&(this.opts.isLlotheo=!1),this.opts.canPutEverywhere==null&&(this.opts.canPutEverywhere=!1),this.opts.loopedBoard==null&&(this.opts.loopedBoard=!1),this.mapWidth=s[0].length,this.mapHeight=s.length;const d=s.join("");this.board=d.split("").map(m=>m==="-"?null:m==="b"?Q:m==="w"?Z:void 0),this.map=d.split("").map(m=>m==="-"||m==="b"||m==="w"?"empty":"null"),this.canPutSomewhere(Q)||(this.turn=this.canPutSomewhere(Z)?Z:null)}get blackCount(){return this.board.filter(s=>s===Q).length}get whiteCount(){return this.board.filter(s=>s===Z).length}posToXy(s){const n=s%this.mapWidth,d=Math.floor(s/this.mapWidth);return[n,d]}xyToPos(s,n){return s+n*this.mapWidth}putStone(s){const n=this.turn;if(n==null)return;this.prevPos=s,this.prevColor=n,this.board[s]=n;const d=this.effects(n,s);for(const b of d)this.board[b]=n;const m=this.turn;this.logs.push({color:n,pos:s,effects:d,turn:m}),this.calcTurn()}calcTurn(){this.turn=this.canPutSomewhere(!this.prevColor)?!this.prevColor:this.canPutSomewhere(this.prevColor)?this.prevColor:null}undo(){const s=this.logs.pop();if(s!=null){this.prevColor=s.color,this.prevPos=s.pos,this.board[s.pos]=null;for(const n of s.effects){const d=this.board[n];this.board[n]=!d}this.turn=s.turn}}mapDataGet(s){const[n,d]=this.posToXy(s);return n<0||d<0||n>=this.mapWidth||d>=this.mapHeight?"null":this.map[s]}getPuttablePlaces(s){return Array.from(this.board.keys()).filter(n=>this.canPut(s,n))}canPutSomewhere(s){return this.getPuttablePlaces(s).length>0}canPut(s,n){return this.board[n]!==null?!1:this.opts.canPutEverywhere?this.mapDataGet(n)==="empty":this.effects(s,n).length!==0}effects(s,n){const d=!s,m=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],b=([e,k])=>{const h=(F,T)=>[F+e,T+k],_=[];let[I,$]=this.posToXy(n);for(;;){if([I,$]=h(I,$),this.opts.loopedBoard&&this.xyToPos(I=(I%this.mapWidth+this.mapWidth)%this.mapWidth,$=($%this.mapHeight+this.mapHeight)%this.mapHeight)===n)return _;if(I===-1||$===-1||I===this.mapWidth||$===this.mapHeight)return[];const F=this.xyToPos(I,$);if(this.mapDataGet(F)==="null")return[];const T=this.board[F];if(T===null)return[];if(T===d&&_.push(F),T===s)return _}};return[].concat(...m.map(b))}calcCrc32(){return He.str(JSON.stringify({board:this.board,turn:this.turn}))}get isEnded(){return this.turn===null}get winner(){return this.isEnded?this.blackCount===this.whiteCount?null:this.opts.isLlotheo===this.blackCount>this.whiteCount?Z:Q:void 0}};function qe(M){const s=[];for(let n=0;n<M.length;n++){const d=M[n],m=n===0?d.time:d.time-M[n-1].time;switch(d.operation){case"put":s.push([m,d.player?1:0,0,d.pos]);break}}return s}function me(M){const s=[];let n=0;for(const d of M){const m=d[0];n+=m;const b=d[1];switch(d[2]){case 0:s.push({time:n,player:b===1,operation:"put",pos:d[3]});break}}return s}function ie(M){const s=me(M.logs),n=new Ye(M.map,{isLlotheo:M.isLlotheo,canPutEverywhere:M.canPutEverywhere,loopedBoard:M.loopedBoard});for(const d of s)switch(d.operation){case"put":n.putStone(d.pos);break}return n}const Ke={name:"4x4",category:"4x4",data:["----","-wb-","-bw-","----"]},ze={name:"6x6",category:"6x6",data:["------","------","--wb--","--bw--","------","------"]},Je={name:"6x6 rounded",category:"6x6",author:"syuilo",data:[" ---- ","------","--wb--","--bw--","------"," ---- "]},Qe={name:"6x6 rounded 2",category:"6x6",author:"syuilo",data:["  --  "," ---- ","--wb--","--bw--"," ---- ","  --  "]},Ze={name:"8x8",category:"8x8",data:["--------","--------","--------","---wb---","---bw---","--------","--------","--------"]},et={name:"8x8 handicap 28",category:"8x8",data:["bbbbbbbb","b------b","b------b","b--wb--b","b--bw--b","b------b","b------b","bbbbbbbb"]},tt={name:"8x8 rounded",category:"8x8",author:"syuilo",data:[" ------ ","--------","--------","---wb---","---bw---","--------","--------"," ------ "]},at={name:"8x8 rounded 2",category:"8x8",author:"syuilo",data:["  ----  "," ------ ","--------","---wb---","---bw---","--------"," ------ ","  ----  "]},st={name:"8x8 rounded 3",category:"8x8",author:"syuilo",data:["   --   ","  ----  "," ------ ","---wb---","---bw---"," ------ ","  ----  ","   --   "]},lt={name:"8x8 with notch",category:"8x8",author:"syuilo",data:["---  ---","--------","--------"," --wb-- "," --bw-- ","--------","--------","---  ---"]},nt={name:"8x8 with some holes",category:"8x8",author:"syuilo",data:["--- ----","----- --","-- -----","---wb---","---bw- -"," -------","--- ----","--------"]},ot={name:"Circle",category:"8x8",author:"syuilo",data:["   --   "," ------ "," ------ ","---wb---","---bw---"," ------ "," ------ ","   --   "]},rt={name:"Smile",category:"8x8",author:"syuilo",data:[" ------ ","--------","-- -- --","---wb---","-- bw --","---  ---","--------"," ------ "]},it={name:"Window",category:"8x8",author:"syuilo",data:["--------","-  --  -","-  --  -","---wb---","---bw---","-  --  -","-  --  -","--------"]},ut={name:"Reserved",category:"8x8",author:"Aya",data:["w------b","--------","--------","---wb---","---bw---","--------","--------","b------w"]},dt={name:"X",category:"8x8",author:"Aya",data:["w------b","-w----b-","--w--b--","---wb---","---bw---","--b--w--","-b----w-","b------w"]},ct={name:"Parallel",category:"8x8",author:"Aya",data:["--------","--------","--------","---bb---","---ww---","--------","--------","--------"]},vt={name:"Lack of Black",category:"8x8",data:["--------","--------","--------","---w----","---bw---","--------","--------","--------"]},mt={name:"Square Party",category:"8x8",author:"syuilo",data:["--------","-wwwbbb-","-w-wb-b-","-wwwbbb-","-bbbwww-","-b-bw-w-","-bbbwww-","--------"]},pt={name:"Minesweeper",category:"8x8",author:"syuilo",data:["b-b--w-w","-w-wb-b-","w-b--w-b","-b-wb-w-","-w-bw-b-","b-w--b-w","-b-bw-w-","w-w--b-b"]},bt={name:"10x10",category:"10x10",data:["----------","----------","----------","----------","----wb----","----bw----","----------","----------","----------","----------"]},ht={name:"The Hole",category:"10x10",author:"syuilo",data:["----------","----------","--wb--wb--","--bw--bw--","----  ----","----  ----","--wb--wb--","--bw--bw--","----------","----------"]},wt={name:"Grid",category:"10x10",author:"syuilo",data:["----------","- - -- - -","----------","- - -- - -","----wb----","----bw----","- - -- - -","----------","- - -- - -","----------"]},ft={name:"Cross",category:"10x10",author:"Aya",data:["   ----   ","   ----   ","   ----   ","----------","----wb----","----bw----","----------","   ----   ","   ----   ","   ----   "]},yt={name:"Char X",category:"10x10",author:"syuilo",data:["---    ---","----  ----","----------"," -------- ","  --wb--  ","  --bw--  "," -------- ","----------","----  ----","---    ---"]},gt={name:"Char Y",category:"10x10",author:"syuilo",data:["---    ---","----  ----","----------"," -------- ","  --wb--  ","  --bw--  ","  ------  ","  ------  ","  ------  ","  ------  "]},_t={name:"Walls",category:"10x10",author:"Aya",data:[" bbbbbbbb ","w--------w","w--------w","w--------w","w---wb---w","w---bw---w","w--------w","w--------w","w--------w"," bbbbbbbb "]},xt={name:"CPU",category:"10x10",author:"syuilo",data:[" b b  b b ","w--------w"," -------- ","w--------w"," ---wb--- "," ---bw--- ","w--------w"," -------- ","w--------w"," b b  b b "]},kt={name:"Checker",category:"10x10",author:"Aya",data:["----------","----------","----------","---wbwb---","---bwbw---","---wbwb---","---bwbw---","----------","----------","----------"]},Ct={name:"Japanese curry",category:"10x10",author:"syuilo",data:["w-b-b-b-b-","-w-b-b-b-b","w-w-b-b-b-","-w-w-b-b-b","w-w-wwb-b-","-w-wbb-b-b","w-w-w-b-b-","-w-w-w-b-b","w-w-w-w-b-","-w-w-w-w-b"]},St={name:"Mosaic",category:"10x10",author:"syuilo",data:["- - - - - "," - - - - -","- - - - - "," - w w - -","- - b b - "," - w w - -","- - b b - "," - - - - -","- - - - - "," - - - - -"]},Et={name:"Arena",category:"10x10",author:"syuilo",data:["- - -- - -"," - -  - - ","- ------ -"," -------- ","- --wb-- -","- --bw-- -"," -------- ","- ------ -"," - -  - - ","- - -- - -"]},It={name:"Reactor",category:"10x10",author:"syuilo",data:["-w------b-","b- -  - -w","- --wb-- -","---b  w---","- b wb w -","- w bw b -","---w  b---","- --bw-- -","w- -  - -b","-b------w-"]},Tt={name:"6x8",category:"Special",data:["------","------","------","--wb--","--bw--","------","------","------"]},Mt={name:"Spark",category:"Special",author:"syuilo",data:[" -      - ","----------"," -------- "," -------- "," ---wb--- "," ---bw--- "," -------- "," -------- ","----------"," -      - "]},$t={name:"Islands",category:"Special",author:"syuilo",data:["--------  ","---wb---  ","---bw---  ","--------  ","  -    -  ","  -    -  ","  --------","  --------","  --------","  --------"]},Pt={name:"Galaxy",category:"Special",author:"syuilo",data:["   ------   ","  --www---  "," ------w--- ","---bbb--w---","--b---b-w-b-","-b--wwb-w-b-","-b-w-bww--b-","-b-w-b---b--","---w--bbb---"," ---w------ ","  ---www--  ","   ------   "]},Ft={name:"Triangle",category:"Special",author:"syuilo",data:["    --    ","    --    ","   ----   ","   ----   ","  --wb--  ","  --bw--  "," -------- "," -------- ","----------","----------"]},At={name:"iPhone X",category:"Special",author:"syuilo",data:[" --  -- ","--------","--------","--------","--------","---wb---","---bw---","--------","--------","--------","--------"," ------ "]},Lt={name:"Deal with it!",category:"Special",author:"syuilo",data:["------------","--w-b-------"," --b-w------","  --w-b---- ","   -------  "]},Rt={name:"Two board",category:"Special",author:"Aya",data:["-------- --------","-------- --------","-------- --------","---wb--- ---wb---","---bw--- ---bw---","-------- --------","-------- --------","-------- --------"]},ue=Object.freeze(Object.defineProperty({__proto__:null,arena:Et,charX:yt,charY:gt,checker:kt,circle:ot,cpu:xt,cross:ft,dealWithIt:Lt,eighteight:Ze,eighteightH28:et,eighteightWithNotch:lt,eighteightWithSomeHoles:nt,fourfour:Ke,galaxy:Pt,grid:wt,hole:ht,iphonex:At,islands:$t,japaneseCurry:Ct,lackOfBlack:vt,minesweeper:pt,mosaic:St,parallel:ct,reactor:It,reserved:ut,roundedEighteight:tt,roundedEighteight2:at,roundedEighteight3:st,roundedSixsix:Je,roundedSixsix2:Qe,sixeight:Tt,sixsix:ze,smile:rt,spark:Mt,squareParty:mt,tenthtenth:bt,triangle:Ft,twoBoard:Rt,walls:_t,window:it,x:dt},Symbol.toStringTag,{value:"Module"})),Vt={class:"_spacer",style:{"--MI_SPACER-w":"600px"}},jt={style:{"text-align":"center"}},Wt={style:{"font-size":"1.5em","text-align":"center"}},Ut={key:0},Ot={class:"_panel"},Gt={style:{display:"flex","align-items":"center",padding:"16px","border-bottom":"solid 1px var(--MI_THEME-divider)"}},Bt={style:{padding:"16px"}},Xt={key:0},Dt=["onClick"],Nt={value:"random"},Ht={value:"1"},Yt={value:"2"},qt={value:5},Kt={value:10},zt={value:30},Jt={value:60},Qt={value:90},Zt={value:120},ea={value:180},ta={value:3600},aa={class:"_gaps_s"},sa={class:"_spacer",style:{"--MI_SPACER-w":"700px","--MI_SPACER-min":"16px","--MI_SPACER-max":"16px"}},la={style:{"text-align":"center"},class:"_gaps_s"},na={key:0,style:{color:"var(--MI_THEME-warn)"}},oa={class:"_buttonsCenter"},ra=be({__name:"game.setting",props:Re({game:{},connection:{}},{shareWhenStart:{type:Boolean,default:!1},shareWhenStartModifiers:{}}),emits:["update:shareWhenStart"],setup(M){const s=pe(),n=xe(),d=Array.from(new Set(Object.values(ue).map(g=>g.category))),m=M,b=Ve(M,"shareWhenStart"),e=B(se(m.game)),k=U(()=>{if(e.value.map==null)return"Random";const g=Object.values(ue).find(p=>p.data.join("")===e.value.map.join(""));return g?g.name:"-Custom-"}),h=U(()=>!!(e.value.user1Id===s.id&&e.value.user1Ready||e.value.user2Id===s.id&&e.value.user2Ready)),_=U(()=>!!(e.value.user1Id!==s.id&&e.value.user1Ready||e.value.user2Id!==s.id&&e.value.user2Ready)),I=B(!1);ne(()=>e.value.bw,()=>{V("bw")}),ne(()=>e.value.timeLimitForEachTurn,()=>{V("timeLimitForEachTurn")});function $(g){const p=[];for(const P of d){const R=Object.values(ue).filter(A=>A.category===P);if(R.length!==0){P!=null&&p.push({type:"label",text:P});for(const A of R)p.push({text:A.name,action:()=>{e.value.map=A.data,V("map")}})}}Me(p,g.currentTarget??g.target)}async function F(){const{canceled:g}=await ke({type:"warning",text:"いいん？"});g||(m.connection.send("cancel",{}),n.push("/reversi"))}function T(){m.connection.send("ready",!0),I.value=!1}function j(){m.connection.send("ready",!1)}function H(g){e.value.user1Ready=g.user1,e.value.user2Ready=g.user2}function V(g){m.connection.send("updateSettings",{key:g,value:e.value[g]})}function Y({userId:g,key:p,value:P}){g!==s.id&&e.value[p]!==P&&(e.value[p]=P,h.value&&(I.value=!0,j()))}function W(g,p){const P=g%e.value.map[0].length,R=Math.floor(g/e.value.map[0].length),A=p===" "?"-":p==="-"?"b":p==="b"?"w":" ",t=e.value.map[R].split("");t[P]=A,e.value.map[R]=t.join(""),V("map")}return m.connection.on("changeReadyStates",H),m.connection.on("updateSettings",Y),he(()=>{m.connection.off("changeReadyStates",H),m.connection.off("updateSettings",Y)}),(g,p)=>{const P=X("MkUserName"),R=X("I18n"),A=X("MkEllipsis"),t=X("MkStickyContainer");return c(),D(t,null,{footer:y(()=>[l("div",{class:"x9MJu"},[l("div",sa,[l("div",la,[I.value?(c(),v("div",na,o("相手が設定変えたで"),1)):x("",!0),l("div",null,[h.value&&_.value?(c(),v(L,{key:0},[E(o("対局、そろそろ開始されるで。"),1),w(A)],64)):x("",!0),h.value&&!_.value?(c(),v(L,{key:1},[E(o("相手の準備が完了するのを待ってんで。"),1),w(A)],64)):x("",!0),!h.value&&_.value?(c(),v(L,{key:2},[E(o("あんさんの準備が完了すんのを待ってんで"),1)],64)):x("",!0),!h.value&&!_.value?(c(),v(L,{key:3},[E(o("準備してなー"),1),w(A)],64)):x("",!0)]),l("div",oa,[w(O,{rounded:"",danger:"",onClick:F},{default:y(()=>[E(o("やめる"),1)]),_:1}),h.value?x("",!0):(c(),D(O,{key:0,rounded:"",primary:"",onClick:T},{default:y(()=>[E(o("準備完了"),1)]),_:1})),h.value?(c(),D(O,{key:1,rounded:"",onClick:j},{default:y(()=>[E(o("準備を再開"),1)]),_:1})):x("",!0)]),l("div",null,[w(K,{modelValue:b.value,"onUpdate:modelValue":p[8]||(p[8]=f=>b.value=f)},{default:y(()=>[E(o("初めの時に対局をタイムラインに投稿するで"),1)]),_:1},8,["modelValue"])])])])],2)]),default:y(()=>[l("div",Vt,[l("div",jt,[l("b",null,[w(P,{user:e.value.user1},null,8,["user"])]),p[9]||(p[9]=E(" vs ",-1)),l("b",null,[w(P,{user:e.value.user2},null,8,["user"])])]),l("div",{class:ee({xhCpY:h.value})},[l("div",{class:ee(["_gaps",{xx19X:h.value}])},[l("div",Wt,o("対局の設定"),1),e.value.noIrregularRules?(c(),v("div",Ut,o("変則なし"),1)):(c(),v(L,{key:1},[l("div",Ot,[l("div",Gt,[l("div",null,o(k.value),1),w(O,{style:{"margin-left":"auto"},onClick:$},{default:y(()=>[E(o("ボードを選択"),1)]),_:1})]),l("div",Bt,[e.value.map==null?(c(),v("div",Xt,[...p[10]||(p[10]=[l("i",{class:"ti ti-dice"},null,-1)])])):(c(),v("div",{key:1,class:"x4YMI",style:Ce({"grid-template-rows":`repeat(${e.value.map.length}, 1fr)`,"grid-template-columns":`repeat(${e.value.map[0].length}, 1fr)`})},[(c(!0),v(L,null,q(e.value.map.join(""),(f,r)=>(c(),v("div",{class:ee(["xcshY",{xi3My:f==" "}]),onClick:u=>W(r,f)},[f==="b"||f==="w"?(c(),v("i",{key:0,style:{"pointer-events":"none","user-select":"none"},class:ee(f==="b"?"ti ti-circle-filled":"ti ti-circle")},null,2)):x("",!0)],10,Dt))),256))],6))])]),w(le,{defaultOpen:!0},{label:y(()=>[E(o("先行/後攻"),1)]),default:y(()=>[w(fe,{modelValue:e.value.bw,"onUpdate:modelValue":p[0]||(p[0]=f=>e.value.bw=f)},{default:y(()=>[l("option",Nt,o("ランダム"),1),l("option",Ht,[w(R,{src:"{name}が黒(先行)",tag:"span"},{name:y(()=>[l("b",null,[w(P,{user:e.value.user1},null,8,["user"])])]),_:1},8,["src"])]),l("option",Yt,[w(R,{src:"{name}が黒(先行)",tag:"span"},{name:y(()=>[l("b",null,[w(P,{user:e.value.user2},null,8,["user"])])]),_:1},8,["src"])])]),_:1},8,["modelValue"])]),_:1}),w(le,{defaultOpen:!0},{label:y(()=>[E(o("1ターンの時間制限"),1)]),suffix:y(()=>[E(o(e.value.timeLimitForEachTurn)+o("秒"),1)]),default:y(()=>[w(fe,{modelValue:e.value.timeLimitForEachTurn,"onUpdate:modelValue":p[1]||(p[1]=f=>e.value.timeLimitForEachTurn=f)},{default:y(()=>[l("option",qt,"5"+o("秒"),1),l("option",Kt,"10"+o("秒"),1),l("option",zt,"30"+o("秒"),1),l("option",Jt,"60"+o("秒"),1),l("option",Qt,"90"+o("秒"),1),l("option",Zt,"120"+o("秒"),1),l("option",ea,"180"+o("秒"),1),l("option",ta,"3600"+o("秒"),1)]),_:1},8,["modelValue"])]),_:1}),w(le,{defaultOpen:!0},{label:y(()=>[E(o("ルール"),1)]),default:y(()=>[l("div",aa,[w(K,{modelValue:e.value.isLlotheo,"onUpdate:modelValue":[p[2]||(p[2]=f=>e.value.isLlotheo=f),p[3]||(p[3]=f=>V("isLlotheo"))]},{default:y(()=>[E(o("石の少ない方が勝ち(ロセオ)"),1)]),_:1},8,["modelValue"]),w(K,{modelValue:e.value.loopedBoard,"onUpdate:modelValue":[p[4]||(p[4]=f=>e.value.loopedBoard=f),p[5]||(p[5]=f=>V("loopedBoard"))]},{default:y(()=>[E(o("ループマップ"),1)]),_:1},8,["modelValue"]),w(K,{modelValue:e.value.canPutEverywhere,"onUpdate:modelValue":[p[6]||(p[6]=f=>e.value.canPutEverywhere=f),p[7]||(p[7]=f=>V("canPutEverywhere"))]},{default:y(()=>[E(o("どこでも置けるモード"),1)]),_:1},8,["modelValue"])])]),_:1})],64))],2)],2)])]),_:1})}}});const ia="https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-BCzaaDPP.png",ua="https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-BdmSL5XX.png",da={class:"_spacer",style:{"--MI_SPACER-w":"500px"}},ca={style:{display:"flex","align-items":"center","justify-content":"center",gap:"10px"}},va={style:{overflow:"clip","line-height":"28px"}},ma={key:0},pa={key:1},ba={key:2},ha={style:{"margin-left":"1em",opacity:"0.7"}},wa={key:3},fa={style:{display:"inline-block","font-weight":"bold",animation:"global-tada 1s linear infinite both"}},ya={style:{"margin-left":"1em",opacity:"0.7"}},ga={key:4},_a={key:0},xa={key:1},ka={class:"_woodenFrame"},Ca={style:{display:"flex"}},Sa=["onClick"],Ea=["src"],Ia=["src"],Ta={key:0,class:"_panel _gaps_s",style:{padding:"16px"}},Ma={key:0,class:"_buttonsCenter"},$a={class:"_panel",style:{padding:"16px"}},Pa={style:{display:"flex","align-items":"center"}},Fa={style:{"margin-right":"8px"}},Aa={style:{display:"flex","align-items":"center"}},La={style:{"margin-right":"8px"}},Ra={key:0},Va={key:1},ja={key:2},Wa={class:"_gaps_s",style:{"text-align":"left"}},Ua={class:"_buttonsCenter"},de=3,Oa=be({__name:"game.board",props:{game:{},connection:{}},setup(M){const s=pe(),n=M,d=B(!1),m=B(!0),b=B(!1),e=B(se(n.game)),k=B(e.value.logs.length),h=ve(ie({map:e.value.map,isLlotheo:e.value.isLlotheo,canPutEverywhere:e.value.canPutEverywhere,loopedBoard:e.value.loopedBoard,logs:e.value.logs})),_=U(()=>e.value.user1Id===s.id||e.value.user2Id===s.id),I=U(()=>_.value?e.value.user1Id===s.id&&e.value.black===1||e.value.user2Id===s.id&&e.value.black===2:null);U(()=>_.value?!I.value:null);const $=U(()=>e.value.black===1?e.value.user1:e.value.user2),F=U(()=>e.value.black===1?e.value.user2:e.value.user1),T=U(()=>h.value.turn===!0?e.value.black===1?e.value.user1:e.value.user2:h.value.turn===!1?e.value.black===1?e.value.user2:e.value.user1:null),j=U(()=>{if(!_.value)return!1;const u=T.value;return u==null?!1:u.id===s.id}),H=U(()=>({"grid-template-rows":`repeat(${e.value.map.length}, 1fr)`,"grid-template-columns":`repeat(${e.value.map[0].length}, 1fr)`}));ne(k,u=>{e.value.isEnded&&(h.value=ie({map:e.value.map,isLlotheo:e.value.isLlotheo,canPutEverywhere:e.value.canPutEverywhere,loopedBoard:e.value.loopedBoard,logs:e.value.logs.slice(0,u)}))}),e.value.isStarted&&!e.value.isEnded&&ce(()=>{if(e.value.isEnded)return;const u=h.value.calcCrc32();z("reversi/verify",{gameId:e.value.id,crc32:u.toString()}).then(a=>{a.desynced&&A(a.game)})},1e4,{immediate:!1,afterMounted:!0});const V=[];function Y(u){if(e.value.isEnded||!_.value||!j.value||!h.value.canPut(I.value,u))return;h.value.putStone(u),ge(h),ae("/client-assets/reversi/put.mp3",{volume:1,playbackRate:1});const a=$e();n.connection.send("putStone",{pos:u,id:a}),V.push(a),W.value=e.value.timeLimitForEachTurn,g.value=e.value.timeLimitForEachTurn,R()}const W=B(e.value.timeLimitForEachTurn),g=B(e.value.timeLimitForEachTurn);n.game.isEnded||ce(()=>{W.value>0&&(W.value=Math.max(0,W.value-de)),g.value>0&&(g.value=Math.max(0,g.value-de)),_.value&&(j.value&&W.value===0||!j.value&&g.value===0)&&n.connection.send("claimTimeIsUp",{})},de*1e3,{immediate:!1,afterMounted:!0});async function p(u){if(e.value.logs=qe([...me(e.value.logs),u]),k.value++,u.id==null||!V.includes(u.id))switch(u.operation){case"put":{if(ae("/client-assets/reversi/put.mp3",{volume:1,playbackRate:1}),u.player!==h.value.turn){const a=await z("reversi/show-game",{gameId:n.game.id});A(a);return}h.value.putStone(u.pos),ge(h),W.value=e.value.timeLimitForEachTurn,g.value=e.value.timeLimitForEachTurn,R();break}}}function P(u){e.value=se(u.game),e.value.winnerId===s.id?(Xe({duration:1e3*3}),ae("/client-assets/reversi/win.mp3",{volume:1,playbackRate:1})):ae("/client-assets/reversi/lose.mp3",{volume:1,playbackRate:1})}function R(){e.value.isEnded=h.value.isEnded,e.value.isEnded&&(h.value.winner===!0?(e.value.winnerId=e.value.black===1?e.value.user1Id:e.value.user2Id,e.value.winner=e.value.black===1?e.value.user1:e.value.user2):h.value.winner===!1?(e.value.winnerId=e.value.black===1?e.value.user2Id:e.value.user1Id,e.value.winner=e.value.black===1?e.value.user2:e.value.user1):(e.value.winnerId=null,e.value.winner=null))}function A(u){e.value=se(u),h.value=ie({map:e.value.map,isLlotheo:e.value.isLlotheo,canPutEverywhere:e.value.canPutEverywhere,loopedBoard:e.value.loopedBoard,logs:e.value.logs}),k.value=e.value.logs.length,R()}async function t(){const{canceled:u}=await ke({type:"warning",text:"いいん？"});u||z("reversi/surrender",{gameId:e.value.id})}function f(){b.value=!0,k.value=0;const u=me(e.value.logs);window.setTimeout(()=>{k.value=1;let a=1,C=u[0];const G=()=>{const J=u[a],te=J.time-C.time;window.setTimeout(()=>{a++,k.value++,C=J,a<u.length?G():b.value=!1},te)};G()},1e3)}function r(){Pe({initialText:`#MisskeyReversi
${Ee}/reversi/g/${e.value.id}`,instant:!0})}return Se(()=>{n.connection!=null&&(n.connection.on("log",p),n.connection.on("ended",P))}),je(()=>{n.connection!=null&&(n.connection.on("log",p),n.connection.on("ended",P))}),We(()=>{n.connection!=null&&(n.connection.off("log",p),n.connection.off("ended",P))}),he(()=>{n.connection!=null&&(n.connection.off("log",p),n.connection.off("ended",P))}),(u,a)=>{const C=X("MkAvatar"),G=X("Mfm"),J=X("MkEllipsis"),te=X("MkUserName"),oe=X("MkA"),Ie=Ue("tooltip");return c(),v("div",da,[l("div",{class:"x1jPV _gaps"},[l("div",ca,[l("span",null,"("+o("黒")+")",1),w(C,{style:{width:"32px",height:"32px"},user:$.value,showIndicator:!0},null,8,["user"]),a[7]||(a[7]=l("span",null," vs ",-1)),w(C,{style:{width:"32px",height:"32px"},user:F.value,showIndicator:!0},null,8,["user"]),l("span",null,"("+o("白")+")",1)]),l("div",va,[!_.value&&!e.value.isEnded&&T.value?(c(),v("div",ma,[(c(),D(G,{key:"turn:"+T.value.id,text:(({name})=>(name+"のターンやで"))({name:T.value.name??T.value.username}),plain:!0,customEmojis:T.value.emojis},null,8,["text","customEmojis"])),w(J)])):x("",!0),k.value!==e.value.logs.length&&T.value?(c(),v("div",pa,[(c(),D(G,{key:"past-turn-of:"+T.value.id,text:(({name})=>(name+"のターン"))({name:T.value.name??T.value.username}),plain:!0,customEmojis:T.value.emojis},null,8,["text","customEmojis"]))])):x("",!0),_.value&&!e.value.isEnded&&!j.value?(c(),v("div",ba,[E(o("相手のターンやで"),1),w(J),l("span",ha,"("+o((({n})=>("残り:"+n))({n:g.value}))+")",1)])):x("",!0),_.value&&!e.value.isEnded&&j.value?(c(),v("div",wa,[l("span",fa,o("あんさんのターンや"),1),l("span",ya,"("+o((({n})=>("残り:"+n))({n:W.value}))+")",1)])):x("",!0),e.value.isEnded&&k.value==e.value.logs.length?(c(),v("div",ga,[e.value.winner?(c(),v(L,{key:0},[(c(),D(G,{key:"won",text:(({name})=>(name+"の勝ち"))({name:e.value.winner.name??e.value.winner.username}),plain:!0,customEmojis:e.value.winner.emojis},null,8,["text","customEmojis"])),e.value.surrenderedUserId!=null?(c(),v("span",_a," ("+o("投了により")+")",1)):x("",!0),e.value.timeoutUserId!=null?(c(),v("span",xa," ("+o("時間切れ")+")",1)):x("",!0)],64)):(c(),v(L,{key:1},[E(o("引き分け"),1)],64))])):x("",!0)]),l("div",ka,[l("div",{class:"x5qyO"},[d.value?(c(),v("div",{key:0,class:"xjDSd"},[(c(!0),v(L,null,q(e.value.map[0].length,S=>(c(),v("span",{key:S,class:"xuKOc"},o(String.fromCharCode(64+S)),3))),128))],2)):x("",!0),l("div",Ca,[d.value?(c(),v("div",{key:0,class:"x4P7I"},[(c(!0),v(L,null,q(e.value.map.length,S=>(c(),v("div",{key:S,class:"xqJkK"},o(S),3))),128))],2)):x("",!0),l("div",{class:"xrxoL",style:Ce(H.value)},[(c(!0),v(L,null,q(h.value.board,(S,N)=>Oe((c(),v("div",{key:N,class:ee(["xqhmt",{xgMid:S==null,xCgBm:h.value.map[N]==="null",xFh9E:e.value.isEnded,xl4S4:!e.value.isEnded&&j.value,xuLKl:T.value?h.value.canPut(T.value.id===$.value.id,N):null,x2Qds:h.value.prevPos===N}]),onClick:Ba=>Y(N)},[w(Ge,{enterActiveClass:"x8K6z",leaveActiveClass:"xyVwq",enterFromClass:"xeIBm",leaveToClass:"xy2rs",mode:"default"},{default:y(()=>[m.value?(c(),v(L,{key:0},[S===!0?(c(),v("img",{key:0,class:"xhIGx",src:$.value.avatarUrl??void 0},null,10,Ea)):S===!1?(c(),v("img",{key:1,class:"xhIGx",src:F.value.avatarUrl??void 0},null,10,Ia)):x("",!0)],64)):(c(),v(L,{key:1},[S===!0?(c(),v("img",{key:0,class:"xhIGx",src:ia},null,2)):S===!1?(c(),v("img",{key:1,class:"xhIGx",src:ua},null,2)):x("",!0)],64))]),_:2},1032,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass"])],10,Sa)),[[Ie,`${String.fromCharCode(65+h.value.posToXy(N)[0])}${h.value.posToXy(N)[1]+1}`]])),128))],6),d.value?(c(),v("div",{key:1,class:"x4P7I"},[(c(!0),v(L,null,q(e.value.map.length,S=>(c(),v("div",{key:S,class:"xqJkK"},o(S),3))),128))],2)):x("",!0)]),d.value?(c(),v("div",{key:1,class:"xjDSd"},[(c(!0),v(L,null,q(e.value.map[0].length,S=>(c(),v("span",{key:S,class:"xuKOc"},o(String.fromCharCode(64+S)),3))),128))],2)):x("",!0)],2)]),e.value.isEnded?(c(),v("div",Ta,[l("div",null,o(k.value)+" / "+o(e.value.logs.length),1),b.value?x("",!0):(c(),v("div",Ma,[w(O,{disabled:k.value===0,onClick:a[0]||(a[0]=S=>k.value=0)},{default:y(()=>[...a[8]||(a[8]=[l("i",{class:"ti ti-chevrons-left"},null,-1)])]),_:1},8,["disabled"]),w(O,{disabled:k.value===0,onClick:a[1]||(a[1]=S=>k.value--)},{default:y(()=>[...a[9]||(a[9]=[l("i",{class:"ti ti-chevron-left"},null,-1)])]),_:1},8,["disabled"]),w(O,{disabled:k.value===e.value.logs.length,onClick:a[2]||(a[2]=S=>k.value++)},{default:y(()=>[...a[10]||(a[10]=[l("i",{class:"ti ti-chevron-right"},null,-1)])]),_:1},8,["disabled"]),w(O,{disabled:k.value===e.value.logs.length,onClick:a[3]||(a[3]=S=>k.value=e.value.logs.length)},{default:y(()=>[...a[11]||(a[11]=[l("i",{class:"ti ti-chevrons-right"},null,-1)])]),_:1},8,["disabled"])])),w(O,{style:{margin:"auto"},disabled:b.value,onClick:a[4]||(a[4]=S=>f())},{default:y(()=>[...a[12]||(a[12]=[l("i",{class:"ti ti-player-play"},null,-1)])]),_:1},8,["disabled"])])):x("",!0),l("div",$a,[l("div",null,[l("b",null,o((({count})=>(count+"ターン目"))({count:k.value})),1),E(" "+o("黒")+":"+o(h.value.blackCount)+" "+o("白")+":"+o(h.value.whiteCount)+" "+o("合計")+":"+o(h.value.blackCount+h.value.whiteCount),1)]),l("div",null,[l("div",Pa,[l("span",Fa,"("+o("黒")+")",1),w(C,{style:{width:"32px",height:"32px","margin-right":"8px"},user:$.value,showIndicator:!0},null,8,["user"]),w(oe,{to:ye(we)($.value)},{default:y(()=>[w(te,{user:$.value},null,8,["user"])]),_:1},8,["to"])]),a[13]||(a[13]=l("div",null," vs ",-1)),l("div",Aa,[l("span",La,"("+o("白")+")",1),w(C,{style:{width:"32px",height:"32px","margin-right":"8px"},user:F.value,showIndicator:!0},null,8,["user"]),w(oe,{to:ye(we)(F.value)},{default:y(()=>[w(te,{user:F.value},null,8,["user"])]),_:1},8,["to"])])]),l("div",null,[e.value.isLlotheo?(c(),v("p",Ra,o("石の少ない方が勝ち(ロセオ)"),1)):x("",!0),e.value.loopedBoard?(c(),v("p",Va,o("ループマップ"),1)):x("",!0),e.value.canPutEverywhere?(c(),v("p",ja,o("どこでも置けるモード"),1)):x("",!0)])]),w(le,null,{label:y(()=>[E(o("オプション"),1)]),default:y(()=>[l("div",Wa,[w(K,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=S=>d.value=S)},{default:y(()=>[E(o("盤面に行・列番号を表示"),1)]),_:1},8,["modelValue"]),w(K,{modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=S=>m.value=S)},{default:y(()=>[E(o("石をアイコンにする"),1)]),_:1},8,["modelValue"])])]),_:1}),l("div",Ua,[!e.value.isEnded&&_.value?(c(),D(O,{key:0,danger:"",onClick:t},{default:y(()=>[E(o("投了"),1)]),_:1})):x("",!0),w(O,{onClick:r},{default:y(()=>[E(o("わけわけ"),1)]),_:1})]),e.value.isEnded?(c(),D(oe,{key:1,to:"/reversi"},{default:y(()=>[...a[14]||(a[14]=[l("img",{src:Be,style:{display:"block","max-width":"100%",width:"200px",margin:"auto"}},null,-1)])]),_:1})):x("",!0)],2)])}}});const Ga={key:0},ts=be({__name:"game",props:{gameId:{}},setup(M){const s=pe(),n=xe(),d=M,m=ve(null),b=ve(null),e=B(!1);ne(()=>d.gameId,()=>{h()});function k(_){m.value?.isStarted||(e.value&&z("notes/create",{text:`${"対局し始めたで！ #MisskeyReversi"}
${Ee}/reversi/g/${d.gameId}`,visibility:"home"}),m.value=_)}async function h(){const _=await z("reversi/show-game",{gameId:d.gameId});m.value=_,e.value=!1,b.value&&b.value.dispose(),m.value.isEnded||(b.value=Ae().useChannel("reversiGame",{gameId:m.value.id}),b.value.on("started",I=>{k(I.game)}),b.value.on("canceled",I=>{b.value?.dispose(),I.userId!==s.id&&(Le({type:"warning",text:"対局がキャンセルされたわ"}),n.push("/reversi"))}))}return ce(async()=>{if(m.value==null||m.value.isStarted)return;const _=await z("reversi/show-game",{gameId:d.gameId});_.isStarted?k(_):m.value=_},1e3*10,{immediate:!1,afterMounted:!0}),Se(()=>{h()}),he(()=>{b.value&&b.value.dispose()}),Fe(()=>({title:"Reversi",icon:"ti ti-device-gamepad"})),(_,I)=>{const $=X("MkLoading");return m.value==null||!m.value.isEnded&&b.value==null?(c(),v("div",Ga,[w($)])):m.value.isStarted?(c(),D(Oa,{key:2,game:m.value,connection:b.value},null,8,["game","connection"])):(c(),D(ra,{key:1,shareWhenStart:e.value,"onUpdate:shareWhenStart":I[0]||(I[0]=F=>e.value=F),game:m.value,connection:b.value},null,8,["shareWhenStart","game","connection"]))}}});export{ts as default};
