import{aH as A,$ as t,J as g,ay as M,at as B,C as p,b as F,bj as m}from"./3iSoGi4ic-DV-GuiCp.js";import{h as V}from"./3iSoGi4ic-B1GPmOGN.js";import{b as D,a as k,e as L,H as $,z,l as s,i as o,g as I,F as f,C as c,p as y,E as d,B as b}from"./3iSoGi4ic-D0mTJ0Mu.js";const P=["disabled"],W=D({__name:"MkFollowButton",props:{user:{},full:{type:Boolean,default:!1},large:{type:Boolean,default:!1}},emits:["update:user"],setup(e,{emit:h}){const l=e,R=h,w=k(l.user.isFollowing),r=k(l.user.hasPendingFollowRequestFromYou),i=k(!1),x=A().useChannel("main");l.user.isFollowing==null&&t&&g("users/show",{userId:l.user.id}).then(v);function v(n){n.id===l.user.id&&(w.value=n.isFollowing,r.value=n.hasPendingFollowRequestFromYou)}async function q(){M({openOnRemote:{type:"web",path:`/@${l.user.username}@${l.user.host??V}`}}),i.value=!0,B();try{if(w.value){const{canceled:n}=await p({type:"warning",text:(({name})=>("Отписаться от "+name+" ?"))({name:l.user.name||l.user.username})});if(n){i.value=!1;return}await g("following/delete",{userId:l.user.id})}else if(r.value){const{canceled:n}=await p({type:"question",text:(({name})=>("Are you sure that you want to cancel your follow request to "+name+"?"))({name:l.user.name||l.user.username})});if(n){i.value=!1;return}await g("following/requests/cancel",{userId:l.user.id}),r.value=!1}else{if(F.s.alwaysConfirmFollow){const{canceled:n}=await p({type:"question",text:(({name})=>("Подписаться на "+name+"?"))({name:l.user.name||l.user.username})});if(n){i.value=!1;return}}if(await g("following/create",{userId:l.user.id,withReplies:F.s.defaultFollowWithReplies}),R("update:user",{...l.user,withReplies:F.s.defaultFollowWithReplies}),r.value=!0,t==null){i.value=!1;return}m("following1"),t.followingCount>=10&&m("following10"),t.followingCount>=50&&m("following50"),t.followingCount>=100&&m("following100"),t.followingCount>=300&&m("following300")}}catch(n){console.error(n)}finally{i.value=!1}}return L(()=>{x.on("follow",v),x.on("unfollow",v)}),$(()=>{x.dispose()}),(n,u)=>{const C=z("MkLoading");return o(),s("button",{class:I(["_button",["x88qx",{xnCyR:i.value,x9Qgw:w.value||r.value,xfS58:e.full,x6zcp:e.large}]]),disabled:i.value,onClick:q},[i.value?(o(),s(f,{key:1},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Обработка"),3)):c("",!0),b(C,{em:!0,colored:!1})],64)):(o(),s(f,{key:0},[r.value&&e.user.isLocked?(o(),s(f,{key:0},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Нерассмотренный запрос на подписку"),3)):c("",!0),u[0]||(u[0]=y("i",{class:"ti ti-hourglass-empty"},null,-1))],64)):r.value&&!e.user.isLocked?(o(),s(f,{key:1},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Обработка"),3)):c("",!0),b(C,{em:!0,colored:!1})],64)):w.value?(o(),s(f,{key:2},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Вы подписаны"),3)):c("",!0),u[1]||(u[1]=y("i",{class:"ti ti-minus"},null,-1))],64)):!w.value&&e.user.isLocked?(o(),s(f,{key:3},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Запрос на подписку"),3)):c("",!0),u[2]||(u[2]=y("i",{class:"ti ti-plus"},null,-1))],64)):!w.value&&!e.user.isLocked?(o(),s(f,{key:4},[e.full?(o(),s("span",{key:0,class:"xDA3n"},d("Подписка"),3)):c("",!0),u[3]||(u[3]=y("i",{class:"ti ti-plus"},null,-1))],64)):c("",!0)],64))],10,P)}}});function j(e){return t&&(t.id===e.id||t.isAdmin||t.isModerator)?!0:!(e.followingVisibility==="private"||e.followingVisibility==="followers"&&!e.isFollowing)}function J(e){return t&&(t.id===e.id||t.isAdmin||t.isModerator)?!0:!(e.followersVisibility==="private"||e.followersVisibility==="followers"&&!e.isFollowing)}export{W as M,J as a,j as i};
