import{cp as z,aS as N,a7 as J,ag as g,ab as c,M as K,L,C as P,J as R,W as Y,b$ as q,cT as G}from"./3iSoGi4ic-DV-GuiCp.js";import{M as D}from"./3iSoGi4ic-BDF7xMl0.js";import{b as H,c as Q,a as i,w as Z,l as h,i as w,p,B as d,f as A,C as j,h as n,D as u,E as s,t as v,R as E}from"./3iSoGi4ic-D0mTJ0Mu.js";const ee={class:"_spacer",style:{"--MI_SPACER-w":"700px"}},le={class:"_gaps_m"},ae={class:"_buttons"},re=H({__name:"MkAntennaEditor",props:{antenna:{}},emits:["created","updated","deleted"],setup(_,{emit:F}){const t=z(_.antenna??{},{name:"",src:"all",userListId:null,users:[],keywords:[],excludeKeywords:[],excludeBots:!1,withReplies:!1,caseSensitive:!1,localOnly:!1,withFile:!1,excludeNotesInSensitiveChannel:!1,isActive:!0,hasUnreadNote:!1,notify:!1}),y=F,{model:r,def:O}=N({items:[{value:"all",label:"Все заметки"},{value:"users",label:"Заметки выбранных пользователей"},{value:"users_blacklist",label:"All notes except for those of one or more specified users"}],initialValue:t.src}),{model:f,def:$}=N({items:Q(()=>V.value==null?[]:V.value.map(o=>({value:o.id,label:o.name}))),initialValue:t.userListId}),x=i(t.name),m=i(t.users.join(`
`)),S=i(t.keywords.map(o=>o.join(" ")).join(`
`)),k=i(t.excludeKeywords.map(o=>o.join(" ")).join(`
`)),b=i(t.caseSensitive),U=i(t.localOnly),C=i(t.excludeBots),I=i(t.withReplies),B=i(t.withFile),M=i(t.excludeNotesInSensitiveChannel),V=i(null);Z(()=>r.value,async()=>{r.value==="list"&&V.value===null&&(V.value=await R("users/lists/list"))});async function T(){const o={name:x.value,src:r.value,userListId:f.value,excludeBots:C.value,withReplies:I.value,withFile:B.value,excludeNotesInSensitiveChannel:M.value,caseSensitive:b.value,localOnly:U.value,users:m.value.trim().split(`
`).map(e=>e.trim()),keywords:S.value.trim().split(`
`).map(e=>e.trim().split(" ")),excludeKeywords:k.value.trim().split(`
`).map(e=>e.trim().split(" "))};if(t.id==null){const e=await L("antennas/create",o);y("created",e)}else{const e=await L("antennas/update",{...o,antennaId:t.id});y("updated",e)}}async function W(){if(t.id==null)return;const{canceled:o}=await P({type:"warning",text:(({x})=>("Хотите удалить «"+x+"»?"))({x:t.name})});o||(await R("antennas/delete",{antennaId:t.id}),Y(),y("deleted"))}function X(){q({includeSelf:!0}).then(o=>{m.value=m.value.trim(),m.value+=`
@`+G(o),m.value=m.value.trim()})}return(o,e)=>(w(),h("div",ee,[p("div",null,[p("div",le,[d(J,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l)},{label:n(()=>[u(s("Название"),1)]),_:1},8,["modelValue"]),d(g,{modelValue:v(r),"onUpdate:modelValue":e[1]||(e[1]=l=>E(r)?r.value=l:null),items:v(O)},{label:n(()=>[u(s("Источник антенны"),1)]),_:1},8,["modelValue","items"]),v(r)==="list"?(w(),A(g,{key:0,modelValue:v(f),"onUpdate:modelValue":e[2]||(e[2]=l=>E(f)?f.value=l:null),items:v($)},{label:n(()=>[u(s("Списки"),1)]),_:1},8,["modelValue","items"])):v(r)==="users"||v(r)==="users_blacklist"?(w(),A(D,{key:1,modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l)},{label:n(()=>[u(s("Пользователи"),1)]),caption:n(()=>[u(s("Пишите каждое название аккаута на отдельной строке")+" ",1),p("button",{class:"_textButton",onClick:X},s("Добавить пользователя"),1)]),_:1},8,["modelValue"])):j("",!0),d(c,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l)},{default:n(()=>[u(s("Исключать ботов"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=l=>I.value=l)},{default:n(()=>[u(s("Включая ответы"),1)]),_:1},8,["modelValue"]),d(D,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=l=>S.value=l)},{label:n(()=>[u(s("Ключевые слова"),1)]),caption:n(()=>[u(s("Пишите слова через пробел в одной строке, чтобы ловить их появление вместе; на отдельных строках располагайте слова, или группы слов, чтобы ловить любые из них."),1)]),_:1},8,["modelValue"]),d(D,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l)},{label:n(()=>[u(s("Чёрный список слов"),1)]),caption:n(()=>[u(s("Пишите слова через пробел в одной строке, чтобы ловить их появление вместе; на отдельных строках располагайте слова, или группы слов, чтобы ловить любые из них."),1)]),_:1},8,["modelValue"]),d(c,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=l=>U.value=l)},{default:n(()=>[u(s("Локально"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l)},{default:n(()=>[u(s("С учётом регистра"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:B.value,"onUpdate:modelValue":e[10]||(e[10]=l=>B.value=l)},{default:n(()=>[u(s("Только заметки с вложениями"),1)]),_:1},8,["modelValue"]),d(c,{modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=l=>M.value=l)},{default:n(()=>[u(s("Исключить заметки из конфиденциальных каналов"),1)]),_:1},8,["modelValue"])]),p("div",{class:"xDoIj"},[p("div",ae,[d(K,{inline:"",primary:"",onClick:e[12]||(e[12]=l=>T())},{default:n(()=>[e[14]||(e[14]=p("i",{class:"ti ti-device-floppy"},null,-1)),u(" "+s("Сохранить"),1)]),_:1}),v(t).id!=null?(w(),A(K,{key:0,inline:"",danger:"",onClick:e[13]||(e[13]=l=>W())},{default:n(()=>[e[15]||(e[15]=p("i",{class:"ti ti-trash"},null,-1)),u(" "+s("Удалить"),1)]),_:1})):j("",!0)])],2)])]))}});export{re as X};
