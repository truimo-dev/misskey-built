import{b as L,l as k,i as y,p,F as b,A as C,E as M,t as w,a as d,e as F,q as H,g as N,z as V,f as D,h as $,j as E,B as Y,v as j,D as W}from"./3iSoGi4ic-D0mTJ0Mu.js";import{u as S}from"./3iSoGi4ic-DCTAa4Sx.js";import{j as T,_ as I,Q as R,b7 as q}from"./3iSoGi4ic-DV-GuiCp.js";import{M as G}from"./3iSoGi4ic-CC5SbM-1.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const Z={viewBox:"0 0 21 7"},J=["x","y"],K=["width","height","x","y","fill"],O=["x","y"],U=L({__name:"WidgetActivity.calendar",props:{activity:{}},setup(g){const l=T(g.activity).map(t=>({...t,total:t.notes+t.replies+t.renotes,x:0,date:{year:0,month:0,day:0,weekday:0},v:0,color:""})),u=Math.max(...l.map(t=>t.total)),a=new Date,s=a.getFullYear(),_=a.getMonth(),r=a.getDate();let h=20;return l.slice().forEach((t,m)=>{t.x=h;const e=new Date(s,_,r-m);t.date={year:e.getFullYear(),month:e.getMonth(),day:e.getDate(),weekday:e.getDay()},t.v=u===0?0:t.total/(u/2),t.v>1&&(t.v=1);const x=t.date.weekday===0||t.date.weekday===6?275:170,i=t.v*100,o=15+(1-t.v)*80;t.color=`hsl(${x}, ${i}%, ${o}%)`,t.date.weekday===0&&h--}),(t,m)=>(y(),k("svg",Z,[(y(!0),k(b,null,C(w(l),e=>(y(),k("rect",{class:"day",width:"1",height:"1",x:e.x,y:e.date.weekday,rx:"1",ry:"1",fill:"transparent"},[p("title",null,M(e.date.year)+"/"+M(e.date.month+1)+"/"+M(e.date.day),1)],8,J))),256)),(y(!0),k(b,null,C(w(l),e=>(y(),k("rect",{class:"day",width:e.v,height:e.v,x:e.x+(1-e.v)/2,y:e.date.weekday+(1-e.v)/2,rx:"1",ry:"1",fill:e.color,style:{"pointer-events":"none"}},null,8,K))),256)),p("rect",{class:"today",width:"1",height:"1",x:w(l)[0].x,y:w(l)[0].date.weekday,rx:"1",ry:"1",fill:"none","stroke-width":"0.1",stroke:"#f73520"},null,8,O)]))}}),ee=I(U,[["__scopeId","data-v-0f6b6671"]]),te=["viewBox"],oe=["points"],ne=["points"],ae=["points"],se=["points"],ie=L({__name:"WidgetActivity.chart",props:{activity:{}},setup(g){const f=g,l=d(147),u=d(60),a=d(1),s=d(0),_=d(),r=d(),h=d(),t=d();function m(o){window.addEventListener("mousemove",o),window.addEventListener("mouseleave",e.bind(null,o)),window.addEventListener("mouseup",e.bind(null,o))}function e(o){window.removeEventListener("mousemove",o),window.removeEventListener("mouseleave",e),window.removeEventListener("mouseup",e)}function x(o){const n=o.clientX,c=o.clientY,v=a.value,z=s.value;m(B=>{let A=B.clientX-n,P=B.clientY-c;a.value=Math.max(1,v+-P/20),s.value=Math.min(0,z+A),s.value<-((f.activity.length-1)*a.value-l.value)&&(s.value=-((f.activity.length-1)*a.value-l.value)),i()})}function i(){const o=Math.max(...f.activity.map(n=>n.total));if(o!==0){const n=f.activity.slice().reverse();_.value=n.map((c,v)=>`${v*a.value+s.value},${(1-c.notes/o)*u.value}`).join(" "),r.value=n.map((c,v)=>`${v*a.value+s.value},${(1-c.replies/o)*u.value}`).join(" "),h.value=n.map((c,v)=>`${v*a.value+s.value},${(1-c.renotes/o)*u.value}`).join(" "),t.value=n.map((c,v)=>`${v*a.value+s.value},${(1-c.total/o)*u.value}`).join(" ")}}return F(()=>{i()}),(o,n)=>(y(),k("svg",{viewBox:`0 0 ${l.value} ${u.value}`,class:"xzkoY",onMousedown:H(x,["prevent"])},[p("polyline",{points:_.value,fill:"none","stroke-width":"1",stroke:"#41ddde"},null,8,oe),p("polyline",{points:r.value,fill:"none","stroke-width":"1",stroke:"#f7796c"},null,8,ne),p("polyline",{points:h.value,fill:"none","stroke-width":"1",stroke:"#a1de41"},null,8,ae),p("polyline",{points:t.value,fill:"none","stroke-width":"1",stroke:"#555","stroke-dasharray":"2 2"},null,8,se)],42,te))}});const X="activity",ye=L({__name:"WidgetActivity",props:{widget:{}},emits:["updateProps"],setup(g,{expose:f,emit:l}){const u=R(),a={showHeader:{type:"boolean",default:!0},transparent:{type:"boolean",default:!1},view:{type:"number",default:0,hidden:!0}},s=g,_=l,{widgetProps:r,configure:h,save:t}=S(X,a,s,_),m=d(null),e=d(!0),x=()=>{r.view===1?r.view=0:r.view++,t()};return q("charts/user/notes",{userId:u.id,span:"day",limit:147}).then(i=>{m.value=i.diffs.normal.map((o,n)=>({total:i.diffs.normal[n]+i.diffs.reply[n]+i.diffs.renote[n],notes:i.diffs.normal[n],replies:i.diffs.reply[n],renotes:i.diffs.renote[n]})),e.value=!1}),f({name:X,configure:h,id:s.widget?s.widget.id:null}),(i,o)=>{const n=V("MkLoading");return y(),D(G,{showHeader:w(r).showHeader,naked:w(r).transparent,"data-cy-mkw-activity":"",class:"mkw-activity"},{icon:$(()=>[...o[1]||(o[1]=[p("i",{class:"ti ti-chart-line"},null,-1)])]),header:$(()=>[W(M("Aktivitas"),1)]),func:$(({buttonStyleClass:c})=>[p("button",{class:N(["_button",c]),onClick:o[0]||(o[0]=v=>x())},[...o[2]||(o[2]=[p("i",{class:"ti ti-selector"},null,-1)])],2)]),default:$(()=>[p("div",null,[e.value?(y(),D(n,{key:0})):(y(),k(b,{key:1},[E(Y(ee,{activity:m.value??[]},null,8,["activity"]),[[j,w(r).view===0]]),E(Y(ie,{activity:m.value??[]},null,8,["activity"]),[[j,w(r).view===1]])],64))])]),_:1},8,["showHeader","naked"])}}});export{ye as default};
