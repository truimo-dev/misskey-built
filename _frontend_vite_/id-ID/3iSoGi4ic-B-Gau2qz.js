import{l as W}from"./3iSoGi4ic-DUrJvqB4.js";import{az as E,bb as R,M as U,bX as z,J as r,A as D}from"./3iSoGi4ic-DV-GuiCp.js";import{b as H,a as i,c as C,z as J,f as T,i as y,h,p as Q,l as X,C as q,B as M,D as V,E as N}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";function G(w,e){window.parent.postMessage({type:w,payload:e},"*")}const K={class:"_spacer",style:{"--MI_SPACER-w":"800px"}},Y={key:1,class:"_buttonsCenter"},le=H({__name:"share",setup(w){const e=new URLSearchParams(window.location.search),g=e.get("localOnly"),b=e.get("visibility"),c=i("fetching"),u=i(e.get("title")),n=e.get("text"),d=e.get("url"),_=i(),f=i(),v=i(),k=i(W.includes(b)?b:void 0),A=i(g==="0"?!1:g==="1"?!0:void 0),x=i([]),I=i([]);async function B(){let s="";if(u.value?(s+=`[ ${u.value} ]
`,n?.startsWith(u.value)?s+=n.replace(u.value,"").trimStart():n&&(s+=`${n}
`)):n&&(s+=`${n}
`),d)try{s+=new URL(d).href}catch{s+=d}if(_.value=s.trim(),k.value==="specified"){const t=e.get("visibleUserIds"),o=e.get("visibleAccts");await Promise.all([...t?t.split(",").map(l=>({userId:l})):[],...o?o.split(",").map(z):[]].map(l=>r("users/show",l).then(p=>{I.value.push(p)},()=>{console.error(`Invalid user query: ${JSON.stringify(l)}`)})))}try{const t=e.get("replyId"),o=e.get("replyUri");if(t)f.value=await r("notes/show",{noteId:t});else if(o){const a=await r("ap/show",{uri:o});a.type==="Note"&&(f.value=a.object)}const l=e.get("renoteId"),p=e.get("renoteUri");if(l)v.value=await r("notes/show",{noteId:l});else if(p){const a=await r("ap/show",{uri:p});a.type==="Note"&&(v.value=a.object)}const P=e.get("fileIds");P&&await Promise.all(P.split(",").map(a=>r("drive/files/show",{fileId:a}).then(L=>{x.value.push(L)},()=>{console.error(`Failed to fetch a file ${a}`)})))}catch(t){D({type:"error",title:t.message,text:t.name})}c.value="writing"}B();function O(){window.close(),window.setTimeout(()=>{window.location.href="/"},100)}function F(){window.location.href="/"}function S(){c.value="posted",G("misskey:shareForm:shareCompleted")}const $=C(()=>[]),j=C(()=>[]);return E(()=>({title:"Bagikan",icon:"ti ti-share"})),(s,t)=>{const o=J("PageWithHeader");return y(),T(o,{actions:$.value,tabs:j.value},{default:h(()=>[Q("div",K,[c.value==="writing"?(y(),T(R,{key:0,fixed:"",instant:!0,initialText:_.value,initialVisibility:k.value,initialFiles:x.value,initialLocalOnly:A.value,reply:f.value,renote:v.value,initialVisibleUsers:I.value,class:"_panel",onPosted:S},null,8,["initialText","initialVisibility","initialFiles","initialLocalOnly","reply","renote","initialVisibleUsers"])):c.value==="posted"?(y(),X("div",Y,[M(U,{primary:"",onClick:O},{default:h(()=>[V(N("Tutup"),1)]),_:1}),M(U,{onClick:F},{default:h(()=>[V(N("Ke Misskey"),1)]),_:1})])):q("",!0)])]),_:1},8,["actions","tabs"])}}});export{le as default};
