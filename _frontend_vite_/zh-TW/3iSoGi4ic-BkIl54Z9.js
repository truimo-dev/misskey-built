import{Q as q,aw as A,ax as j,M as v,ad as K,C,a8 as R,h as W,r as O}from"./3iSoGi4ic-DV-GuiCp.js";import{b as Q,u as X,e as G,a as H,c as w,w as J,z as L,f as x,i as d,h as u,p as n,g as Y,s as Z,B as b,l as _,C as y,D as p,E as i,t as g}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const h={class:"_gaps_s _spacer"},ee={key:0},te={class:"_buttonsCenter"},ue=Q({__name:"MkUploaderDialog",props:{files:{},folderId:{},multiple:{type:Boolean,default:!0},features:{}},emits:["done","canceled","closed"],setup(F,{emit:B}){const I=q(),f=F,m=B,c=X("dialog"),s=A({multiple:f.multiple,folderId:f.folderId,features:f.features});G(()=>{s.addFiles(f.files)});const a=s.items,k=H(!1),T=w(()=>k.value&&s.readyForUpload.value),P=w(()=>a.value.some(t=>t.uploaded!=null)),U=w(()=>{const t=a.value.length;if(t===0)return 0;const e=a.value.reduce((r,o)=>o.uploaded?r+1:o.progress?r+o.progress.value/o.progress.max:r,0);return Math.round(e/t*100)});J(a,()=>{if(a.value.length===0){m("canceled"),c.value?.close();return}a.value.every(t=>t.uploaded)&&(m("done",a.value.map(t=>t.uploaded)),c.value?.close())},{deep:!0});async function S(){const{canceled:t}=await C({type:"question",text:"有些檔案尚未上傳，您要中止嗎？",okText:"是",cancelText:"否"});t||(s.abortAll(),m("canceled"),c.value?.close())}function $(){k.value=!0,s.upload()}async function E(){const{canceled:t}=await C({type:"question",text:"有些檔案尚未上傳，您要中止嗎？",okText:"是",cancelText:"否"});t||s.abortAll()}async function V(){if(!s.allItemsUploaded.value){const{canceled:t}=await C({type:"question",text:"有些檔案尚未上傳，是否要完成上傳？",okText:"是",cancelText:"否"});if(t)return}m("done",a.value.filter(t=>t.uploaded!=null).map(t=>t.uploaded)),c.value?.close()}async function z(t){const e=await R({multiple:!0});s.addFiles(e)}function D(t,e){const r=s.getMenu(t);W(r,e.currentTarget??e.target)}function N(t,e){const r=s.getMenu(t);O(r,e)}return(t,e)=>{const r=L("MkTip");return d(),x(K,{ref_key:"dialog",ref:c,width:800,height:500,onClose:e[7]||(e[7]=o=>S()),onClosed:e[8]||(e[8]=o=>m("closed"))},{header:u(()=>[e[9]||(e[9]=n("i",{class:"ti ti-upload"},null,-1)),p(" "+i((({n})=>("上傳了 "+n+" 個檔案"))({n:F.files.length})),1)]),footer:u(()=>[n("div",te,[g(s).uploading.value?(d(),x(v,{key:0,rounded:"",onClick:e[3]||(e[3]=o=>E())},{default:u(()=>[e[11]||(e[11]=n("i",{class:"ti ti-x"},null,-1)),p(" "+i("取消"),1)]),_:1})):k.value?y("",!0):(d(),x(v,{key:1,primary:"",rounded:"",disabled:!g(s).readyForUpload.value,onClick:e[4]||(e[4]=o=>$())},{default:u(()=>[e[12]||(e[12]=n("i",{class:"ti ti-upload"},null,-1)),p(" "+i("上傳"),1)]),_:1},8,["disabled"])),T.value?(d(),x(v,{key:2,rounded:"",onClick:e[5]||(e[5]=o=>$())},{default:u(()=>[e[13]||(e[13]=n("i",{class:"ti ti-reload"},null,-1)),p(" "+i("重試"),1)]),_:1})):y("",!0),P.value?(d(),x(v,{key:3,rounded:"",onClick:e[6]||(e[6]=o=>V())},{default:u(()=>[e[14]||(e[14]=n("i",{class:"ti ti-arrow-right"},null,-1)),p(" "+i("完成"),1)]),_:1})):y("",!0)])]),default:u(()=>[n("div",{class:"xmsKE"},[n("div",{class:Y(["x8jwk",T.value?"xode9":null]),style:Z({"--op":`${U.value}%`})},null,6),n("div",h,[b(r,{k:"uploader"},{default:u(()=>[p(i("檔案尚未上傳。您可以在此對話框中進行上傳前的確認、重新命名、壓縮、裁切等操作。準備完成後，請點選「上傳」按鈕開始上傳。\n"),1)]),_:1}),b(j,{items:g(a),onShowMenu:e[0]||(e[0]=(o,M)=>D(o,M)),onShowMenuViaContextmenu:e[1]||(e[1]=(o,M)=>N(o,M))},null,8,["items"]),f.multiple?(d(),_("div",ee,[b(v,{style:{margin:"auto"},iconOnly:!0,rounded:"",onClick:e[2]||(e[2]=o=>z(o))},{default:u(()=>[...e[10]||(e[10]=[n("i",{class:"ti ti-plus"},null,-1)])]),_:1})])):y("",!0),n("div",null,i((({x})=>("可上傳的最大檔案大小為 "+x+"。"))({x:g(I).policies.maxFileSizeMb+"MB"})),1)])],2)]),_:1},512)}}});export{ue as default};
