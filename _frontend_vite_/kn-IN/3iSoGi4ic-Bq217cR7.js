import{J as E,ak as ee,P as R,aF as te,a0 as P,bz as ne,by as ae,$ as I,c3 as se,az as le,M,aL as ie,R as B,b as oe,bb as ue,Z as re,H as ce,d0 as de,a7 as ve,c as fe,L as A,O as V,C as pe,E as he}from"./3iSoGi4ic-DV-GuiCp.js";import{u as T}from"./3iSoGi4ic-B1GPmOGN.js";import{b as U,a as w,z as $,l as i,i as s,F as _,C as r,p as l,g as me,E as c,t as x,B as f,Z as ye,m as z,c as S,w as ke,k as xe,f as k,h as u,j as H,s as we,A as ge,D as C}from"./3iSoGi4ic-D0mTJ0Mu.js";import{M as J}from"./3iSoGi4ic-mUIS9yQt.js";import{M as be}from"./3iSoGi4ic-DtDbNQ4_.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CdSqfJMx.js";import"./3iSoGi4ic-Dv7rS4og.js";const Ie=["disabled"],Ce=U({__name:"MkChannelFollowButton",props:{channel:{},full:{type:Boolean,default:!1}},setup(h){const g=h,p=w(g.channel.isFollowing),o=w(!1);async function e(){o.value=!0;try{p.value?(await E("channels/unfollow",{channelId:g.channel.id}),p.value=!1):(await E("channels/follow",{channelId:g.channel.id}),p.value=!0)}catch(m){console.error(m)}finally{o.value=!1}}return(m,y)=>{const b=$("MkLoading");return s(),i("button",{class:me(["_button",["xoYiP",{x7yue:o.value,xz4Cc:p.value,xo7QK:h.full}]]),disabled:o.value,onClick:e},[o.value?(s(),i(_,{key:1},[h.full?(s(),i("span",{key:0,class:"xE6IL"},c("Processing..."),3)):r("",!0),f(b,{em:!0})],64)):(s(),i(_,{key:0},[p.value?(s(),i(_,{key:0},[h.full?(s(),i("span",{key:0,class:"xE6IL"},c("Unfollow"),3)):r("",!0),y[0]||(y[0]=l("i",{class:"ti ti-minus"},null,-1))],64)):(s(),i(_,{key:1},[h.full?(s(),i("span",{key:0,class:"xE6IL"},c("Follow"),3)):r("",!0),y[1]||(y[1]=l("i",{class:"ti ti-plus"},null,-1))],64))],64))],10,Ie)}}});const _e={class:"_spacer",style:{"--MI_SPACER-w":"700px"}},Me={key:0,class:"_gaps"},Ae={key:0,style:{color:"var(--MI_THEME-warn)"}},$e={style:{"margin-left":"4px"}},Fe={key:0,class:"_gaps"},Pe={key:1,class:"_gaps"},Se={key:2},Ee={key:3},Le={key:0,class:"_gaps"},Ne={key:1},De={class:"_spacer",style:{"--MI_SPACER-w":"700px","--MI_SPACER-min":"16px","--MI_SPACER-max":"16px"}},Re={class:"_buttonsCenter"},Ye=U({__name:"channel",props:{channelId:{}},setup(h){const g=ee(),p=h,o=w("overview"),e=w(null),m=w(!1),y=w(""),b=ye(),L=w(""),W=z(new R("notes/featured",{limit:10,computedParams:S(()=>({channelId:p.channelId}))}));te(()=>{e.value!=null&&P.setItemAsJson(`channelLastReadedAt:${e.value.id}`,Date.now())},3e3,{immediate:!0,afterMounted:!0}),ke(()=>p.channelId,async()=>{const a=await E("channels/show",{channelId:p.channelId});if(m.value=a.isFavorited??!1,(m.value||a.isFollowing)&&(o.value="timeline"),(m.value||a.isFollowing)&&a.lastNotedAt){const t=P.getItemAsJson(`channelLastReadedAt:${a.id}`)??0,d=Date.parse(a.lastNotedAt);d>t&&P.setItemAsJson(`channelLastReadedAt:${a.id}`,d)}e.value=a},{immediate:!0});function Q(){g.push("/channels/:channelId/edit",{params:{channelId:p.channelId}})}function K(){fe({channel:e.value})}function Y(){e.value&&A("channels/favorite",{channelId:e.value.id}).then(()=>{m.value=!0,V.delete()})}async function Z(){!e.value||(await pe({type:"warning",text:"Really remove from favorites?"})).canceled||A("channels/unfavorite",{channelId:e.value.id}).then(()=>{m.value=!1,V.delete()})}async function j(){if(!e.value)return;const a=e.value,{canceled:t,result:d}=await he({title:"Mute duration",items:[{value:"indefinitely",label:"Permanently"},{value:"tenMinutes",label:"10 minutes"},{value:"oneHour",label:"One hour"},{value:"oneDay",label:"One day"},{value:"oneWeek",label:"One week"}],default:"indefinitely"});if(t)return;const F=d==="indefinitely"?null:d==="tenMinutes"?Date.now()+1e3*60*10:d==="oneHour"?Date.now()+1e3*60*60:d==="oneDay"?Date.now()+1e3*60*60*24:d==="oneWeek"?Date.now()+1e3*60*60*24*7:null;A("channels/mute/create",{channelId:a.id,expiresAt:F}).then(()=>{a.isMuting=!0})}async function q(){if(!e.value)return;const a=e.value;A("channels/mute/delete",{channelId:a.id}).then(()=>{a.isMuting=!1})}async function N(){if(!e.value)return;const a=y.value.toString().trim();a!=null&&(b.value=z(new R("notes/search",{limit:10,params:{query:a,channelId:e.value.id}})),L.value=a)}const O=S(()=>{if(e.value){const a=[];return a.push({icon:"ti ti-link",text:"Copy URL",handler:async()=>{if(!e.value){console.warn("failed to copy channel URL. channel.value is null.");return}ne(`${T}/channels/${e.value.id}`)}}),ae()&&a.push({icon:"ti ti-share",text:"Share",handler:async()=>{if(!e.value){console.warn("failed to share channel. channel.value is null.");return}navigator.share({title:e.value.name,text:e.value.description??void 0,url:`${T}/channels/${e.value.id}`})}}),e.value.isMuting?a.push({icon:"ti ti-volume-off",text:"Unmute",handler:async()=>{await q()}}):a.push({icon:"ti ti-volume",text:"Mute",handler:async()=>{await j()}}),(I&&I.id===e.value.userId||se)&&a.push({icon:"ti ti-settings",text:"Edit",handler:Q}),a.length>0?a:null}else return null}),G=S(()=>[{key:"overview",title:"Overview",icon:"ti ti-info-circle"},{key:"timeline",title:"ಸಮಯಸಾಲು",icon:"ti ti-home"},{key:"featured",title:"Featured",icon:"ti ti-bolt"},{key:"search",title:"ಹುಡುಕು",icon:"ti ti-search"}]);return le(()=>({title:e.value?e.value.name:"Channels",icon:"ti ti-device-tv"})),(a,t)=>{const d=$("I18n"),F=$("Mfm"),X=$("PageWithHeader"),D=xe("tooltip");return s(),k(X,{tab:o.value,"onUpdate:tab":t[6]||(t[6]=v=>o.value=v),actions:O.value,tabs:G.value,swipable:!0},{footer:u(()=>[l("div",{class:"xaY9v"},[l("div",De,[l("div",Re,[f(M,{inline:"",rounded:"",primary:"",gradate:"",onClick:t[5]||(t[5]=v=>K())},{default:u(()=>[t[14]||(t[14]=l("i",{class:"ti ti-pencil"},null,-1)),C(" "+c("Post to channel"),1)]),_:1})])])],2)]),default:u(()=>[l("div",_e,[e.value&&o.value==="overview"?(s(),i("div",Me,[l("div",{class:"_panel x6VG1"},[f(Ce,{channel:e.value,full:!0,class:"xn6QZ"},null,8,["channel","class"]),m.value?H((s(),k(M,{key:0,asLike:"",class:"button xk9C4",rounded:"",primary:"",onClick:t[0]||(t[0]=v=>Z())},{default:u(()=>[...t[7]||(t[7]=[l("i",{class:"ti ti-star"},null,-1)])]),_:1},8,["class"])),[[D,"ಮೆಚ್ಚುಗೆ ಅಳಿಸು"]]):H((s(),k(M,{key:1,asLike:"",class:"button xk9C4",rounded:"",onClick:t[1]||(t[1]=v=>Y())},{default:u(()=>[...t[8]||(t[8]=[l("i",{class:"ti ti-star"},null,-1)])]),_:1},8,["class"])),[[D,"ಮೆಚ್ಚಿನ"]]),l("div",{style:we({backgroundImage:e.value.bannerUrl?`url(${e.value.bannerUrl})`:void 0}),class:"xgesw"},[l("div",{class:"xaFpA"},[l("div",null,[t[9]||(t[9]=l("i",{class:"ti ti-users ti-fw"},null,-1)),f(d,{src:"{n} Participants",tag:"span",style:{"margin-left":"4px"}},{n:u(()=>[l("b",null,c(e.value.usersCount),1)]),_:1},8,["src"])]),l("div",null,[t[10]||(t[10]=l("i",{class:"ti ti-pencil ti-fw"},null,-1)),f(d,{src:"{n} Notes",tag:"span",style:{"margin-left":"4px"}},{n:u(()=>[l("b",null,c(e.value.notesCount),1)]),_:1},8,["src"])]),x(I)!=null&&e.value!=null&&x(I).id===e.value.userId?(s(),i("div",Ae,[t[11]||(t[11]=l("i",{class:"ti ti-user-star ti-fw"},null,-1)),l("span",$e,c("You are admin"),1)])):r("",!0)],2),e.value.isSensitive?(s(),i("div",{key:0,class:"xiCtj"},c("Sensitive"),3)):r("",!0),l("div",{class:"xq1JE"},null,2)],6),e.value.description?(s(),i("div",{key:2,class:"xt7Ow"},[f(F,{text:e.value.description,isNote:!1},null,8,["text"])],2)):r("",!0)],2),f(be,null,{header:u(()=>[t[12]||(t[12]=l("i",{class:"ti ti-pin ti-fw",style:{"margin-right":"0.5em"}},null,-1)),C(c("Pinned notes"),1)]),default:u(()=>[e.value.pinnedNotes&&e.value.pinnedNotes.length>0?(s(),i("div",Fe,[(s(!0),i(_,null,ge(e.value.pinnedNotes,v=>(s(),k(ie,{key:v.id,class:"_panel",note:v},null,8,["note"]))),128))])):r("",!0)]),_:1})])):r("",!0),e.value&&o.value==="timeline"?(s(),i("div",Pe,[e.value.isArchived?(s(),k(B,{key:0,warn:""},{default:u(()=>[C(c("This channel has been archived."),1)]),_:1})):r("",!0),x(I)&&x(oe).r.showFixedPostFormInChannel.value?(s(),k(ue,{key:1,channel:e.value,class:"post-form _panel",fixed:"",autofocus:x(re)==="desktop"},null,8,["channel","autofocus"])):r("",!0),(s(),k(ce,{key:h.channelId,src:"channel",channel:h.channelId},null,8,["channel"]))])):o.value==="featured"?(s(),i("div",Se,[f(J,{paginator:x(W)},null,8,["paginator"])])):o.value==="search"?(s(),i("div",Ee,[x(de)?(s(),i("div",Le,[l("div",null,[f(ve,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=v=>y.value=v),onEnter:t[3]||(t[3]=v=>N())},{prefix:u(()=>[...t[13]||(t[13]=[l("i",{class:"ti ti-search"},null,-1)])]),_:1},8,["modelValue"]),f(M,{primary:"",rounded:"",style:{"margin-top":"8px"},onClick:t[4]||(t[4]=v=>N())},{default:u(()=>[C(c("ಹುಡುಕು"),1)]),_:1})]),b.value?(s(),k(J,{key:L.value,paginator:b.value},null,8,["paginator"])):r("",!0)])):(s(),i("div",Ne,[f(B,{warn:""},{default:u(()=>[C(c("Note search is unavailable."),1)]),_:1})]))])):r("",!0)])]),_:1},8,["tab","actions","tabs"])}}});export{Ye as default};
