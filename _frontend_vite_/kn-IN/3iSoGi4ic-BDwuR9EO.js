import{b as U,u as j,m as A,c as N,w as T,e as H,o as J,z as k,k as W,f as i,i as o,U as I,t,h as w,l as r,x as $,B as q,j as K,G as X,F as Y,A as Z,C as ee,p as m,D as b,E as h,v as te}from"./3iSoGi4ic-D0mTJ0Mu.js";import{b as c,P as S,U as M,aF as se,aG as oe,aH as E,aI as ne,aJ as ae,aK as O,aL as le,aM as ie,aN as re,aO as ce}from"./3iSoGi4ic-DV-GuiCp.js";const ue={key:"_empty_"},de=["data-scroll-anchor"],me=["disabled"],pe={key:0},f=1e3*10,Te=U({__name:"MkStreamingNotificationsTimeline",props:{excludeTypes:{}},setup(P,{expose:D}){const p=P,u=j("rootEl"),e=c.s.useGroupedNotifications?A(new S("i/notifications-grouped",{limit:20,computedParams:N(()=>({excludeTypes:p.excludeTypes??void 0}))})):A(new S("i/notifications",{limit:20,computedParams:N(()=>({excludeTypes:p.excludeTypes??void 0}))})),F=c.s.pollingInterval===1?f*1.5*1.5:c.s.pollingInterval===2?f*1.5:(c.s.pollingInterval===3,f);M.s.realtimeMode||se(async()=>{e.fetchNewer({toQueue:!1})},F,{immediate:!1,afterMounted:!0});function x(){if(l==null||u.value==null)return!0;const a=l.scrollTop,s=u.value.offsetTop-l.offsetTop;return a<=s}function R(){e.releaseQueue(),ce(u.value)}let l=null;function V(){x()&&e.releaseQueue()}T(u,a=>{if(a&&l==null){if(l=re(a),l==null)return;l.addEventListener("scroll",V,{passive:!0})}},{immediate:!0});const C=oe();let _=!1;T(C,()=>{C.value==="hidden"?_=!0:(_=!1,x()&&R())});function B(a){const s=p.excludeTypes?p.excludeTypes.includes(a.type):!1;(s||window.document.visibilityState==="visible")&&M.s.realtimeMode&&E().send("readNotification"),s||(x()&&!_?e.prepend(a):e.enqueue(a))}function y(){return e.reload()}let d=null;return H(()=>{e.init(),e.computedParams&&T(e.computedParams,()=>{e.reload()},{immediate:!1,deep:!0}),M.s.realtimeMode&&(d=E().useChannel("main"),d.on("notification",B),d.on("notificationFlushed",y))}),J(()=>{d&&d.dispose()}),D({reload:y}),(a,s)=>{const g=k("MkLoading"),z=k("MkError"),G=k("MkResult"),Q=W("appear");return o(),i(I(t(c).s.enablePullToRefresh?ne:"div"),{refresher:()=>y()},{default:w(()=>[t(e).fetching.value?(o(),i(g,{key:0})):t(e).error.value?(o(),i(z,{key:1,onRetry:s[0]||(s[0]=n=>t(e).init())})):t(e).items.value.length===0?(o(),r("div",ue,[$(a.$slots,"empty",{},()=>[q(G,{type:"empty",text:"ಅಧಿಸೂಚನೆಗಳಿಲ್ಲ"},null,8,["text"])])])):(o(),r("div",{key:3,ref_key:"rootEl",ref:u},[(o(),i(I(t(c).s.animation?X:"div"),{class:"x3BD2",enterActiveClass:"x5T5J",leaveActiveClass:"xee3p",enterFromClass:"xAAIf",leaveToClass:"xmrDs",moveClass:"xhkaz",tag:"div"},{default:w(()=>[(o(!0),r(Y,null,Z(t(e).items.value,(n,v)=>(o(),r("div",{key:n.id,"data-scroll-anchor":n.id,class:"xmufI"},[v>0&&t(ae)(t(e).items.value[v-1].createdAt,n.createdAt)?(o(),r("div",{key:0,class:"xcnVt"},[m("span",null,[s[2]||(s[2]=m("i",{class:"ti ti-chevron-up"},null,-1)),b(" "+h(t(O)(t(e).items.value[v-1].createdAt,n.createdAt)?.prevText),1)]),s[4]||(s[4]=m("span",{style:{height:"1em",width:"1px",background:"var(--MI_THEME-divider)"}},null,-1)),m("span",null,[b(h(t(O)(t(e).items.value[v-1].createdAt,n.createdAt)?.nextText)+" ",1),s[3]||(s[3]=m("i",{class:"ti ti-chevron-down"},null,-1))])],2)):ee("",!0),["reply","quote","mention"].includes(n.type)&&"note"in n?(o(),i(le,{key:1,class:"x7OW7",note:n.note,withHardMute:!0},null,8,["class","note"])):(o(),i(ie,{key:2,class:"x7OW7",notification:n,withTime:!0,full:!0},null,8,["class","notification"]))],10,de))),128))]),_:1},8,["class","enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass","moveClass"])),K((o(),r("button",{key:"_more_",disabled:t(e).fetchingOlder.value,class:"_button xzMCj",onClick:s[1]||(s[1]=(...n)=>t(e).fetchOlder&&t(e).fetchOlder(...n))},[t(e).fetchingOlder.value?(o(),i(g,{key:1})):(o(),r("div",pe,h("ಇನ್ನಷ್ಟು ನೋಡು"),1))],10,me)),[[te,t(e).canFetchOlder.value],[Q,t(c).s.enableInfiniteScroll?t(e).fetchOlder:null]])],512))]),_:3},8,["refresher"])}}});export{Te as M};
