import{Q as T,aF as U,J as f}from"./3iSoGi4ic-DV-GuiCp.js";import{b as D,a as p,L as v,M as K,e as S,z as t,l as o,i as a,F as A,C as r,f as n,A as V,g as E,h as I,p as u,B as m,D as H,E as y}from"./3iSoGi4ic-D0mTJ0Mu.js";const J={key:0,class:"_gaps_s"},F=D({__name:"MkChatHistories",setup(G){const M=T(),c=p([]),d=p(!0),g=p(!1);async function x(){if(g.value)return;g.value=!0;const[_,l]=await Promise.all([f("chat/history",{room:!1}),f("chat/history",{room:!0})]);c.value=[..._,...l].toSorted((s,i)=>new Date(i.createdAt).getTime()-new Date(s.createdAt).getTime()).map(s=>({id:s.id,message:s,other:!("room"in s)||s.room==null?s.fromUserId===M.id?s.toUser:s.fromUser:null,isMe:s.fromUserId===M.id})),g.value=!1,d.value=!1}let k=!0;return v(()=>{k=!0}),K(()=>{k=!1}),U(()=>{!window.document.hidden&&k&&x()},1e3*10,{immediate:!1,afterMounted:!0}),v(()=>{x()}),S(()=>{x()}),(_,l)=>{const s=t("MkAvatar"),i=t("MkTime"),C=t("MkUserName"),w=t("MkAcct"),B=t("MkA"),N=t("MkResult"),R=t("MkLoading");return a(),o(A,null,[c.value.length>0?(a(),o("div",J,[(a(!0),o(A,null,V(c.value,e=>(a(),n(B,{key:e.id,class:E([["xCmgE",{x7JsG:e.isMe,xbSlw:e.message.isRead}],"_panel"]),to:e.message.toRoomId?`/chat/room/${e.message.toRoomId}`:`/chat/user/${e.other.id}`},{default:I(()=>[e.message.toRoomId?(a(),n(s,{key:0,class:"xBi4k",user:e.message.fromUser,indicator:"",preview:!1},null,8,["class","user"])):e.other?(a(),n(s,{key:1,class:"xBi4k",user:e.other,indicator:"",preview:!1},null,8,["class","user"])):r("",!0),u("div",{class:"xiKNw"},[e.message.toRoom?(a(),o("header",{key:0,class:"xeVuq"},[u("span",{class:"xtKrH"},[l[0]||(l[0]=u("i",{class:"ti ti-users"},null,-1)),H(" "+y(e.message.toRoom.name),1)],2),m(i,{time:e.message.createdAt,class:"x5ctC"},null,8,["time","class"])],2)):(a(),o("header",{key:1,class:"xeVuq"},[m(C,{class:"xtKrH",user:e.other},null,8,["class","user"]),m(w,{class:"xcEQD",user:e.other},null,8,["class","user"]),m(i,{time:e.message.createdAt,class:"x5ctC"},null,8,["time","class"])],2)),u("div",{class:"x4GK4"},[e.isMe?(a(),o("span",{key:0,class:"xoJx8"},y("あなた")+":",3)):r("",!0),H(y(e.message.text),1)],2)],2)]),_:2},1032,["class","to"]))),128))])):r("",!0),!d.value&&c.value.length==0?(a(),n(N,{key:1,type:"empty",text:"履歴はありません"},null,8,["text"])):r("",!0),d.value?(a(),n(R,{key:2})):r("",!0)],64)}}});export{F as M};
