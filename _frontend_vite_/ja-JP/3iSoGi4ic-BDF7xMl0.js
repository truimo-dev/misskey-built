import{b as K,N as X,a as u,c as j,u as z,w,e as R,n as C,o as U,z as G,k as h,l as x,i as d,p as c,C as k,j as M,f as Y,x as S,g as V,S as F,E as g,v as W,B as H,h as J,D as L}from"./3iSoGi4ic-D0mTJ0Mu.js";import{b4 as O,b5 as Q,M as Z}from"./3iSoGi4ic-DV-GuiCp.js";const _={class:"_selectable"},ee=["disabled","required","readonly","placeholder","pattern","autocomplete","spellcheck"],se=K({__name:"MkTextarea",props:{modelValue:{},required:{type:Boolean},readonly:{type:Boolean},disabled:{type:Boolean},pattern:{},placeholder:{},autofocus:{type:Boolean},autocomplete:{},mfmAutocomplete:{type:[Boolean,Array]},mfmPreview:{type:Boolean},spellcheck:{type:Boolean},debounce:{type:Boolean},manualSave:{type:Boolean},code:{type:Boolean},tall:{type:Boolean},pre:{type:Boolean}},emits:["change","keydown","enter","update:modelValue"],setup(t,{emit:P}){const n=t,i=P,{modelValue:b,autofocus:T}=X(n),l=u(b.value??""),r=u(!1),v=u(!1),A=u(!1);j(()=>l.value!==""&&l.value!=null);const o=z("inputEl"),m=u(!1);let p=null;const B=()=>o.value?.focus(),$=a=>{v.value=!0,i("change",a)},D=a=>{if(!(a.isComposing||a.key==="Process"||a.keyCode===229)&&(i("keydown",a),a.code==="Enter"&&i("enter"),n.code&&a.key==="Tab")){const e=o.value?.selectionStart??0,y=o.value?.selectionEnd??l.value.length;l.value=l.value.slice(0,e)+"	"+l.value.slice(y),C(()=>{o.value?.setSelectionRange(e+1,e+1)}),a.preventDefault()}},f=()=>{v.value=!1,i("update:modelValue",l.value??"")},N=O(1e3,f);return w(b,a=>{l.value=a??""}),w(l,()=>{n.manualSave||(n.debounce?N():f()),A.value=o.value?.validity.badInput??!0}),R(()=>{C(()=>{T.value&&B()}),n.mfmAutocomplete&&o.value&&(p=new Q(o.value,l,n.mfmAutocomplete===!0?void 0:n.mfmAutocomplete))}),U(()=>{p&&p.detach()}),(a,e)=>{const y=G("Mfm"),q=h("adaptive-border"),I=h("panel");return d(),x("div",_,[c("div",{class:"x7Ceb",onClick:B},[S(a.$slots,"label")],2),c("div",{class:V({xca1Y:t.disabled,xBnh9:r.value,xr7ya:t.tall,xyXiK:t.pre}),style:{position:"relative"}},[M(c("textarea",{ref_key:"inputEl",ref:o,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s),class:V(["xj1il",{_monospace:t.code}]),disabled:t.disabled,required:t.required,readonly:t.readonly,placeholder:t.placeholder,pattern:t.pattern,autocomplete:t.autocomplete,spellcheck:t.spellcheck,onFocus:e[1]||(e[1]=s=>r.value=!0),onBlur:e[2]||(e[2]=s=>r.value=!1),onKeydown:e[3]||(e[3]=s=>D(s)),onInput:$},null,42,ee),[[F,l.value],[q]])],2),c("div",{class:"xtIxP"},[S(a.$slots,"caption")],2),t.mfmPreview?(d(),x("button",{key:0,style:{"font-size":"0.85em"},class:"_textButton",type:"button",onClick:e[4]||(e[4]=s=>m.value=!m.value)},g("プレビュー"),1)):k("",!0),t.mfmPreview?M((d(),x("div",{key:1,class:"x9X6G"},[H(y,{text:l.value},null,8,["text"])],2)),[[W,m.value],[I]]):k("",!0),t.manualSave&&v.value?(d(),Y(Z,{key:2,primary:"",class:"x7eak",onClick:f},{default:J(()=>[e[5]||(e[5]=c("i",{class:"ti ti-device-floppy"},null,-1)),L(" "+g("保存"),1)]),_:1},8,["class"])):k("",!0)])}}});export{se as M};
