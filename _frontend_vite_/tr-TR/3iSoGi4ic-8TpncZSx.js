import{i as M,u as A,C}from"./3iSoGi4ic-CqmhgU-Q.js";import{J as D,U as S}from"./3iSoGi4ic-DV-GuiCp.js";import{a as v}from"./3iSoGi4ic-BPp9MNgd.js";import{b as E,u as k,a as T,e as R,z as $,l as x,i as f,f as Y,p as B,n as I}from"./3iSoGi4ic-D0mTJ0Mu.js";const W={key:1},J=E({__name:"MkRetentionHeatmap",setup(z){M();const r=k("rootEl"),i=k("chartEl");let l=null;const m=T(!0),{handler:_}=A({position:"middle"});async function b(){if(r.value==null)return;l&&l.destroy();const d=r.value.offsetWidth>600,c=r.value.offsetWidth<400,o=d?10:c?5:7;let s=await D("retention",{});s=s.slice(0,o+1);const u=[];for(const t of s){u.push({x:0,y:t.createdAt,v:t.users});let e=1;for(const a of Object.keys(t.data).sort((n,p)=>new Date(n).getTime()-new Date(p).getTime()))u.push({x:e,y:t.createdAt,v:t.data[a]}),e++}m.value=!1,await I();const h=S.s.darkMode?"#b4e900":"#86b300",w=t=>{const e=t.getFullYear().toString().padStart(2,"0"),a=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${e}/${a}/${n}`},g=t=>s.find(e=>e.createdAt===t).users,y=12;i.value!=null&&(l=new C(i.value,{type:"matrix",data:{datasets:[{label:"Active",data:u,borderWidth:0,borderRadius:3,backgroundColor(t){const e=t.dataset.data[t.dataIndex],a=e.v,n=g(e.y);if(n===0)return v(h,0);{const p=a/n;return v(h,p)}},width(t){const e=t.chart.chartArea??{};return(e.right-e.left)/o-y},height(t){const e=t.chart.chartArea??{};return(e.bottom-e.top)/o-y/1.5}}]},options:{aspectRatio:2,layout:{padding:{left:8,right:0,top:0,bottom:0}},scales:{x:{position:"top",suggestedMax:o,grid:{display:!1},ticks:{display:!0,padding:0,maxRotation:0,autoSkipPadding:0,autoSkip:!1,callback:(t,e,a)=>t},title:{display:!0,text:"Days later"}},y:{type:"time",offset:!0,reverse:!0,position:"left",time:{unit:"day",round:"day"},grid:{display:!1},ticks:{maxRotation:0,autoSkip:!0,padding:1,font:{size:9}}}},plugins:{legend:{display:!1},tooltip:{enabled:!1,callbacks:{title(t){const e=t[0].dataset.data[t[0].dataIndex];return w(new Date(new Date(e.y).getTime()+e.x*864e5))},label(t){const e=t.dataset.data[t.dataIndex],a=g(e.y);return a===0?[`Active: ${e.v} (-%)`]:[`Active: ${e.v} (${Math.round(e.v/a*100)}%)`]}},animation:{duration:0},external:_}}}}))}return R(async()=>{b()}),(d,c)=>{const o=$("MkLoading");return f(),x("div",{ref_key:"rootEl",ref:r},[m.value?(f(),Y(o,{key:0})):(f(),x("div",W,[B("canvas",{ref_key:"chartEl",ref:i},null,512)]))],512)}}});export{J as _};
