import{Q as H,ab as O,M as U,ad as P,J as F,az as J,R as G,ar as K,L as B,C as W}from"./3iSoGi4ic-DV-GuiCp.js";import{b,c as $,z as Y,l as y,i as f,p as d,B as k,C as A,h as v,D as x,E as u,g as j,t as I,u as Q,a as X,f as M,k as q,j as Z,F as z,A as L}from"./3iSoGi4ic-D0mTJ0Mu.js";import{M as V}from"./3iSoGi4ic-CSc4cSLM.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const N=b({__name:"avatar-decoration.decoration",props:{active:{type:Boolean},decoration:{},angle:{},flipH:{type:Boolean},offsetX:{},offsetY:{}},emits:["click"],setup(l,{emit:o}){const s=H(),e=l,C=o,h=$(()=>e.decoration.roleIdsThatCanBeUsedThisDecoration.length>0&&!s.roles.some(_=>e.decoration.roleIdsThatCanBeUsedThisDecoration.includes(_.id)));return(_,n)=>{const r=Y("MkCondensedLine"),p=Y("MkAvatar");return f(),y("div",{class:j(["x3egY",{xhCeU:l.active}]),onClick:n[0]||(n[0]=t=>C("click"))},[d("div",{class:"xzzO8"},[k(r,{minScale:.5},{default:v(()=>[x(u(l.decoration.name),1)]),_:1})],2),k(p,{style:{width:"60px",height:"60px"},user:I(s),decorations:[{url:l.decoration.url,angle:l.angle,flipH:l.flipH,offsetX:l.offsetX,offsetY:l.offsetY}],forceShowDecoration:""},null,8,["user","decorations"]),h.value?(f(),y("i",{key:0,class:"x244I ti ti-lock"},null,2)):A("",!0)],2)}}});const ee={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px"}},te={style:{"text-align":"center"}},ae={class:"_gaps_s"},oe=b({__name:"avatar-decoration.dialog",props:{usingIndex:{},decoration:{}},emits:["closed","attach","update","detach"],setup(l,{emit:o}){const s=H(),e=l,C=o,h=Q("dialog"),_=$(()=>s.policies.avatarDecorationLimit-s.avatarDecorations.length<=0),n=$(()=>e.decoration.roleIdsThatCanBeUsedThisDecoration.length>0&&!s.roles.some(w=>e.decoration.roleIdsThatCanBeUsedThisDecoration.includes(w.id))),r=X((e.usingIndex!=null?s.avatarDecorations[e.usingIndex].angle:null)??0),p=X((e.usingIndex!=null?s.avatarDecorations[e.usingIndex].flipH:null)??!1),t=X((e.usingIndex!=null?s.avatarDecorations[e.usingIndex].offsetX:null)??0),m=X((e.usingIndex!=null?s.avatarDecorations[e.usingIndex].offsetY:null)??0),D=$(()=>{const w={id:e.decoration.id,url:e.decoration.url,angle:r.value,flipH:p.value,offsetX:t.value,offsetY:m.value,blink:!0},a=[...s.avatarDecorations];return e.usingIndex!=null?a[e.usingIndex]=w:a.push(w),a});function g(){h.value?.close()}async function S(){C("update",{angle:r.value,flipH:p.value,offsetX:t.value,offsetY:m.value}),h.value?.close()}async function T(){C("attach",{angle:r.value,flipH:p.value,offsetX:t.value,offsetY:m.value}),h.value?.close()}async function R(){C("detach"),h.value?.close()}return(w,a)=>{const E=Y("MkAvatar");return f(),M(P,{ref_key:"dialog",ref:h,width:400,height:450,onClose:g,onClosed:a[4]||(a[4]=c=>C("closed"))},{header:v(()=>[x(u("Avatar süsleri"),1)]),default:v(()=>[d("div",null,[d("div",ee,[d("div",te,[d("div",{class:"xdIXz"},u(l.decoration.name),3),k(E,{style:{width:"64px",height:"64px","margin-bottom":"20px"},user:I(s),decorations:D.value,forceShowDecoration:""},null,8,["user","decorations"])]),d("div",ae,[k(V,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=c=>r.value=c),continuousUpdate:"",min:-.5,max:.5,step:.025,textConverter:c=>`${Math.floor(c*360)}°`},{label:v(()=>[x(u("Açı"),1)]),_:1},8,["modelValue","textConverter"]),k(V,{modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=c=>t.value=c),continuousUpdate:"",min:-.25,max:.25,step:.025,textConverter:c=>`${Math.floor(c*100)}%`},{label:v(()=>[x("X "+u("Pozisyon"),1)]),_:1},8,["modelValue","textConverter"]),k(V,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=c=>m.value=c),continuousUpdate:"",min:-.25,max:.25,step:.025,textConverter:c=>`${Math.floor(c*100)}%`},{label:v(()=>[x("Y "+u("Pozisyon"),1)]),_:1},8,["modelValue","textConverter"]),k(O,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=c=>p.value=c)},{label:v(()=>[x(u("Çevir"),1)]),_:1},8,["modelValue"])])]),d("div",{class:"xnoKo _buttonsCenter"},[l.usingIndex!=null?(f(),M(U,{key:0,primary:"",rounded:"",onClick:S},{default:v(()=>[a[5]||(a[5]=d("i",{class:"ti ti-check"},null,-1)),x(" "+u("Güncelle"),1)]),_:1})):A("",!0),l.usingIndex!=null?(f(),M(U,{key:1,rounded:"",onClick:R},{default:v(()=>[a[6]||(a[6]=d("i",{class:"ti ti-x"},null,-1)),x(" "+u("Kaldır"),1)]),_:1})):(f(),M(U,{key:2,disabled:_.value||n.value,primary:"",rounded:"",onClick:T},{default:v(()=>[a[7]||(a[7]=d("i",{class:"ti ti-check"},null,-1)),x(" "+u("Ek"),1)]),_:1},8,["disabled"]))],2)])]),_:1},512)}}});const ne={key:0,class:"_gaps"},se={key:1},ve=b({__name:"avatar-decoration",setup(l){const o=H(),s=X(!0),e=X([]);F("get-avatar-decorations").then(n=>{e.value=n,s.value=!1});function C(n){h(e.value.find(r=>r.id===o.avatarDecorations[n].id)??{id:"",url:"",name:"?",roleIdsThatCanBeUsedThisDecoration:[]},n)}async function h(n,r){const{dispose:p}=K(oe,{decoration:n,usingIndex:r??null},{attach:async t=>{const m={id:n.id,url:n.url,angle:t.angle,flipH:t.flipH,offsetX:t.offsetX,offsetY:t.offsetY},D=[...o.avatarDecorations,m];await B("i/update",{avatarDecorations:D}),o.avatarDecorations=D},update:async t=>{const m={id:n.id,url:n.url,angle:t.angle,flipH:t.flipH,offsetX:t.offsetX,offsetY:t.offsetY},D=[...o.avatarDecorations];D[r]=m,await B("i/update",{avatarDecorations:D}),o.avatarDecorations=D},detach:async()=>{const t=[...o.avatarDecorations];t.splice(r,1),await B("i/update",{avatarDecorations:t}),o.avatarDecorations=t},closed:()=>p()})}function _(){W({type:"warning",text:"Emin misin?"}).then(async({canceled:n})=>{n||(await B("i/update",{avatarDecorations:[]}),o.avatarDecorations=[])})}return $(()=>[]),$(()=>[]),J(()=>({title:"Avatar süsleri",icon:"ti ti-sparkles"})),(n,r)=>{const p=Y("MkAvatar"),t=Y("MkLoading"),m=Y("SearchMarker"),D=q("panel");return f(),M(m,{path:"/settings/avatar-decoration",label:"Avatar süsleri",keywords:["avatar","icon","decoration"],icon:"ti ti-sparkles",markerId:"gtaOSdIJB","data-in-app-search-marker-id":"gtaOSdIJB"},{default:v(()=>[d("div",null,[s.value?(f(),y("div",se,[k(t)])):(f(),y("div",ne,[k(G,null,{default:v(()=>[x(u((({max})=>("En fazla "+max+" süs ekleyebilirsin."))({max:I(o).policies.avatarDecorationLimit}))+" ("+u((({n})=>("Kalan: "+n))({n:I(o).policies.avatarDecorationLimit-I(o).avatarDecorations.length}))+")",1)]),_:1}),k(p,{class:"xn33G",user:I(o),forceShowDecoration:""},null,8,["class","user"]),I(o).avatarDecorations.length>0?Z((f(),y("div",{key:0,class:"xoCIa _gaps_s"},[d("div",null,u("Kullanılıyor"),1),d("div",{class:"xDSzT"},[(f(!0),y(z,null,L(I(o).avatarDecorations,(g,S)=>(f(),M(N,{decoration:e.value.find(T=>T.id===g.id)??{id:"",url:"",name:"?",roleIdsThatCanBeUsedThisDecoration:[]},angle:g.angle,flipH:g.flipH,offsetX:g.offsetX,offsetY:g.offsetY,active:!0,onClick:T=>C(S)},null,8,["decoration","angle","flipH","offsetX","offsetY","onClick"]))),256))],2),k(U,{danger:"",onClick:_},{default:v(()=>[x(u("Tümünü Kaldır"),1)]),_:1})],2)),[[D]]):A("",!0),d("div",{class:"xDSzT"},[(f(!0),y(z,null,L(e.value,g=>(f(),M(N,{key:g.id,decoration:g,onClick:S=>h(g)},null,8,["decoration","onClick"]))),128))],2)]))])]),_:1},8,["label"])}}});export{ve as default};
