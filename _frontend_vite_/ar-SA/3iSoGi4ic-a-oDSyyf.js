import{b as G,a as m,m as w,c as v,w as L,z as y,f as i,i as a,h as p,p as n,B as f,T as U,t as h,l as u,C as r,D as I,E as V,F as j,A as F}from"./3iSoGi4ic-D0mTJ0Mu.js";import{$ as H,P as _,az as W,b as q,M as C,J as B,bC as J,ay as X}from"./3iSoGi4ic-DV-GuiCp.js";import{h as Y}from"./3iSoGi4ic-B1GPmOGN.js";import{M as Q}from"./3iSoGi4ic-i0V9UGTl.js";import{M as N}from"./3iSoGi4ic-mUIS9yQt.js";import{M as Z}from"./3iSoGi4ic-Db5Eufi0.js";import{d as ee}from"./3iSoGi4ic-y3_HjM0O.js";import{M as te}from"./3iSoGi4ic-VTO3_13K.js";import{a as ae,s as $}from"./3iSoGi4ic-Cx1VE20Y.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-Cj3FgKaq.js";import"./3iSoGi4ic-CS6W3O_2.js";import"./3iSoGi4ic-CdSqfJMx.js";import"./3iSoGi4ic-Dv7rS4og.js";const ne={class:"_spacer",style:{"--MI_SPACER-w":"800px"}},se={key:0},oe={key:0,class:"_margin"},le={class:"_margin"},ie={class:"_margin _gaps_s"},re={key:1,class:"_margin"},ue={style:{"font-weight":"bold",padding:"12px"}},de={class:"_gaps"},ce={key:1,class:"_margin"},Be=G({__name:"note",props:{noteId:{},initialTab:{}},setup(M){const k=!H&&ae($,"note")?$.note:null,o=M,e=m(k),x=m(),d=m(!1),c=m(!1),P=m(),A=w(new _("users/notes",{limit:10,initialId:o.noteId,computedParams:v(()=>e.value?{userId:e.value.userId}:void 0)})),E=w(new _("users/notes",{limit:10,initialId:o.noteId,initialDirection:"newer",computedParams:v(()=>e.value?{userId:e.value.userId}:void 0)})),R=w(new _("channels/timeline",{limit:10,initialId:o.noteId,computedParams:v(()=>e.value&&e.value.channelId!=null?{channelId:e.value.channelId}:void 0)})),D=w(new _("channels/timeline",{limit:10,initialId:o.noteId,initialDirection:"newer",computedParams:v(()=>e.value&&e.value.channelId!=null?{channelId:e.value.channelId}:void 0)}));function T(){if(d.value=!1,c.value=!1,e.value=null,k&&k.id===o.noteId){e.value=k;return}B("notes/show",{noteId:o.noteId}).then(l=>{e.value=l;const t=J(l)??l;((t.clippedCount??0)>0||new Date(t.createdAt).getTime()<new Date("2023-10-01").getTime())&&B("notes/clips",{noteId:t.id}).then(b=>{x.value=b})}).catch(l=>{["fbcc002d-37d9-4944-a6b0-d9e29f2d33ab","145f88d2-b03d-4087-8143-a78928883c4b"].includes(l.id)&&X({path:"/",message:l.id==="fbcc002d-37d9-4944-a6b0-d9e29f2d33ab"?"Set by the author to require login to view":"To continue, you need to move your server or sign up / log in to this server.",openOnRemote:{type:"lookup",url:`https://${Y}/notes/${o.noteId}`}}),P.value=l})}L(()=>o.noteId,T,{immediate:!0});const z=v(()=>[]),S=v(()=>[]);return W(()=>({title:"ملاحظة",...e.value?{subtitle:ee(e.value.createdAt),avatar:e.value.user,path:`/notes/${e.value.id}`,share:{title:(({user})=>("ملاحظات "+user))({user:e.value.user.name??e.value.user.username}),text:e.value.text}}:{}})),(l,t)=>{const b=y("MkError"),K=y("MkLoading"),O=y("PageWithHeader");return a(),i(O,{actions:z.value,tabs:S.value},{default:p(()=>[n("div",ne,[f(U,{name:h(q).s.animation?"fade":"",mode:"out-in"},{default:p(()=>[e.value?(a(),u("div",se,[c.value?(a(),u("div",oe,[f(N,{direction:"up",withControl:!1,pullToRefresh:!1,class:"",paginator:c.value==="channel"?h(D):h(E),noGap:!0,forceDisableInfiniteScroll:!0},null,8,["paginator"])])):r("",!0),n("div",le,[c.value?r("",!0):(a(),u("div",{key:0,class:"_buttons xsB03"},[e.value.channelId?(a(),i(C,{key:0,rounded:"",class:"xwuKp",onClick:t[0]||(t[0]=s=>c.value="channel")},{default:p(()=>[...t[6]||(t[6]=[n("i",{class:"ti ti-chevron-up"},null,-1),I(),n("i",{class:"ti ti-device-tv"},null,-1)])]),_:1},8,["class"])):r("",!0),f(C,{rounded:"",class:"xwuKp",onClick:t[1]||(t[1]=s=>c.value="user")},{default:p(()=>[...t[7]||(t[7]=[n("i",{class:"ti ti-chevron-up"},null,-1),I(),n("i",{class:"ti ti-user"},null,-1)])]),_:1},8,["class"])],2)),n("div",ie,[e.value.user.host!=null?(a(),i(Z,{key:0,href:e.value.url??e.value.uri},null,8,["href"])):r("",!0),(a(),i(Q,{key:e.value.id,note:e.value,"onUpdate:note":t[2]||(t[2]=s=>e.value=s),initialTab:M.initialTab,class:"x3kEw"},null,8,["note","initialTab","class"]))]),x.value&&x.value.length>0?(a(),u("div",re,[n("div",ue,V("مِشبك"),1),n("div",de,[(a(!0),u(j,null,F(x.value,s=>(a(),i(te,{key:s.id,clip:s},null,8,["clip"]))),128))])])):r("",!0),d.value?r("",!0):(a(),u("div",{key:2,class:"_buttons xjzB5"},[e.value.channelId?(a(),i(C,{key:0,rounded:"",class:"xwuKp",onClick:t[3]||(t[3]=s=>d.value="channel")},{default:p(()=>[...t[8]||(t[8]=[n("i",{class:"ti ti-chevron-down"},null,-1),I(),n("i",{class:"ti ti-device-tv"},null,-1)])]),_:1},8,["class"])):r("",!0),f(C,{rounded:"",class:"xwuKp",onClick:t[4]||(t[4]=s=>d.value="user")},{default:p(()=>[...t[9]||(t[9]=[n("i",{class:"ti ti-chevron-down"},null,-1),I(),n("i",{class:"ti ti-user"},null,-1)])]),_:1},8,["class"])],2))]),d.value?(a(),u("div",ce,[f(N,{withControl:!1,pullToRefresh:!1,class:"",paginator:d.value==="channel"?h(R):h(A),noGap:!0},null,8,["paginator"])])):r("",!0)])):P.value?(a(),i(b,{key:1,onRetry:t[5]||(t[5]=s=>T())})):(a(),i(K,{key:2}))]),_:1},8,["name"])])]),_:1},8,["actions","tabs"])}}});export{Be as default};
