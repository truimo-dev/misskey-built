import{M as T,a7 as V,al as $,R as B,ab as U,d3 as D,af as O,J as R,E as L,L as M,C as H}from"./3iSoGi4ic-DV-GuiCp.js";import{M as J}from"./3iSoGi4ic-Fx-BY70c.js";import{M as Y}from"./3iSoGi4ic-B70zSkp5.js";import{b as q,u as G,a as c,w as Q,c as X,f as A,i as f,a2 as Z,h as t,D as i,E as u,p as o,l as y,C as W,B as d,t as ee,F as le,A as ae}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const se={style:{display:"flex","flex-direction":"column","min-height":"100%"}},te={class:"_spacer",style:{"--MI_SPACER-min":"20px","--MI_SPACER-max":"28px","flex-grow":"1"}},oe={class:"_gaps_m"},ie=["src"],ne=["src"],ue=["src"],de=["src"],me={class:"_gaps"},re=["onClick"],Ce=q({__name:"emoji-edit-dialog",props:{emoji:{}},emits:["done","closed"],setup(x,{emit:_}){const a=x,k=_,p=G("windowEl"),g=c(a.emoji?a.emoji.name:""),C=c(a.emoji?.category?a.emoji.category:""),b=c(a.emoji?a.emoji.aliases.join(" "):""),w=c(a.emoji?.license?a.emoji.license:""),S=c(a.emoji?a.emoji.isSensitive:!1),I=c(a.emoji?a.emoji.localOnly:!1),h=c(a.emoji?a.emoji.roleIdsThatCanBeUsedThisEmojiAsReaction:[]),r=c([]),v=c();Q(h,async()=>{r.value=(await Promise.all(h.value.map(s=>R("admin/roles/show",{roleId:s}).catch(()=>null)))).filter(s=>s!=null)},{immediate:!0});const j=X(()=>v.value?v.value.url:a.emoji?a.emoji.url:null);async function N(s){v.value=await O({anchorElement:s.currentTarget??s.target,multiple:!1});const e=v.value.name.replace(/\.(.+)$/,"");e.match(/^[a-z0-9_]+$/)&&(g.value=e)}async function z(){const s=await R("admin/roles/list"),e=r.value.map(m=>m.id),{canceled:l,result:E}=await L({items:s.filter(m=>m.isPublic).filter(m=>!e.includes(m.id)).map(m=>({label:m.name,value:m.id}))});l||E==null||r.value.push(s.find(m=>m.id===E))}async function F(s,e){r.value=r.value.filter(l=>l.id!==s.id)}async function K(){const s={name:g.value,category:C.value===""?null:C.value,aliases:b.value.split(" ").filter(e=>e!==""),license:w.value===""?null:w.value,isSensitive:S.value,localOnly:I.value,roleIdsThatCanBeUsedThisEmojiAsReaction:r.value.map(e=>e.id),fileId:v.value?v.value.id:void 0};if(a.emoji)await M("admin/emoji/update",{id:a.emoji.id,...s}),k("done",{updated:{id:a.emoji.id,...s}}),p.value?.close();else{if(s.fileId==null)return;const e=await M("admin/emoji/add",{...s,fileId:s.fileId});k("done",{created:e}),p.value?.close()}}async function P(){if(!a.emoji)return;const{canceled:s}=await H({type:"warning",text:(({x})=>("متأكد من أنك تريد حذف "+x+"؟"))({x:g.value})});s||R("admin/emoji/delete",{id:a.emoji.id}).then(()=>{k("done",{deleted:!0}),p.value?.close()})}return(s,e)=>(f(),A(D,{ref_key:"windowEl",ref:p,initialWidth:400,initialHeight:500,canResize:!0,onClose:e[7]||(e[7]=l=>p.value?.close()),onClosed:e[8]||(e[8]=l=>k("closed"))},Z({default:t(()=>[o("div",se,[o("div",te,[o("div",oe,[j.value!=null?(f(),y("div",{key:0,class:"xmvNt"},[o("div",{style:{background:"#000"},class:"x6oTS"},[o("img",{src:j.value,class:"xsW1K"},null,10,ie)],2),o("div",{style:{background:"#222"},class:"x6oTS"},[o("img",{src:j.value,class:"xsW1K"},null,10,ne)],2),o("div",{style:{background:"#ddd"},class:"x6oTS"},[o("img",{src:j.value,class:"xsW1K"},null,10,ue)],2),o("div",{style:{background:"#fff"},class:"x6oTS"},[o("img",{src:j.value,class:"xsW1K"},null,10,de)],2)],2)):W("",!0),d(T,{rounded:"",style:{margin:"0 auto"},onClick:N},{default:t(()=>[i(u("اختر ملفًا"),1)]),_:1}),d(V,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),pattern:"[a-z0-9_]",autocapitalize:"off"},{label:t(()=>[i(u("الإسم"),1)]),_:1},8,["modelValue"]),d(V,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=l=>C.value=l),datalist:ee($).filter(l=>l!=null)},{label:t(()=>[i(u("الفئات"),1)]),_:1},8,["modelValue","datalist"]),d(V,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),autocapitalize:"off"},{label:t(()=>[i(u("الوسوم"),1)]),caption:t(()=>[i(u("This is the keyword when searching for custom emojis."),1),e[10]||(e[10]=o("br",null,null,-1)),i(" "+u("يمكنك ادخال أكثر من مدخل واحد وذلك بفصلها بمسافات."),1)]),_:1},8,["modelValue"]),d(V,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),mfmAutocomplete:!0},{label:t(()=>[i(u("الرخصة"),1)]),_:1},8,["modelValue"]),d(J,null,{label:t(()=>[i(u("الأدوار التي يُسمح لأصحابها استخدام هذا اإيموجي في اللتفاعل"),1)]),suffix:t(()=>[i(u(r.value.length===0?"الكل":r.value.length),1)]),default:t(()=>[o("div",me,[d(T,{rounded:"",onClick:z},{default:t(()=>[e[11]||(e[11]=o("i",{class:"ti ti-plus"},null,-1)),i(" "+u("إضافة"),1)]),_:1}),(f(!0),y(le,null,ae(r.value,l=>(f(),y("div",{key:l.id,class:"xeE9o"},[d(Y,{class:"x8mSB",role:l,forModeration:!0,detailed:!1,style:{"pointer-events":"none"}},null,8,["class","role"]),l.target==="manual"?(f(),y("button",{key:0,class:"_button xv2fs",onClick:E=>F(l,E)},[...e[12]||(e[12]=[o("i",{class:"ti ti-x"},null,-1)])],10,re)):(f(),y("button",{key:1,class:"_button xv2fs",disabled:""},[...e[13]||(e[13]=[o("i",{class:"ti ti-ban"},null,-1)])],2))],2))),128)),d(B,null,{default:t(()=>[i(u("إذا لم تحدد دورًا يمكن للجميع استخدام هذا الإيموجي في التفاعل."),1)]),_:1}),d(B,{warn:""},{default:t(()=>[i(u("يجب أن تكون الأدوار علنية."),1)]),_:1})])]),_:1}),d(U,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=l=>S.value=l)},{default:t(()=>[...e[14]||(e[14]=[i("isSensitive",-1)])]),_:1},8,["modelValue"]),d(U,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=l=>I.value=l)},{default:t(()=>[i(u("المحلي فقط"),1)]),_:1},8,["modelValue"]),x.emoji?(f(),A(T,{key:1,danger:"",onClick:e[6]||(e[6]=l=>P())},{default:t(()=>[e[15]||(e[15]=o("i",{class:"ti ti-trash"},null,-1)),i(" "+u("حذف"),1)]),_:1})):W("",!0)])]),o("div",{class:"xfu6x"},[d(T,{primary:"",rounded:"",style:{margin:"0 auto"},onClick:K},{default:t(()=>[e[16]||(e[16]=o("i",{class:"ti ti-check"},null,-1)),i(" "+u(a.emoji?"حدِّث":"أنشئ"),1)]),_:1})],2)])]),_:2},[x.emoji?{name:"header",fn:t(()=>[i(":"+u(x.emoji.name)+":",1)]),key:"0"}:{name:"header",fn:t(()=>[e[9]||(e[9]=i("New emoji",-1))]),key:"1"}]),1536))}});export{Ce as default};
