import{P as S,J,R as Z,dm as Q,M as g,d6 as W,$ as j,ad as U,C as X,L as N}from"./3iSoGi4ic-DV-GuiCp.js";import{M as Y}from"./3iSoGi4ic-CdSqfJMx.js";import{i18n as o}from"./3iSoGi4ic-Dty8GuTz.js";import{b as G,a as $,m as I,Z as tt,z as m,k as O,f as r,i as s,h as n,B as a,p as l,t as _,l as i,F as et,A as st,j as P,C as f,D as d,E as u}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-Dv7rS4og.js";const lt={class:"_spacer"},ot={class:"_gaps_s"},nt={key:0,class:"_nowrap"},it={key:1,class:"_nowrap"},at={key:2,class:"_nowrap"},rt={key:3,class:"_nowrap"},dt={key:4,class:"_nowrap"},ct=["title"],ut={key:0,class:"ti ti-world"},pt={key:1,class:"ti ti-home"},mt={key:2,class:"ti ti-lock"},ft={key:3,class:"ti ti-mail"},yt=["title"],Mt=G({__name:"MkNoteDraftsDialog",props:{scheduled:{type:Boolean}},emits:["restore","cancel","closed"],setup(T,{emit:V}){const q=T,v=V,k=$(q.scheduled?"scheduled":"drafts"),h=I(new S("notes/drafts/list",{limit:10,params:{scheduled:!1}})),C=I(new S("notes/drafts/list",{limit:10,params:{scheduled:!0}})),M=$(0);J("notes/drafts/count").then(c=>{M.value=c});const x=tt();function b(){v("cancel"),x.value?.close()}function E(c){v("restore",c),x.value?.close()}async function R(c){const{canceled:t}=await X({type:"warning",text:o.ts._drafts.deleteAreYouSure});t||N("notes/drafts/delete",{draftId:c.id}).then(()=>{h.reload()})}async function z(c){N("notes/drafts/update",{draftId:c.id,isActuallyScheduled:!1,scheduledAt:null}).then(()=>{C.reload()})}return(c,t)=>{const F=m("MkResult"),A=m("MkTime"),y=m("I18n"),w=m("Mfm"),D=m("MkAcct"),L=m("MkStickyContainer"),H=O("tooltip"),K=O("panel");return s(),r(U,{ref_key:"dialogEl",ref:x,width:600,height:650,withOkButton:!1,onClick:t[1]||(t[1]=p=>b()),onClose:t[2]||(t[2]=p=>b()),onClosed:t[3]||(t[3]=p=>v("closed")),onEsc:t[4]||(t[4]=p=>b())},{header:n(()=>[d(u(o.ts.draftsAndScheduledNotes)+" ("+u(M.value)+"/"+u(_(j)?.policies.noteDraftLimit)+") ",1)]),default:n(()=>[a(L,null,{header:n(()=>[a(W,{tab:k.value,"onUpdate:tab":t[0]||(t[0]=p=>k.value=p),centered:"",class:"x52Vh",tabs:[{key:"drafts",title:o.ts.drafts,icon:"ti ti-pencil-question"},{key:"scheduled",title:o.ts.scheduled,icon:"ti ti-calendar-clock"}]},null,8,["tab","class","tabs"])]),default:n(()=>[l("div",lt,[(s(),r(Y,{key:k.value,paginator:k.value==="scheduled"?_(C):_(h),withControl:""},{empty:n(()=>[a(F,{type:"empty",text:o.ts._drafts.noDrafts},null,8,["text"])]),default:n(({items:p})=>[l("div",ot,[(s(!0),i(et,null,st(p,e=>P((s(),i("div",{key:e.id,class:"x9zJP"},[l("div",{class:"xBb7H _gaps_s"},[e.scheduledAt!=null&&e.isActuallyScheduled?(s(),r(Z,{key:0},{default:n(()=>[a(y,{src:o.ts.scheduledToPostOnX,tag:"span"},{x:n(()=>[a(A,{time:e.scheduledAt,mode:"detail",style:{"font-weight":"bold"}},null,8,["time"])]),_:2},1032,["src"])]),_:2},1024)):f("",!0),l("div",{class:"xEtHO"},[l("div",{class:"xcDLm"},[e.reply?(s(),i("div",nt,[t[5]||(t[5]=l("i",{class:"ti ti-arrow-back-up"},null,-1)),t[6]||(t[6]=d()),a(y,{src:o.ts._drafts.replyTo,tag:"span"},{user:n(()=>[e.reply.user.name!=null?(s(),r(w,{key:0,text:e.reply.user.name,plain:!0,nowrap:!0},null,8,["text"])):(s(),r(D,{key:1,user:e.reply.user},null,8,["user"]))]),_:2},1032,["src"])])):e.replyId?(s(),i("div",it,[t[7]||(t[7]=l("i",{class:"ti ti-arrow-back-up"},null,-1)),t[8]||(t[8]=d()),a(y,{src:o.ts._drafts.replyTo,tag:"span"},{user:n(()=>[d(u(o.ts.deletedNote),1)]),_:1},8,["src"])])):f("",!0),e.renote&&e.text!=null?(s(),i("div",at,[t[9]||(t[9]=l("i",{class:"ti ti-quote"},null,-1)),t[10]||(t[10]=d()),a(y,{src:o.ts._drafts.quoteOf,tag:"span"},{user:n(()=>[e.renote.user.name!=null?(s(),r(w,{key:0,text:e.renote.user.name,plain:!0,nowrap:!0},null,8,["text"])):(s(),r(D,{key:1,user:e.renote.user},null,8,["user"]))]),_:2},1032,["src"])])):e.renoteId?(s(),i("div",rt,[t[11]||(t[11]=l("i",{class:"ti ti-quote"},null,-1)),t[12]||(t[12]=d()),a(y,{src:o.ts._drafts.quoteOf,tag:"span"},{user:n(()=>[d(u(o.ts.deletedNote),1)]),_:1},8,["src"])])):f("",!0),e.channel?(s(),i("div",dt,[t[13]||(t[13]=l("i",{class:"ti ti-device-tv"},null,-1)),d(" "+u(o.tsx._drafts.postTo({channel:e.channel.name})),1)])):f("",!0)],2)],2),l("div",{class:"xacZw"},[a(w,{text:_(Q)(e,{showRenote:!1,showReply:!1}),plain:!0,author:e.user},null,8,["text","author"])],2),l("div",{class:"xyzyK"},[l("div",{class:"xmfKi"},[l("span",{title:o.ts._visibility[e.visibility]},[e.visibility==="public"?(s(),i("i",ut)):e.visibility==="home"?(s(),i("i",pt)):e.visibility==="followers"?(s(),i("i",mt)):e.visibility==="specified"?(s(),i("i",ft)):f("",!0)],8,ct),e.localOnly?(s(),i("span",{key:0,title:o.ts._visibility.disableFederation},[...t[14]||(t[14]=[l("i",{class:"ti ti-rocket-off"},null,-1)])],8,yt)):f("",!0)],2),a(A,{time:e.createdAt,class:"xpq6f",mode:"detail",colored:""},null,8,["time","class"])],2)],2),l("div",{class:"x7Q1b _buttons"},[e.scheduledAt!=null&&e.isActuallyScheduled?(s(),r(g,{key:0,class:"",small:"",onClick:B=>z(e)},{default:n(()=>[t[15]||(t[15]=l("i",{class:"ti ti-calendar-x"},null,-1)),d(" "+u(o.ts._drafts.cancelSchedule),1)]),_:1},8,["class","onClick"])):(s(),r(g,{key:1,class:"",small:"",onClick:B=>E(e)},{default:n(()=>[t[16]||(t[16]=l("i",{class:"ti ti-corner-up-left"},null,-1)),d(" "+u(o.ts._drafts.restore),1)]),_:1},8,["class","onClick"])),P((s(),r(g,{danger:"",small:"",iconOnly:!0,class:"",style:{"margin-left":"auto"},onClick:B=>R(e)},{default:n(()=>[...t[17]||(t[17]=[l("i",{class:"ti ti-trash"},null,-1)])]),_:1},8,["class","onClick"])),[[H,o.ts._drafts.delete]])],2)],2)),[[K]])),128))])]),_:1},8,["paginator"]))])]),_:1})]),_:1},512)}}});export{Mt as default};
