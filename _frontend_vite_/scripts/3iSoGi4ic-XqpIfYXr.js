import{ai as q,aj as ve,ak as Ce,b as te,U as W,al as Pe,am as Q,an as $e,ao as Me,ap as ze,$ as Se,Z as Te,aq as Be,ar as De,as as Re,at as Ue,au as me,_ as Ne,a5 as _e}from"./3iSoGi4ic-DV-GuiCp.js";import{b as ie,c as P,a as V,z as G,k as he,j as se,l as u,i as o,p as r,C as I,D as w,x as fe,g as B,E as U,F as D,A as R,f as E,t as F,h as J,u as X,w as Ie,e as Ae,q as Oe,B as oe,a7 as Z,s as He}from"./3iSoGi4ic-D0mTJ0Mu.js";import{i18n as _}from"./3iSoGi4ic-Dty8GuTz.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";function We(c,$,p){if(typeof p=="string"||"char"in p)return!0;const b=p.roleIdsThatCanBeUsedThisEmojiAsReaction??[];return!(p.localOnly&&$.user.host!==c.host)&&!(p.isSensitive&&($.reactionAcceptance==="nonSensitiveOnly"||$.reactionAcceptance==="nonSensitiveOnlyForLocalLikeOnlyForRemote"))&&(b.length===0||c.roles.some(k=>b.includes(k.id)))}const Fe={key:0,style:{"border-radius":"6px","border-bottom":"0.5px solid var(--MI_THEME-divider)"}},Le={key:0,class:"body"},Ve=["data-emoji","disabled","onClick"],Ke={key:1,style:{"border-radius":"6px","border-bottom":"0.5px solid var(--MI_THEME-divider)"}},Qe={key:0,style:{"padding-left":"9px"}},Ze={key:1,class:"body"},qe=["data-emoji","disabled","onClick"],ne=ie({__name:"MkEmojiPicker.section",props:{emojis:{},disabledEmojis:{},initialShown:{type:Boolean},hasChildSection:{type:Boolean},customEmojiTree:{}},emits:["chosen"],setup(c,{emit:$}){const p=c,b=$,k=P(()=>Array.isArray(p.emojis)?p.emojis:p.emojis.value),f=V(!!p.initialShown);function N(x){const n=x.target,y=n.dataset.emoji;n.title=ve(y)}function M(x,n){b("chosen",x,n)}return(x,n)=>{const y=G("MkCustomEmoji"),A=G("MkEmoji"),L=he("panel");return c.hasChildSection?se((o(),u("section",Ke,[r("header",{class:"_acrylic",onClick:n[1]||(n[1]=d=>f.value=!f.value)},[r("i",{class:B(["toggle ti-fw",f.value?"ti ti-chevron-down":"ti ti-chevron-up"])},null,2),n[5]||(n[5]=w()),fe(x.$slots,"default"),n[6]||(n[6]=w(" (",-1)),n[7]||(n[7]=r("i",{class:"ti ti-folder ti-fw"},null,-1)),w(":"+U(c.customEmojiTree?.length)+" ",1),n[8]||(n[8]=r("i",{class:"ti ti-icons ti-fw"},null,-1)),w(":"+U(k.value.length)+") ",1)]),f.value?(o(),u("div",Qe,[(o(!0),u(D,null,R(c.customEmojiTree,d=>(o(),E(ne,{key:`custom:${d.value}`,initialShown:c.initialShown,emojis:P(()=>F(q).filter(j=>j.category===d.category).map(j=>`:${j.name}:`)),hasChildSection:d.children.length!==0,customEmojiTree:d.children,onChosen:M},{default:J(()=>[w(U(d.value||_.ts.other),1)]),_:2},1032,["initialShown","emojis","hasChildSection","customEmojiTree"]))),128))])):I("",!0),f.value?(o(),u("div",Ze,[(o(!0),u(D,null,R(k.value,d=>(o(),u("button",{key:d,"data-emoji":d,class:"_button item",disabled:c.disabledEmojis?.value.includes(d),onPointerenter:N,onClick:j=>b("chosen",d,j)},[d[0]===":"?(o(),E(y,{key:0,class:"emoji",name:d,normal:!0},null,8,["name"])):(o(),E(A,{key:1,class:"emoji",emoji:d,normal:!0},null,8,["emoji"]))],40,qe))),128))])):I("",!0)])),[[L]]):se((o(),u("section",Fe,[r("header",{class:"_acrylic",onClick:n[0]||(n[0]=d=>f.value=!f.value)},[r("i",{class:B(["toggle ti-fw",f.value?"ti ti-chevron-down":"ti ti-chevron-up"])},null,2),n[2]||(n[2]=w()),fe(x.$slots,"default"),n[3]||(n[3]=w(" (",-1)),n[4]||(n[4]=r("i",{class:"ti ti-icons"},null,-1)),w(":"+U(k.value.length)+") ",1)]),f.value?(o(),u("div",Le,[(o(!0),u(D,null,R(k.value,d=>(o(),u("button",{key:d,"data-emoji":d,class:"_button item",disabled:c.disabledEmojis?.value.includes(d),onPointerenter:N,onClick:j=>b("chosen",d,j)},[d[0]===":"?(o(),E(y,{key:0,class:"emoji",name:d,normal:!0,fallbackToImage:!0},null,8,["name"])):(o(),E(A,{key:1,class:"emoji",emoji:d,normal:!0},null,8,["emoji"]))],40,Ve))),128))])):I("",!0)])),[[L]])}}}),Ge=["value","placeholder"],Je={class:"result"},Xe={key:0,class:"body"},Ye=["disabled","title","onClick"],et={key:1,class:"body"},tt=["title","onClick"],st={key:0,class:"group index"},ot={key:0},nt={class:"body"},it=["data-emoji","disabled","onClick"],at={class:"_acrylic"},lt={class:"body"},rt=["disabled","data-emoji","onClick"],ut={class:"_acrylic"},ct={class:"_acrylic"},dt={class:"tabs"},mt=ie({__name:"MkEmojiPicker",props:{showPinned:{type:Boolean,default:!0},pinnedEmojis:{},maxHeight:{},asDrawer:{type:Boolean},asWindow:{type:Boolean},asReactionPicker:{type:Boolean},targetNote:{}},emits:["chosen","esc"],setup(c,{expose:$,emit:p}){const b=Ce(),k=c,f=p,N=X("searchEl"),M=X("emojisEl"),{emojiPickerScale:x,emojiPickerWidth:n,emojiPickerHeight:y}=te.r,A=W.r.recentlyUsedEmojis,L=P(()=>A.value.map(ue)),d=P(()=>j.value?.map(ue)),j=P(()=>k.pinnedEmojis),ke=P(()=>x.value),pe=P(()=>n.value),ye=P(()=>y.value),z=V(""),O=V([]),H=V([]),S=V("index"),Y={value:"",category:"",children:[]};function ae(t,s){const h=t.split("/").map(a=>a.trim());let v=s;for(const a of h){let e=v.children.find(l=>l.value===a);if(!e){const l={value:a,category:t,children:[]};v.children.push(l),e=l}v=e}return v}Pe.value.forEach(t=>{t!==null&&ae(t,Y)}),ae("",Y),Ie(z,()=>{if(M.value&&(M.value.scrollTop=0),z.value===""){O.value=[],H.value=[];return}const t=z.value.replace(/:/g,"").toLowerCase(),s=()=>{const a=q.value,e=new Set,l=a.find(i=>i.name===t);if(l&&e.add(l),t.includes(" ")){const i=t.split(" ");for(const m of a)if(i.every(g=>m.name.includes(g))&&(e.add(m),e.size>=100))break;if(e.size>=100)return e;for(const m of a)if(i.every(g=>m.name.includes(g)||m.aliases.some(ee=>ee.includes(g)))&&(e.add(m),e.size>=100))break}else{if(Q.has(t)&&e.add(Q.get(t)),e.size>=100)return e;for(const i of a)if(i.aliases.some(m=>m===t)&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of a)if(i.name.startsWith(t)&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of a)if(i.aliases.some(m=>m.startsWith(t))&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of a)if(i.name.includes(t)&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of a)if(i.aliases.some(m=>m.includes(t))&&(e.add(i),e.size>=100))break}return e},h=()=>{const a=me,e=new Set,l=a.find(i=>i.name===t);if(l&&e.add(l),t.includes(" ")){const i=t.split(" ");for(const m of a)if(i.every(g=>m.name.includes(g))&&(e.add(m),e.size>=100))break;if(e.size>=100)return e;for(const m of Object.values(W.s.additionalUnicodeEmojiIndexes))for(const g of a)if(i.every(ee=>m[g.char]?.some(we=>we.includes(ee)))&&(e.add(g),e.size>=100))break}else{for(const i of a)if(i.name.startsWith(t)&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of Object.values(W.s.additionalUnicodeEmojiIndexes))for(const m of a)if(i[m.char]?.some(g=>g.startsWith(t))&&(e.add(m),e.size>=100))break;for(const i of a)if(i.name.includes(t)&&(e.add(i),e.size>=100))break;if(e.size>=100)return e;for(const i of Object.values(W.s.additionalUnicodeEmojiIndexes))for(const m of a)if(i[m.char]?.some(g=>g.includes(t))&&(e.add(m),e.size>=100))break}return e};O.value=Array.from(s()),H.value=Array.from(h())});function K(t){return!k.targetNote||We(Se,k.targetNote,t)}function le(t,s){return s===""?t.category==="null"||!t.category:t.category===s}function re(){!["smartphone","tablet"].includes(Te)&&!Be&&N.value?.focus({preventScroll:!0})}function ge(){M.value&&(M.value.scrollTop=0),z.value=""}function T(t){return typeof t=="string"?t:"char"in t?t.char:`:${t.name}:`}function ue(t){if(t.includes(":")){const s=t.replaceAll(":","");return Q.get(s)??t}else return $e(t)}function ce(t){const s=t.target,h=s.dataset.emoji;s.title=ve(h)}function C(t,s){const h=s&&(s.currentTarget??s.target);if(h&&te.s.animation){const a=h.getBoundingClientRect(),e=a.left+h.offsetWidth/2,l=a.top+h.offsetHeight/2,{dispose:i}=De(Re,{x:e,y:l},{end:()=>i()})}const v=T(t);if(f("chosen",v),Ue(),!j.value?.includes(v)){let a=W.s.recentlyUsedEmojis;a=a.filter(e=>e!==v),a.unshift(v),W.set("recentlyUsedEmojis",a.splice(0,32))}}function be(){z.value=N.value?.value.trim()??""}function je(t){const s=t.clipboardData?.getData("text")??"";de(s)&&t.preventDefault()}function Ee(t){t.isComposing||t.key==="Process"||t.keyCode===229||(t.key==="Enter"&&(t.preventDefault(),t.stopPropagation(),de()),t.key==="Escape"&&(t.preventDefault(),t.stopPropagation(),f("esc")))}function de(t){if(t==null&&(t=z.value),t==null||typeof t!="string")return;const s=t.replace(/:/g,""),h=Q.get(s);if(h)return C(h),!0;const v=me.find(a=>a.char===s||a.name===s);if(v)return C(v),!0;if(O.value.length>0)return C(O.value[0]),!0;if(H.value.length>0)return C(H.value[0]),!0}function xe(){f("esc"),b.push("/settings/emoji-palette")}return Ae(()=>{re()}),$({focus:re,reset:ge}),(t,s)=>{const h=G("MkCustomEmoji"),v=G("MkEmoji"),a=he("tooltip");return o(),u("div",{class:B(["omfetrab",["s"+ke.value,"w"+pe.value,"h"+ye.value,{asDrawer:c.asDrawer,asWindow:c.asWindow}]]),style:He({maxHeight:c.maxHeight?c.maxHeight+"px":void 0})},[r("input",{ref_key:"searchEl",ref:N,value:z.value,class:B(["search",{filled:z.value!=null&&z.value!=""}]),"data-prevent-emoji-insert":"",placeholder:_.ts.search,type:"search",autocapitalize:"off",onInput:s[0]||(s[0]=e=>be()),onPaste:Oe(je,["stop"]),onKeydown:Ee},null,42,Ge),r("div",{ref_key:"emojisEl",ref:M,class:"emojis",tabindex:"-1"},[r("section",Je,[O.value.length>0?(o(),u("div",Xe,[(o(!0),u(D,null,R(O.value,e=>(o(),u("button",{key:e.name,class:"_button item",disabled:!K(e),title:e.name,tabindex:"0",onClick:l=>C(e,l)},[oe(h,{class:"emoji",name:e.name,fallbackToImage:!0},null,8,["name"])],8,Ye))),128))])):I("",!0),H.value.length>0?(o(),u("div",et,[(o(!0),u(D,null,R(H.value,e=>(o(),u("button",{key:e.name,class:"_button item",title:e.name,tabindex:"0",onClick:l=>C(e,l)},[oe(v,{class:"emoji",emoji:e.char},null,8,["emoji"])],8,tt))),128))])):I("",!0)]),S.value==="index"?(o(),u("div",st,[c.showPinned&&j.value&&j.value.length>0?(o(),u("section",ot,[r("div",nt,[(o(!0),u(D,null,R(d.value,e=>(o(),u("button",{key:T(e),"data-emoji":T(e),class:"_button item",disabled:!K(e),tabindex:"0",onPointerenter:ce,onClick:l=>C(e,l)},[e.hasOwnProperty("char")?(o(),E(v,{key:1,class:"emoji",emoji:T(e),normal:!0},null,8,["emoji"])):(o(),E(h,{key:0,class:"emoji",name:T(e),normal:!0},null,8,["name"]))],40,it))),128)),se((o(),u("button",{class:"_button config",onClick:xe},[...s[7]||(s[7]=[r("i",{class:"ti ti-settings"},null,-1)])])),[[a,_.ts.settings]])])])):I("",!0),r("section",null,[r("header",at,[s[8]||(s[8]=r("i",{class:"ti ti-clock ti-fw"},null,-1)),w(" "+U(_.ts.recentUsed),1)]),r("div",lt,[(o(!0),u(D,null,R(L.value,e=>(o(),u("button",{key:T(e),class:"_button item",disabled:!K(e),"data-emoji":T(e),onPointerenter:ce,onClick:l=>C(e,l)},[e.hasOwnProperty("char")?(o(),E(v,{key:1,class:"emoji",emoji:T(e),normal:!0},null,8,["emoji"])):(o(),E(h,{key:0,class:"emoji",name:T(e),normal:!0},null,8,["name"]))],40,rt))),128))])])])):I("",!0),s[1]||(Z(-1,!0),(s[1]=r("div",{class:"group"},[r("header",ut,U(_.ts.customEmojis),1),(o(!0),u(D,null,R(Y.children,e=>(o(),E(ne,{key:`custom:${e.value}`,initialShown:!1,emojis:P(()=>F(q).filter(l=>le(l,e.value)).map(l=>`:${l.name}:`)),disabledEmojis:P(()=>F(q).filter(l=>le(l,e.value)).filter(l=>!K(l)).map(l=>`:${l.name}:`)),hasChildSection:e.children.length!==0,customEmojiTree:e.children,onChosen:C},{default:J(()=>[w(U(e.value||_.ts.other),1)]),_:2},1032,["emojis","disabledEmojis","hasChildSection","customEmojiTree"]))),128))])).cacheIndex=1,Z(1),s[1]),s[2]||(Z(-1,!0),(s[2]=r("div",{class:"group"},[r("header",ct,U(_.ts.emoji),1),(o(!0),u(D,null,R(F(ze),e=>(o(),E(ne,{key:e,emojis:F(Me).get(e)??[],hasChildSection:!1,onChosen:C},{default:J(()=>[w(U(e),1)]),_:2},1032,["emojis"]))),128))])).cacheIndex=2,Z(1),s[2])],512),r("div",dt,[r("button",{class:B(["_button tab",{active:S.value==="index"}]),onClick:s[3]||(s[3]=e=>S.value="index")},[...s[9]||(s[9]=[r("i",{class:"ti ti-asterisk ti-fw"},null,-1)])],2),r("button",{class:B(["_button tab",{active:S.value==="custom"}]),onClick:s[4]||(s[4]=e=>S.value="custom")},[...s[10]||(s[10]=[r("i",{class:"ti ti-mood-happy ti-fw"},null,-1)])],2),r("button",{class:B(["_button tab",{active:S.value==="unicode"}]),onClick:s[5]||(s[5]=e=>S.value="unicode")},[...s[11]||(s[11]=[r("i",{class:"ti ti-leaf ti-fw"},null,-1)])],2),r("button",{class:B(["_button tab",{active:S.value==="tags"}]),onClick:s[6]||(s[6]=e=>S.value="tags")},[...s[12]||(s[12]=[r("i",{class:"ti ti-hash ti-fw"},null,-1)])],2)])],6)}}}),ft=Ne(mt,[["__scopeId","data-v-9c0f08d3"]]),gt=ie({__name:"MkEmojiPickerDialog",props:{manualShowing:{type:[Boolean,null],default:null},anchorElement:{},showPinned:{type:Boolean,default:!0},pinnedEmojis:{default:void 0},asReactionPicker:{type:Boolean,default:!1},targetNote:{},choseAndClose:{type:Boolean,default:!0}},emits:["done","close","closed"],setup(c,{emit:$}){const p=c,b=$,k=X("modal"),f=X("picker");function N(x){b("done",x),p.choseAndClose&&k.value?.close()}function M(){f.value?.reset(),f.value?.focus(),window.setTimeout(()=>{f.value?.focus()},10)}return(x,n)=>(o(),E(_e,{ref_key:"modal",ref:k,zPriority:"middle",preferType:F(te).s.emojiPickerStyle,hasInteractionWithOtherFocusTrappedEls:!0,transparentBg:!0,manualShowing:c.manualShowing,anchorElement:c.anchorElement,onClick:n[1]||(n[1]=y=>k.value?.close()),onEsc:n[2]||(n[2]=y=>k.value?.close()),onOpening:M,onClose:n[3]||(n[3]=y=>b("close")),onClosed:n[4]||(n[4]=y=>b("closed"))},{default:J(({type:y,maxHeight:A})=>[oe(ft,{ref_key:"picker",ref:f,class:B(["_popup _shadow",{xwooH:y==="drawer"}]),showPinned:c.showPinned,pinnedEmojis:c.pinnedEmojis,asReactionPicker:c.asReactionPicker,targetNote:c.targetNote,asDrawer:y==="drawer","max-height":A,onChosen:N,onEsc:n[0]||(n[0]=L=>k.value?.close())},null,8,["class","showPinned","pinnedEmojis","asReactionPicker","targetNote","asDrawer","max-height"])]),_:1},8,["preferType","manualShowing","anchorElement"]))}});export{gt as default};
