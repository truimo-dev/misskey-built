import{i as h,J as S,U as V,$ as w,a7 as A,ad as Q}from"./3iSoGi4ic-DV-GuiCp.js";import{b as P}from"./3iSoGi4ic-B1GPmOGN.js";import{F as Y}from"./3iSoGi4ic-D8X1N6Gw.js";import{b as z,c as H,a as p,u as W,e as Z,z as D,f as $,i as t,h as a,p as v,l as u,C as I,g,D as i,E as x,t as _,B as r,F as L,A as R}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-D98_HDRS.js";const J=["onClick"],j=["onClick"],ae=z({__name:"MkUserSelectDialog",props:{includeSelf:{type:Boolean,default:!1},localOnly:{type:Boolean,default:!1}},emits:["ok","cancel","closed"],setup(O,{emit:T}){const k=T,y=O,B=H(()=>y.localOnly||h.federation==="none"),n=p(""),d=p(""),m=p([]),N=p([]),l=p(null),U=W("dialogEl");function C(){if(n.value===""&&d.value===""){m.value=[];return}S("users/search-by-username-and-host",{username:n.value,host:B.value?".":d.value,limit:10,detail:!1}).then(c=>{m.value=c.filter(e=>y.includeSelf?!0:e.id!==w?.id)})}async function b(){if(l.value==null)return;const c=await S("users/show",{userId:l.value.id});k("ok",c),U.value?.close();let e=V.s.recentlyUsedUsers;e=e.filter(o=>o!==l.value?.id),e.unshift(l.value.id),V.set("recentlyUsedUsers",e.splice(0,16))}function E(){k("cancel"),U.value?.close()}return Z(()=>{S("users/show",{userIds:V.s.recentlyUsedUsers}).then(c=>{let e=c;e=e.filter(o=>B.value?o.host==null:!0),e=e.filter(o=>y.includeSelf?!0:o.id!==w?.id),N.value=e})}),(c,e)=>{const o=D("MkAvatar"),F=D("MkUserName"),q=D("MkAcct");return t(),$(Q,{ref_key:"dialogEl",ref:U,withOkButton:!0,okButtonDisabled:l.value==null,onClick:e[5]||(e[5]=s=>E()),onClose:e[6]||(e[6]=s=>E()),onOk:e[7]||(e[7]=s=>b()),onClosed:e[8]||(e[8]=s=>k("closed"))},{header:a(()=>[i(x("选择用户"),1)]),default:a(()=>[v("div",null,[v("div",{class:"xu4Mf"},[B.value?(t(),$(A,{key:0,modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>n.value=s),C],autofocus:!0},{label:a(()=>[i(x("用户名"),1)]),prefix:a(()=>[...e[9]||(e[9]=[i("@",-1)])]),_:1},8,["modelValue"])):(t(),$(Y,{key:1,minWidth:170},{default:a(()=>[r(A,{modelValue:n.value,"onUpdate:modelValue":[e[1]||(e[1]=s=>n.value=s),C],autofocus:!0},{label:a(()=>[i(x("用户名"),1)]),prefix:a(()=>[...e[10]||(e[10]=[i("@",-1)])]),_:1},8,["modelValue"]),r(A,{modelValue:d.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>d.value=s),C],datalist:[_(P)]},{label:a(()=>[i(x("主机名"),1)]),prefix:a(()=>[...e[11]||(e[11]=[i("@",-1)])]),_:1},8,["modelValue","datalist"])]),_:1}))],2),n.value!=""||d.value!=""?(t(),u("div",{key:0,class:g(["xdLBZ",{x4RNE:m.value.length>0}])},[m.value.length>0?(t(),u("div",{key:0,class:"xA2h8"},[(t(!0),u(L,null,R(m.value,s=>(t(),u("div",{key:s.id,class:g(["_button",["x7FR4",{xCY0B:l.value&&l.value.id===s.id}]]),onClick:M=>l.value=s,onDblclick:e[3]||(e[3]=M=>b())},[r(o,{user:s,class:"xp6IS",indicator:""},null,8,["user","class"]),v("div",{class:"xlcTD"},[r(F,{user:s,class:"xb67P"},null,8,["user","class"]),r(q,{user:s,class:"xSqlq"},null,8,["user","class"])],2)],42,J))),128))],2)):(t(),u("div",{key:1,class:"x8QHa"},[v("span",null,x("无用户"),1)],2))],2)):I("",!0),n.value==""&&d.value==""?(t(),u("div",{key:1,class:"x5L9Q"},[v("div",{class:"xA2h8"},[(t(!0),u(L,null,R(N.value,s=>(t(),u("div",{key:s.id,class:g(["_button",["x7FR4",{xCY0B:l.value&&l.value.id===s.id}]]),onClick:M=>l.value=s,onDblclick:e[4]||(e[4]=M=>b())},[r(o,{user:s,class:"xp6IS",indicator:""},null,8,["user","class"]),v("div",{class:"xlcTD"},[r(F,{user:s,class:"xb67P"},null,8,["user","class"]),r(q,{user:s,class:"xSqlq"},null,8,["user","class"])],2)],42,j))),128))],2)],2)):I("",!0)])]),_:1},8,["okButtonDisabled"])}}});export{ae as default};
