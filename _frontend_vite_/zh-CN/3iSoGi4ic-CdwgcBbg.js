import{u as Q}from"./3iSoGi4ic-DCTAa4Sx.js";import{aH as W,b as q,be as A,j as w,l as B,bf as L,_ as V}from"./3iSoGi4ic-DV-GuiCp.js";import{k as a}from"./3iSoGi4ic-DbGnjMgs.js";import{b as E,r as y,a as _,o as I,l as m,i as f,p as t,D as k,C as S,g as d,E as l,t as s}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";const J={class:"inbox"},z={class:"label"},h={key:0,class:"ti ti-alert-triangle icon"},F={class:"values"},H=["title"],M=["title"],U=["title"],G=["title"],K={class:"deliver"},O={class:"label"},R={key:0,class:"ti ti-alert-triangle icon"},X={class:"values"},Y=["title"],Z=["title"],ee=["title"],ie=["title"],P="jobQueue",te=E({__name:"WidgetJobQueue",props:{widget:{}},emits:["updateProps"],setup(T,{expose:$,emit:j}){const C={transparent:{type:"boolean",default:!1},sound:{type:"boolean",default:!1}},c=T,D=j,{widgetProps:p,configure:N}=Q(P,C,c,D),v=W().useChannel("queueStats"),e=y({inbox:{activeSincePrevTick:0,active:0,waiting:0,delayed:0},deliver:{activeSincePrevTick:0,active:0,waiting:0,delayed:0}}),n=y({}),r=_(null),u=_(!1);q.s["sound.masterVolume"]&&A("/client-assets/sounds/syuilo/queue-jammed.mp3").then(o=>{if(!o)throw new Error("[WidgetJobQueue] Failed to initialize AudioBuffer");r.value=o});for(const o of["inbox","deliver"])n[o]=w(e[o]);const g=o=>{for(const i of["inbox","deliver"])if(n[i]=w(e[i]),e[i].activeSincePrevTick=o[i].activeSincePrevTick,e[i].active=o[i].active,e[i].waiting=o[i].waiting,e[i].delayed=o[i].delayed,e[i].waiting>0&&p.sound&&r.value&&!u.value){const b=L(r.value,{}).soundSource;b&&(u.value=!0,b.onended=()=>u.value=!1,b.start())}},x=o=>{for(const i of[...o].reverse())g(i)};return v.on("stats",g),v.on("statsLog",x),v.send("requestLog",{id:B(),length:1}),I(()=>{v.off("stats",g),v.off("statsLog",x),v.dispose()}),$({name:P,configure:N,id:c.widget?c.widget.id:null}),(o,i)=>(f(),m("div",{"data-cy-mkw-jobQueue":"",class:d(["mkw-jobQueue _monospace",{_panel:!s(p).transparent}])},[t("div",J,[t("div",z,[i[0]||(i[0]=k("Inbox queue",-1)),e.inbox.waiting>0?(f(),m("i",h)):S("",!0)]),t("div",F,[t("div",null,[i[1]||(i[1]=t("div",null,"Process",-1)),t("div",{class:d({inc:e.inbox.activeSincePrevTick>n.inbox.activeSincePrevTick,dec:e.inbox.activeSincePrevTick<n.inbox.activeSincePrevTick}),title:`${e.inbox.activeSincePrevTick}`},l(s(a)(e.inbox.activeSincePrevTick,2)),11,H)]),t("div",null,[i[2]||(i[2]=t("div",null,"Active",-1)),t("div",{class:d({inc:e.inbox.active>n.inbox.active,dec:e.inbox.active<n.inbox.active}),title:`${e.inbox.active}`},l(s(a)(e.inbox.active,2)),11,M)]),t("div",null,[i[3]||(i[3]=t("div",null,"Delayed",-1)),t("div",{class:d({inc:e.inbox.delayed>n.inbox.delayed,dec:e.inbox.delayed<n.inbox.delayed}),title:`${e.inbox.delayed}`},l(s(a)(e.inbox.delayed,2)),11,U)]),t("div",null,[i[4]||(i[4]=t("div",null,"Waiting",-1)),t("div",{class:d({inc:e.inbox.waiting>n.inbox.waiting,dec:e.inbox.waiting<n.inbox.waiting}),title:`${e.inbox.waiting}`},l(s(a)(e.inbox.waiting,2)),11,G)])])]),t("div",K,[t("div",O,[i[5]||(i[5]=k("Deliver queue",-1)),e.deliver.waiting>0?(f(),m("i",R)):S("",!0)]),t("div",X,[t("div",null,[i[6]||(i[6]=t("div",null,"Process",-1)),t("div",{class:d({inc:e.deliver.activeSincePrevTick>n.deliver.activeSincePrevTick,dec:e.deliver.activeSincePrevTick<n.deliver.activeSincePrevTick}),title:`${e.deliver.activeSincePrevTick}`},l(s(a)(e.deliver.activeSincePrevTick,2)),11,Y)]),t("div",null,[i[7]||(i[7]=t("div",null,"Active",-1)),t("div",{class:d({inc:e.deliver.active>n.deliver.active,dec:e.deliver.active<n.deliver.active}),title:`${e.deliver.active}`},l(s(a)(e.deliver.active,2)),11,Z)]),t("div",null,[i[8]||(i[8]=t("div",null,"Delayed",-1)),t("div",{class:d({inc:e.deliver.delayed>n.deliver.delayed,dec:e.deliver.delayed<n.deliver.delayed}),title:`${e.deliver.delayed}`},l(s(a)(e.deliver.delayed,2)),11,ee)]),t("div",null,[i[9]||(i[9]=t("div",null,"Waiting",-1)),t("div",{class:d({inc:e.deliver.waiting>n.deliver.waiting,dec:e.deliver.waiting<n.deliver.waiting}),title:`${e.deliver.waiting}`},l(s(a)(e.deliver.waiting,2)),11,ie)])])])],2))}}),ce=V(te,[["__scopeId","data-v-1891e95a"]]);export{ce as default};
