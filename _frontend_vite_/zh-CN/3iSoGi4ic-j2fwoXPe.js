import{b as ae,u as V,a as u,c as h,e as oe,M as se,o as ne,z as le,f as C,i as c,h as o,p as t,g as de,B as m,T as ie,l as $,C as x,t as H,E as s,s as O,D as l,R as re,n as S}from"./3iSoGi4ic-D0mTJ0Mu.js";import{u as ue}from"./3iSoGi4ic-B1GPmOGN.js";import{aS as me,dx as ce,dy as ve,b as be,a7 as pe,ag as Ce,ab as z,R as N,M,cE as xe,ad as fe,dz as ge,bz as Ge}from"./3iSoGi4ic-DV-GuiCp.js";import"./3iSoGi4ic-D98_HDRS.js";const we=["src"],ye={class:"_buttons"},_e={class:"_gaps_s"},Re={class:"_gaps_s"},Ve=ae({__name:"MkEmbedCodeGenDialog",props:{entity:{},id:{},params:{}},emits:["ok","cancel","closed"],setup(F,{emit:j}){const W=j,i=F,E=V("dialogEl");function q(){W("cancel"),E.value?.close()}function K(){E.value?.close()}const G=u("input"),Z=h(()=>({header:w.value,maxHeight:typeof r.value=="number"?Math.max(0,r.value):void 0,colorMode:v.value==="auto"?void 0:v.value,rounded:y.value,border:_.value})),B=u(i.params??{}),P=h(()=>{const n=new URLSearchParams(ce(B.value));if(n.has("maxHeight")){const e=parseInt(n.get("maxHeight"));n.set("maxHeight",e===0?"500":Math.min(e,700).toString())}return`${ue}/embed/${i.entity}/${i.id}${n.toString()?"?"+n.toString():""}`}),D=h(()=>ve.includes(i.entity)),w=u(i.params?.header??!0),r=u(i.params?.maxHeight!==0?i.params?.maxHeight??null:500),{model:v,def:J}=me({items:[{value:"auto",label:"将深色模式与设备设置同步"},{value:"light",label:"浅色"},{value:"dark",label:"深色"}],initialValue:i.params?.colorMode??"auto"}),y=u(i.params?.rounded??!0),_=u(i.params?.border??!0);function Q(){const n=P.value;B.value={header:w.value,maxHeight:typeof r.value=="number"?Math.max(0,r.value):void 0,colorMode:v.value==="auto"?void 0:v.value,rounded:y.value,border:_.value},S(()=>{n===P.value&&f.value?.contentWindow?.window.location.reload()})}const R=u("");function X(){R.value=ge(`/embed/${i.entity}/${i.id}`,Z.value),G.value="result"}function Y(){Ge(R.value)}const b=V("resizerRootEl"),p=u(!0),f=V("iframeEl"),g=u(0),k=u(1),ee=h(()=>`translate(-50%, -50%) scale(${k.value})`),I=new ResizeObserver(()=>{A()});function te(){f.value?.contentWindow?.addEventListener("beforeunload",()=>{p.value=!0,S(()=>{g.value=0,k.value=1})})}function T(n){n.source===f.value?.contentWindow&&(n.data.type==="misskey:embed:ready"&&f.value.contentWindow?.postMessage({type:"misskey:embedParent:registerIframeId",payload:{iframeId:"embedCodeGen"}}),n.data.type==="misskey:embed:changeHeight"&&(g.value=n.data.payload.height,S(()=>{A(),p.value=!1})))}function A(){if(!b.value)return;const n=b.value.clientWidth-40,e=b.value.clientHeight-40,d=Math.min(n/500,e/g.value,1);k.value=d}oe(()=>{window.addEventListener("message",T),b.value&&I.observe(b.value)});function U(){window.removeEventListener("message",T),I.disconnect(),g.value=0,k.value=1,p.value=!0,R.value="",G.value="input"}return se(()=>{U()}),ne(()=>{U()}),(n,e)=>{const L=le("MkLoading");return c(),C(fe,{ref_key:"dialogEl",ref:E,width:1e3,height:600,scroll:!1,withOkButton:!1,onClose:e[5]||(e[5]=d=>q()),onClosed:e[6]||(e[6]=d=>W("closed"))},{header:o(()=>[e[7]||(e[7]=t("i",{class:"ti ti-code"},null,-1)),l(" "+s("自定义嵌入代码"),1)]),default:o(()=>[t("div",{class:"xr34D"},[m(ie,{mode:"out-in",enterActiveClass:"xuqV4",leaveActiveClass:"xwCKC",enterFromClass:"x9Os6",leaveToClass:"xm5OB"},{default:o(()=>[G.value==="input"?(c(),$("div",{key:"input",class:"xxnn2"},[t("div",{class:de(["xnRDy",H(be).s.animation?"xzqiE":null])},[p.value?(c(),C(L,{key:0,class:"xedog"},null,8,["class"])):x("",!0),t("div",{class:"xa19E"},[t("div",{class:"_acrylic xcrUt"},s("预览"),3),t("div",{ref_key:"resizerRootEl",ref:b,class:"xcEL8",inert:""},[t("div",{class:"x7sjh",style:O({transform:ee.value})},[t("iframe",{ref_key:"iframeEl",ref:f,src:P.value,class:"x46bw",style:O({height:`${g.value}px`}),onLoad:te},null,46,we)],6)],2)],2)],2),t("div",{class:"xDRgk _gaps"},[D.value?(c(),C(pe,{key:0,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=d=>r.value=d),type:"number",min:0},{label:o(()=>[l(s("最大高度"),1)]),suffix:o(()=>[...e[8]||(e[8]=[l("px",-1)])]),caption:o(()=>[l(s("若将最大值设为 0 则不限制最大高度。为防止小工具无限增高，建议设置一下。"),1)]),_:1},8,["modelValue"])):x("",!0),m(Ce,{modelValue:H(v),"onUpdate:modelValue":e[1]||(e[1]=d=>re(v)?v.value=d:null),items:H(J)},{label:o(()=>[l(s("主题"),1)]),_:1},8,["modelValue","items"]),D.value?(c(),C(z,{key:1,modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=d=>w.value=d)},{default:o(()=>[l(s("显示标题"),1)]),_:1},8,["modelValue"])):x("",!0),m(z,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=d=>y.value=d)},{default:o(()=>[l(s("圆角"),1)]),_:1},8,["modelValue"]),m(z,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=d=>_.value=d)},{default:o(()=>[l(s("外边框"),1)]),_:1},8,["modelValue"]),D.value&&(!r.value||r.value<=0)?(c(),C(N,{key:2,warn:""},{default:o(()=>[l(s("最大高度限制已禁用（0）。若这不是您想要的效果，请将最大高度设一个值。"),1)]),_:1})):x("",!0),typeof r.value=="number"&&(r.value<=0||r.value>700)?(c(),C(N,{key:3},{default:o(()=>[l(s("由于超出了预览画面可显示的范围，因此显示内容会与实际嵌入时有所不同。"),1)]),_:1})):x("",!0),t("div",ye,[m(M,{disabled:p.value,onClick:Q},{default:o(()=>[l(s("应用预览"),1)]),_:1},8,["disabled"]),m(M,{disabled:p.value,primary:"",onClick:X},{default:o(()=>[l(s("生成嵌入代码")+" ",1),e[9]||(e[9]=t("i",{class:"ti ti-arrow-right"},null,-1))]),_:1},8,["disabled"])])],2)],2)):G.value==="result"?(c(),$("div",{key:"result",class:"xbP3Z"},[t("div",{class:"xBC1b _gaps"},[t("div",_e,[t("div",{class:"x7PIt"},[...e[10]||(e[10]=[t("i",{class:"ti ti-check"},null,-1)])],2),t("div",{class:"xm1fD"},s("已生成代码"),3),t("div",{class:"xcrDm"},s("将生成的代码贴到网站上来使用。"),3)]),t("div",Re,[m(xe,{code:R.value,lang:"html",forceShow:!0,copyButton:!1,class:"xmbNv"},null,8,["code","class"]),m(M,{class:"xjAb5",rounded:"",primary:"",onClick:Y},{default:o(()=>[e[11]||(e[11]=t("i",{class:"ti ti-copy"},null,-1)),l(" "+s("复制"),1)]),_:1},8,["class"])]),m(M,{class:"xjAb5",rounded:"",transparent:"",onClick:K},{default:o(()=>[l(s("关闭"),1)]),_:1},8,["class"])],2)],2)):x("",!0)]),_:1},8,["enterActiveClass","leaveActiveClass","enterFromClass","leaveToClass"])],2)]),_:1},512)}}});export{Ve as default};
