const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DUMB4COq.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D0mTJ0Mu.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-B1GPmOGN.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DV-GuiCp.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Dty8GuTz.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-D98_HDRS.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-DZU1WGtr.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-9GwroBN9.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-Fx-BY70c.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Dkg-saem.css","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/scripts/3iSoGi4ic-DbFLP2ql.js","https://fastly.jsdelivr.net/gh/truimo-dev/misskey-built@latest/_frontend_vite_/assets/3iSoGi4ic-Box48UwB.css"])))=>i.map(i=>d[i]);
import{Q as G,R as x,M as h,bl as J,ab as z,ch as P,L as y,d as W,e as Q,a6 as U,A as H,C as B,W as X,k as D,b2 as Y,P as Z,az as ee,J as te,_ as ae}from"./3iSoGi4ic-DV-GuiCp.js";import{s as N,c as se,b as re}from"./3iSoGi4ic-DR2vO6TF.js";import{F as S}from"./3iSoGi4ic-BBsRrkiB.js";import{M as O}from"./3iSoGi4ic-Fx-BY70c.js";import{b as $,c as K,z as m,f as g,i as o,h as e,B as a,l as _,C as v,t as d,D as r,E as s,p as u,F,A as V,m as ne,k as ie,j as oe}from"./3iSoGi4ic-D0mTJ0Mu.js";import{F as le}from"./3iSoGi4ic-D8UyQ0ea.js";import{M as ce}from"./3iSoGi4ic-CdSqfJMx.js";import{M as de}from"./3iSoGi4ic-4oa2bN0A.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-Dv7rS4og.js";const ue={key:0,class:"_gaps_s"},fe={key:0,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},pe={key:0,class:"_gaps_s"},_e=["textContent"],ke={key:1,class:"_gaps_s"},me={class:"_gaps_s"},we={class:"_buttons"},ye=$({__name:"2fa",props:{first:{type:Boolean,default:!1}},setup(R){const c=G(),I=K(()=>c.usePasswordLessLogin??!1);async function L(){const n=await P();if(n.canceled)return;const i=await y("i/2fa/register",{password:n.result.password,token:n.result.token}),{dispose:l}=await W(Q(()=>import("./3iSoGi4ic-DUMB4COq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url).then(T=>T.default),{twoFactorData:i},{closed:()=>l()})}async function w(){const n=await P();n.canceled||y("i/2fa/unregister",{password:n.result.password,token:n.result.token}).then(i=>{U({twoFactorEnabled:!1})}).catch(i=>{H({type:"error",text:i})})}function f(){B({type:"question",title:"重置验证器",text:"当前验证器的验证码及备用代码已失效",okText:"重新配置",cancelText:"不用，谢谢"}).then(({canceled:n})=>{n||L()})}async function C(n){if((await B({type:"question",title:"删除安全密钥",text:(({name})=>("确定要删除 "+name+" 吗？"))({name:n.name})})).canceled)return;const l=await P();l.canceled||(await y("i/2fa/remove-key",{password:l.result.password,token:l.result.token,credentialId:n.id}),X())}async function k(n){const i=await D({title:"重命名",default:n.name,type:"text",minLength:1,maxLength:30});i.canceled||await y("i/2fa/update-key",{name:i.result,credentialId:n.id})}async function p(){const n=await P();if(n.canceled)return;const i=se({publicKey:await y("i/2fa/register-key",{password:n.result.password,token:n.result.token})}),l=await D({title:"注册安全密钥或 Passkey",text:"输入密钥名称",type:"text",minLength:1,maxLength:30});if(l.canceled)return;const T=await Y(re(i),null,()=>{},"请按照浏览器说明操作来注册安全密钥或 Passkey。");!T||(await P()).canceled||await y("i/2fa/key-done",{password:n.result.password,token:n.result.token,name:l.result,credential:T.toJSON()})}async function E(n){await y("i/2fa/password-less",{value:n})}return(n,i)=>{const l=m("SearchLabel"),T=m("SearchText"),M=m("SearchMarker"),A=m("MkTime"),j=m("I18n");return o(),g(M,{markerId:"2fa",keywords:["2fa"],children:["qCXM0HtJ7","3g1RePuD9","pFRud5u8k"]},{default:e(()=>[a(S,{first:R.first},{label:e(()=>[a(l,null,{default:e(()=>[r(s("双因素认证"),1)]),_:1})]),default:e(()=>[d(c)?(o(),_("div",ue,[d(c).twoFactorEnabled&&d(c).twoFactorBackupCodesStock==="partial"?(o(),g(x,{key:0,warn:""},{default:e(()=>[r(s("已使用备用代码。若验证器无法使用，请尽快重置验证器。"),1)]),_:1})):v("",!0),d(c).twoFactorEnabled&&d(c).twoFactorBackupCodesStock==="none"?(o(),g(x,{key:1,warn:""},{default:e(()=>[r(s("已使用完所有的备用代码。若验证器无法使用，则无法再访问您的账户。请重置验证器。"),1)]),_:1})):v("",!0),a(M,{keywords:["totp","app"],markerId:"qCXM0HtJ7","data-in-app-search-marker-id":"qCXM0HtJ7"},{default:e(()=>[a(O,{defaultOpen:!0},{icon:e(()=>[...i[1]||(i[1]=[u("i",{class:"ti ti-shield-lock"},null,-1)])]),label:e(()=>[a(l,null,{default:e(()=>[r(s("验证器"),1)]),_:1})]),caption:e(()=>[a(T,null,{default:e(()=>[r(s("使用验证器输入一次性密码"),1)]),_:1})]),suffix:e(()=>[d(c).twoFactorEnabled?(o(),_("i",fe)):v("",!0)]),default:e(()=>[d(c).twoFactorEnabled?(o(),_("div",pe,[u("div",{textContent:s("此设备已被注册")},null,8,_e),d(c).securityKeysList.length>0?(o(),_(F,{key:0},[a(h,{onClick:f},{default:e(()=>[r(s("重置验证器"),1)]),_:1}),a(x,null,{default:e(()=>[r(s("当注册了安全密钥时，无法取消使用验证器。"),1)]),_:1})],64)):(o(),g(h,{key:1,danger:"",onClick:w},{default:e(()=>[r(s("删除账户"),1)]),_:1}))])):d(c).twoFactorEnabled?v("",!0):(o(),_("div",ke,[a(h,{primary:"",gradate:"",onClick:L},{default:e(()=>[r(s("开始设置验证器"),1)]),_:1}),a(J,{url:"https://misskey-hub.net/docs/for-users/stepped-guides/how-to-enable-2fa/",target:"_blank"},{default:e(()=>[i[2]||(i[2]=u("i",{class:"ti ti-help-circle"},null,-1)),r(" "+s("更多信息"),1)]),_:1})]))]),_:1})]),_:1}),a(M,{keywords:["security","key","passkey"],markerId:"3g1RePuD9","data-in-app-search-marker-id":"3g1RePuD9"},{default:e(()=>[a(O,null,{icon:e(()=>[...i[3]||(i[3]=[u("i",{class:"ti ti-key"},null,-1)])]),label:e(()=>[a(l,null,{default:e(()=>[r(s("安全密钥或 Passkey"),1)]),_:1})]),default:e(()=>[u("div",me,[a(x,null,{default:e(()=>[r(s("注册兼容 WebAuthn 的密钥，例如支持 FIDO2 的硬件安全密钥、设备上的生物识别功能、PIN 以及 Passkey 等。"),1)]),_:1}),d(N)()?d(N)()&&!d(c).twoFactorEnabled?(o(),g(x,{key:1,warn:""},{default:e(()=>[r(s("要注册安全密钥或 Passkey，请先设置验证器。"),1)]),_:1})):(o(),_(F,{key:2},[a(h,{primary:"",onClick:p},{default:e(()=>[r(s("注册安全密钥或 Passkey"),1)]),_:1}),(o(!0),_(F,null,V(d(c).securityKeysList,b=>(o(),g(O,{key:b.id},{label:e(()=>[r(s(b.name),1)]),suffix:e(()=>[a(j,{src:"最后使用: {t}"},{t:e(()=>[a(A,{time:b.lastUsed},null,8,["time"])]),_:2},1032,["src"])]),default:e(()=>[u("div",we,[a(h,{onClick:q=>k(b)},{default:e(()=>[i[4]||(i[4]=u("i",{class:"ti ti-forms"},null,-1)),r(" "+s("重命名"),1)]),_:1},8,["onClick"]),a(h,{danger:"",onClick:q=>C(b)},{default:e(()=>[i[5]||(i[5]=u("i",{class:"ti ti-trash"},null,-1)),r(" "+s("删除账户"),1)]),_:1},8,["onClick"])])]),_:2},1024))),128))],64)):(o(),g(x,{key:0,warn:""},{default:e(()=>[r(s("您的浏览器不支持安全密钥。"),1)]),_:1}))])]),_:1})]),_:1}),a(M,{keywords:["password","less","key","passkey","login","signin"],markerId:"pFRud5u8k","data-in-app-search-marker-id":"pFRud5u8k"},{default:e(()=>[a(z,{disabled:!d(c).twoFactorEnabled||d(c).securityKeysList.length===0,modelValue:I.value,"onUpdate:modelValue":i[0]||(i[0]=b=>E(b))},{label:e(()=>[a(l,null,{default:e(()=>[r(s("无密码登录"),1)]),_:1})]),caption:e(()=>[a(T,null,{default:e(()=>[r(s("不使用密码，仅使用安全密钥或 Passkey 登录"),1)]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1})])):v("",!0)]),_:1},8,["first"])]),_:1})}}}),ge={class:"_gaps_m"},he={key:0,class:"ti ti-check icon succ"},Te={key:1,class:"ti ti-circle-x icon fail"},be={class:"ip _monospace"},Pe=$({__name:"security",setup(R){const c=ne(new Z("i/signin-history",{limit:5}));async function I(){const{canceled:w,result:f}=await D({title:"新密码",type:"password",autocomplete:"new-password"});if(w||f==null)return;const{canceled:C,result:k}=await D({title:"重新输入密码：",type:"password",autocomplete:"new-password"});if(C||k==null)return;if(f!==k){H({type:"error",text:"两次输入不一致！"});return}const p=await P();p.canceled||y("i/change-password",{currentPassword:p.result.password,token:p.result.token,newPassword:f})}async function L(){const w=await P();w.canceled||te("i/regenerate-token",{password:w.result.password,token:w.result.token})}return K(()=>[]),K(()=>[]),ee(()=>({title:"安全",icon:"ti ti-lock"})),(w,f)=>{const C=m("SearchText"),k=m("SearchLabel"),p=m("SearchMarker"),E=m("MkTime"),n=ie("panel");return o(),g(p,{path:"/settings/security",label:"安全",keywords:["security"],icon:"ti ti-lock",inlining:["2fa"],markerId:"5BjnxMfYV","data-in-app-search-marker-id":"5BjnxMfYV",children:["75QPEg57v","akN2Pdb9d","kTHaMxzD0"]},{default:e(()=>[u("div",ge,[a(de,{icon:"/client-assets/locked_with_key_3d.png",color:"#ffbf00"},{default:e(()=>[a(C,null,{default:e(()=>[r(s("可在此设置如密码、登入方式、验证器、Passkey 等账户安全性设置。"),1)]),_:1})]),_:1}),a(p,{keywords:["password"],markerId:"75QPEg57v","data-in-app-search-marker-id":"75QPEg57v",children:["CiHijRkGG"]},{default:e(()=>[a(S,{first:""},{label:e(()=>[a(k,null,{default:e(()=>[r(s("密码"),1)]),_:1})]),default:e(()=>[a(p,{markerId:"CiHijRkGG","data-in-app-search-marker-id":"CiHijRkGG"},{default:e(()=>[a(h,{primary:"",onClick:f[0]||(f[0]=i=>I())},{default:e(()=>[a(k,null,{default:e(()=>[r(s("修改密码"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ye),a(p,{keywords:["signin","login","history","log"],markerId:"akN2Pdb9d","data-in-app-search-marker-id":"akN2Pdb9d"},{default:e(()=>[a(S,null,{label:e(()=>[a(k,null,{default:e(()=>[r(s("登录历史"),1)]),_:1})]),default:e(()=>[a(ce,{paginator:d(c),withControl:"",forceDisableInfiniteScroll:!0},{default:e(({items:i})=>[u("div",null,[(o(!0),_(F,null,V(i,l=>oe((o(),_("div",{key:l.id,class:"timnmucd"},[u("header",null,[l.success?(o(),_("i",he)):(o(),_("i",Te)),u("code",be,s(l.ip),1),a(E,{time:l.createdAt,class:"time"},null,8,["time"])])])),[[n]])),128))])]),_:1},8,["paginator"])]),_:1})]),_:1}),a(p,{keywords:["regenerate","refresh","reset","token"],markerId:"kTHaMxzD0","data-in-app-search-marker-id":"kTHaMxzD0"},{default:e(()=>[a(S,null,{default:e(()=>[a(le,null,{caption:e(()=>[r(s("重新生成用于登录的内部令牌。通常您不需要这样做。重新生成后，您将在所有设备上登出。"),1)]),default:e(()=>[a(h,{danger:"",onClick:L},{default:e(()=>[f[1]||(f[1]=u("i",{class:"ti ti-refresh"},null,-1)),f[2]||(f[2]=r()),a(k,null,{default:e(()=>[r(s("重新生成登录令牌"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["label"])}}}),Re=ae(Pe,[["__scopeId","data-v-42ef2882"]]);export{Re as default};
