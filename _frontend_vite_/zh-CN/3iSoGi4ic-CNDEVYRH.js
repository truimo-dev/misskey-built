import{aS as W,az as z,R as M,ag as O,a7 as T,ab as h,M as k,l as J,C as Y,J as y,L as g}from"./3iSoGi4ic-DV-GuiCp.js";import{_ as E}from"./3iSoGi4ic-Dz5OvLqt.js";import{M as j}from"./3iSoGi4ic-Fx-BY70c.js";import{M as q}from"./3iSoGi4ic-BDF7xMl0.js";import{b as G,a as C,w as K,c as b,z as w,f as m,i as r,h as a,p as o,B as u,C as p,l as v,D as n,E as s,t as A,R as Q,F as I,A as X}from"./3iSoGi4ic-D0mTJ0Mu.js";import"./3iSoGi4ic-B1GPmOGN.js";import"./3iSoGi4ic-D98_HDRS.js";import"./3iSoGi4ic-CZYXc2mx.js";const Z={class:"_spacer",style:{"--MI_SPACER-w":"900px"}},ee={class:"_gaps"},te={key:0,class:"ti ti-info-circle"},le={key:1,class:"ti ti-alert-triangle",style:{color:"var(--MI_THEME-warn)"}},ae={key:2,class:"ti ti-circle-x",style:{color:"var(--MI_THEME-error)"}},se={key:3,class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}},ie={class:"_buttons"},oe={class:"_gaps"},de={value:"normal"},ne={value:"banner"},re={value:"dialog"},ue={key:1},xe=G({__name:"announcements",setup(ce){const{model:f,def:R}=W({items:[{label:"活动",value:"active"},{label:"已归档",value:"archived"}],initialValue:"active"}),_=C(!0),x=C(!1),c=C([]);K(f,i=>{_.value=!0,y("admin/announcements/list",{status:i}).then(l=>{c.value=l,_.value=!1})},{immediate:!0});function S(){c.value.unshift({_id:J(),id:null,title:"New announcement",text:"",imageUrl:null,icon:"info",display:"normal",forExistingUsers:!1,silence:!1,needConfirmationToRead:!1})}function B(i){Y({type:"warning",text:(({x})=>("要删掉「"+x+"」吗？"))({x:i.title})}).then(({canceled:l})=>{l||(c.value=c.value.filter(V=>V!==i),y("admin/announcements/delete",i))})}async function D(i){await g("admin/announcements/update",{...i,isActive:!1}),U()}async function H(i){await g("admin/announcements/update",{...i,isActive:!0}),U()}async function P(i){i.id==null?(await g("admin/announcements/create",i),U()):g("admin/announcements/update",i)}function N(){x.value=!0,y("admin/announcements/list",{status:f.value,untilId:c.value.reduce((i,l)=>l.id!=null?l:i).id}).then(i=>{c.value=c.value.concat(i),x.value=!1})}function U(){_.value=!0,y("admin/announcements/list",{status:f.value}).then(i=>{c.value=i,_.value=!1})}const $=b(()=>[{asFullButton:!0,icon:"ti ti-plus",text:"添加",handler:S,disabled:f.value==="archived"}]),F=b(()=>[]);return z(()=>({title:"公告",icon:"ti ti-speakerphone"})),(i,l)=>{const V=w("MkLoading"),L=w("PageWithHeader");return r(),m(L,{actions:$.value,tabs:F.value},{default:a(()=>[o("div",Z,[o("div",ee,[u(M,null,{default:a(()=>[n(s("因可能损坏新用户的 UX 体验，建议将通知用于发布具有时效性的信息，而不是用于长期展示的信息。"),1)]),_:1}),c.value.length>5?(r(),m(M,{key:0,warn:""},{default:a(()=>[n(s("若有大量活动公告，可能会造成用户体验下降。请考虑归档已完成的公告。"),1)]),_:1})):p("",!0),u(O,{modelValue:A(f),"onUpdate:modelValue":l[0]||(l[0]=e=>Q(f)?f.value=e:null),items:A(R)},{label:a(()=>[n(s("筛选"),1)]),_:1},8,["modelValue","items"]),_.value?(r(),m(V,{key:1})):(r(),v(I,{key:2},[(r(!0),v(I,null,X(c.value,e=>(r(),m(j,{key:e.id??e._id,defaultOpen:e.id==null},{label:a(()=>[n(s(e.title),1)]),icon:a(()=>[e.icon==="info"?(r(),v("i",te)):e.icon==="warning"?(r(),v("i",le)):e.icon==="error"?(r(),v("i",ae)):e.icon==="success"?(r(),v("i",se)):p("",!0)]),caption:a(()=>[n(s(e.text),1)]),footer:a(()=>[o("div",ie,[u(k,{rounded:"",primary:"",onClick:d=>P(e)},{default:a(()=>[l[2]||(l[2]=o("i",{class:"ti ti-device-floppy"},null,-1)),n(" "+s("保存"),1)]),_:1},8,["onClick"]),e.id!=null&&e.isActive?(r(),m(k,{key:0,rounded:"",onClick:d=>D(e)},{default:a(()=>[l[3]||(l[3]=o("i",{class:"ti ti-check"},null,-1)),n(" "+s("结束公告")+" ("+s("归档")+")",1)]),_:1},8,["onClick"])):p("",!0),e.id!=null&&!e.isActive?(r(),m(k,{key:1,rounded:"",onClick:d=>H(e)},{default:a(()=>[l[4]||(l[4]=o("i",{class:"ti ti-restore"},null,-1)),n(" "+s("取消归档"),1)]),_:1},8,["onClick"])):p("",!0),e.id!=null?(r(),m(k,{key:2,rounded:"",danger:"",onClick:d=>B(e)},{default:a(()=>[l[5]||(l[5]=o("i",{class:"ti ti-trash"},null,-1)),n(" "+s("删除"),1)]),_:1},8,["onClick"])):p("",!0)])]),default:a(()=>[o("div",oe,[u(T,{modelValue:e.title,"onUpdate:modelValue":d=>e.title=d},{label:a(()=>[n(s("标题"),1)]),_:1},8,["modelValue","onUpdate:modelValue"]),u(q,{modelValue:e.text,"onUpdate:modelValue":d=>e.text=d,mfmAutocomplete:"",mfmPreview:!0},{label:a(()=>[n(s("文本"),1)]),_:1},8,["modelValue","onUpdate:modelValue"]),u(T,{modelValue:e.imageUrl,"onUpdate:modelValue":d=>e.imageUrl=d,type:"url"},{label:a(()=>[n(s("图片 URL"),1)]),_:1},8,["modelValue","onUpdate:modelValue"]),u(E,{modelValue:e.icon,"onUpdate:modelValue":d=>e.icon=d},{label:a(()=>[n(s("头像"),1)]),default:a(()=>[l[6]||(l[6]=o("option",{value:"info"},[o("i",{class:"ti ti-info-circle"})],-1)),l[7]||(l[7]=o("option",{value:"warning"},[o("i",{class:"ti ti-alert-triangle",style:{color:"var(--MI_THEME-warn)"}})],-1)),l[8]||(l[8]=o("option",{value:"error"},[o("i",{class:"ti ti-circle-x",style:{color:"var(--MI_THEME-error)"}})],-1)),l[9]||(l[9]=o("option",{value:"success"},[o("i",{class:"ti ti-check",style:{color:"var(--MI_THEME-success)"}})],-1))]),_:1},8,["modelValue","onUpdate:modelValue"]),u(E,{modelValue:e.display,"onUpdate:modelValue":d=>e.display=d},{label:a(()=>[n(s("显示"),1)]),default:a(()=>[o("option",de,s("正常"),1),o("option",ne,s("横幅"),1),o("option",re,s("对话框"),1)]),_:1},8,["modelValue","onUpdate:modelValue"]),e.display==="dialog"?(r(),m(M,{key:0,warn:""},{default:a(()=>[n(s("同时存在 2 个或以上的对话框公告极有可能对用户体验产生负面的影响，建议谨慎使用。"),1)]),_:1})):p("",!0),u(h,{modelValue:e.forExistingUsers,"onUpdate:modelValue":d=>e.forExistingUsers=d,helpText:"若启用，该公告将仅对创建此公告时存在的用户可见。 如果禁用，则在创建此公告后注册的用户也可以看到该公告。"},{default:a(()=>[n(s("仅限现有用户"),1)]),_:1},8,["modelValue","onUpdate:modelValue","helpText"]),u(h,{modelValue:e.silence,"onUpdate:modelValue":d=>e.silence=d,helpText:"开启后，此条公告将不会发送通知，也不强制用户阅读。"},{default:a(()=>[n(s("不发送通知"),1)]),_:1},8,["modelValue","onUpdate:modelValue","helpText"]),u(h,{modelValue:e.needConfirmationToRead,"onUpdate:modelValue":d=>e.needConfirmationToRead=d,helpText:"若启用，则会在标记已读时会显示确认对话框。此外，它也会不受批量已读操作的影响。"},{default:a(()=>[n(s("需要确认才能标记为已读"),1)]),_:1},8,["modelValue","onUpdate:modelValue","helpText"]),e.reads?(r(),v("p",ue,s((({n})=>(n+"人已读"))({n:e.reads})),1)):p("",!0)])]),_:2},1032,["defaultOpen"]))),128)),x.value?(r(),m(V,{key:0})):p("",!0),u(k,{onClick:l[1]||(l[1]=e=>N())},{default:a(()=>[l[10]||(l[10]=o("i",{class:"ti ti-reload"},null,-1)),n(s("更多！"),1)]),_:1})],64))])])]),_:1},8,["actions","tabs"])}}});export{xe as default};
