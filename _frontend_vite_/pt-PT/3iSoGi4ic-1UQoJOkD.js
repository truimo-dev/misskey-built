import{c as M}from"./3iSoGi4ic-B1GPmOGN.js";import{i as b,$ as l,J as N,M as c,b2 as B,A as T,b3 as U,L as A}from"./3iSoGi4ic-DV-GuiCp.js";import{b as K,a as d,f,C as O,i as w,h as y,D as g,E as h,t as P}from"./3iSoGi4ic-D0mTJ0Mu.js";const E=K({__name:"MkPushNotificationAllowButton",props:{primary:{type:Boolean},gradate:{type:Boolean},rounded:{type:Boolean},inline:{type:Boolean},link:{type:Boolean},to:{},autofocus:{type:Boolean},wait:{type:Boolean},danger:{type:Boolean},full:{type:Boolean},showOnlyToRegister:{type:Boolean}},setup(e,{expose:C}){const u=d(),r=d(!1),i=d(null),a=d();async function D(){if(!(!u.value||!r.value||!b.swPublickey)){if("Notification"in window){let t=Notification.permission;if(Notification.permission==="default"&&(t=await B(Notification.requestPermission(),null,null,"Please enable push notifications in your browser")),t!=="granted"){T({type:"error",title:"Failed to acquire permission to send notifications",text:(({serverName})=>("You do not have permission to send notifications from "+serverName+". Please allow notifications in your browser settings and try again."))({serverName:M})});return}}await B(u.value.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:x(b.swPublickey)}).then(async t=>{i.value=t,a.value=await N("sw/register",{endpoint:t.endpoint,auth:p(t.getKey("auth")),publickey:p(t.getKey("p256dh"))})},async t=>{if(t?.name==="NotAllowedError"){console.info("User denied the notification permission request.");return}await m()}),null,null)}}async function m(){if(!i.value)return;const t=i.value.endpoint,n=await U();a.value=void 0,l&&n.length>=2?A("sw/unregister",{endpoint:t},l.token):(i.value.unsubscribe(),A("sw/unregister",{endpoint:t},null),i.value=null)}function p(t){return btoa(String.fromCharCode.apply(null,t?new Uint8Array(t):[]))}function x(t){const n="=".repeat((4-t.length%4)%4),S=(t+n).replace(/-/g,"+").replace(/_/g,"/"),v=window.atob(S),k=new Uint8Array(v.length);for(let s=0;s<v.length;++s)k[s]=v.charCodeAt(s);return k}return navigator.serviceWorker==null||navigator.serviceWorker.ready.then(async t=>{if(u.value=t,i.value=await u.value.pushManager.getSubscription(),b.swPublickey&&"PushManager"in window&&l&&l.token&&(r.value=!0,i.value)){const n=await N("sw/show-registration",{endpoint:i.value.endpoint});n&&(a.value=n)}}),C({pushRegistrationInServer:a}),(t,n)=>r.value&&!a.value?(w(),f(c,{key:0,type:"button",primary:"",gradate:e.gradate,rounded:e.rounded,inline:e.inline,autofocus:e.autofocus,wait:e.wait,full:e.full,onClick:D},{default:y(()=>[g(h("Ativar notificações push"),1)]),_:1},8,["gradate","rounded","inline","autofocus","wait","full"])):!e.showOnlyToRegister&&(P(l)?a.value:i.value)?(w(),f(c,{key:1,type:"button",primary:!1,gradate:e.gradate,rounded:e.rounded,inline:e.inline,autofocus:e.autofocus,wait:e.wait,full:e.full,onClick:m},{default:y(()=>[g(h("Desativar notificações push"),1)]),_:1},8,["gradate","rounded","inline","autofocus","wait","full"])):P(l)&&a.value?(w(),f(c,{key:2,disabled:"",rounded:e.rounded,inline:e.inline,wait:e.wait,full:e.full},{default:y(()=>[g(h("Notificações push já estão habilitadas"),1)]),_:1},8,["rounded","inline","wait","full"])):r.value?O("",!0):(w(),f(c,{key:3,disabled:"",rounded:e.rounded,inline:e.inline,wait:e.wait,full:e.full},{default:y(()=>[g(h("Seu navegador ou instância não tem suporte às notificações push"),1)]),_:1},8,["rounded","inline","wait","full"]))}});export{E as _};
