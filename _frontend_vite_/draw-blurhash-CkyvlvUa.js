function g(t){let r=0;for(let o=0;o<t.length;o++)r=r*83+"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~".indexOf(t[o]);return r}function F(t,r){return Math.cos(Math.PI*t/r)}function M(t,r){r[0]=A(t>>16),r[1]=A(t>>8&255),r[2]=A(t&255)}function A(t){const r=t/255;return r<=.04045?r/12.92:((r+.055)/1.055)**2.4}function X(t,r,o){r[0]=R(Math.floor(t/361))*o,r[1]=R(Math.floor(t/19)%19)*o,r[2]=R(t%19)*o}function R(t){const r=(t-9)/9;return Math.sign(r)*Math.abs(r)**2}function w(t,r,o=1){const l=g(t[0]),c=l%9+1,n=(l-c+1)/9+1,U=(g(t[1])+1)/166*o,u=new Float32Array(3*c*n);for(let a=0;a<c*n;a++)a?X(g(t.slice(a*2+4,a*2+6)),u.subarray(a*3,(a+1)*3),U):M(g(t.slice(2,6)),u.subarray(0,3));const T=new Float32Array(c*n*3);for(let a=0;a<c*n;a++){const m=a%c,p=n-1-(a-m)/c,D=T.subarray(a*3,(a+1)*3);for(let s=0;s<n;s++){const y=F(s*p,n);for(let f=0;f<c;f++){const I=y*F(f*m,c),L=u.subarray(s*c*3+f*3,s*c*3+(f+1)*3);for(let d=0;d<3;d++)D[d]+=L[d]*I}}}const e=r.getContext("webgl2"),h=e.createShader(e.VERTEX_SHADER);e.shaderSource(h,`#version 300 es
in vec2 a;in vec2 b;out vec2 c;void main(){gl_Position=vec4(a,0.,1.);c=b;}`),e.compileShader(h);const b=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(b,`#version 300 es
precision mediump float;in vec2 c;uniform sampler2D d;out vec4 e;vec3 f(vec3 a,vec3 b,vec3 c,vec3 d,float e){float f=e*e,g=f*e;return(d/2.-c*3./2.+b*3./2.-a/2.)*g+(a-b*5./2.+c*2.-d/2.)*f+(c/2.-a/2.)*e+b;}void main(){vec2 g=vec2(${c},${n}),h=c*g+vec2(1.,0.),i=fract(h);h=(floor(h)-.5)/g;vec3 k=f(f(texture(d,h+vec2(-1.)/g).rgb,texture(d,h+vec2(0.,-1.)/g).rgb,texture(d,h+vec2(1.,-1.)/g).rgb,texture(d,h+vec2(2.,-1.)/g).rgb,i.x),f(texture(d,h+vec2(-1.,0.)/g).rgb,texture(d,h).rgb,texture(d,h+vec2(1.,0.)/g).rgb,texture(d,h+vec2(2.,0.)/g).rgb,i.x),f(texture(d,h+vec2(-1.,1.)/g).rgb,texture(d,h+vec2(0.,1.)/g).rgb,texture(d,h+vec2(1.)/g).rgb,texture(d,h+vec2(2.,1.)/g).rgb,i.x),f(texture(d,h+vec2(-1.,2.)/g).rgb,texture(d,h+vec2(0.,2.)/g).rgb,texture(d,h+vec2(1.,2.)/g).rgb,texture(d,h+vec2(2.)/g).rgb,i.x),i.y),l=pow(abs(k),vec3(1./2.4))*1.055-vec3(.055);l=mix(k*12.92,l,step(.0031308,k));e=vec4(l,1.);}`),e.compileShader(b);const i=e.createProgram();e.attachShader(i,h),e.attachShader(i,b),e.linkProgram(i),e.useProgram(i);const E=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,E),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW);const x=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,x),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),e.STATIC_DRAW);const v=e.getAttribLocation(i,"a");e.enableVertexAttribArray(v),e.bindBuffer(e.ARRAY_BUFFER,E),e.vertexAttribPointer(v,2,e.FLOAT,!1,0,0);const _=e.getAttribLocation(i,"b");e.enableVertexAttribArray(_),e.bindBuffer(e.ARRAY_BUFFER,x),e.vertexAttribPointer(_,2,e.FLOAT,!1,0,0);const B=e.createTexture();e.bindTexture(e.TEXTURE_2D,B),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,e.RGB16F,c,n,0,e.RGB,e.FLOAT,T),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);const S=e.getUniformLocation(i,"d");e.uniform1i(S,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)}const P=new OffscreenCanvas(64,64);onmessage=t=>{if(!("id"in t.data&&typeof t.data.id=="string")||!("hash"in t.data&&typeof t.data.hash=="string"))return;w(t.data.hash,P);const r=P.transferToImageBitmap();self.postMessage({id:t.data.id,bitmap:r},[r])};
